define("dropbox",["external/flash_detect","external/keymaster","external/modernizr","external/plupload_dev","external/purify","external/react","external/react-dom","external/underscore","jquery","libs","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/stacked_avatars","modules/clean/base64","modules/clean/browse/browse_drag_utils","modules/clean/browse_events","modules/clean/browse_interface","modules/clean/clipboard","modules/clean/contacts/cache_store","modules/clean/contacts/facebook_modal","modules/clean/contacts/facebook_oauth","modules/clean/contacts/list","modules/clean/contacts/types","modules/clean/css","modules/clean/datetime","modules/clean/dbmodal","modules/clean/deprecated/dbmodal_loading","modules/clean/deprecated/uirequest","modules/clean/display_format","modules/clean/downloads","modules/clean/em_string","modules/clean/event_load","modules/clean/events/rollback","modules/clean/file_events","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/form","modules/clean/frame_messenger","modules/clean/gandalf_util","modules/clean/groups/api","modules/clean/history","modules/clean/image_size","modules/clean/job_progress","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/legacy_pyxl_controllers/bubble_picker","modules/clean/legacy_pyxl_controllers/role_picker","modules/clean/multiaccount_login","modules/clean/notserver","modules/clean/page_role_observer","modules/clean/pagination_manager","modules/clean/payments/cash","modules/clean/payments/dfb_util","modules/clean/photos/legacy_thumb_loader","modules/clean/previews/pdf_loader","modules/clean/previews/util","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/react/browse/constants","modules/clean/react/file_viewer/controller","modules/clean/react/modal","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_linkfile","modules/clean/search/search_helpers","modules/clean/search/search_type","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/share_modal_util","modules/clean/sharing/shared_content_link_sync_modal","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/ui_util","modules/clean/sprite","modules/clean/sso_login_checks","modules/clean/static_urls","modules/clean/teams/modals/suggest_team_invite_modal","modules/clean/teams/team_folder_modal","modules/clean/top_notif","modules/clean/undo","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/debug","modules/constants/env","modules/constants/file_viewer","modules/constants/legacy","modules/constants/page_load","modules/constants/python","modules/constants/request","modules/constants/shared_link_folder","modules/constants/static","modules/constants/teams","modules/constants/time","modules/core/browser","modules/core/controller_helpers","modules/core/cookies","modules/core/dom","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","require"],function(e,t,n,i,s,o,r,a,l,u,_,c,d,h,m,f,p,v,g,w,b,y,k,x,E,C,T,S,D,A,N,I,R,O,L,M,j,F,U,q,P,z,B,H,Y,W,V,K,G,J,X,Z,Q,ee,te,ne,ie,se,oe,re,ae,le,ue,_e,ce,de,he,me,fe,pe,ve,ge,we,be,ye,ke,xe,Ee,Ce,Te,Se,De,$e,Ae,Ne,Ie,Re,Oe,Le,Me,je,Fe,Ue,qe,Pe,ze,Be,He,Ye,We,Ve,Ke,Ge,Je){var Xe,Ze={},Qe=_.EmailVerification,et=b.DefaultContactsCacheStore,tt=b.LegacyContactsCacheStore,nt=S.DBModal,it=S.DBModalStack,st=(S.DBUserModal,H.image_best_fit_size,Y.Job),ot=Y.ModalProgress,rt=K.RolePickerState,at=(J.NotServer,J.NotClients,Q.CashUtil,ee.DfBTransitionInfoFetcher,oe.LinkedProfileServices),lt=oe.ProfileServicesLinkingHandler,ut=(re.FileTypes,re.SharedWithActionTypes,le.SimpleModal,_e.PreviewLinkfile,he.SharingApi,me.FolderShareApiClient,pe.ContentInfo,ve.showShareModal),assert=(Te.TopNotificationBar,Ye.SEVERITY,Ye.assert),reportStack=Ye.reportStack,reportException=Ye.reportException,_t=Ve.ungettext,ct=Ve._;Ve.N_,Ve.E_,Ve.render_sentences;INLINE_JS.$=$,INLINE_JS.$u=a,Function.prototype.defer=Function.prototype.defer.wrap(function(e){var t;return t=$A(arguments).slice(1),e.apply(this,t)}),String.prototype.evalScripts=String.prototype.evalScripts.wrap(function(e){var t,n;t=$A(arguments).slice(1);try{return e.apply(this,t)}catch(e){return n=e,assert(0,n.toString())}}),Xe={cache:{},set:function(e,t,n){var i;return i=Xe.cache[e],null==i&&(i=Xe.cache[e]={}),i.value=t,i.expires=n?(new Date).getTime()+n:0},get:function(e){var t;return t=Xe.cache[e],null==t||(new Date).getTime()>t.expires?(delete Xe.cache[e],!1):t.value}},Function.prototype.cached=function(e){var t,n;return monkey_check(),n=Math.random(),t=this,function(){var i;return i=Xe.get(n),i!==!1?i:(i=t(),Xe.set(n,i,e),i)}},Array.prototype.sort_by_key=function(e,t){var n;return null==t&&(t=!1),monkey_check(),n=t?-1:1,this.sort(function(t,i){return t=e(t),i=e(i),t<i?n*-1:t>i?1*n:0})},Array.prototype.contains=function(e){return monkey_check(),this.indexOf(e)!==-1},Array.prototype.remove=function(e,t){return monkey_check(),t=t||e+1,this.splice(e,t-e)},Array.prototype.removeItem=function(e){var t;return monkey_check(),t=this.indexOf(e),t>=0&&this.remove(t)},Array.prototype.dict_by=function(e){var t,n,i,s;for(monkey_check(),s={},t=n=0,i=this.length;n<i;t=++n)this[t],s[this[t][e]]=this[t];return s},Array.prototype.unique=function(){var e,t,n,i,s;for(monkey_check(),e={},n=0,i=this.length;n<i;n++){if(t=this[n],"string"!=typeof t)return this;e[t]=0}s=[];for(t in e)s.push(t);return s},String.prototype.widthSplit=function(e){var t,n,i,s;for(null==e&&(e=15),monkey_check(),t=[],n=this,s=0,i=n.substring(s,s+e);""!==i;)t.push(i),s+=e,i=n.substring(s,s+e);return t},Object.extend(Effect.Transitions,{EaseIn:function(e){return Math.pow(e,2)},EaseOut:function(e){return Math.pow(e,.5)}}),(function(e){var t;return t=function(e){var t,n,i,s,o,r,a,l,u;if(e)if(Object.isArray(e)){for(t=[],i=0,o=e.length;i<o;i++)n=e[i],t.push(We.escape(n).toHTML());e=new We(t.join(""))}else if(e.top||e.bottom||e.before||e.after)for(l=["top","bottom","before","after"],s=0,r=l.length;s<r;s++)a=l[s],u=e[a],u&&(e[a]=arguments.callee(u));else ht.isElm(e)||e.toElement||e.toHTML||(e=We.escape(e));return e},Element.addMethods({db_observe:function(e,t,n){return monkey_check(),e.observe(t,function(t){return n(t,e)})},smoothScrollIntoView:function(e,t){var n,i,s,o,r,a;if(null==t&&(t={}),monkey_check(),n={duration:.3,offset:0,padding:0,transition:Effect.Transitions.EaseOut},t=Object.extend(n,t),s=e.viewportOffset(e),i=e.getDimensions(),a=document.viewport.getDimensions(),r=t.padding||0,!(s.top>r&&s.top+i.height<a.height-r))return o=s.top<r?-1*Math.floor(a.height/4):-1*Math.floor(3*a.height/4),t.offset=t.offset||o,new Effect.ScrollTo(e,t)},__sert:function(e,n){return Element.insert(e,t(n))},__date:function(e,n){return Element.update(e,t(n))},replace:function(n,i){return e(n,t(i))}})})(Element.replace),String.prototype.lpad=function(e,t){var n;for(null==t&&(t="0"),monkey_check(),n=this;n.length<e;)n=t+n;return n.toString()},String.prototype.reverse=function(){var e,t;return monkey_check(),t=this.split(""),e=t.reverse(),e.join("")},String.prototype.count=function(e){return monkey_check(),(this.length-this.gsub(e,"").length)/e.length},String.prototype.repeat=function(e){return monkey_check(),new Array(e+1).join(this)},String.prototype.title=function(){return monkey_check(),this.charAt(0).toUpperCase()+this.substr(1)},Ajax.DBRequest=Class.create(Ajax.Request,{initialize:function($super,e,t){var n,i,s,o,r,a,u,_,c,d,h,m,f,p,v;if(null==t&&(t={}),monkey_check(),this.orig_req={url:e,options:t},this.start_time=T.time(),t.method=t.method||"post",t.evalJS=!1,t.suppress_nonstandard_headers=!0,t.parameters=t.parameters||{},t.parameters.t=Be.read(Me.JS_CSRF_COOKIE),t.parameters.is_xhr=!0,("post"===t.method.toLowerCase()||Ae.CPROFILE_ENABLED)&&(t.parameters.parent_request_id=Me.REQUEST_ID),Ae.CPROFILE_ENABLED&&(t.parameters.cProfile=Ae.CPROFILE_PARAMETER),Oe.PUBLIC_MODE_OVERRIDE&&(t.parameters.public_mode_override="1"),Oe.COUNTRY_OVERRIDE&&(t.parameters.public_mode_override=Oe.COUNTRY_OVERRIDE),Ajax.DBRequest.restrict&&(t.parameters.restrict=Ajax.DBRequest.restrict),i=t.cleanUp||function(){},this.subject_user=t.subject_user||t.job_user,t.job&&(this.job_id=ht.nonce(),t.parameters.job_id=this.job_id,cn.watch(this,t.dont_hide_progress_on_complete)),t.no_watch||ft.watch(this,!!t.job),d=t.onFailure,h=t.onSuccess,c=t.onComplete,_=(function(e){return function(n){var i;return!(t.parameters.xhr_retry||!t.allow_retries)&&((0===(i=n.status)||500===i||502===i||503===i)&&(e.orig_req.options.parameters.xhr_retry=!0,e.orig_req.options.onFailure=d,e.orig_req.options.onSuccess=h,new Ajax.DBRequest(e.orig_req.url,e.orig_req.options),!0))}})(this),t.onFailure=function(e){var n,s;if(!st.handled(e.request.job_id)&&!_(e))return t.noAutonotify||Ke.error(ct("There was a problem completing this request.")),i(!1),d&&d(e),403===e.status&&(s=ht.session_storage_get("reload-timestamp"),(!s||T.time()-s>3e4)&&(ht.session_storage_set("reload-timestamp",T.time()),location.reload(!0))),assert(t.noAutonotify||403===(n=e.status)||404===n||502===n,"Ajax "+e.status+" on "+e.request.url)},t.onComplete=(function(e){return function(e){if(e.responseText.length&&c&&0!==e.responseText.indexOf("async_task_started:"))return c(e)}})(this),t.onSuccess=(function(n){return function(s){var o,r,a,u,c,m,f,p,v,g,w,b,y,k,x,E,C;if(C=T.time()-s.request.start_time,!st.handled(s.request.job_id)){if(s.responseText.length){if(0===s.responseText.indexOf("err:"))t.noAutonotify||(p=s.responseText.substr(4),t.html_in_error_msg&&(p=new We(p)),Ke.error(p)),d&&d(s);else if(0===s.responseText.indexOf("async_task_started:")?(n.async_task_id=s.responseText.split(":")[1],cn.watch(n)):h&&(0===s.responseText.indexOf("ok:")&&Ke.success(s.responseText.substr(3)),h(s)),E=s.getHeader("X-Server-Response-Time")||"-1",t.log_timing&&$e.log_ajax_transition.defer(C,void 0,void 0,void 0,E,e=dt.absolutize(n.url)),r=l("#cprofile"),!t.no_watch&&r.length){if(y=Me.REQUEST_ID+"-"+s.getHeader("X-Dropbox-Request-Id"),e=s.request.url.replace(/[^\/]*\/\/[^\/]+/,"").replace(/\?.*$/,""),g={request_id:y},b=s.request.url,b.indexOf("dl-web.dropbox.com")!==-1)g.block=1;else for(w=Ne.BATCH_THUMB_ENDPOINTS,m=0,f=w.length;m<f;m++)if(c=w[m],b.indexOf(c)!==-1){g.block=1;break}o=function(e,t,n,i){var s;return s=l(i?'<a target="_blank" />':"<a />"),s.attr("href",String(Ge({authority:"www.dropbox.com",path:t,query:n}))).text(e+" ")},v=[["svg","/profile/cprofile/svg",!0],["pstats","/profile/cprofile/pstats",!1],["callgrind","/profile/cprofile/callgrind",!1],["IO","/profile/ioprofile",!0],["DB","/profile/dbprofile",!0]],x=(function(){var e,t,n;for(n=[],e=0,t=v.length;e<t;e++)a=v[e],n.push(o(a[0],a[1],g,a[2]));return n})(),k=l('<div class="ajax">').text("Ajax: "+e+" ("+E+"ms)").prepend(x),u=r.find(".ajax"),u.length>=10&&u.last().remove(),r.prepend(k)}}else if(!t.job){if(_(s))return;p=ct("There was a problem completing this request."),t.noAutonotify||s&&0===s.status||Ke.error(p),d&&d(s)}return i(!0)}}})(this),t.onException=function(t,n){if(window.console)throw n;return"Error with AJAX callback for: "+e+" :::: "+n.toString(),reportException({err:n})},t.job&&(e+=(e.indexOf("?")===-1?"?":"&")+"long_running=1"),t.subject_user&&!(null!=(f=t.parameters)?f._subject_uid:void 0)&&(e=Ge.parse(e).updateQuery("_subject_uid",t.subject_user).toString()),n=$H({url:e}),t.parameters){for(n.update(t.parameters),p=n.keys(),s=0,a=p.length;s<a;s++)for(r=p[s],v=["passwd","password","oauth","ccn","host_id"],o=0,u=v.length;o<u;o++)m=v[o],r.indexOf(m)!==-1&&n.unset(r);n.unset("t")}return t.onSuccess.__tb_ajax_info__=t.onFailure.__tb_ajax_info__=Object.toJSON(n),$super(e,t)}}),void 0!==t&&null!==t&&Object.extend(t,{main_modifier:function(){return monkey_check(),ht.is_mac()?decodeURIComponent("%E2%8C%98"):"ctrl"}}),INLINE_JS.$j=l;var dt,ht;ht=INLINE_JS.Util=Ze.Util={scroll_to_thumb:function(e){var t,n,i,s;if(n=e.cumulativeOffset().top,t=e.getHeight(),s=He.scroll_offsets().top,i=He.viewport_dimensions().height,n<s||n+t>s+i)return He.scroll_to(0,n-i/2)},decode_sort_key:function(e){var t,n,i,s;for(s=[],n=0,i=e.length;n<i;n++)t=e[n],"string"==typeof t?s.push(f.decode(t)):s.push(t);return s},sort_by_rank_or_key:function(e,t){return null!=e.sort_rank&&null!=t.sort_rank?e.sort_rank-t.sort_rank:(assert(null!=e.sort_key&&null!=t.sort_key,"expected sort keys on both elms"),this._sort_by_key(e,t))},sort_by_key:function(e,t){return this._sort_by_key(e,t)},_sort_by_key:function(e,t){var n,i,s,o,r;for(o=e.sort_key,r=t.sort_key,n=i=0,s=o.length;0<=s?i<s:i>s;n=0<=s?++i:--i){if(null==r[n])return 1;if(typeof o[n]!=typeof r[n])return"string"==typeof o[n]?1:-1;if(o[n]!==r[n])return o[n]>r[n]?1:-1}return r.length>o.length?-1:0},add_sort_arrow_mouseover:function(e,t,n,i){var s,o,r,a,l;for(a=$$(n),l=[],s=0,o=a.length;s<o;s++)r=a[s],l.push((function(n){var i;if(e!==n)return ye.src(n.down("img"),"web","downtick-spacer"),n.removeClassName("bolded");if(n.addClassName("bolded"),!n.hasClassName("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",ye.src(n.down("img"),"web",i)})(r));return l},add_sort_arrow_mouseover_j:function(e,t,n,i){var s,o,r,a,u;for(a=l(n),u=[],s=0,o=a.length;s<o;s++)r=a[s],u.push((function(n){var i;if(e.attr("data-sort")!==l(n).attr("data-sort"))return ye.src(l(n).find("img")[0],"web","downtick-spacer"),l(n).removeClass("bolded");if(l(n).addClass("bolded"),!l(n).hasClass("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",ye.src(l(n).find("img")[0],"web",i)})(r));return u},one_line_fit:function(e){var t,n;if(t=$$(e),!(t.length<2))return(n=(function(e){return function(){var e,i,s,o,r,a,l,u,_;if(s=t[0],a=t[t.length-1],o=s.cumulativeOffset().top,l=a.cumulativeOffset().top,o!==l){if(e=parseInt(s.getStyle("font-size"),10),_=e-1,_<8)return;for(r=0,u=t.length;r<u;r++)i=t[r],i.style.fontSize=_+"px";return n()}}})(this))()},nice_list:function(e){var t,n,i,s,o;return e?1===e.length?e[0]:2===e.length?ct("%(x)s and %(y)s").format({x:e[0],y:e[1]}):(o=ct("%(x)s, %(y)s, and %(z)s").split(/%\(x\)s|%\(y\)s|%\(z\)s/),assert(4===o.length,"bad item list format %(x)s, %(y)s, and %(z)s"),n=o[0],i=o[1],s=o[2],t=o[3],[n,e.slice(0,-1).join(i),s,e[e.length-1],t].join("")):""},list_em_snippet:function(e,t){var n,i,s,o,r,a;for(o="",t-=new R("...").length,i=s=0,r=e.length;(0<=r?s<r:s>r)&&(a=e[i],0!==i&&(a=", "+a),n=new R(a).length,!(n>t));i=0<=r?++s:--s)t-=n,o+=a;return{str:o,snipped:e.length-i}},start_of_day:function(e){var t;return t=new Date,t.setTime(e.getTime()),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},to_iso8601_date:function(e,t,n){var i;return null==t&&(t=!1),null==n&&(n=!1),t?(i=e.getUTCFullYear().toString()+"-"+(e.getUTCMonth()+1).toString().lpad(2)+"-"+e.getUTCDate().toString().lpad(2),n&&(i+=" "+e.getUTCHours().toString().lpad(2)+":"+e.getUTCMinutes().toString().lpad(2)+":"+e.getUTCSeconds().toString().lpad(2))):(i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),n&&(i+=" "+e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2))),i},to_mysql_date:function(e,t,n){var i,s,o;return i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),o=e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2),s="."+e.getMilliseconds().toString().lpad(3),t?n?i+" "+o+s:i+" "+o:i},from_mysql_date:function(e){var t,n,i,s,o,r,a;return s=e.split(" "),t=s[0],r=s.length>1&&s[1],n=t.split("-"),assert(3===n.length,"weird date format on "+this+", expected yyyy-mm-dd"),i=new Date(n[0],parseInt(n[1],10)-1,n[2]),r&&(a=r.split(":"),assert(3===a.length,"weird time format on "+this+", expected hh:mm:ss.ms"),i.setHours(a[0]),i.setMinutes(a[1]),o=a[2].split("."),i.setSeconds(o[0]),o.length>1&&i.setMilliseconds(o[1])),i},make_table:function(e,t){var n,i,s,o,r,a,l;s=new Element("table",t),o=new Element("tbody"),s.__sert(o);for(i in e)l=e[i],a=new Element("tr"),r=new Element("td").insert(i),n=new Element("td").insert(l),a.__sert(r),a.__sert(n),o.__sert(a);return s},validate_email:function(e){var t;return t=new RegExp("^['&A-Z0-9._%+-]+@[A-Z0-9-][A-Z0-9.-]*\\.[A-Z]{2,15}$","i"),t.test(e)},scrollTop:function(){return window.scrollY||document.documentElement.scrollTop||0},scrollLeft:function(){return window.scrollX||document.documentElement.scrollLeft||0},scried:{},scry:function(e){var t,n;return n=this.scried,t=n[e],t||(t=$(e),n[e]=t),t},urlquote:function(e){return e.split("/").map(encodeURIComponent).join("/")},ie8:Prototype.Browser.IE&&document.documentMode&&!0,ie:Prototype.Browser.IE,log:function(){},childElement:function(e,t){var n;return n=this.childElementWithIndex(e,t),n[0]},childElementWithIndex:function(e,t){var n,i,s,o,r,a;for(n=0,a=e.childNodes,s=o=0,r=a.length;o<r;s=++o)if(i=a[s],1===i.nodeType&&n++===t)return[i,s];return[!1,!1]},disableSelection:function(e){return e.onselectstart=function(){return!1},e.unselectable="on",e.style.MozUserSelect="none",e.style.cursor="default"},enableSelection:function(e){return e.onselectstart=function(){return!0},e.unselectable="off",e.style.MozUserSelect="",e.style.cursor=""},disable_ie_image_dragging:function(){if(Prototype.Browser.IE&&Prototype.Browser.IEV<9)return document.ondragstart=function(){return!1}},bsearch:function(e,t,n,i){var s,o,r,a;for(n||(n=function(e,t){return e-t}),s=e.length,o=0;s>o;)if(r=Math.floor(s/2+o/2),a=n(e[r],t),a>0)s=r;else{if(!(a<0))return r;o=r+1}return i?o:-1},nonce:function(){var e,t,n;return e=new Date,n=e.getTime().toString(),t=Math.floor(1e6*Math.random()).toString().lpad(6),n+t},focus:function(e){if(e){e=$(e);try{return e.focus()}catch(e){}}},sumStyles:function(e,t){var n,i,s,o;if(i=0,e)for(s=0,o=t.length;s<o;s++)n=t[s],i+=parseInt(e.getStyle(n),10)||0;return i},smart_window_load:function(e){return"complete"===document.readyState?e.defer():Event.observe(window,"load",e)},isNumber:function(e){return!isNaN(Number(e,10))},shorten_url:function(e,t){return new Ajax.DBRequest("/shorten_url",{parameters:{url:e},onSuccess:function(e){return t(e.responseText)}})},falsy_to_empty:function(e){return e||""},preloaded_images:{},preload_image:function(e,t,n){var i;if(!this.preloaded_images[e])return i=new Image,null!=t&&Element.extend(i).observe("error",t),null!=n&&Element.extend(i).observe("load",n),i.src=e,this.preloaded_images[e]=i},get_preloaded_image:function(e){return this.preloaded_images[e]?this.preloaded_images[e].clone():new Element("img",{src:e})},clear_selected:function(){var e;if(window.getSelection){if(e=window.getSelection(),e.removeAllRanges)return e.removeAllRanges()}else if(document.selection)return document.selection.empty()},is_mac:function(){return navigator.appVersion.indexOf("Mac")!==-1},is_windows:function(){return navigator.appVersion.indexOf("Windows")!==-1},in_scrollbar:function(e){var t,n;return t=20,n=He.viewport_dimensions(),e>n.width-t},freshbutton_overlay:function(e,t){var n,i;return i=e instanceof l&&e||l(e),n=t instanceof l&&t||l(t),i.on("mouseover",(function(e){return function(){return n.addClass("hovered")}})(this)),i.on("mouseout",(function(e){return function(){return n.removeClass("hovered"),n.removeClass("pressed")}})(this)),i.on("mousedown",(function(e){return function(){return n.removeClass("hovered"),n.addClass("pressed")}})(this)),i.on("mouseup",(function(e){return function(){return n.removeClass("pressed")}})(this))},isElm:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},_track_twitter_chars_left:function(e,t){var n;return clearInterval(this.chars_left_interval),n=(function(n){return function(){var n,i;return n=$("twitter-chars"),i=t-$F(e).trim().length,i<0?n.addClassName("too-long"):n.removeClassName("too-long"),n.__date(i)}})(this),this.chars_left_interval=setInterval(n,250)},session_storage_set:function(e,t){if(window.sessionStorage&&window.JSON)return window.sessionStorage.setItem(e,JSON.stringify(t))},session_storage_get:function(e){if(window.sessionStorage&&window.JSON)return JSON.parse(window.sessionStorage.getItem(e))},pdf_plugins:function(){var e,t;return t=/Chrome PDF|Adobe Reader|Adobe PDF|Acrobat/gi,(function(){var n,i,s,o;for(s=window.navigator.plugins,o=[],n=0,i=s.length;n<i;n++)e=s[n],t.test(e.name)&&o.push(e);return o})()},get_window_location:function(){return window.location}},ht.scrollLeft=ht.scrollLeft.cached(50),ht.scrollTop=ht.scrollTop.cached(50),null==window.console&&(window.console={log:function(){},profile:function(){},profileEnd:function(){}}),document.observe("script:loaded",function(){var e,t,n,i,s;if(ht.ie8){for(i=$$("#page-header a, #page-footer a"),s=[],e=0,t=i.length;e<t;e++)n=i[e],"_blank"===n.target?s.push(n.target=""):s.push(void 0);return s}}),dt=Ze.URLUtil={absolutize:function(e){return e.startsWith("https://")||e.startsWith("http://")?e:"/"===e.charAt(0)?window.location.protocol+"//"+window.location.host+e:assert(0,"absolutize is confused by "+e)}},Ze.Velocity={scroll_container:null,velocity:0,last_nonzero_velocity:0,old_y:0,max_delta_y:0,calculate_velocity:function(){return this.velocity=this.max_delta_y,0!==this.velocity&&(this.last_nonzero_velocity=this.velocity),this.max_delta_y=0},capture_new_y_pos:function(){var e,t;return null==this.old_y?void(this.old_y=null!=this.scroll_container?this.scroll_container.scrollTop:He.scroll_offsets().top):null==this.max_delta_y?void(this.max_delta_y=0):(t=null!=this.scroll_container?this.scroll_container.scrollTop:He.scroll_offsets().top,e=Math.abs(this.max_delta_y)<Math.abs(t-this.old_y),e?(this.max_delta_y=t-this.old_y,this.old_y=t):void 0)},start_capture:function(e){return this.scroll_container=e,this.velocity_calculator_interval=setInterval(this.calculate_velocity.bind(this,500)),null!=this.scroll_container?this.scroll_container.observe("scroll",this.capture_new_y_pos.bind(this)):Event.observe(window,"scroll",this.capture_new_y_pos.bind(this))},get:function(e){return null==e&&(e=!1),assert(null!=this.velocity_calculator_interval,"Haven't started capturing velocity"),e?this.last_nonzero_velocity:this.velocity}};var mt;mt=Ze.DomUtil={fromElm:function(e){return $(e).innerHTML},updateFromElm:function(e,t){return e=$(e),t=$(t),e.update(this.fromElm(t))},fillVal:function(e,t){var n,i,s,o,r,a;for(s=$$("."+t),r=[],n=0,i=s.length;n<i;n++)a=s[n],a=$(a),"INPUT"===a.tagName?(a.value=e,r.push(a.defaultValue=e)):(""!==a.innerHTML||"A"!==(o=a.tagName)&&"B"!==o&&"INPUT"!==o&&"I"!==o&&"LABEL"!==o&&"SELECT"!==o&&"SPAN"!==o&&"TEXTAREA"!==o||ht.log("Filling an empty value; this may look broken in IE7",a),r.push(a.innerHTML=e));return r}};var ft;ft=Ze.RequestWatcher={reqs:[],working_msg:ct("Still working...",{comment:"Comment about waiting for a process to complete"}),last_notification:null,TIMEOUT:10,watch:function(e,t){var n;return n=this.reqs,n.length||(this.int_id=setInterval(this.check_up.bind(this),500)),t&&(e.skip_message=!0),n.push([e,T.time()])},check_up:function(){return this.scan(!1)},remove:function(e){return this.scan(e)},scan:function(e){var t,n,i,s,o,r,a,l,u;for(s=T.time(),o=[],a=this.reqs,n=0,i=a.length;n<i;n++)r=a[n],l=r[0],u=r[1],t=s-u,4!==l.transport.readyState?(t>4e3&&!l.skip_message&&(l.skip_message=!0,Ke.isShown()&&Ke.current()===!Se.undo_notification&&(this.last_notification=Ke.success(this.working_msg))),t>1e3*this.TIMEOUT&&l.job&&l.transport.abort(),l!==e?o.push([l,u]):l.transport.abort()):this.clearWorkingMessage();if(this.reqs=o,!o.length)return clearInterval(this.int_id)},clearWorkingMessage:function(){if(Ke.isShown()&&Ke.current()===this.last_notification)return Ke.clear()}},l(function(){var e,t,n,i;n=Prototype.Browser,i=[];for(e in n)t=n[e],t===!0&&i.push(l(document.body).addClass(e.toLowerCase()));return i});var pt=[].slice;l((function(e){return function(){return B.init()}})(this)),Ze.HashRouter={watch_timer:null,callback_map:{},last_hash:"",last_prefix:"",_get_location:function(){return window.location.href},_set_location:function(e){return window.location.href=e},_replace_location:function(e){return window.location.replace(e)},init:function(){return this.watch_timer=setInterval(this.check_hash.bind(this),300)},watch:function(e,t){if(this.callback_map[e]=t,!this.watch_timer)return this.init()},check_hash:function(){var e,t,n,i,s,o;if(i=this._get_location().split("#")[1],null!=i&&(i=i.replace(/%27/g,"'")),this.last_hash!==i){if(this.last_hash=i,this.last_prefix&&""===i)i=this.last_prefix+":";else if(!i)return;return o=i.split(":"),s=o.first(),this.last_prefix=s,n=this.callback_map[s],null!=n&&(t=(function(){var t,n,i,s;for(i=o.slice(1),s=[],t=0,n=i.length;t<n;t++)e=i[t],s.push(decodeURIComponent(e));return s})(),n.apply(null,t)),$(document).fire("db:hash_change",{hash:i})}},_prepare_hash:function(e){var t,n;return n=$A(e).map(ht.falsy_to_empty),t=n.map(encodeURIComponent),t.join(":")},set_hash:function(){var e,t;return e=1<=arguments.length?pt.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t)},replace_hash:function(){var e,t;return e=1<=arguments.length?pt.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t,!0)},_set_hash:function(e,t){return""===e&&(e="/"),this.last_hash=e,t?this._replace_location("#"+e):this._set_location("#"+e)}};var vt;vt=Ze.SharingUtil=(function(){function e(){}return e.success_string_for_recipients=function(e){return 1===e.length?e[0].indexOf("@")===-1?ct("Sent to %(recipient)s.",{comment:"Recipient is a user's name"}).format({recipient:e[0]}):ct("Sent to %(recipient)s.",{comment:"Recipient is an email address"}).format({recipient:e[0]}):2===e.length?e[0].indexOf("@")===-1?e[1].indexOf("@")===-1?ct("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are users' names."}).format({recipient_first:e[0],recipient_second:e[1]}):ct("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is a user's name, second is an email address"}).format({recipient_first:e[0],recipient_second:e[1]}):e[1].indexOf("@")===-1?ct("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is an email address, second is a user's name"}).format({recipient_first:e[0],recipient_second:e[1]}):ct("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are email addresses"}).format({recipient_first:e[0],recipient_second:e[1]}):(e[0].indexOf("@"),ct("Sent to %(recipient)s and %(num_others)s others.",{comment:"num_others is 2 or more"}).format({recipient:e[0],num_others:e.length-1}))},e.truncate_emails=function(e){var t;return e.length<=1500?e:(t=e.lastIndexOf(",",1500),t===-1?"":e.slice(0,t))},e})();var gt;Autocompleter.Contacts=Class.create(Autocompleter.Base,{initialize:function(e,t,n,i){var s,o,r,a,u;return this.user=e,h.LegacySharingVortexLogger.log("initialize-autocompleter-contacts"),this.baseInitialize(t,n,i),this.options.array=!1,this.options.larray=!1,this.options.frequency=.1,this._num_contacts_shown=0,this._num_query_results=0,o=this.options.include_fb===!0,null==this.options.include_team&&(this.options.include_team=!0),u=this.options.include_team===!0,a=this.options.include_new_style_groups===!0,r=this.options.include_me===!0,this.profile_services=at.get_linked_profile_services_for_user(this.user.id,this.update_import_contacts_link),this.link_handler=new lt,this._autocompleter_profile_services_item_tmpl=We.tmpl("autocompleter_item_tmpl"),this.listen(),this.possible_email_pattern=/[.@_-]/,s=(function(e){return function(t){return t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(o||(t=t.excludeFacebook()),a||(t=t.excludeNewStyleGroups()),u||(t=t.excludeTeamMembers()),r||(t=t.excludeMe())),e.setContacts(t)}})(this),function(){var e;return e=tt.getOrCreateForViewer(),e.load_contacts(!1,function(t){return s(t),e.register_for_updates("autocompleter_contacts",s)})}.defer(),this.options.onShow=function(e,t){return t.style.position&&"absolute"!==t.style.position||(t.style.position="absolute",He.clone_position(l(t),l(e),{setHeight:!1,setTop:!1,setLeft:!1})),l(t).fadeTo(150,1)}},link_callback:function(e){return lt.show_import_notifications(e)},getToken:function(){var e;return e=this.getTokenBounds(),this.element.value.substring(e[0],e[1])},listen:function(){var e;return this.install_profile_services_link_listener(),e=(function(e){return function(t){if(!e.profile_services.has_connected_services()&&!l(e.element).val())return e.activate(),setTimeout(function(){var t;return null!=(t=e.get_entry_container())?t.show():void 0},300),!0}})(this),l(this.element).click(e)},install_profile_services_link_listener:function(){var e;return Event.stopObserving(this.element,"blur"),e=(function(e){return function(t){var n;if(!l(t.target).closest("li").hasClass("profile-services-link-handler"))return null!=(n=e.get_entry_container())?n.hide():void 0}})(this),l(this.element).closest(".db-modal-box").click(e),l(this.element).closest("#modal-box").click(e)},get_entry_container:function(){var e;return null!=(e=this.element.up(".tokenized_autocompleter_container"))?e.down(".autocomplete"):void 0},profile_services_show:function(){var e,t,n,i;return e=this.get_entry_container(),(null!=(t=e.firstChild)&&null!=(n=t.firstChild)?n.value:void 0)>0?this.old_display=e.style.display:(this.old_contents="<ul></ul>",this.old_display="none"),this.profile_services_render_buttons(),null!=(i=$("flash_copy_container"))&&i.hide(),this.element.focus()},profile_services_render_buttons:function(){var e;return e=this.get_profile_services_button_list(),this.hasFocus=!0,this.updateChoices("<ul>"+e.join("")+"</ul>")},get_profile_services_button_list:function(){var e,t,n,i,s,o;for(o=[],s=se.importable_contact_services(),t=0,n=s.length;t<n;t++)i=s[t],assert(this.profile_services.is_updated,"profile_services has not been updated"),e="",this.profile_services.service_is_connected(i)?e=ct("Connected"):this.profile_services.service_was_connected(i)&&(e=ct("Reconnect")),o.push(this._autocompleter_profile_services_item_tmpl({email_provider_num:i,email_provider_img:se.to_img(i)[0],email_provider_name:se.to_name(i),bottom_text:e}).toHTML());return o},update_import_contacts_link:(function(e){return function(t){return e.profile_services=t,e.profile_services.has_unconnected_services(!0)?l(e.element).closest("form").find(".import-contacts-link").show():l(e.element).closest("form").find(".import-contacts-link").hide()}})(this),hide_containing_modal:function(){return this.$hidden_modals=l(".db-modal-wrapper:visible").first(),this.$hidden_modals.length?this.$hidden_modals.css("display","none"):(this.$hidden_modals=l("#modal:visible, #modal-overlay:visible"),this.$hidden_modals.hide())},show_containing_modal:function(){return this.$hidden_modals.show(),this.$hidden_modals=null},setContacts:function(e){if(this.options.array=e.contacts,this.options.larray=e.lcontacts,this.active||this.getToken())return this.getUpdatedChoices()},loadContacts:function(){var e;return e=(function(e){return function(t){var n,i,s,o;return n=e.options.include_fb===!0,null==e.options.include_team&&(e.options.include_team=!0),o=e.options.include_team===!0,s=e.options.include_new_style_groups===!0,i=e.options.include_me===!0,t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(n||(t=t.excludeFacebook()),s||(t=t.excludeNewStyleGroups()),o||(t=t.excludeTeamMembers()),i||(t=t.excludeMe())),e.setContacts(t)}})(this),function(){var t;return t=et.getOrCreateForViewer(),t.load_contacts(!1,function(n){return e(n),t.register_for_updates("autocompleter_contacts",e)})
}.defer()},getUpdatedChoices:function(){return this.updateChoices(this.options.selector())},selectEntry:function(){var e,t,n;return t=this.getCurrentEntry(),e=this.options.array[t.value],e.type===E.FB||e.type===E.NEW_STYLE_GROUP?t.innerHTML=e.name:t.innerHTML=e.email,n=this.options.tokens.length>1?this.options.tokens[0]+" ":"",t.innerHTML+=n,this.active=!1,this.updateElement(t),l(this.element).trigger("db:autocompleted")}},gt=function(e,t){var n;return n=l("<div>"),n.addClass(e),"string"==typeof t||t instanceof String?n.text(t):n.append(t),n},{getNumContactsShown:function(){return this._num_contacts_shown},getNumQueryResults:function(){return this._num_query_results},getContactInfoFromEmail:function(e){var t,n,i,s;for(s=this.options.array,n=0,i=s.length;n<i;n++)if(t=s[n],t.email===e)return{display_name:t.name,email:e,avatar_url:t.photo_url};return{display_name:"",email:e,avatar_url:null}},setOptions:function(e){var t;return null==e&&(e={}),t={choices:5,selector:(function(e){return function(){var t,n,i,s,o,r,a,u,_,c,d,h,m,f,p,v,g,w,b,y,k,x,C,T,S,D,$,A,N,I,O,L,M,j,F,U,q,P,z,B,H,Y,W,V,K,G;for(H=[],d=e.getToken().toLowerCase(),x=e.options.array.length,o=e.options.array,I=e.options.larray,B=[],d.indexOf(" ")===-1&&B.push("\\s+"),d.indexOf("+")===-1&&B.push("\\+"),d.indexOf("@")===-1&&B.push("@"),d.indexOf(".")===-1&&B.push("\\."),d.indexOf("&lt;")===-1&&B.push("&lt;"),z=RegExp("("+B.join("|")+")"),g=0;d.length>0&&g<x;){switch(s=o[g],N=I[g],h=-1,c=[],L=[],v="",s.name=s.name?R.em_snippet(s.name,22):"",s.email_snippet=s.email?R.em_snippet(s.email,22):"",s.type){case E.EMAIL:c.push(s.name,s.email_snippet),L.push(N.name,N.email),v="/static/images/icons/mail28-vflHfHPJ0.png";break;case E.FB:c.push(s.name),L.push(N.name),v="https://graph.facebook.com/"+N.fb_id+"/picture";break;case E.NEW_STYLE_GROUP:c.push(s.name,s.members),L.push(N.name,""),v="",null!=__CIRCULAR_DEPENDENCY__.GroupsListController&&(n=__CIRCULAR_DEPENDENCY__.GroupsListController.string_to_color(s.name),i=__CIRCULAR_DEPENDENCY__.GroupsListController.get_initials(s.name),m=l("<span class='group-icon'>").css("border-color",n).css("color",n).text(i));break;default:assert(!1,"should never get here due to type: "+s.type+", "+s.name+", "+s.email+", "+s)}for(y=f=0,S=L.length;f<S;y=++f){for(O=L[y],F=B.length?O.split(z):[O],a=0,b=0,D=F.length;b<D;b++)if(j=F[b]){if(0===j.indexOf(d)){h=a;break}a+=j.length}if(h!==-1){P=(d.length/j.length*9.4).toFixed(0),null!=s.sort_key&&(P+=s.sort_key),C=document.createTextNode(c[y].substr(0,h)),M=l("<strong>").text(c[y].substr(h,d.length)),W=document.createTextNode(c[y].substr(h+d.length)),c[y]=[C,M,W];break}}s.type===E.FB&&c.push(ct("Facebook message")),h!==-1&&(v?p=l('<img width="28px" height="28px">').attr({src:v,alt:""}):m&&(p=m),U=gt("autocomplete-line",c[0]),G=gt("autocomplete-line autocomplete-secondary",c[1]),T=gt("autocomplete-left",p),V=gt(null,[U,G]),A=l("<li>").attr("value",g).append(T,V),H.push([P,A])),g++}for(H.sort(function(e,t){return e[0]<t[0]?1:e[0]>t[0]?-1:0}),e._num_query_results=H.length,H=H.slice(0,e.options.choices),Y=l("<ul>"),k=0,$=H.length;k<$;k++)K=H[k],Y.append(K[1]);return e._num_contacts_shown=H.length,l(e.element).hasClass("no-profile-services-link-handler")||e.profile_services.has_unconnected_services(!0)&&(r=l(e.element).closest(".tokenized_autocompleter_container"),q=r.attr("data-provider"),w=ct(q===se.GOOGLE?"Select from your Gmail contacts":q===se.YAHOO?"Select from your Yahoo contacts":"Select from your contacts"),u=!1,q!==se.GOOGLE&&q!==se.YAHOO||e.profile_services.service_is_connected(q)?e.profile_services.has_connected_services()&&(u=!1,w=ct("Import Contacts")):u=!0,u?(_=e._autocompleter_profile_services_item_tmpl({email_provider_num:q,email_provider_img:se.to_img(q)[0],email_provider_name:w,bottom_text:""}).toHTML(),Y.append(_)):(p=ye.make("web","user_add"),U=gt("autocomplete-line autocomplete-line-center",w),T=gt("autocomplete-left",p),V=gt(null,[U]),A=l("<li>").addClass("profile-services-link-handler").append(T,V),Y.append(A))),t=Y.wrap("<span>").parent().html(),e.old_contents=t,t}})(this)},this.options=Object.extend(t,e)}});var wt;wt=Ze.Token=Class.create({initialize:function(e,t,n,i){return this.element=$(e),this.token_manager=n,this.hidden_input=t,this.element.token=this,this.selected=!1,this.info=i,l(this.element).closest(".tokenized_autocompleter_container").click(this.onclick.bindAsEventListener(this))},select:function(){var e;return this.token_manager.token=this,null!=(e=this.hidden_input)&&e.element.activate(),this.selected=!0,this.element.addClassName("token_selected")},deselect:function(){return this.token_manager.token===this&&(this.token_manager.token=null),this.selected=!1,this.element.removeClassName("token_selected")},onclick:function(e){return e&&e.preventDefault&&e.preventDefault(),this.detect(e)&&!this.selected?this.select():this.deselect()},remove:function(e){return this.token_manager.remove(this)},detect:function(e){var t,n,i;for(n=e.target?e.target:e.srcElement,i=n.token,t=n;null==i&&t.parentNode;)t=t.parentNode,i=t.token;return null!=i&&i.element===this.element}});var bt;bt=Ze.TokenManager=Class.create({initialize:function(e,t,n,i){return this.contact_search_logger=i,this.shift_boundary_right_func=t,this.shift_boundary_left_func=n,this.element=e,this.tokens=[],this.token=null},add:function(e){return this.tokens.push(e),this.element.fire("token:add",e.info)},populate:function(){var e,t,n,i,s,o,r;for(r=this.element.select(".token"),i=[],t=0,n=r.length;t<n;t++)o=r[t],e=o.hasClassName("token-warn"),s=new wt(o,null,this,{external:e}),i.push(this.add(s));return i},remove:function(e){var t;if(null==e&&(e=this.token),null!=e)return this.contact_search_logger.flag_record_as_removed(e.info.value),t=this.tokens.indexOf(e),this.tokens.splice(t,1),e.element.remove(),this.token===e&&t<this.tokens.length?this.tokens[t].select():(this.token=null,null!=this.shift_boundary_right_func&&this.shift_boundary_right_func()),this.element.fire("token:remove",e.info)},removeAll:function(){var e,t,n,i,s;for(s=this.tokens.slice(0),this.tokens.clear(),n=[],e=0,t=s.length;e<t;e++)i=s[e],i.element.remove(),n.push(this.element.fire("token:remove",i.info));return n},shift_left:function(){var e;return e=this.token?this.tokens.indexOf(this.token):this.tokens.length,e>0?(this.token&&this.token.deselect(),this.tokens[e-1].select()):null!=this.shift_boundary_left_func?this.shift_boundary_left_func():void 0},shift_right:function(){var e;return e=this.tokens.indexOf(this.token),this.token&&this.token.deselect(),e+1<this.tokens.length?this.tokens[e+1].select():null!=this.shift_boundary_right_func?this.shift_boundary_right_func():void 0}});var yt;yt=Ze.HiddenInput=Class.create({initialize:function(e,t,n){return this.element=$(e),this.auto_complete_element=t,this.token_manager=n,Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},onKeyPress:function(e){switch(e.keyCode){case Event.KEY_LEFT:e.preventDefault(),this.token_manager.shift_left();break;case Event.KEY_TAB:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_RIGHT:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:this.token_manager.remove()}return!1}});var kt=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.ContactsTokenizer=Class.create(Autocompleter.Contacts,{initialize:function($super,e,t,n,i,s){var o;return this.user=e,$super(this.user,t,n,s),this.contact_search_logger=new h.ContactSearchLogger,this.token_manager=new bt(this.element,this.generate_shift_boundary_right_func(),null,this.contact_search_logger),this.hidden_input=new yt(i,this.element,this.token_manager),this.textbox_height=0,this.element.hacks||(this.element.should_use_borderless_hack=Prototype.Browser.WebKit,this.element.should_use_shadow_hack=Prototype.Browser.IE||Prototype.Browser.Opera,this.element.hacks=!0),(this.element.should_use_borderless_hack||this.element.should_use_shadow_hack)&&l(this.element).parent().addClass("tokenizer_input_borderless"),this.options.onShow=function(e,t){return He.clone_position(l(t),l(e.parentNode.parentNode),{setHeight:!1,setTop:!1,setLeft:!1}),t.show()},this.options.onHide=function(e,t){return t.hide()},this.max_textbox_height=270,null!=s.max_textbox_height&&(this.max_textbox_height=s.max_textbox_height),this.members=[],null!=s.members&&(this.members=s.members),this.invitees=[],null!=s.invitees&&(this.invitees=s.invitees),this.new_style_groups=[],null!=s.new_style_groups&&(this.new_style_groups=s.new_style_groups),this.contacts_only=!1,null!=s.contacts_only&&(this.contacts_only=s.contacts_only),o=B.get_url().indexOf("/referrals")!==-1?l("#retrieve-contacts-button"):l(this.element).closest("form").find(".tokenizer-submit-button")[0],l(o).on("mousedown",this.beforeSubmit.bindAsEventListener(this)),l(this.element).on("focus",this.onFocus.bindAsEventListener(this)),this.import_links=[],s.hide_import_contacts||(this.import_links=l(".import-contacts-link")),this.calculate_input_size(),this.dynamically_resize_input(),this.check_populated(),setInterval(this.check_populated.bind(this),100)},onClick:function(e){var t,n;if(t=e.findElement("li"),this.index=t.autocompleteIndex,n=this.selectEntry(),!n)return this.hide()},onBlur:function($super,e){return $(this.element.parentNode).removeClassName("focused"),this.element.up(".tokenizer").removeClassName("focused"),$super(e)},onFocus:function(e){return $(this.element.parentNode).addClassName("focused"),this.element.up(".tokenizer").addClassName("focused")},beforeSubmit:function(e){return this.tokenize_emails_input(!0)},clearTokens:function(e){return this.token_manager.removeAll(),this.calculate_input_size(),this.dynamically_resize_input()},getTokenCount:function(){return this.token_manager.tokens.length},getEmails:function(){var e,t;return e=l(this.element).closest(".tokenized_autocompleter_container").find(".token-valid").find('[name="emails"]'),(function(){var n,i,s;for(s=[],n=0,i=e.length;n<i;n++)t=e[n],s.push(l(t).val());return s})().join(", ")},check_populated:function(){var e,t;return e=$(this.element.parentNode),t=""===this.element.value&&0===this.token_manager.tokens.length,e.hasClassName("populated")&&t?e.removeClassName("populated"):e.hasClassName("populated")||t?void 0:e.addClassName("populated")},clean_email_addr:function(e,t){var n,i,s;for(i=0,s=e.length;i<s;i++)n=e[i],t=t.sub(n,"");return t.trim()},get_regexp_from_delimiters:function(e){var t,n,i,s;for(n="",i=0,s=e.length;i<s;i++)t=e[i],n+=t+"|";return new RegExp("["+n+"\\r\\n|\\r|\\n|\\t]+")},createTokenInfo:function(e,t,n){var i,s;return s=!0,i=t,n===E.FB&&(i=e),n!==E.EMAIL||ht.validate_email(t)?kt.call(this.members,t)>=0?(s=!1,i=ct("Already member")):kt.call(this.invitees,t)>=0?(s=!1,i=ct("Already invited")):n===E.NEW_STYLE_GROUP&&(kt.call(this.new_style_groups,t)>=0?(s=!1,i=ct("Already member group")):(s=!0,i=ct("Group"))):s=!1,t!==this.user.email&&t!==this.user.id||(i=ct("You"),s=!this.contacts_only),!e&&t&&(e=t.toString()),{display:e,value:t,type:n,valid:s,bubble_title:i}},COMPOUND_EMAIL_REGEX:/([^<>]+)<([^@>]+@[^@>]+)>/,parse_compound_email:function(e){var t;return t=e.match(this.COMPOUND_EMAIL_REGEX),t?this.createTokenInfo(t[0],t[2],E.EMAIL):null},tokenize_emails_input:function(e,t){var n,i,s,o,r,a,l,u,_,c,d,h,m,f,p,v,g,w,b;if(i=this.options.tokens,v=this.get_regexp_from_delimiters(i),o=this.options.single_token?[this.element.value]:this.element.value.split(v),w="",e||(w=o[o.length-1],p=this.clean_email_addr(i,w),o=o.slice(0,o.length-1)," "!==(f=w[w.length-1])&&">"!==f||(p.match(this.COMPOUND_EMAIL_REGEX)||ht.validate_email(p))&&(o.push(p),w="")),n=!1,b=[],o.length>0)for(a=0,_=o.length;a<_;a++)s=o[a],g=this.parse_compound_email(s),(null!=g?g.valid:void 0)?(n=!0,this.set_input_size(1),this.addContact(g)&&(h={sort_variant:null,context:"legacy_tokenizer",contact_type:E.EMAIL,contact_id:g.value,contact_name:g.display,did_select_suggestion:!1},this.contact_search_logger.add_record(h))):b.push(s);if(o=b,!this.options.single_token){for(m=[],l=0,c=o.length;l<c;l++)s=o[l],m.push.apply(m,s.split(" "));o=m}if(o.length>0)for(u=0,d=o.length;u<d;u++)if(s=o[u],s=this.clean_email_addr(i,s)){if(g=this.createTokenInfo(s,s,E.EMAIL),g.valid)n=!0;else if(t)continue;this.set_input_size(1),this.addContact(g)&&(h={sort_variant:null,context:"legacy_tokenizer",contact_type:E.EMAIL,contact_id:s,did_select_suggestion:!1},this.contact_search_logger.add_record(h))}return this.element.value!==w&&(this.element.value=w),r=this.element.up("form"),n&&$t.clear_errors(r),this.dynamically_resize_input()},generate_shift_boundary_right_func:function(){var e;return e=this.element,function(){return e.focus()}},set_input_size:function(e){return(null==e||e<0)&&(e=20),this.element.setStyle({width:e+"px"})},calculate_input_size:function(){if(this.import_links.length)return this.import_links_width=this.import_links.width(),this.import_links_visible=this.import_links.is(":visible")},dynamically_resize_input:function(){var e,t,n,i,s,o,r,a,u,_,c,d,h,m,f,p,v,g,w,b;for(f=$(this.element.parentNode.parentNode),v=parseInt(f.getStyle("width"),10)-15,p=parseInt(f.getStyle("height"),10),p!==this.textbox_height&&(this.textbox_height=p,p>=this.max_textbox_height?f.setStyle({"overflow-y":"auto"}):f.setStyle({"overflow-y":"hidden"})),r=v,e=l(".tokenizer-link",f.parentNode),e.length>0&&(r-=e.width()),w=this.token_manager.tokens,_=!1,b=0,s=0,a=w.length;s<a;s++)g=w[s],i=g.element,n=parseInt(i.getStyle("width"),10)+parseInt(i.getStyle("margin-right"),10),d=b+n,d>v?(b=n,_=!0):n>v?(b=0,_=!0):b=d;if(c=r-b,t=7*this.element.value.length,t>c&&(c=v),this.set_input_size(c),this.import_links.length&&this.import_links_visible&&(_||v-b-t<1.25*this.import_links_width)){for(this.import_links_visible=!1,h=this.import_links,m=[],o=0,u=h.length;o<u;o++)i=h[o],m.push(l(i).fadeOut(100));return m}},onKeyPress:function(e){var t,n;if(this.dynamically_resize_input(),this.active)switch(e.keyCode){case 44:case 188:case 59:case 186:return e.shiftKey||(this.has_selected_profile_services_entry()||this.has_selected_profile_services())&&this.tokenize_emails_input(!0),void this.reset_observer();case Event.KEY_TAB:case Event.KEY_RETURN:return this.has_selected_profile_services_entry()||this.has_selected_profile_services()?(this.tokenize_emails_input(!0),this.hide(),void Event.stop(e)):(this.selectEntry(),this.hide(),this.active=!1,void Event.stop(e));case Event.KEY_ESC:return this.hide(),this.active=!1,void Event.stop(e);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void Event.stop(e);case Event.KEY_DOWN:return this.markNext(),this.render(),void Event.stop(e)}else{if(this.tokenize_emails_input(!1),e.keyCode===Event.KEY_TAB||e.keyCode===Event.KEY_RETURN)return this.element.value&&e.preventDefault&&e.preventDefault(),void this.tokenize_emails_input(!0);if(""===this.element.value)(t=e.keyCode)!==Event.KEY_LEFT&&t!==Event.KEY_BACKSPACE||this.token_manager.shift_left();else if((n=e.keyCode)===Event.KEY_LEFT||n===Event.KEY_RIGHT||n===Event.KEY_UP||n===Event.KEY_DOWN)return}return this.update_typeahead(),this.reset_observer()},update_typeahead:function(){return this.changed=!0,this.hasFocus=!0},reset_observer:function(){return this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),1e3*this.options.frequency)},onObserverEvent:function($super){var e,t,n,i,s,o;if(this.active){for(o=this.element.value,s=this.options.tokens,n=0,i=s.length;n<i;n++)if(e=s[n],t=o.indexOf(e),t!==-1){if(this.has_selected_profile_services_entry())return this.tokenize_emails_input(!0),void this.hide();this.element.value=o.substr(0,t),this.selectEntry(),this.hide(),this.active=!1,this.element.value=o.substr(t+1);break}this.update_typeahead()}return this.tokenize_emails_input(!1),$super()},has_selected_profile_services:function(e){return null==e&&(e=this.getCurrentEntry()),l(e).hasClass("profile-services-link-handler")},has_selected_profile_services_entry:function(e){var t;return null==e&&(e=this.getCurrentEntry()),0===e.value&&0!==(null!=(t=e.id)?t.length:void 0)},selectEntry:function(){var e,t,n,i,s,o,r,a,l;return t=this.getCurrentEntry(),this.has_selected_profile_services(t)?(h.SharedFolderActivityLogger.log("web","import_contacts_button_clicked",this.user),this.profile_services_show(),!0):this.has_selected_profile_services_entry(t)?(o="suggestion",n=t.id.split("_")[0],assert(kt.call(se.importable_contact_services(),n)>=0,"The 'id-value' of an autocompleter-entry is not a valid Third Party contact import service"),a=se.to_name(n),this.profile_services.service_is_connected(n)?void Ke.success(ct("You're already connected to %(service_name)s").format({service_name:a})):kt.call(se.importable_contact_services(),n)>=0?this.link_handler.auth_service_with_user(n,this.user.id,(function(e){return function(t){return e.link_callback(t)}})(this),o):assert(!1,"Should never get here. entry_value: "+n)):(e=this.options.array[t.value],i=e.type===E.FB?e.fb_id:e.type===E.NEW_STYLE_GROUP?e.group_id:e.email,this.set_input_size(1),r=this.element.value,l=this.createTokenInfo(e.name.trim(),i,e.type),this.addContact(l)&&(s={sort_variant:null,context:"legacy_tokenizer",search_expr:r,selected_pos:this.index,num_query_results:this.getNumQueryResults(),contact_type:e.type,contact_id:i,contact_name:e.name.trim(),did_select_suggestion:!0},this.contact_search_logger.add_record(s)),$t.clear_errors(this.element.up("form")),this.dynamically_resize_input(),this.index=0,this.element.focus())},addContact:function(e){var t,n,i,s,o,r,a,u,_,c,d,h,m,f,p,v,g,w,b;for(b=this.token_manager.tokens,i=0,u=b.length;i<u;i++)if(h=b[i],e.value===h.info.value)return!1;switch(this.element.value="",e.type){case E.FB:r="fb_ids",s=new Element("img",{src:"/static/images/icons/fb_16-vflbiYTkC.png",alt:ct("Facebook")});break;case E.EMAIL:r="emails",s=new Element("img",{src:"/static/images/icons/email_16-vflcFyDTl.png",alt:""});break;case E.NEW_STYLE_GROUP:r="new_style_group_ids",s=new Element("img",{src:"/static/images/icons/icon_spacer-vflN3BYt2.gif",class:"sprite sprite_groups s_groups_group",alt:ct("Group")});break;case E.INVALID:r="invalids",s=new Element("span",{class:"hidden"});break;default:assert(!1,"should never get here due to type: "+e.type)}for(m=this.getTokenClass(e),w=l("<span class='x'>").addClass(m),w.on("click",function(e){return this.parentNode.parentNode.parentNode.parentNode.parentNode.token.remove(e),!1}),p=new Element("input",{type:"hidden",name:r,value:e.value.toString()}),h=new Element("a",{class:"title_bubble token "+m,href:"#",tabindex:"-1",title:e.bubble_title}),o=new Element("span"),this.options.wrap_name?(v=new Element("div",{class:"token-display-text"}),v.__sert(e.display),f=v,t=1):(f=e.display,t=0),c=[p,s,f],a=0,_=c.length;a<_;a++)n=c[a],o.__sert(n);return l(o).append(w),h.__date(new Element("span").__date(new Element("span").__date(new Element("span").__date(o)))),null!=(d=$(h).down(5).next(t))&&(d.innerHTML="&nbsp;"),g=new wt(h,this.hidden_input,this.token_manager,e),this.token_manager.add(g),this.element.up().__sert({before:h}),!0},getTokenClass:function(e){return e.valid?"token-valid":"token-error"},isTeamOnly:function(){return!1}});var kt=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.TeamTokenizer=Class.create(Autocompleter.ContactsTokenizer,{initialize:function($super,e,t,n,i,s){return $super(e,t,n,i,s),this.warn_only=!s.team_only,this.element.observe("token:remove",this.notifyExternal.bind(this)),this.element.observe("token:add",this.notifyExternal.bind(this)),this.team_contacts={},this.suspended_contacts={},this.pending_contacts={},this.reloadContacts(!0)},isTeamOnly:function(){return!this.warn_only},setTeamOnly:function(e){return this.warn_only=!e,this.reloadContacts()},reloadContacts:function(e){var t;return null==e&&(e=!1),t=tt.getOrCreateForViewer(),t.load_contacts(e=e,(function(e){return function(t){return e.setContacts(t)}})(this))},setContacts:function($super,e){var t,n,i,s;for(this.team_contacts={},this.team_contacts[De.get_viewer().work_email]=1,l(this.element).hasClass("team-admin")||(e=e.excludeSuspended()),e=e.sortByTeamFirst(),s=e.contacts,n=0,i=s.length;n<i;n++)t=s[n],t.team&&"active"===t.join_state&&(this.team_contacts[t.email]=1),t.team&&"suspended"===t.join_state&&(this.suspended_contacts[t.email]=1),t.team&&"pending"===t.join_state&&(this.pending_contacts[t.email]=1);return $super(this.options.contact_filter?this.options.contact_filter(e):e)},createTokenInfo:function(e,t,n){var i,s,o,r;return r=!0,s=!1,i=t,o=!1,n===E.FB&&(i=e),n!==E.EMAIL||ht.validate_email(t)?kt.call(this.members,t)>=0?(r=!1,i=ct("Already member")):kt.call(this.invitees,t)>=0?(r=!1,i=ct("Already invited")):n!==E.EMAIL||this.team_contacts[t]||this.pending_contacts[t]?n===E.FB?(r=this.warn_only,s=!0):n===E.NEW_STYLE_GROUP&&(kt.call(this.new_style_groups,t)>=0?(r=!1,i=ct("Already member group")):(r=!0,i=ct("Group"))):(r=this.warn_only,s=!0):r=!1,t!==this.user.email&&t!==this.user.id||(i=ct("You"),r=!this.contacts_only),this.suspended_contacts[t]&&(i=ct("Suspended user"),o=!0),!e&&t&&(e=t.toString()),{display:e,value:t,type:n,valid:r,external:s,bubble_title:i,suspended:o}},getTokenClass:function(e){return e.valid?e.suspended?"token-warn token-suspended":e.external?"token-warn":"token-valid":"token-error"},notifyExternal:function(e){var t,n,i;if(i=e.memo,i.external)return n=this.token_manager.tokens.filter(function(e){return e.info.external}),t=n?n.length:0,this.element.fire("sf:token:external",{count:t})}});var xt,kt=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};xt=INLINE_JS.SharingModel=Ze.SharingModel={ALBUM_THUMB_SIZE:260,ALBUM_PADDING:40,THUMBS_BATCH_SIZE:12,SHARING_URL_PREFIXES:["/sh","/scl","/sc"],filename:null,c2d_vars:{},is_folder:!1,is_album:!1,gallery_enabled:!1,gallery_showing:!1,file_viewer_files:[],send_link_autocompleter:null,team_only_shmodel:!1,owner_name:null,account_menu_options:null,sync_vars:{},init:function(e,t){return this.filename=e,this.c2d_url=null!=t?t:"/sm/c2d",this.init_logger(),l(".nav-close").on("click",this.close_embedded_fileviewer.bind(this)),l((function(e){return function(){var t,n,i;if(n=$("login-create-an-account"),n&&n.writeAttribute("href","/register?signup_tag=shmodel"),scrollTo(1,0),scrollTo(0,0),l("#download_button_link[data-dl-link]").on("click",e.download_zip),e.set_viewport_size(),t=function(t,n){return e.do_c2d(n.id)},l("#c2d-modal .login-form").on("db:login:success",t),l("#c2d-modal .register-form").on("db:register:success",t),i=Ge.parse(window.location.href),i.getQuery().force_dl)return i.updateQuery({force_dl:0,dl:1}),I.get({url:i.toString(),__do_not_use_expected_domain:"dl.dropboxusercontent.com"})}})(this))},init_folder:function(e,t,n,i,s,o,r,a,u,_,c,d){var h;if(this.c2d_vars=e,this.sync_vars=t,null==a&&(a=!1),this.shared_link_infos=null!=u?u:null,this.share_tokens=null!=_?_:null,this.share_permissions=null!=c?c:null,null==d&&(d=null),this.is_folder=!0,this.gallery_enabled=n,this.gallery_showing=i,this.file_viewer_files=s,this.file_view_target=o,this.account_menu_options=d,this.file_view_target===Le.FileViewTargetType.SHARED_CONTENT_LINK?this.file_view_origin=Le.FileViewOriginType.SHARED_CONTENT_LINK_PAGE:this.file_view_origin=Le.FileViewOriginType.SHARED_LINK_PAGE,h=this._get_sharing_url_prefix(),kt.call(xt.SHARING_URL_PREFIXES,h)>=0&&B.add_callback(h,this._handle_url_change,!0),l((function(e){return function(){return e._open_file_viewer(r),e.load_thumbs(),l("#gallery-toggle").click(function(){return e.switch_mode("gallery")}),l("#list-toggle").click(function(){return e.switch_mode("list")}),l(".file-link").click(function(t){return e._open_file_viewer(l(t.currentTarget).data("mediaIndex"))})}})(this)),o===Le.FileViewTargetType.SHARED_CONTENT_LINK)return this._log_scl_ttv()},_get_sharing_url_prefix:function(){var e;return e=window.location.pathname.match(/^(\/s[hc]l?)\//),e?e[1]:""},_handle_url_change:function(e,t){var n;if(n=ae.isShown(),n&&!t.preview)return ae.close()},_open_file_viewer:function(e){var t,n,i;if(a.isNumber(e)&&!(e<0))return i=De.get_viewer(),t=i.is_role_signed_in("work")?i.get_user_by_role("work"):De.get_viewer().get_users()[0],n="react-file-viewer",ae.open(this.file_viewer_files,e,t,n,{fileViewTarget:this.file_view_target,fileViewOrigin:this.file_view_origin,fileViewAction:Le.FileViewActionType.CLICK,sharedLinkInfos:this.shared_link_infos,shareTokens:this.share_tokens,sharePermissions:this.share_permissions,accountMenuOptions:this.account_menu_options}),!1},init_album:function(){return this.is_album=!0,this._resize_album_view(),Event.observe(window,"resize",this._resize_album_view.bind(this))},init_file:function(e,t,n){if(this.c2d_vars=t,null==n&&(n=!1),this.is_folder=!1,!n&&!this.c2d_vars.subpath&&!this.c2d_vars.is_package)return this.c2d_vars.subpath="/"+e},init_logger:function(){return l((function(e){return function(){var e;return e=l("#login-hover-link")[0],e&&e.observe("click",function(){return vn.log(vn.CLICK_SIGN_IN)}),$("download_button_link")&&vn.attachLogListener(vn.CLICK_DOWNLOAD,$("download_button_link")),e=$("add_to_my_dropbox_link"),e&&vn.attachLogListener(vn.CLICK_ADD_TO_MY_DROPBOX,e),$$(".remove-link").length&&vn.attachLogListener(vn.REMOVE_LINK,$$(".remove-link")[0]),$$(".shmodel-filename").length&&vn.attachLogListener(vn.CLICK_FILENAME,$$(".shmodel-filename")[0]),e=$("default_content_download_button"),e&&vn.attachLogListener(vn.CLICK_DOWNLOAD,e),e=$("default_content_a2md"),e&&vn.attachLogListener(vn.CLICK_ADD_TO_MY_DROPBOX,e),e=l("#login-create-an-account")[0],vn.attachLogListener(vn.CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN,e),e=l("#login-hover-cont .login-form")[0],vn.attachLogListener(vn.LOGIN_THRU_DEFAULT_DROPDOWN,e),l("#share-button").click(function(e){return vn.log(vn.CLICK_SHARE)})}})(this))},_log_scl_ttv:function(){var e,t,n,i,s,o,r;if(e=(new Date).getTime(),s=$e.start_time(),t={ns_id:null!=(n=this.sync_vars)?n.sf_id:void 0,timing:e-s},r=De.get_viewer().get_users(),r[0])return o=r[0].id,i=fe.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,h.ShareTibEventLogger.log(o,"PREVIEW_RENDER",i,t)},set_team_only_shmodel:function(e,t){return this.team_only_shmodel=e,this.owner_name=t},_resize_album_view:function(){var e;return e=Math.floor((He.viewport_dimensions().width-2*this.ALBUM_PADDING)/this.ALBUM_THUMB_SIZE)*this.ALBUM_THUMB_SIZE,$("content-wrapper").setStyle({display:"block",width:e+"px"})},load_thumbs:function(){var e,t,n;if(n=this.gallery_showing?$$(".gallery-icon-view img"):$$(".browse-files .icon"),t=function(e){return e.src.endsWith(ye.SPACER)||e.addClassName("thumbnail"),$e.mark_time_to_view(),$e.mark_time_to_interactive()},e=te.batch_load_thumbs(n,this.THUMBS_BATCH_SIZE,t),0===e)return $e.mark_time_to_interactive()},switch_mode:function(e){var t,n,i,s,o,r,a;for(a=$A(["gallery","list"]),i=0,s=a.length;i<s;i++)r=a[i],n=$(r+"-view-container"),t=$(r+"-toggle"),e===r?(n.show(),t.addClassName("selected")):(n.hide(),t.removeClassName("selected"));return history.replaceState&&(o=window.location.pathname,"list"===e&&(o+="?lst"),history.replaceState({},"",o)),this.gallery_showing=!this.gallery_showing,this.load_thumbs()},set_viewport_size:function(){var e;if($(document.body).hasClassName("mobile"))return e=new Element("meta",{name:"viewport",content:"width = 480"}),document.head.appendChild(e)},toggle_dropdown:function(e,t,n){var i,s;if(e&&Event.extend(e).preventDefault(),!t.visible())return this.is_album?It.show(t,n,null,!0):(s=$$(".nav-header").first().getHeight(),i=$$(".nav-header .buttons").first().cumulativeOffset().top-4,i<0&&ht.ie8&&(i=4),It.show(t,n,s-i,!0))},prepare_confirm_remove_modal:function(e,t,n,i,s,o,r,a){var u,_,c;return n?(c=ct(i?"Unshare?":"Unshare album?"),u=l("#album-disable-token-modal")[0],mt.fillVal(e.escapeHTML(),"album_unshare_name")):(o?(c=ct("Remove link created by %(name)s").format({name:r}),_=ct("You are removing the link to %(fname)s created by <b>%(owner)s</b>.  This link will no longer work for anyone who has it.<br/><br/>We'll notify <b>%(owner_email)s</b>.  Do you want to continue?"),_=_.format({fname:R.em_snippet(e,17),owner:r,owner_email:a})):(c=ct("Delete link to %(name)s?").format({name:R.em_snippet(e,17)}),_=ct("This link will no longer work for anyone who has it.")),u=l("#disable-token-modal")[0],mt.fillVal(_,"disable-token-desc")),{title:c,contents:u}},confirm_remove:function(e,t,n,i,s,o,r,a,l,u){var _;return null==n&&(n=!1),null==i&&(i=!1),null==s&&(s=!1),null==o&&(o=null),null==r&&(r=!1),null==a&&(a=null),null==l&&(l=null),null==u&&(u=null),assert(t,"confirm_remove missing tkey"),assert(e,"confirm_remove missing name"),assert(o,"confirm_remove missing user_id"),assert(!r||!i,"admin removal of collections not supported"),assert(!r||a,"missing link owner name for admin removal"),assert(!r||l,"missing link owner email for admin removal"),De.get_viewer().is_uid_signed_in(o)?(_=xt.prepare_confirm_remove_modal(e,n,i,s,o,r,a,l),Ot.show(_.title,_.contents,{token:t,name:e,is_album:i,user_id:o,success_callback:u})):void G.show_modal({user_id:o,on_success:(function(u){return function(){return u.confirm_remove(e,t,n,i,s,o,r,a,l)}})(this)})},confirm_remove_from_event_gid:function(e,t,n,i,s,o,r,a){var l;return null==s&&(s=!1),null==o&&(o=null),null==r&&(r=null),null==a&&(a=null),assert(t,"confirm_remove missing event gid"),assert(e,"confirm_remove missing name"),assert(i,"confirm_remove missing user_id"),assert(De.get_viewer().is_uid_signed_in(i),"user not logged in"),assert(!s||o,"missing link owner name for admin removal"),assert(!s||r,"missing link owner email for admin removal"),l=xt.prepare_confirm_remove_modal(e,n,!1,!1,i,s,o,r),Ot.show(l.title,l.contents,{name:e,user_id:i,activity_log_event_gid_dbase64:t,redirect_to_member_id:a})},do_remove:function(e){var t,n,i;return assert(e.token||e.activity_log_event_gid_dbase64,"missing token or event gid_dbase64"),t=l("#modal-content input").first(),t.attr("disabled",!0),l("#modal-content").addClass("ajax-loading"),i=window.location.pathname,"/links"===i||"/links/your_links"===i||"/recents"===i||i.match("^/home|^/work|^/personal")?new Ajax.DBRequest("/sm/disable/"+e.token,{subject_user:e.user_id,onSuccess:(function(t){return function(){var t;return Ot.hide(),"function"==typeof e.success_callback&&e.success_callback(),t=ct(e.is_album?"Unshared '%(name)s'":"Deleted link to %(name)s"),t=t.format({name:e.name}),Ke.success(t),document.fire(M.LINKS_REMOVE,{token:e.token})}})(this),onComplete:(function(e){return function(){return t.attr("disabled",!1),l("#modal-content").removeClass("ajax-loading")}})(this)}):(e.token?n=Ge({path:"/sm/disable/"+e.token}):(n=Ge({path:"/sm/disable_by_event_gid/"+e.activity_log_event_gid_dbase64}),n.updateQuery("redirect_to_member_id",e.redirect_to_member_id).toString()),$t.postRequest(n.updateQuery("_subject_uid",e.user_id).toString()))},show_shmodal_onload:function(e,t,n,i){return null==i&&(i=null),l((function(s){return function(){return B.remove_query_param("m"),De.get_viewer().is_uid_signed_in(i)?null!=i&&Qe.get_for_user(De.get_viewer().get_user_by_id(i)).verified_or_show()?s.show_shmodal(e,t,n,i):null==i?(assert(De.get_viewer().is_paired,"Expected viewer to be paired."),s.show_share_shmodel_role_chooser(e,t,n)):void 0:void G.show_modal({user_id:i,on_success:function(){return s.show_shmodal_onload(e,t,n,i)}})}})(this))},show_shmodal:function(t,n,i,s){var o,r,a,u,_,c,d,h,m,f;if(this.url=t,this.short_url=n,!De.get_viewer().is_uid_signed_in(s))return void G.show_modal({user_id:s,on_success:(function(e){return function(){return e.show_shmodal(e.url,e.short_url,i,s)}})(this)});if(f=De.get_viewer().get_user_by_id(s),Qe.get_for_user(f).verified_or_show()){if(h="shmodal-user-"+s,Ot.show(this._get_shmodal_title(f.is_team),mt.fromElm($(h))),_={},_._subject_uid=s,$t.add_vars("shmodal-send-form",_),this._get_thumbnail_type())for(m=$$(".shmodal-image"),c=0,
d=m.length;c<d;c++)u=m[c],u.addClassName("thumbnail");return a="contacts"===i?Autocompleter.ContactsTokenizer:Autocompleter.TeamTokenizer,this.send_link_autocompleter=new a(f,h+"-new-collab-input",h+"-new-whobulk",h+"-hidden-input",{tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===i,user_id:s}),this.configure_dropdown(),this.disabled||(e.installed?(o=w.clipboard_overlay(this.url,l("#"+h+"-copy-link"),xt.copied_to_clipboard),o.css({position:"fixed",zIndex:1001}),o.children().height(o.height()),clearInterval(this.follow_freshbutton),r=(function(e){return function(){return He.clone_position(o,l("#"+h+"-copy-link"),{offsetHeight:6,offsetWidth:6})}})(this),this.follow_freshbutton=setInterval(r,500)):$(h+"-copy-link").hide()),Lt._create($("modal").down(".custom-message-container")),Lt._create($("modal").down(".fb-post-sickinput")),$(h+"-new-collab-input").focus(),vn.log("shmodal_show")}},configure_dropdown:function(){var e,t,n,i,s;for(i=$$(".dropdown-menu-container"),t=0,n=i.length;t<n;t++)e=i[t],s=e.down(".dropdown-menu-trigger"),null!=s&&s.observe("click",(function(e){return function(e){var t;return t=e.target.up(".dropdown-menu-container"),t.toggleClassName("dropdown-shown")}})(this));return document.on("click",(function(e){return function(e){var t,n,i,s,o;if(!e.target.hasClassName("dropdown-menu-trigger")&&!e.target.up(".dropdown-menu-trigger")){for(s=$$(".dropdown-shown"),o=[],n=0,i=s.length;n<i;n++)t=s[n],o.push(t.removeClassName("dropdown-shown"));return o}}})(this))},copied_to_clipboard:function(){return Ke.success(ct("Link copied to clipboard")),Ot.hide(),vn.log("shmodal_copy_link"),h.ViralLogger.log(De.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_copy_link",file_type:xt.is_album?"collection":xt.is_folder?"folder":xt.filename.indexOf(".")===-1?"file":_n.EXTENSION_TO_CATEGORY[j.file_extension(xt.filename).toLowerCase()]||"file"})},get_shmodel_send_recipients:function(e){var t,n,i,s,o,r,a,l,u,_,c,d,h;for(assert(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),_=e.select('input[name="new_style_group_ids"]'),d=[],h=[t,n,i,_],s=0,l=h.length;s<l;s++)for(r=h[s],a=0,u=r.length;a<u;a++)o=r[a],c=o.up().innerHTML.stripTags().escapeHTML(),d.push(c.substring(0,c.indexOf("&")));return d},close_embedded_fileviewer:function(e){var t;return e.preventDefault(),t=new q,t.configureParentMessaging(function(){},["parent-ready"]),t.startListening(),t.postMessageToParent("close-fileviewer")},send_shmodel_link:function(e){var t,n,i,s;return t=$("shmodal-send-form"),assert(t,"Couldn't find the shmodal send form."),s=this.get_shmodel_send_recipients(t),i=(function(e){return function(e){var t;return t=vt.success_string_for_recipients(s),Ke.success(t),Ot.hide(),vn.log("shmodal_send")}})(this),n=(function(e){return function(e){return $t.remove_loading()}})(this),$t.ajax_submit(t,"/sm/share",i,n,t.down(".tokenizer-submit-button"))},show_content:function(e){var t,n,i,s;for($("shmodal-title-text").__date(Et.to_title_str(e)),i=Et.list,t=0,n=i.length;t<n;t++)s=i[t],s!==e&&($(Et.to_toggle_str(s)).removeClassName("toggled"),$(Et.to_content_str(s)).hide());return $(Et.to_content_str(e)).show(),$(Et.to_toggle_str(e)).addClassName("toggled"),l("#modal .focusarea").focus()},show_send_content:function(){return this.show_content(Et.SEND)},show_fb_content:function(){return this.show_content(Et.FB)},start_fb_post:function(e,t){var n,i,s,o;return i=(function(n){return function(){return k.do_auth(n.do_fb_post.curry(e,t),t)}})(this),n=l("#modal:visible, #modal-overlay:visible"),s=function(){return n.show()},k.authed_user_id===t?this.do_fb_post(e,t):De.get_viewer().is_uid_associated(k.authed_user_id)?(n.hide(),o=new y(De.get_viewer().get_user_by_id(t),s,i.bind(this)),o.show()):i()},do_fb_post:function(e,t){return k.custom_show_posting=function(){return $t.add_loading($("shmodal-fb-post-submit"))},k.custom_show_complete=function(){return Ot.hide(),Ke.success(ct("Successfully posted to Facebook")),vn.log("shmodal_fb_post"),h.ViralLogger.log(De.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_fb_post",file_type:xt.is_album?"collection":xt.is_folder?"folder":xt.filename.indexOf(".")===-1?"file":_n.EXTENSION_TO_CATEGORY[j.file_extension(xt.filename).toLowerCase()]||"file"})},k.post($F("shmodal-fb-post-input"),e,null,null,null,function(){return Ot.hide()},t)},_get_shmodal_title:function(e){return null==e&&(e=!1),this.generate_title_content(this._get_shmodal_title_text(),(function(e){return function(){return e.show_send_content()}})(this),(function(e){return function(){return e.show_fb_content()}})(this),e)},generate_title_content:function(e,t,n,i){var s,o,r,a,u;return null==i&&(i=!1),a=l("<div/>",{id:"shmodal-title"}),u=l("<div/>",{id:"shmodal-title-text",text:e}),a.append(u),i||(r=l("<a/>",{id:"shmodal-send-toggle",class:"freshtoggle ft-left toggled"}),r.html(ye.make("web","email_20")),r.on("click",t),o=l("<a/>",{id:"shmodal-fb-toggle",class:"freshtoggle ft-middle"}),o.html(ye.make("web","fb_20")),o.on("click",n),a.append([r,o])),s=l("<div/>",{class:"clear"}),a.append(s),a[0]},_get_shmodal_title_text:function(){var e,t;return this.is_folder?(e=ct("Share link to %(folder_name)s"),e=e.format({folder_name:R.em_snippet(this.filename,15)})):(t=this._get_thumbnail_type(),t===_n.CATEGORY_TO_TRANSLATION.IMAGE?ct("Share this image"):t===_n.CATEGORY_TO_TRANSLATION.VIDEO?ct("Share this video"):ct("Share '%(filename)s'").format({filename:R.em_snippet(this.filename,18)}))},_get_thumbnail_type:function(){var e,t;return this.filename.indexOf(".")!==-1&&(t=j.file_extension(this.filename).toLowerCase(),e=_n.EXTENSION_TO_CATEGORY[t],!(!e||"IMAGE"!==e&&"VIDEO"!==e)&&_n.CATEGORY_TO_TRANSLATION[e])},download_zip:function(e){var t,n,i,s,o;return t=l("#download_button_link").attr("data-dl-link"),o=l("#download_button_link").attr("data-test-link"),s="true"===l("#download_button_link").attr("data-owner"),i=(function(e){return function(e){var n;return"OK"===e?window.location=t:0===e.indexOf("err:")?(n=ct(s?"The zip file is too large.":"The zip file is too large. Please add it to your Dropbox."),Ke.error(n)):Ke.error(ct("Failed to download zip file.")),!1}})(this),n=(function(e){return function(e){return Ke.error(ct("Failed to download zip file.")),!1}})(this),o&&l.support.cors===!0?d.SilentBackgroundRequest({url:o,success:i,error:n}):window.location=t,!1},show_share_shmodel_role_chooser:function(e,t,n){return null==this.shmodel_select_role_modal&&(this.shmodel_select_role_modal=new Vt({element_id:"share-shmodel-select-role-modal",link_url:e,short_url:t,tokenizer_type:n})),this.shmodel_select_role_modal.show().set_title(this._get_shmodal_title_text())},prompt_login_then_share:function(e,t,n,i){var s;return s=(function(s){return function(){var s;return Ot.hide(),l("#role-selector option").removeClass("disabled"),s=De.get_viewer().get_uid_by_role(i),De.get_viewer().sign_in_user_by_id(s),h.ShmodelUILogger.log("via-shmodel-viewer"),xt.show_shmodal(e,t,n,s)}})(this),De.get_viewer().is_role_signed_in(i)?s():G.show_modal({role:i,on_success:s})},show_c2d_modal:function(e,t){var n,i,s,o,r;if(null==e&&(e=""),null==t&&(t=!1),e){if("personal"===e&&assert("forbid"!==this.team_only_shmodel,"Can't copy to personal Dropbox if restricted"),!De.get_viewer().is_role_signed_in(e))return void G.show_modal({role:e,on_success:(function(t){return function(){return t.show_c2d_modal(e)}})(this)})}else if(De.get_viewer().is_paired)return void new Kt({element_id:"select-role-modal"}).show();return h.WebMiscActivityLogger.log("show-c2d-modal",{filename:this.filename,auth_google:null!=l.find(".auth-google")}),o=e?"#c2d-modal-"+e:"#c2d-modal",r=this._c2d_modal_msg(e,De.get_viewer().team_name),n=this._c2d_modal_button_msg(e,De.get_viewer().team_name),i=this._c2d_modal_desc(e,De.get_viewer().team_name),t&&(i=this._c2d_modal_team_only_desc(De.get_viewer().team_name)+"<br/><br/>"+i),s=this._c2d_modal_login_desc(e,De.get_viewer().team_name),mt.fillVal(i,"c2d-desc"),mt.fillVal(s,"c2d-login-desc"),l(".c2d-submit-button").val(n),l(".c2d-login-register-desc").hide(),this.is_album?l(".c2d-login-register-album-desc").show():this.is_folder?l(".c2d-login-register-folder-desc").show():l(".c2d-login-register-file-desc").show(),Ot.show(r,l(o)[0],!1,!1,!1,!1)},_c2d_modal_msg:function(e,t){var n,i;return null==e&&(e=""),null==t&&(t=""),this.c2d_vars.title?i=this.c2d_vars.title:"personal"===e?(i=ct("Save '%(filename)s' to my personal Dropbox"),i.format({filename:R.em_snippet(this.filename,10)})):"work"===e?(i=ct("Save '%(filename)s' to my %(team_name)s Dropbox"),n=Math.max(10,15-new R(t).length),i.format({filename:R.em_snippet(this.filename,n),team_name:t})):(i=ct("Save '%(filename)s' to my Dropbox"),i.format({filename:R.em_snippet(this.filename,15)}))},_c2d_modal_button_msg:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),"personal"===e?n=ct("Save to my personal Dropbox"):"work"===e?(n=ct("Save to my %(team_name)s Dropbox"),n.format({team_name:t})):ct("Save to my Dropbox")},_c2d_modal_team_only_desc:function(e){var t;return t=ct(this.is_album?"You can only add this album to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the album to members of <b>%(team_name)s</b>.":this.is_folder?"You can only add this folder to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the folder to members of <b>%(team_name)s</b>.":"You can only add this file to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the file to members of <b>%(team_name)s</b>."),t.format({owner_name:this.owner_name,team_name:e})},_c2d_modal_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),"personal"===e?this.is_album?"warn"===this.team_only_shmodel?(n=ct("The photos and videos in this album were sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy them to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=ct("The photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):this.is_folder?"warn"===this.team_only_shmodel?(n=ct("This folder was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=ct("This folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):"warn"===this.team_only_shmodel?(n=ct("This file was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=ct("This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):"work"===e?(n=ct(this.is_album?"The photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"This folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):ct(this.is_album?"The photos and videos in this album will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":this.is_folder?"This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":"This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.")},_c2d_modal_login_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),"personal"===e?n=ct(this.is_album?"Once you sign in to your personal Dropbox, the photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":this.is_folder?"Once you sign in to your personal Dropbox, this folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":"Once you sign in to your personal Dropbox, this file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):"work"===e?(n=ct(this.is_album?"Once you sign in to your %(team_name)s Dropbox, the photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"Once you sign in to your %(team_name)s Dropbox, this folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"Once you sign in to your %(team_name)s Dropbox, this file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):void 0},do_c2d:function(e){var t;return assert(e,"Must specify a user_id for saving to Dropbox."),t=ct("Saving to your Dropbox..."),De.get_viewer().is_paired&&(De.get_viewer().get_user_by_id(e).is_team?(t=ct("Saving to your %(team_name)s Dropbox..."),t=t.format({team_name:De.get_viewer().team_name})):t=ct("Saving to your personal Dropbox...")),Ke.success(t),Ot.hide(),new Ajax.DBRequest(this.c2d_url,{parameters:this.c2d_vars,job:this.is_folder,progress_text:t,subject_user:e,onSuccess:(function(e){return function(e){if(e.responseText)return Pe.redirect(e.responseText)}})(this)})},request_shared_folder_sync:function(e){var t;return null==e&&(e=""),t=fe.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,we.mountSharedFolder(this.sync_vars.sf_id,e,t)}};var Et;Et=Ze.ShmodalPanes={SEND:0,FB:1,list:[0,1],_content_str:["shmodal-send-content","shmodal-fb-content"],_toggle_str:["shmodal-send-toggle","shmodal-fb-toggle"],_title_str:["Share by Email",ct("Share on Facebook")],to_content_str:function(e){return this._content_str[e]},to_toggle_str:function(e){return this._toggle_str[e]},to_title_str:function(e){return 0===e?xt._get_shmodal_title_text():this._title_str[e]},to_focus_str:function(e){return this._focus_str[e]}};var Ct=function(e,t){return function(){return e.apply(t,arguments)}},Tt=function(e,t){function n(){this.constructor=e}for(var i in t)St.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},St={}.hasOwnProperty;INLINE_JS.ShareLinkModal=Ze.ShareLinkModal=(function(e){function t(e,n,i,s,o){var r,a;this.user_id=e,null==s&&(s=!1),null==o&&(o=void 0),this.before_show=Ct(this.before_show,this),this.show=Ct(this.show,this),this.prompt_login_then_show=Ct(this.prompt_login_then_show,this),h.LegacySharingVortexLogger.log("construct-share-link-modal"),a={origin:i},a._subject_uid=this.user_id,r=o?Ge({path:"/sm/get_link_modal_content/"+o}).toString():Ge({path:"/sm/share_link"+n}).toString(),t.__super__.constructor.call(this,{element_id:"share-link-modal",endpoint_url:r,parameters:a})}return Tt(t,e),t.prototype.prompt_login_then_show=function(){var e;return e=(function(e){return function(){return Ot.hide(),l("#role-selector option").removeClass("disabled"),De.get_viewer().sign_in_user_by_id(e.user_id),h.ShmodelUILogger.log("via-shmodel-viewer"),e.show()}})(this),De.get_viewer().is_uid_signed_in(this.user_id)?e():G.show_modal({user_id:this.user_id,on_success:e})},t.prototype.show=function(){var e;if(h.LegacySharingVortexLogger.log("show-share-link-modal"),e=De.get_viewer().get_user_by_id(this.user_id),Qe.get_for_user(e).verified_or_show(c.SHMODAL))return t.__super__.show.call(this)},t.prototype.before_show=function(){var e,t,n;if(this.$modal_window.find(".share-link-modal-content").length)return e={class:"ajax-loading-indicator",src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:ct("Loading...")},n=l("<img />",e),t=l("<div />",{class:"loading-spinner"}).append(n),this.$modal_window.find(".dynamic-content").html(t)},t})(D),Ze.ShareLinkModalContent=(function(){function e(e,t,n,i,s,o,r,a,u,_,c){var d,h;this.owner_id=e,this.tkey=t,this.fq_path=n,this.link=i,this.filename=s,this.is_dir=o,this.tokenizer_type=r,this.tokenizer_ctx_str=a,this.is_restricted_to_members=u,this.fq_path_of_restricting_sf=c,this._send_link=Ct(this._send_link,this),this._show_shared_link_remove_confirm_modal=Ct(this._show_shared_link_remove_confirm_modal,this),this._show_shared_folder_settings_modal=Ct(this._show_shared_folder_settings_modal,this),this._select_all_text=Ct(this._select_all_text,this),this._toggle_send_link_button=Ct(this._toggle_send_link_button,this),this._toggle_recipients_outside_team_warning=Ct(this._toggle_recipients_outside_team_warning,this),this._toggle_close_button_text=Ct(this._toggle_close_button_text,this),this._mark_onboarding_as_seen=Ct(this._mark_onboarding_as_seen,this),this._add_message_checkbox_changed=Ct(this._add_message_checkbox_changed,this),this._toggle_comment_option=Ct(this._toggle_comment_option,this),this._listen=Ct(this._listen,this),this._init_autocompleter=Ct(this._init_autocompleter,this),this.$content=l(".share-link-modal-content"),this.modal=nt.get_containing_modal(this.$content),this.modal&&("shared_folder"===this.tokenizer_type&&(this.shared_folder_members=x.create_contacts_list(_)),h={filename:this.filename,fq_path:this.fq_path,tkey:this.tkey,user_id:this.owner_id},document.fire(M.LINKS_ADD,h),l(document).trigger(M.LINKS_ADD,h),this.modal.set_title(ct("Share link to %(filename)s").format({filename:R.em_snippet(this.filename,15)})),this.collab_input_id=this.tokenizer_ctx_str+"-new-collab-input",this.$collab_input=this.$content.find("#"+this.collab_input_id),this.$send_link_button=this.$content.find(".confirm-button"),this.$share_link_url_input=this.$content.find(".copy-link-input-container input[type='text']"),this.$cancel_button=this.$content.find(".cancel-button"),this.$custom_message_textarea=this.$content.find("#share-link-modal-custom-message"),this.$comment_option_container=this.$content.find(".add-message-as-comment-container"),this._init_autocompleter(),this._listen(),null!=(d=this.$share_link_url_input[0])&&d.select())}return e.prototype._init_autocompleter=function(){var e,t;return e={tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===this.tokenizer_type,user_id:this.owner_id},"shared_folder"===this.tokenizer_type?this.autocompleter=new Autocompleter.SharedFolderTokenizer(De.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e,this.shared_folder_members):"contacts"===this.tokenizer_type?this.autocompleter=new Autocompleter.ContactsTokenizer(De.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e):this.autocompleter=new Autocompleter.TeamTokenizer(De.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e),t=(function(e){return function(t){return function(){return e.autocompleter.contact_search_logger.log_records(e.owner_id,t)}}})(this),this.modal.logger_keydown_close_handler=t(!0),this.modal.$overlay.on("click",t(!0)),this.modal.$db_modal_x.on("click",t(!0)),this.$send_link_button.on("click",t(!1)),this.$cancel_button.on("click",t(!0)),Lt.init(),this.$collab_input.focus()},e.prototype._listen=function(){var e,t,n,i,s,o,r;return this.$send_link_button.on("click",this._send_link),this.$share_link_url_input.on("click",this._select_all_text),this.$cancel_button.on("click",(function(e){return function(e){return it.pop()}})(this)),this.$content.find("#shared-folder-options-link").on("click",this._show_shared_folder_settings_modal),this.$content.find("#shared-link-delete-link").on("click",this._show_shared_link_remove_confirm_modal),this.$comment_option_container.length>0&&(this.$custom_message_textarea.on("input",this._toggle_comment_option),this.$comment_option_container.find("#add-message-as-comment").on("change",this._add_message_checkbox_changed),e=this.$comment_option_container.find(".bubble-dropdown-x"),e.length>0&&e.on("click",this._mark_onboarding_as_seen)),null!=(t=this.$collab_input)&&t.keyup(this._toggle_send_link_button),null!=(n=this.$collab_input)&&n.on("input",this._toggle_send_link_button),null!=(i=this.$collab_input[0])&&i.observe("token:remove",this._toggle_send_link_button),null!=(s=this.$collab_input[0])&&s.observe("token:add",this._toggle_close_button_text),null!=(o=this.$collab_input[0])&&o.observe("token:remove",this._toggle_close_button_text),null!=(r=this.$collab_input[0])?r.observe("sf:token:external",this._toggle_recipients_outside_team_warning):void 0},e.prototype._toggle_comment_option=function(e){var t;return t=this.$custom_message_textarea.val().length,t>0?this.$comment_option_container.css("visibility","visible"):this.$comment_option_container.css("visibility","hidden")},e.prototype._add_message_checkbox_changed=function(e){return d.SilentBackgroundRequest({url:"/file_activity/set_share_modal_checkbox_preference",data:{fq_path:this.fq_path,checked:e.currentTarget.checked},subject_user:this.owner_id})},e.prototype._mark_onboarding_as_seen=function(e){return d.SilentBackgroundRequest({url:"/file_activity/has_seen_add_message_as_comment_onboarding",data:{fq_path:this.fq_path},subject_user:this.owner_id})},e.prototype._toggle_close_button_text=function(e){var t,n;return n=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),n?this.$cancel_button.text(ct("Close")):this.$cancel_button.text(ct("Cancel"))},e.prototype._toggle_recipients_outside_team_warning=function(e){var t,n;if(t=l(".external-recipient-warning-message"),t.length)return n=e.memo.count,e.memo.shared_folder_warning?n>0?t.show():t.hide():n>1?(t.find(".external-recpient-num").text(n),t.removeClass("single").show()):1===n?t.addClass("single").show():t.hide()},e.prototype._toggle_send_link_button=function(e){var t,n;return n=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),n=n&&""===l.trim(this.$collab_input.val()),this.$send_link_button.prop("disabled",n)},e.prototype._select_all_text=function(e){return l(e.currentTarget)[0].select()},e.prototype._show_shared_folder_settings_modal=function(e){var t;return e.preventDefault(),t=De.get_viewer().get_user_by_id(this.owner_id),ut(t,{fqPath:this.fq_path_of_restricting_sf,isFolder:!0,origin:"SHARE_LINK_MODAL"}),it.pop()},e.prototype._show_shared_link_remove_confirm_modal=function(e){var t;return e.preventDefault(),t=(function(e){return function(){return it.pop(),l(document).trigger(M.LINKS_REMOVE,{fq_path:e.fq_path})}})(this),xt.confirm_remove(this.filename,this.tkey,this.is_dir,!1,!1,this.owner_id,!1,null,null,t)},e.prototype._send_link=function(e){var t,n,i,s,o;return i=this.$content.find(".share-link-modal-send-form")[0],s=this.get_shmodel_send_recipients(i),o=(function(e){return function(e){var t;return t=vt.success_string_for_recipients(s),Ke.success(t),it.pop(),vn.log("shmodal_send")}})(this),n=(function(e){return function(e){return $t.remove_loading()}})(this),t=this.$content.find(".tokenizer-submit-button")[0],$t.ajax_submit(i,"/sm/share",o,n,t)},e.prototype.get_shmodel_send_recipients=function(e){var t,n,i,s,o,r,a,l,u,_,c,d,h;for(assert(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),_=e.select('input[name="new_style_group_ids"]'),d=[],h=[t,n,i,_],s=0,l=h.length;s<l;s++)for(r=h[s],a=0,u=r.length;a<u;a++)o=r[a],c=o.up().innerHTML.stripTags().escapeHTML(),d.push(c.substring(0,c.indexOf("&")));return d},e})();var Dt;Dt=INLINE_JS.FileOps=Ze.FileOps={do_folder_restore:function(e,t){var n;return n=function(t){var n,i;return n=ct("Restoring '%(folder_name)s'").format({folder_name:j.filename(e)}),i=t.responseText,i.startsWith("err:")?(i=i.substring(4),l("#async-result").html(i),Ke.error(new We(i),60)):(n=ct("Restored '%(folder_name)s'").format({folder_name:j.filename(e)}),l("#status-of-files").text(ct("Restored files")),Ke.success(n,60)),l("#restore-done-heading").text(n),l(".pre-restore").hide(),l(".post-restore").show()},new Ajax.DBRequest("/cmd/restore",{parameters:{files:[e]},job:!0,html_in_error_msg:!0,progress_text:ct("Restoring..."),onSuccess:n,onFailure:n,subject_user:t})}};var $t,St={}.hasOwnProperty;$t=INLINE_JS.Forms=Ze.Forms={submitOnlyOnce:function(){var e;return e=$t.submitted!==!0,$t.submitted=!0,e},disable:function(e){if(e)return setTimeout(function(){return e.disabled=!0},0)},enable:function(e){if(e)return setTimeout(function(){return e.disabled=!1},0)},_button_on_change:function(e,t,n,i){var s,o,r,a;return s=l(e),s[t](),null==i&&(i=s.closest("form")),o=i[0],null==this.next_id&&(this.next_id=0),r=this.next_id++,null==this.initial_vars&&(this.initial_vars={}),this.initial_vars[r]=this.collect_form_vars(o),s.attr("data-id",r),i.data("button-id",r),a=(function(e){return function(){var i,a,l;s[t](),a=e.collect_form_vars(o),Object.keys(a).length!==Object.keys(e.initial_vars[r]).length&&s[n](),l=[];for(i in a)a[i]!==e.initial_vars[r][i]?l.push(s[n]()):l.push(void 0);return l}})(this),i.change(a),i.find("input").filter(":text").on("input",a),i.find("textarea").on("input",a)},show_button_on_change:function(e,t){return this._button_on_change(e,"hide","show",t)},hide_button_on_change:function(e,t){return this._button_on_change(e,"show","hide",t)},add_vars:function(e,t){var n,i,s;e=$(e),s=[];for(i in t)St.call(t,i)&&(n=new Element("input",{type:"hidden",name:i}),n.setValue(t[i]),s.push(e.__sert(n)));return s},collect_form_vars:function(e,t){var n,i,s,o,r,a;for(null==t&&(t=!1),e=e||$(document.body),i=e.select("input").concat(e.select("textarea")).concat(e.select("select")),r={},s=0,o=i.length;s<o;s++)n=i[s],n.name&&"t"!==n.name&&!l(n).attr("data-ignore-var")&&(a=n.getValue(),(a||t)&&("string"!=typeof a&&(a=a.join(",")),null!=r[n.name]?"string"==typeof r[n.name]?r[n.name]=[r[n.name],a]:r[n.name].push(a):r[n.name]=a));return r},add_loading:function(e,t){var n;if(e)return e=$(e),n=new Element("img",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),n.addClassName("text-img ajax_submit_loading"),"after"===t?l(e).after(n):l(e).before(n)},remove_loading:function(e){return l(".ajax_submit_loading").remove()},ui_form_submit:function(e,t){return t=t||e.action,!e.ajax_submitted&&(e.ajax_submitted=!0,new A(l(e),t,{data:$t.collect_form_vars(e),success:(function(t){return function(n,i,s){var o,r;if(r=l(e).data("button-id"),null!=r)return o=l(e).find("*[type='submit'][data-id='"+r+"']"),t.initial_vars[r]=t.collect_form_vars(e),o.hide()}})(this),complete:(function(t){return function(t,n){return e.ajax_submitted=!1}})(this)}))},ajax_submit_obj:function(e){var t,n,i,s,o,r,a,l,u,_,c;return s=e.form,c=e.url,_=e.success_callback,i=e.fail_callback,t=e.button,a=e.more_vars,l=e.position,r=e.job,o=e.html_response,n=e.complete_callback,u=e.progress_text,$t.ajax_submit(s,c,_,i,t,a,l,r,o,n,u)},ajax_submit:function(e,t,n,i,s,o,r,a,l,u,_){var c;return null==l&&(l=!1),!e.ajax_submitted&&(e.ajax_submitted=!0,s&&$t.add_loading(s,r),c=$t.collect_form_vars(e),o&&Object.extend(c,o),new Ajax.DBRequest(t||e.action,{noAutonotify:!0,parameters:c,job:a,progress_text:_,evalJSON:!1,onSuccess:function(e){if($t.remove_loading(),n&&"function"==typeof n)return n(e)},onFailure:function(t){var n,s;if(t&&(0===t.responseText.indexOf("err:")?(n=t.responseText.substr(4),0===n.indexOf("{")?(s=n.evalJSON(!0),$t.fill_errors(e,s)):(l&&(n=new We(n)),Ke.error(n))):Ke.error(ct("There was a problem completing this request.")),$t.remove_loading(),i&&"function"==typeof i))return i(t)},onComplete:function(t){if(e.ajax_submitted=!1,u&&"function"==typeof u)return u(t)}}),!1)},clear_errors:function(e){return e=e||$(document.body),this.hide_errors(e),e.select(".error-removable").invoke("remove")},fill_errors:function(e,t){var n,i,s,o,r,a;t=t||{},e=e||$(document.body),$t.clear_errors(e);for(r in t)St.call(t,r)&&(i=e.down("[data-error-field-name='"+r+"']")||e.down("[name='"+r+"']"),i&&(n=new Element("br",{class:"error-removable"}),s=new Element("span",{class:"error-message error-removable"}),o=t[r],assert(o.message_html||o.message_text,"Error message must have a message_html or message_text property"),o.message_html?s.update(o.message_html):s.__date(o.message_text),l(i).before(s),l(i).before(n),a=l(e).find("input[name='"+r+"'], textarea[name='"+r+"']"),a&&a.addClass("input-error")));return this.show_errors(e)},value:function(e){var t,n,i,s,o;for(i=$$('input[name="'+e+'"]'),o=null,t=0,s=i.length;t<s;t++)n=i[t],o=$(n).getValue()||o;return o},postRequest:function(e,t,n){var i;return null==t&&(t={}),null==n&&(n={}),assert(null!=e,"postRequest missing action"),t.t=Be.read(Me.JS_CSRF_COOKIE),i=new Element("form",{action:e,method:"POST"}),n.target&&(i.target=n.target),document.body.appendChild(i),$t.add_vars(i,t),i.submit()},hide_errors:function(e){var t,n,i,s,o;for(t=this.get_errors(e),s=[],n=0,i=t.length;n<i;n++)o=t[n],o.down("span.error-message")?s.push(o.hide()):s.push(void 0);return s},show_errors:function(e){var t,n,i,s;for(t=this.get_errors(e),n=0,i=t.length;n<i;n++)s=t[n],s.down("span.error-message")&&s.show();return l(".sick-input").find("label").css("top","")},get_errors:function(e){var t;return t=".error-bubble, .error-plain-text",e?e.select(t):$$(t)}},l(function(){return $t.show_errors()});var At;At=Ze.ActAsBlock={elm_list:["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"],parent_list:["padding-left","padding-right","border-left-width","border-right-width"],register:function(e,t){var n,i,s,o;for(null==t&&(t=document.body),s=$(t).getElementsByClassName("act_as_block"),o=[],n=0,i=s.length;n<i;n++)e=s[n],o.push(this.resize(e));return o},resize:function(e){var t,n,i,s;if(e=$(e),n=e.up(),t=ht.sumStyles(e,this.elm_list),i=ht.sumStyles(n,this.parent_list),e.style.width="1px",s=n.getWidth()-t-i,s>0)return e.style.width=s+"px"}};Ze.BrowseStyleRows={register_all:function(){var e,t,n,i;for(n=$$(".bs-row"),e=0,t=n.length;e<t;e++)i=n[e],this.register(i);return Event.observe(document,"click",this.kill_current.bind(this)),l(document).on("dropdown-opened",this.kill_current.bind(this))},register:function(e){var t;if(e=$(e),e.db_observe("mouseover",this.mouseover.bind(this)),e.db_observe("mouseout",this.mouseout.bind(this)),t=e.down(".action-button"))return t.db_observe("click",this.click.bind(this))},mouseover:function(e,t){if(!t.hasClassName("no-hover"))return t.addClassName("hover")},mouseout:function(e,t){return t.removeClassName("hover")},click:function(e,t){var n,i,s;if("A"!==e.target.tagName)return i=t.up(".bs-row"),Event.stop(e),i.hasClassName("selected")?void this.kill_current(!1):(l(document).trigger("dropdown-opened"),this.kill_current(!1),s=$(e.target),s.match(".bs-actions-list *")||i.addClassName("selected"),n=s.hasClassName("bs-row")?s:s.up(".bs-row"),n.style.zIndex=9)},kill_current:function(e){var t,n,i,s,o;for(s=$$(".bs-row.selected"),o=[],n=0,i=s.length;n<i;n++)t=s[n],t.removeClassName("selected"),o.push(t.style.zIndex="");return o}};var Nt;Nt=Ze.Bubble={make:function(e,t,n,i,s){var o,r,a,l,u,_,c,d,h,m,f,p,v,g,w,b,y,k,x,E;return null==t&&(t="left"),s=null!=s?s:{},["left","right"].contains(t)?(n=n||"middle",assert(["top","middle","bottom"].contains(n),"expected tail position ['top', 'middle', 'bottom'], got "+n)):["bottom","top"].contains(t)?(n=n||"center",assert(["left","center","right"].contains(n),"expected tail position ['left', 'center', 'right'], got "+n)):["none"].contains(t)||assert(!1,"unexpected tail side, got "+t),p=new Element("table"),
"titled"===s.style?(p.addClassName("bluebubble"),v="bluebubble"):(p.addClassName("bubble"),v="bubble"),i&&(p.style.width=i+"px"),w=new Element("tbody"),k=new Element("tr"),b=new Element("td"),b.addClassName("tl"),f=new Element("td"),f.addClassName("t"),"titled"===s.style&&i&&(f.style.width=i-42+"px"),y=new Element("td"),y.addClassName("tr"),"top"===t&&(g=new Element("img",{src:"/static/images/"+v+"_arrow_top.png"}),g.addClassName("tarrow"),"titled"===s.style?(g.addClassName("arrow-"+n),r=new Element("div"),r.addClassName("arrow-container"),i&&(r.style.width=i-42+"px"),r.__sert(g),f.__sert(r)):(f.style.textAlign=n,f.__sert(g))),k.__sert(b),k.__sert(f),k.__sert(y),w.__sert(k),x=new Element("tr"),d=new Element("td"),d.addClassName("l"),"left"===t&&(o="titled"===s.style?new Element("img",{src:"/static/images/bluebubble_arrow_left-vfl8zzy_-.png"}):new Element("img",{src:"/static/images/bubble_arrow-vfl8m7tk-.png"}),o.addClassName("arrow"),d.__sert(o),d.vAlign=n),c=new Element("td"),c.addClassName("c"),c.update(e),h=new Element("td"),h.addClassName("r"),"right"===t&&(m=new Element("img",{src:"/static/images/bubble_arrow_right-vflmW3_2s.png"}),m.addClassName("rarrow"),h.__sert(m),h.vAlign=n),x.__sert(d),x.__sert(c),x.__sert(h),w.__sert(x),E=new Element("tr"),u=new Element("td"),u.addClassName("bl"),a=new Element("td"),a.addClassName("b"),"bottom"===t&&(l=new Element("img",{src:"/static/images/"+v+"_arrow_bottom.png"}),l.addClassName("barrow"),"titled"===s.style?(l.addClassName("arrow-"+n),r=new Element("div"),r.addClassName("arrow-container"),i&&(r.style.width=i-42+"px"),r.__sert(l),a.__sert(r)):(a.style.textAlign=n,a.__sert(l))),_=new Element("td"),_.addClassName("br"),E.__sert(u),E.__sert(a),E.__sert(_),w.__sert(E),p.__sert(w),p}};var It;It=INLINE_JS.FreshDropdown=Ze.FreshDropdown={show:function(e,t,n,i){var s,o,r,a;return null==i&&(i=!1),l(document).trigger("dropdownOpened",[1]),s=l(t),n||(n=s[0].offsetHeight+10),this.hide_all(),o=l(e).show(),a=o[0].offsetWidth,r=s[0].offsetWidth,He.clone_position(o,s,{setHeight:!1,setWidth:!1,offsetLeft:-1*(a-r)+22,offsetTop:n}),i&&o.width(a),s.addClass("pressed"),(function(e){return function(){return document.observe("click",It.hide_all)}})(this).defer()},hide_all:function(e){var t,n;return n=l(".freshdropdown-menu"),t=0,n.each(function(){if(l(this).is(":visible"))return t+=1}),n.hide(),l(document).trigger("dropdownClosed",[t]),$$(".freshdropdown-button").invoke("removeClassName","pressed"),document.stopObserving("click",It.hide_all)}};var Rt;Rt=Ze.JumpWatcher={inverval:null,last_hash:null,last_page_offset:0,check:function(){return window.location.href.endsWith("#")&&0===window.pageYOffset&&0!==Rt.last_page_offset?this.report():(this.last_page_offset=window.pageYOffset,this.last_hash=Ge.parse(window.location.href).fragment)},report:function(){return clearInterval(Rt.interval),reportStack("Hash jump detected, last hash = "+this.last_hash+". You may have an onclick handler that isn't firing, or you are not preventing the default action (eg. by returning false in your handler)")}};var Ot;Ot=INLINE_JS.Modal=Ze.Modal={KEY_SCOPE:"modal",width:640,vertical_offset:90,show:function(e,n,i,s,o,r,a,u,_){var c,d,h,m,f;return null==i&&(i=!1),null==s&&(s=!1),null==o&&(o=!1),null==r&&(r=!1),null==a&&(a=""),null==u&&(u=!0),null==_&&(_=!1),Ot.shown()&&Ot._cleanup(),o=o||this.width,d="#modal-content .error-message, #modal-content .error-removable, #modal-content .error-bubble",$$(d).invoke("hide"),assert(n,"Missing modal content!"),f=this.vars._prev_scope,this.vars=i||{},this.vars._prev_scope=f,$("modal").setStyle({width:o+"px",margin:"0 0 0 "+Math.floor(-o/2).toString()+"px"}),this.vars.extra_class="",a&&($("modal").addClassName(a),this.vars.extra_class=a),r||(m=ht.childElement($("modal-content"),0),m&&m!==n&&$("grave-yard").__sert(m),c=new Element("div"),c.update(n),$("modal-content").__sert(c),n.show&&n.show(),Element.show("modal")),l("#modal-overlay").off("click"),u?l("#modal-overlay").on("click",function(e){return Ot.hide(null,!1,!0),e.preventDefault(),e.stopPropagation()}):l("#modal-overlay").on("click",function(e){return e.preventDefault(),e.stopPropagation()}),this.fix_position(),$("modal-overlay").show(),$("modal-behind").setStyle({width:o+20+"px",margin:"0 0 0 "+Math.floor(-o/2-10).toString()+"px"}),l("#modal-behind").css("opacity",.2),$("modal-behind").show(),s?$("modal-content").select("#"+s.id).first().focus():ht.ie||(h=$("modal").down("input[type=submit]")||$("modal").down("input[type=button]"),h&&h.focus()),this.track_id||this.track_resizes(),e?(ht.isElm(e)?l("#modal-title").html(e):l("#modal-title").text(e),l("#modal-title").show(),l("#modal-title").text()):l("#modal-title").hide(),At.register(!1,"modal"),this.keydownHandler=this.keydown.bind(this),document.observe("keydown",this.keydownHandler),$("modal-content").style.height="auto",t.getScope()!==this.KEY_SCOPE&&(this.vars._prev_scope=t.getScope()),t.setScope(this.KEY_SCOPE),this.prevent_hide_if_loading=_,l("#modal").find("input").filter(":visible:first").focus(),this.in_viewport()&&(this.scroll_locked=!0,He.scroll_lock_document()),l(document).trigger("modalOpened",[1]),!1},in_viewport:function(){var e,t,n,i,s;return e=l("#modal"),t=e.height(),s=e.width(),n=He.viewport_dimensions(),i=He.viewport_offset(e),i.left>0&&i.top>0&&i.left+s<n.width&&i.top+t<n.height},fix_position:function(e){var t,n;return n=document.viewport.getScrollOffsets().top+this.vertical_offset,t=parseInt($("modal").getStyle("height"),10),t+this.vertical_offset<document.viewport.getHeight()?($("modal").setStyle({position:"fixed",top:this.vertical_offset+"px"}),$("modal-behind").setStyle({position:"fixed",height:t+20+"px",top:this.vertical_offset-10+"px"})):($("modal").setStyle({position:"absolute",top:n+"px"}),$("modal-behind").setStyle({position:"absolute",height:t+20+"px",top:n-10+"px"}))},keydown:function(e){var t,n,i,s;if(i=e.keyCode||e.which||e.charCode,(27===i||8===i&&!He.focus_in_input())&&(e.preventDefault(),this.hide(null,!1,!0)),9===i&&!He.focus_in_input()){for(n=$("modal").down("input[type=text], input[type=email]"),s=$("modal").down(".modal-tabs"),t=s;t&&t.next();)if(t=t.next(),t.visible()){n=t.down("input[type=text], input[type=email]");break}if(n)return e.preventDefault(),n.focus()}},shown:function(){return $("modal").visible()},hide:function(e,n,i){return e&&Event.stop(e),!this.should_prevent_hide()&&(this.prevent_hide_if_loading=!1,this.onHide?void this.onHide(i):(this.onHide=null,Element.hide("modal-behind"),Element.hide("modal-overlay"),$("modal").removeClassName(this.vars.extra_class),n?$("modal").style.marginLeft="-10000000px":Element.hide("modal"),Ot._cleanup(),this.track_id&&(clearInterval(this.track_id),this.track_id=!1),document.stopObserving("keydown",this.keydownHandler),document.activeElement&&[document,window,document.body].indexOf(document.activeElement)===-1&&$(document.activeElement).blur(),t.setScope(this.vars._prev_scope)))},_cleanup:function(){if(l(document).trigger("modalClosed",[1]),this.scroll_locked)return He.scroll_unlock_document()},should_prevent_hide:function(){return this.prevent_hide_if_loading&&a.some(l("#modal form"),function(e){return e.ajax_submitted})},track_resizes:function(){return this.track_id=setInterval(this.on_resize.bind(this),150)},on_resize:function(){var e;if(e=$("modal").getHeight(),this.old_height!==e||$("modal-behind").getHeight()<e)return this.old_height=e,this.fix_position()},vars:{}};var Lt;Lt=Ze.SickInput={init:function(){var e,t,n,i,s;for(i=$$(".sick-input"),s=[],t=0,n=i.length;t<n;t++)e=i[t],e.hasClassName("sickified")||s.push(this._create(e));return s},_create:function(e){var t,n,i;if(null!=e)return n=e.identify(),i=e.down("input")||e.down("textarea")||e.down("select"),i.observe("focus",function(){return e.addClassName("focused")}),i.observe("blur",function(){return e.removeClassName("focused")}),t=function(){if(e.hasClassName("populated")&&""===i.getValue()?e.removeClassName("populated"):e.hasClassName("populated")||""===i.getValue()||e.addClassName("populated"),n in Lt._handler_map)return Lt._handler_map[n]()},$t.show_errors(),t(),setInterval(t,100)},_handler_map:{},add_interval_handler:function(e,t){var n;return n=e.identify(),this._handler_map[n]=t},remove_interval_handler:function(e,t){var n;if(n=e.identify(),this._handler_map[n]===t)return delete this._handler_map[n]}};var Mt;Mt=Ze.TitleBubble=(function(){var e,t,n,i,s,o,r;return r=0,e=0,o=function(e){return r=e},s=function(i){var s,o,a,u,_,c,d,h,m,f,p;return o=l(i.currentTarget),p=o.attr("title"),(null!=p?p.length:void 0)&&(o.attr("data-title",p),o.removeAttr("title")),_=parseInt(o.data("title-delay")),u="title-bubble-"+e++,o.data("bubble-id",u),s=l("<div/>",{id:u,class:"title_bubble_container"}),_||(s.css({opacity:0}),s.addClass("has-transition")),o.hasClass("white")&&s.addClass("white"),o.hasClass("black")&&s.addClass("black"),s.text(o.attr("data-title")),h=o.attr("data-title-html"),s.html(h),f="yes"!==o.attr("data-title-hide-tail"),f&&(a=l("<div/>",{class:"tail"}),s.append(a)),l(document.body).append(s),d=n(o[0],s[0]),c=t(d,s[0],o[0]),He.clone_position(s,o,{setWidth:!1,setHeight:!1,offsetTop:c.top-r,offsetLeft:c.left}),s.addClass("position-"+d),f&&He.clone_position(a,o,{setWidth:!1,setHeight:!1,setTop:!1,offsetLeft:c.left+c.tail_offset_left+l(s).outerWidth()/2}),m=function(){var e;if(s.data("pending-delay")&&o.data("bubble-id")===u)return e=parseInt(o.data("title-fade-time"))||400,s.fadeIn(e)},_?(s.hide(),s.data("pending-delay",!0),setTimeout(m,_)):s.css({opacity:""})},n=function(e,t){var n,i,s;if(e=$(e),s=e.getAttribute("data-title-position"),n=document.viewport.getDimensions(),i=e.viewportOffset(),"above"!==s&&"below"!==s&&"right"!==s&&"left"!==s&&(s="above"),"left"===s){if(i.left<t.width)return"right"}else if("right"===s){if(n.width-(i.left+e.getWidth())<t.width)return"left"}else if("below"===s){if(n.height-(i.top+e.getHeight())<t.height)return"above"}else if("above"===s&&i.top<t.height)return"below";return s},t=function(e,t,n){var i,s,o,r,a,l,u,_,c,d;return t=$(t),n=$(n),o=document.viewport.getDimensions(),i=t.getDimensions(),r=n.viewportOffset(),s=6,a=0,l=0,c=0,d=0,"below"!==e&&"above"!==e||(l="below"===e?n.getHeight()+s:-1*i.height-s,u=n.getWidth()/2-i.width/2,r.left+u+i.width>o.width?(a=o.width-r.left-i.width,c=u-a-5):(a=u,c=-5)),"left"!==e&&"right"!==e||(a="right"===e?n.getWidth()+s:-1*i.width-s,_=n.getHeight()/2-i.height/2,r.top+_+i.height>o.height?(l=o.height-r.top-i.height,d=_-l-5):(l=_,d=-5)),{left:a,top:l,tail_offset_left:c,tail_offset_top:d}},i=function(e){var t,n,i;return n=l(null!=e?e.currentTarget:void 0),t=l("#"+n.data("bubble-id")),t.data("pending-delay")?(t.removeData("pending-delay"),i=parseInt(n.data("title-fade-time"))||400,t.fadeOut(i,function(){return t.remove()})):t.remove()},{init:function(){return l(document).on("mouseenter",".title_bubble",s),l(document).on("mouseleave",".title_bubble",i).on("mouseup",".title_bubble",i),l(document).on("mouseenter",".title_bubble_sticky",s),l(document).on("mouseleave",".title_bubble_sticky",i)},set_vertical_space:o,hide_all:function(){return l(".title_bubble_container").remove()}}})();var jt;jt=INLINE_JS.Tooltip=Ze.Tooltip={attach:function(e,t,n,i){var s,o;return null==i&&(i={}),e=$(e),n=n?$(n):null,s=Nt.make(t,e.tail_position,i.tail_position,i.width,i),s.setStyle({display:"none",position:"absolute"}),$("floaters").__sert(s),e.match("#modal-content *")||e.match(".db-modal-content *")?s.style.zIndex="13001":s.style.zIndex="","right"===e.tail_position&&(o=ht.ie?32:12,s.style.marginLeft=-(s.getWidth()+e.getWidth()+o)+"px"),e.tooltip=s,e.out_target=!!n,e.observe("mouseout",this.mouseout("target",e)),e.observe("mouseover",this.mouseover("target",e)),e.out_trigger=!n,n&&(n.observe("mouseout",this.mouseout("trigger",e)),n.observe("mouseover",this.mouseover("trigger",e))),e.out_tooltip=!0,s.observe("mouseout",this.mouseout("tooltip",e)),s.observe("mouseover",this.mouseover("tooltip",e))},update:function(e,t){if(e.tooltip)return $(e.tooltip).update(t)},mouseover:function(e,t){return function(){return t["out_"+e]=!1}},mouseout:function(e,t){return function(){return t["out_"+e]=!0,jt.hide_if_out.defer(t)}},show_by:function(e){var t,n;return t=l(e.tooltip),e=l(e),t.show(),n=Math.floor(t[0].offsetHeight/2),He.clone_position(t,e,{setWidth:!1,setHeight:!1,offsetTop:Math.floor(e[0].offsetHeight/2)-n,offsetLeft:e[0].offsetWidth+1})},hide_if_out:function(e){var t;if(e.out_target&&e.out_trigger&&e.out_tooltip)return t=$(e.tooltip),t.hide()},show:function(e,t,n,i,s){return null==i&&(i="left"),e=$(e),e.tail_position||(e.tail_position=i),n=n?$(n):null,e.tooltip||this.attach(e,t,n,s),this.show_by(e)}};INLINE_JS.TreeView=Ze.TreeView={tv:{},loaded:!1,user:null,role_icon:"",set_params:function(e){return this.ajax_params=e},init:function(e,t,n){var i;return null==n&&(n="treeview"),this.tv[n]={},i=this.tv[n],i.autohide=null===t||t,i.handler=e,i.viewdiv=$(n),i.hidefunc=this.hide.bindAsEventListener(this),this.ajax_params={}},schedule_reset:function(){return this.loaded=!1},reset:function(e){var t,n,i,s,o,r,a;return t={url:"/ajax_subtreeview",data:l.extend({},this.ajax_params),success:(function(t){return function(n){var i,s;i=[];for(s in t.tv)t.tv.hasOwnProperty(s)?(t.tv[s].viewdiv.down(".treeview-folders").update(n),e&&e.onSuccess?i.push(e.onSuccess(n)):i.push(void 0)):i.push(void 0);return i}})(this)},(null!=e?e.user:void 0)?(e.user.id!==(null!=(n=this.user)?n.id:void 0)&&(o=l("<p />",{id:"treeview-loading"}),r=l("<img />",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),o.append(r),a=" "+ct("Loading your folders"),o.append(a),l("#dest-treeview .treeview-folders").html(o),this.user=e.user),t.subject_user=e.user,s=De.get_role_title(e.user),i=De.get_viewer().is_paired?e.user.is_team?"s_briefcase":"s_house":"dropbox",s||(s=ct("Dropbox")),l("#first-treeview-link span").text(s),ye.replace(l("#root-img")[0],"web",this.role_icon,i),this.role_icon=i):l("#first-treeview-link span").text(ct("Dropbox")),d.SilentBackgroundRequest(t)},toggle:function(e,t){var n;return Event.stop(e),n=this.tv[t||"treeview"],n.shown?(n.shown=!1,this.hide(e,t)):(n.shown=!0,this.show(e.target,t)),!1},hide:function(e,t){var n;if(n=this.tv[t||"treeview"],!e||!$(e.target).descendantOf(n.viewdiv))return n.viewdiv.hide(),Event.stopObserving(window,"click",n.hidefunc),n.shown=!1},show:function(e,t){var n,i;return i=this.tv[t||"treeview"],e=$(e),e.blur(),n=e.cumulativeOffset(),i.viewdiv.setStyle({top:n.top+e.getHeight()+"px",left:n.left-4+"px"}),i.viewdiv.show(),Event.observe(window,"click",i.hidefunc)},toggleNode:function(e){var t;return e=$(e),t=e.down("img"),t.className.match("bullet_plus")?ye.replace(t,"web","bullet_plus","bullet_minus"):ye.replace(t,"web","bullet_minus","bullet_plus"),e.up().next("div").toggle(),e.blur(),!1},toggleNodeAjax:function(e,t,n){var i,s;return e.fetched_children?this.toggleNode(e):(e=$(e),i=e.down("img"),s=ye._get(i),i.src="/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",d.SilentBackgroundRequest({url:"/ajax_subtreeview"+t,data:l.extend({},this.ajax_params),subject_user:n,success:(function(t){return function(n){var o;return o=new Element("div",{style:"display: none;"}).update(n),e.up().__sert({after:o}),e.fetched_children=!0,ye._set(i,s),t.toggleNode(e)}})(this),complete:function(){if(/loading/.match(i.src))return ye._set(i,s)}}),!1)},handle:function(e,t){var n,i;if(n=$H(this.tv).keys(),i=$(t).ancestors().find(function(e){return n.include(e.id)}))return i=this.tv[i.id],l(document).trigger("db:treeview_selected",[e]),i.handler&&i.handler(e,t),i.autohide&&this.hide(i.id),!1},move:function(e,t,n){var i;return i=$(e),this.loaded?n&&n.onSuccess&&n.onSuccess():this.reset({onSuccess:(function(i){return function(){return i.loaded=1,i.move(e,t,n)}})(this),user:null!=n?n.user:void 0}),assert(i,"Couldn't find tree_id"),assert($(t),"Couldn't find location_id"),$(t).appendChild(i),i.show()}};var Ft;Ft=Ze.ULSelectMenu=(function(){var e,t,n,i,s,o,r,a,u,_,c;return e=function(e){return e.removeClassName("shown")},c=function(e){return e.toggleClassName("shown")},r=function(){return this.removeClassName("hover")},o=function(){return this.addClassName("hover")},a=function(e,t){var n,i,s,o;for(s=[],n=0,i=t.length;n<i;n++)o=t[n],s.push(e.insert(o));return s},i=function(e,t,n){if(a(e,n),e.firstChild!==t)return e.__sert({top:t})},u=function(e,t){var n;return n="selected",l(e).find("."+n).removeClass(n),l(t).addClass(n)},_=function(e,t){var n,i,s,o,r;for(o=e.select("li"),r=[],i=0,s=o.length;i<s;i++)n=o[i],n.getAttribute("data-value")===t?r.push(u(e,n)):r.push(void 0);return r},s=function(t,n,s){return function(o){return t.hasClassName("selected")?(i(n,t,s),c(n)):(u(n,t),n.fire("db:change",t.getAttribute("data-value")),e(n))}},t=function(t){var n,i,a,l,u,_,c,d;if(l=t.select("li"),assert(l.length,"Empty list of options "+t.identify()),u=void 0,1===l.length)t.addClassName("one");else{for(i=0,a=l.length;i<a;i++)n=l[i],c=n.getAttribute("data-value"),assert(c,n.identify()+" missing data value"),n.observe("click",s(n,t,l)),n.observe("mouseenter",o),n.observe("mouseleave",r),n.hasClassName("selected")&&(u=n);$(document.body).observe("click",function(n){if($(n.target).up(".ul_select_menu")!==t)return e(t)})}return u||(u=l[0]),u.addClassName("selected"),d=new Element("span"),_=u.getDimensions(),d.setStyle({width:_.width+"px",height:_.height+"px",position:"relative",display:"inline-block"}),t.wrap(d)},n=function(){var e,n,i,s,o;for(s=$$(".ul_select_menu"),o=[],n=0,i=s.length;n<i;n++)e=s[n],o.push(t(e));return o},l(n),{init:function(e){return t(e)},set_selected_by_value:_}})();var Ut;Ut=Ze.DBCalendar=Class.create({initialize:function(e,t){return this.options=t||{},this.container=$(e),assert(this.container,"Couldn't find the element"),this.today=new Date,this.options.disable_future&&(this.options.last_day=ht.start_of_day(this.options.last_day||this.today)),this.options.disable_past&&(this.options.first_day=ht.start_of_day(this.options.first_day||this.today)),this.view_date=ht.start_of_day(this.options.selected_date||this.today),this.selected_date=ht.start_of_day(this.options.selected_date||this.today),this.render()},_change_month:function(e,t){return Event.stop(e),this.view_date.setMonth(t),this.render()},is_valid_date:function(e,t,n,i,s){var o;return e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10),i=parseInt(i,10),s=parseInt(s,10),i=i||1970,s=s||(new Date).getFullYear()+1,t+=1,!(n<i)&&(!(n>s)&&(!(t<1||t>12)&&(!(e<=0)&&(2===t?(o=n%4===0&&(n%100!==0||n%400===0),o?e<=29:e<=28):4===t||6===t||9===t||11===t?e<=30:e<=31))))},change_date:function(e,t,n){var i;if(this.is_valid_date(e,t,n))return i=n!==this.view_date.getFullYear()||t!==this.view_date.getMonth(),this.selected_date=new Date(n,t,e),i?(this.view_date.setMonth(t),this.view_date.setFullYear(n),this.render()):(l(this.container).find(".selected").removeClass("selected"),l(this.container).find("a#day"+e+"-"+t).addClass("selected")),this.options.onDateChange?this.options.onDateChange(this.selected_date):void 0},render:function(){var e,t,n,i,s,o,r,a,u,_;return t=this.render_days(),i=l(".current-month",t),r=i.first().data("date"),o=i.last().data("date"),_=r<=this.options.first_day,u=o>=this.options.last_day,e=new Element("div"),e.addClassName("calendar clearfix"),u||(this._next_month=function(e){return this._change_month(e,this.view_date.getMonth()+1)}.bind(this),s=new Element("a"),s.addClassName("changemonth next"),s.update(ye.make("web","arrowright",{})),Event.observe(s,"click",this._next_month),e.__sert(s)),_||(this._prev_month=function(e){return this._change_month(e,this.view_date.getMonth()-1)}.bind(this),a=new Element("a"),a.addClassName("changemonth prev"),a.update(ye.make("web","arrowleft",{})),Event.observe(a,"click",this._prev_month),e.__sert(a)),n=new Element("h5"),n.update(ct("%(month)s %(year)s",{comment:"For example 'January 2010'. This is used as part of a calendar."}).format({month:T.month_name(this.view_date.getMonth()),year:this.view_date.getFullYear()})),e.__sert(n),e.__sert(t),this.container.__date(e)},render_days:function(){var e,t,n,i,s,o,r,a,l;for(t=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1),a=t.getDay(),e=new Element("div"),e.addClassName("days"),n=s=l=a;l<=0?s<0:s>0;n=l<=0?++s:--s)r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r.setDate(r.getDate()-n),e.__sert(this.render_day(r,!0));for(i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);i.getMonth()===this.view_date.getMonth();)e.__sert(this.render_day(i)),i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),i.getDate()+1);for(o=new Date(this.view_date.getFullYear(),this.view_date.getMonth()+1,0);6!==o.getDay();)o=new Date(o.getFullYear(),o.getMonth(),o.getDate()+1),e.__sert(this.render_day(o,!0));return e},render_day:function(e,t){var n,i;return i=!t,this.options.last_day&&(t=t||e>this.options.last_day),this.options.first_day&&(t=t||e<this.options.first_day),n=new Element(t?"span":"a"),l(n).data("date",e),i&&n.addClassName("current-month"),n.update(e.getDate()),n.addClassName("date"),n.writeAttribute("id","day"+e.getDate()+"-"+e.getMonth()),this.selected_date.getDate()===e.getDate()&&this.selected_date.getMonth()===e.getMonth()&&this.selected_date.getFullYear()===e.getFullYear()&&n.addClassName("selected"),t?n.addClassName("inactive"):(this._handler=function(e){var t;return t=e.target.identify().substr(3).split("-"),this.change_date(t[0],this.view_date.getMonth(),this.view_date.getFullYear())}.bind(this),Event.observe(n,"click",this._handler)),n}});Ze.DatePickerInput=Class.create({initialize:function(e,t){var n,i,s,o;return this.container=e,this.options={},Object.extend(this.options,t||{}),this.input=this.container.down(".input-date"),this.display=this.container.down(".visible-date"),o=this.input.value?ht.from_mysql_date(this.input.value):new Date,this.container.hasAttribute("data-first")&&(s=ht.from_mysql_date(this.container.getAttribute("data-first"))),n=null==this.options.disable_future||this.options.disable_future,i=null==this.options.disable_past||this.options.disable_past,this.cal_container=this.container.down(".cal-container"),this.calendar=new Ut(this.cal_container,{onDateChange:this.onDateChange.bind(this),first_day:s,disable_future:n,disable_past:i,selected_date:o}),this.container.observe("click",this.show_cal.bindAsEventListener(this)),$(document.body).observe("click",this.hide_cal.bind(this)),this.onDateChange(o)},show_cal:function(e){var t;if(e&&Event.stop(e),t=$(e.target),!t.match(".cal-container")&&!t.up(".cal-container"))return l(".cal-container").hide(),this.cal_container.show()},hide_cal:function(){return this.cal_container.hide()},onDateChange:function(e){return this.input.value=ht.to_mysql_date(e,!1),this.display.update(mn.localize(e)),this.hide_cal()}});Ze.TextInputDatePicker=Class.create({initialize:function(e,t){var n,i,s,o;return this.options={include_seconds:!0,include_microseconds:!0,choose_eod:!1},Object.extend(this.options,t||{}),this.input=$(e),assert(this.input,"Couldn't find the element "+e.toString()),s=new Date,o=!!this.input.value&&ht.from_mysql_date(this.input.value),i=new Date(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),this.cal_icon=ye.make("web","calendar_view_month",{align:"absmiddle"}),this.cal_container=new Element("div",{id:"cal_container_"+e,style:"display: none; position: absolute; z-index: 1"}),this.calendar=new Ut(this.cal_container,{onDateChange:this.onDateChange.bind(this),last_day:i,selected_date:o}),this.input.__sert({after:this.cal_icon}),this.cal_icon.observe("click",this.toggle_cal.bindAsEventListener(this)),n=l(this.input),He.clone_position(l(this.cal_container),n,{setWidth:!1,setHeight:!1,offsetTop:n[0].offsetHeight}),this.cal_icon.__sert({after:this.cal_container})},toggle_cal:function(e){return e&&Event.stop(e),this.cal_container.toggle()},hide_cal:function(e){return e&&Event.stop(e),this.cal_container.hide()},onDateChange:function(e){return this.options.choose_eod&&e.setTime(ht.start_of_day(e).getTime()+86399999),this.input.value=ht.to_mysql_date(e,this.options.include_seconds,this.options.include_microseconds),this.hide_cal()}}),O.window_load(At.register.bind(At)),l(Lt.init.bind(Lt)),Event.observe(window,"scroll",function(){return Mt.hide_all()}),l(function(){return Rt.interval=setInterval(Rt.check.bind(Rt),500),Mt.init()});var qt;qt=INLINE_JS.BonusTable=Ze.BonusTable={_tmpl:null,_inited:null,_next_page:0,_fetching_page:!1,init:function(e){if(this.user_id=e,!qt._inited&&$("bonus-loading"))return qt._inited=!0,$("bonus-loading").show(),qt._tmpl=We.tmpl("bonus_row_tmpl"),qt.listen(),qt.get_next_page()},_render:function(e){var t,n,i,s;for(t=[],n=0,i=e.length;n<i;n++)s=e[n],t.push(qt._tmpl({row:s,Sprite:ye}));return $("bonus-table").__sert(t)},get_next_page:function(){if(!qt._fetching_page)return qt._fetching_page=!0,new Ajax.DBRequest("/account/bonus_page/"+qt._next_page,{onSuccess:function(e){var t,n,i;return t=e.responseText.evalJSON(),i=t.rows,n=t.has_more,qt._render(i),$("bonus-loading").hide(),n?(qt._next_page+=1,$("load-more-bonus").show()):$("load-more-bonus").hide(),qt._fetching_page=!1},subject_user:this.user_id})},_max_referral_over:function(e){var t,n,i;return n=l(e.currentTarget),i=ct("You've earned the maximum amount of referral space. Thanks for inviting people to Dropbox!"),t=l(Nt.make(i,"right","middle")),Element.absolutize(t[0]),n.append(t),He.clone_position(t,n,{setWidth:!1,setHeight:!1}),t.css({width:"200px",left:parseInt(t.css("left"),10)-210+"px",top:parseInt(t.css("top"),10)-55+"px"})},_max_referral_out:function(e){var t,n,i,s,o;for(s=l(".reached-max-referral-bonus .bubble"),o=[],n=0,i=s.length;n<i;n++)t=s[n],o.push(t.remove());return o},listen:function(){return l("#load-more-bonus").on("click",qt.get_next_page.bind(qt)),l(document).on("mouseenter",".reached-max-referral-bonus",qt._max_referral_over),l(document).on("mouseleave",".reached-max-referral-bonus",qt._max_referral_out)},toggle:function(){return l("#bonus-list").is(":visible")?(this.hide(),l("#space-earned-link").text(ct("View all space earned"))):(this.show(),l("#space-earned-link").text(ct("Hide space earned")))},show:function(){return l("#bonus-list").slideDown(150)},hide:function(){return l("#bonus-list").slideUp(150)}};var Pt;INLINE_JS.DowngradeReasons=Ze.DowngradeReasons={reasons:{},addReason:function(e){return this.reasons[e]=!0},addReasons:function(e){var t,n,i,s;for(s=[],t=0,i=e.length;t<i;t++)n=e[t],s.push(this.addReason(n));return s},change:function(e,t,n){var i,s,o,r,a,l;e=parseInt(e,10),s=$(t),assert(s,"Couldn't find container for DowngradeReason"),i=!1,a=this.reasons;for(r in a)o=a[r],l=$(n+r),assert(l,"Couldn't find container for "+(n+r)),o&&parseInt(r,10)===e?(l.show(),i=!0):l.hide();return i?s.show():s.hide()}},Pt=Ze.DowngradeReasons2={init:function(){var e,t,n,i;for(i=["input[name=downgrade_reason_id]","input[name=other_reason_id]"],e=0,t=i.length;e<t;e++)n=i[e],l(n).change(function(e){var t;return t=e.target.id.indexOf("other")>=0,Pt.change(t,e.target.getValue())});return l(".shared-additional-info").attr("name","shared_additional_info")},change:function(e,t){var n;if(l(".downgrade-other-reason .error-message").hide(),!e)return n="#downgrade-info-"+t,l(".downgrade-info").hide(),l(n).show(),l(".downgrade-info textarea").removeAttr("name"),l(n+" textarea").attr("name","additional_info"),l("input[name=other_reason_id]").removeAttr("checked")}},Ze.DowngradeSurvey={init:function(){var e;return e="#downgrade-survey-form",l(""+e).on("submit",(function(t){return function(t){var n,i;if(i=l(e+" input[name=other_reason_id]:checked").length,n=l(e+" input[id=downgrade-radio-8]"),n.is(":checked")&&0===i)return l(".downgrade-other-reason .error-message").show(),t.preventDefault()}})(this))}},Ze.TrialDowngradeReasons={init:function(){return l(document).on("click",".reasons-option",function(e){var t,n,i,s;if(i=e.target.getValue(),s=e.target.name,"other_reason_id"===s&&(n="#other-info-"+i,l(".other-info").hide(),l(n).show()),"downgrade_reason_id"===s)return t="#downgrade-info-"+i,l(".downgrade-info").hide(),l(t).show()}),l("#downgrade-survey-form").on("submit",function(e){var t,n;return n=l("#downgrade-survey-form input[id=downgrade-radio-207]"),n.is(":checked")&&0===l(".q1-other-reason.textinput").val().length?(l(".trial-downgrade--error-message").show(),void e.preventDefault()):(t="",l(".reasons-option:checked").each(function(e,n){var i,s,o;if(i=n.getValue(),s=l("#downgrade-info-"+i+" textarea").val(),o=l("#other-info-"+i+" textarea").val(),(null!=s?s.length:void 0)>0&&(t=i+":"+s),(null!=o?o.length:void 0)>0)return t=t+" "+i+":"+o}),l(".downgrade-info textarea").removeAttr("name"),l(".other-info textarea").removeAttr("name"),l('#downgrade-survey-form input:hidden[name="additional_info"]').val(t))})}};var zt;zt=INLINE_JS.GetSpace=Ze.GetSpace={_current_space:null,_why_msg:null,_twitter_url:null,offer_highlight_color:"#ffa",init:function(e,t,n){var i;if(zt._current_space=e,zt._why_msg=t,zt._twitter_url=n,$("space-actions").on("click",".space-action",zt.perform_action),i=Ge.parse(window.location.href).fragment)return zt.highlight_offer(i)},highlight_offer:function(e){var t,n;return t=l("#"+e),n=t.css("background-color"),t.css("background-color",zt.offer_highlight_color).delay(2e3).animate({"background-color":n}).queue(function(){return t.css("background-color","")})},perform_action:function(e){var t,n;return e.preventDefault(),n={contact_sales:zt._contact_sales,contact_support:zt._contact_support,teams:zt._teams,upgrade:zt._upgrade,plans:zt._plans,refer:zt._refer,get_started:zt._get_started,fb_link:zt._fb_link,twitter_follow:zt._twitter_follow,why_like:zt._why_like,mailbox_link:zt._mailbox_link},t=$(e.target),t.hasClassName("space-action")||(t=t.up(".space-action")),n[t.id]()},_teams:function(){return window.location.href="/business?tk=dropbox&ag=getspace&ad=v1"},_contact_sales:function(){return window.location.href="mailto:sales@dropbox.com"},_contact_support:function(){return window.location.href="/support"},_plans:function(){return window.location.href="/plans"},_upgrade:function(){return window.location.href="/upgrade"},_refer:function(){return window.location.href="/referrals"},_get_started:function(){return window.location.href="/gs"},_fb_link:function(){return k.do_auth(function(){return zt._refresh_link_bonuses(),zt._completed($("fb_link"))},De.get_viewer().personal_user.id)},_twitter_follow:function(){return pn.do_auth_and_follow_dropbox(De.get_viewer().personal_user.id)},_why_like:function(){return Ot.show(ct("Tell us why you love Dropbox"),$("why-i-like-modal")),$("why-i-like-input").focus(),ht._track_twitter_chars_left("why-i-like-input",90)},_mailbox_link:function(){return window.location.href="http://www.mailboxapp.com/"},submit_why:function(){return zt._why_msg=$F("why-i-like-input"),$t.ajax_submit($("why-i-like-form"),!1,function(){return Ot.hide(),zt._completed($("why_like"))},!1,$("why-i-like-submit"))},_completed:function(e){var t,n;return e.addClassName("completed"),null!=(n=e.down(".icon-col"))&&n.__date(Element("img",{src:"/static/images/check_36-vflimxFPn.png"})),l(e).css("opacity",.5).fadeTo(500,1),setTimeout(function(){return l(e).css("opacity",1).slideUp().animate({opacity:0},{queue:!1,duration:"normal"})},1500),t=parseInt(e.down(".space").readAttribute("data-space"),10),zt._current_space+=t,$("current-space").__date(N.format_bytes(zt._current_space)),$("current-space").addClassName("updated"),setTimeout(function(){return $("current-space").removeClassName("updated")},5e3)},_refresh_link_bonuses:function(){return new Ajax.DBRequest("/social_recheck")}};Ze.Help={toggle_more_help:!1,show_os:function(e,t,n){return t=$(t),$$(".os-filter").invoke("removeClassName","selected"),t.addClassName("selected"),$$(".help-os-section").invoke("hide"),$$(".help-os-"+n).invoke("show"),Event.stop(e)},vote:function(e,t){return new Ajax.DBRequest("/help/"+e+"/vote/"+t),l("#help-vote-cont").fadeOut(),Ke.success(ct("Thanks for your feedback!"))}};var Bt,Ct=function(e,t){return function(){return e.apply(t,arguments)}
},Tt=function(e,t){function n(){this.constructor=e}for(var i in t)St.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},St={}.hasOwnProperty;Bt=Ze.DeleteFailuresModal=(function(e){function t(){return this.on_show=Ct(this.on_show,this),this.on_confirm_button_click=Ct(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Tt(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),window.location.href="/delete_failures?host_id="+this.host_id,this.hide()},t.prototype.on_show=function(e){var t;return t=_t("Dropbox couldn't delete %(num_failures)d file from the computer <strong>%(host_name)s</strong>. You can download the name of this file and the reason why it couldn't be deleted.","Dropbox couldn't delete %(num_failures)d files from the computer <strong>%(host_name)s</strong>. You can download the names of these files and the reasons why they couldn't be deleted.",this.num_failures).format({host_name:this.name.escapeHTML(),num_failures:this.num_failures}),this.$modal_window.find(".failures_message").html(t)},t})(nt),INLINE_JS.show_delete_failures_modal=Ze.show_delete_failures_modal=function(e,t,n){var i;return i=new Bt({element_id:"delete-failures-modal"}),i.host_id=e,i.name=t,i.num_failures=n,i.show(),!1};var Ht;Ht=Ze.News={DEFAULT_TAB:"recent-news",init:function(){return $("news-home").on("click","#nav a",function(e,t){var n;if(t.hasAttribute("data-div"))return e.preventDefault(),n=t.readAttribute("data-div"),B.push_state("/news/"+n)}),B.add_callback("/news",Ht.history_change)},change_tab:function(e){var t;if(t=$$("#nav a[data-div="+e+"]").first(),$(t))return $$(".section").invoke("removeClassName","selected"),$$("#nav a").invoke("removeClassName","selected"),$(t).addClassName("selected"),$(e).addClassName("selected")},history_change:function(e){return e=e||Ht.DEFAULT_TAB,Ht.change_tab(e)}};Ze.Recover={init:function(){var e;return e=$("recover-form"),e.observe("submit",this.form_submit.bind(this))},form_submit:function(e){return this.clear_error(),e.preventDefault(),$t.ajax_submit($("recover-form"),null,this.submit_response.bind(this))},submit_response:function(e){var t;if(t=JSON.parse(e.responseText),"error"===t.status&&this.show_error(t.msg),"ok"===t.status&&this.show_hosts(t),"redirect"===t.status)return window.location.href=t.url},show_hosts:function(e){var t,n,i,s,o,r,a;for($t.add_vars($("recover-form"),{check_file:"true"}),$("filename-to-create").update(e.filename),n=$("trusted-hosts"),n.update(),a=e.hosts,i=0,o=a.length;i<o;i++)t=a[i],r=new Element("li"),s="lnx","mac"===t.platform&&(s="osx"),"win"===t.platform&&(s="win"),r.__sert(ye.make("web",s)),r.__sert(new We(t.display_name.escapeHTML())),n.appendChild(r);return $("login-step").hide(),$("hosts-step").show()},show_error:function(e){return $("error-messages").update(e),$("error-messages").show()},clear_error:function(){return $("error-messages").update()}};var Yt;Yt=Ze.Restore={next:function(e,t){var n,i;return i=l("ul.selected"),n=i.next("ul"),n.addClass("selected"),i.removeClass("selected"),n.next("ul").length?l("#next-page").show():l("#next-page").hide(),l("#prev-page").show(),Yt.inc_page(1)},prev:function(e,t){var n,i;return i=l("ul.selected"),n=i.prev("ul"),n.addClass("selected"),i.removeClass("selected"),n.prev("ul").length?l("#prev-page").show():l("#prev-page").hide(),l("#next-page").show(),Yt.inc_page(-1)},inc_page:function(e){var t,n;return t=parseInt(l("#page_num").text(),10),n=t+e,l("#page_num").text(n)},init:function(e,t,n){var i;return i=De.get_viewer().get_user_by_id(n),l("#next-page").on("click",function(e){return Yt.next(e),!1}),l("#prev-page").on("click",function(e){return Yt.prev(e),!1}),l("#restore-submit-button").on("click",function(t){return Dt.do_folder_restore(e,i),!1}),l("#restore-cancel-button").on("click",function(e){return Pe.redirect(t)}),l("#restore-back-button").on("click",function(e){return Pe.redirect(t)})}};var Wt,Vt,Kt,Ct=function(e,t){return function(){return e.apply(t,arguments)}},Tt=function(e,t){function n(){this.constructor=e}for(var i in t)St.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},St={}.hasOwnProperty;Wt=Ze.SelectRoleModal=(function(e){function t(){return this.on_show=Ct(this.on_show,this),t.__super__.constructor.apply(this,arguments)}return Tt(t,e),t.prototype.on_select_role=null,t.prototype.on_show=function(){return l(".role-options li").click((function(e){return function(t){var n,i;return n=l(t.target).closest("li"),i=n.data("role"),assert(e.on_select_role,"missing on_select_role implementation"),e.on_select_role(i),e.hide()}})(this))},t})(nt),Kt=Ze.ShmodelC2DSelectRoleModal=(function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Tt(t,e),t.prototype.on_select_role=function(e){var t;return t=function(){return xt.show_c2d_modal(e)},De.get_viewer().is_role_signed_in(e)?t():G.show_modal({role:e,on_success:t})},t})(Wt),Vt=Ze.ShareShmodelSelectRoleModal=(function(e){function t(){return this.on_select_role=Ct(this.on_select_role,this),t.__super__.constructor.apply(this,arguments)}return Tt(t,e),t.prototype.on_select_role=function(e){return xt.prompt_login_then_share(this.options.link_url,this.options.short_url,this.options.tokenizer_type,e)},t})(Wt);Ze.TabController=Class.create({initialize:function(e,t){var n;return n=$(e),assert(n,e+" is missing."),this.container=n,this.options={killEvent:!0},Object.extend(this.options,t),this.listen()},listen:function(){var e,t,n,i,s,o;for(o=this,i=this.container.select("a"),s=[],t=0,n=i.length;t<n;t++)e=i[t],assert(e.id&&e.id.length>0,"Element is missing an id"),s.push(e.observe("click",function(e){return this.click(e)}.bindAsEventListener(o)));return s},click:function(e){return this.options.killEvent&&Event.stop(e),this.toggle($(e.target))},toggle:function(e){var t,n,i,s,o;if(o=this.container.down("a.selected"),o&&(s=$(o.id+"-content"),s&&s.hide()),this.container.select(".selected").invoke("removeClassName","selected"),n=!1,e||(e=this.container.down("a"),n=!0),e.addClassName("selected"),t=$(e.id+"-content"),t&&t.show(),this.options.onTabChange&&this.options.onTabChange(e,o),this.options.url_prefix)return i=this.options.url_prefix,n||(i+="/"+e.id),B.push_state(i)}});var Gt,Jt,Xt,Zt,Qt,en,tn,nn,sn,on,rn,an,ln,un,Ct=function(e,t){return function(){return e.apply(t,arguments)}},Tt=function(e,t){function n(){this.constructor=e}for(var i in t)St.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},St={}.hasOwnProperty;Je(["modules/core/browser"],function(e){}),nn={ACTIVE:1,PENDING:2,ERROR:3,REMOVED:4,SUSPENDED:5},rn=INLINE_JS.Team=Ze.Team={_use_async_reset:!1,team_id:De.get_viewer().team_id,set_team_id:function(e){this.team_id=e},setup_beta_modal_listeners:function(){var e,t,n,i,s,o,r,a,u,_,c,h,m,f,p;for(n=l(".feature-list .enroll-button"),t=l(".feature-list .enroll-button-admins"),s=l(".feature-list .feedback-button"),o=l(".generate-smart-sync-hosts-report"),r=0,c=n.length;r<c;r++)e=n[r],i=l(e).data("feature"),l(e).click((function(e){return function(){return new Jt(e,!0).show()}})(i)),e.disabled=!1;for(a=0,h=t.length;a<h;a++)e=t[a],i=l(e).data("feature"),l(e).click((function(e){return function(){return new Jt(e,!1).show()}})(i)),e.disabled=!1;for(u=0,m=s.length;u<m;u++)e=s[u],i=l(e).data("feature"),l(e).click((function(e){return function(){return new Xt(e).show()}})(i));for(p=[],_=0,f=o.length;_<f;_++)e=o[_],p.push(l(e).click((function(e){return function(){return d.WebRequest({url:"/team/smartsync/hosts/csv",data:{team_id:e.team_id,tzoffset:(new Date).getTimezoneOffset().toString()},dataType:"json",success:function(e){return 0===e.status?Ke.success(ct("Report started. Well email you when its ready.")):(console.error("Unexpected status from /team/smartsync/hosts/csv: "+e),Ke.error(ct("There was a problem completing this request.")))}})}})(this)));return p},init_admin:function(){return Mt.set_vertical_space(2),l("form.activity-report-generator").submit(this.submit_report_form.bind(this))},init_team_name_change_notice:function(){return l(".team_name_change_notice .hide_link").click((function(e){return function(t){return e.hide_team_name_change_banner()}})(this))},show_demo_signup_modal:function(e,t,n,i,s){var o,r,a,l;return this.webinar_key=e,this.webinar_iso_datetime=t,this.webinar_date=n,this.webinar_title=i,this.tab_url=s,l=ct("Register for a webinar on %(start_time)s").format({start_time:this.webinar_date}),r=new Zt({element_id:"demo-signup-modal",title:l}),r.show(),r.$modal_window.find("input[name=webinar_key]").attr("value",this.webinar_key),r.$modal_window.find("input[name=webinar_title]").attr("value",this.webinar_title),r.$modal_window.find("input[name=Sales_Webinar_Topic__c]").attr("value",this.webinar_title),r.$modal_window.find("input[name=Sales_webinar_date__c]").attr("value",this.webinar_iso_datetime),a=r.$modal_window.find("input[name=retURL]"),a.attr("value",a.val()+"#"+this.tab_url),o=r.$modal_window.find("#demo-signup-form")[0],o.on("submit",r.on_confirm_button_click)},show_unsuspend_modal:function(e,t,n,i){var s;return s=new tn({element_id:"dfe-unsuspend-modal",focus:"confirm"}),s.user_name=e||n,s.email=n,s.user_id=t,s.team_id=this.team_id,s.refresh_cb=i,s.show(),!1},show_remove_or_deactivate_modal:function(e,t,n,i,s,o,r,a,l){var u;return u=new Qt({element_id:"dfe-remove-or-deactivate-user-modal",focus:".new-collab-input"}),u.user_name=t||i,u.email=i,u.user_id=n,u.team_id=this.team_id,u.invited=s,u.limited=r,u.num_api_apps=o,u.hide_transfer_wipe=a,u.refresh_cb=l,u.show(),!1},show_remove_modal:function(e,t,n,i,s,o,r,a,l,u){var _;return _=new en({element_id:"dfe-remove-user-modal",focus:".new-collab-input"}),_.user_name=t||i,_.email=i,_.user_id=n,_.team_id=this.team_id,_.invited=s,_.num_api_apps=o,_.hide_transfer_setting=r,_.hide_remote_wipe_setting=a,_.refresh_cb=u,_.user_is_managed=l,_.show(),!1},remove_user:function(e,t){var n,i,s;return alert("in remove_user"),Event.stop(e),i=l("input[type=submit]","#remove-user-modal"),i.attr("disabled",1),s=Ot.vars.user_id,n=!!t||l("input[name=should_disable]:checked","#remove-user-modal").val(),new Ajax.DBRequest("/account/team/remove_user",{parameters:{team_id:this.team_id,user_id:s,should_disable:n},onSuccess:(function(e){return function(t){return e.decrement_used_licenses(),Ke.success(ct("User removed."))}})(this),cleanUp:function(){return Ot.hide(),i.removeAttr("disabled")}})},show_reinvite_modal:function(e,t,n,i){var s;return mt.fillVal(i,"reinvite-user-email"),mt.fillVal(t,"reinvite-user-team"),s=ct("Resend invite to '%(email_address)s'").format({email_address:R.em_snippet(i,18)}),Ot.show(s,$("reinvite-user-modal"),{user_id:n,button:e})},email_verification:this.email_verification=new Qe("work"),show_email_verification_modal:function(){return this.email_verification.show_verify_modal(null,c.NEW_DFB_TEAM_BUY)},reinvite_user:function(e){var t;return Event.stop(e),t=Ot.vars.user_id,new Ajax.DBRequest("/account/team/reinvite_user",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){var t;return Ke.success(ct("Invite sent.")),null!=(t=$("team-member-info"))?t.update(e.responseText):void 0},cleanUp:function(){return Ot.hide()}})},show_request_license_modal:function(e,t){var n;return n=ct("Send upgrade request?"),Ot.show(n,$("request-license-modal"),{user_id:t,button:e})},request_license:function(e){var t;return Event.stop(e),t=Ot.vars.user_id,new Ajax.DBRequest("/team/request_license",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){return l("#request_license_text").hide(),l("#request-license-section").hide(),Ke.success(ct("Request sent."))},cleanUp:function(){return Ot.hide()}})},show_user_activity_log_modal:function(e,t,n){var i;return i=l("#activity-log-modal"),i.find(".activity-log-email").text(t),i.find(".activity-log-name").text(n),i.find("#activity-log-user-message").show(),Ot.show(ct("Create activity report"),i[0],{user_id:e})},show_team_activity_log_modal:function(e,t){var n;return n=l("#activity-log-modal"),n.find(".activity-log-email").text(e),n.find(".activity-log-name").text(t),n.find("#activity-log-team-message").show(),Ot.show(ct("Create full activity report"),n[0])},generate_activity_log:function(e){var t,n,i,s,o,r,a;return Event.stop(e),n=l("#activity-log-modal"),i=n.find("input[name='from_date']").val(),o=n.find("input[name='to_date']").val(),i>o?void Ke.error(ct("Your start date is after your end date.")):(s=this.team_id,a=Ot.vars.user_id,r=(new Date).getTimezoneOffset().toString(),t=l(".activity-report-generator .freshbutton-blue"),t.prop("disabled",!0),new Ajax.DBRequest("/team/events_report/csv",{parameters:{from_date:i,to_date:o,team_id:s,user_id:a,tzoffset:r},onSuccess:function(e){return Ke.success(ct("Report started. We'll email you when it's ready."))},cleanUp:function(){return Ot.hide(),t.prop("disabled",!1)}}))},show_reset_password_modal:function(e,t,n){var i,s;return s=Ge({path:"/team/admin/members/member",query:{id:n}}).toString(),l("#reset-password-modal .member-name").text(t),l("#reset-password-modal .member-page-link").attr("href",s),i=ct("Reset password for '%(user_name)s'").format({user_name:t}),Ot.show(i,$("reset-password-modal"),{user_id:n,button:e})},reset_password:function(e){var t;return Event.stop(e),t=Ot.vars.user_id,new Ajax.DBRequest("/account/team/reset_password",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){return Ke.success(ct("User's password reset."))},cleanUp:function(){return Ot.hide()}})},show_admin_status_modal:function(e,t,n,i,s,o){var r,a,l,u;return a=s.trim()||i,l=void 0,r=void 0,u=void 0,o?(u=ct("Add admin permissions for '%(person_name)s'").format({person_name:a.escapeHTML()}),l=ct("Are you sure you want to add admin permissions for <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),r=ct("Add admin permissions",{comment:"make this user an admin; give them the permissions an admin has"})):(u=ct("Remove admin privileges from '%(person_name)s'").format({person_name:a.escapeHTML()}),l=ct("Are you sure you want to remove admin permissions from <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),r=ct("Remove admin permissions",{comment:"clicking this button completes the action: it removes a person's admin status"})),mt.fillVal(i,"admin-status-email"),mt.fillVal(l,"admin-status-action"),mt.fillVal(r,"admin-status-button-action"),Ot.show(u,$("admin-status-modal"),{user_id:n,button:e,admin_on:o}),!1},set_admin_status:function(e){var t;return Event.stop(e),t=Ot.vars.user_id,new Ajax.DBRequest("/account/team/set_admin_status",{parameters:{team_id:this.team_id,user_id:t,on:Ot.vars.admin_on?"yes":"no"},onSuccess:function(e){return ct(Ot.vars.admin_on?"User's admin status granted.":"User's admin status removed."),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():Ot.vars.admin_on?window.location="/team/admin/members/member?id=%d&msg=granted".format(Ot.vars.user_id):window.location="/team/admin/members/member?id=%d&msg=removed".format(Ot.vars.user_id)},cleanUp:function(){return Ot.hide()}})},show_disable_2fa_modal:function(e,t,n){return l("#disable-2fa-modal .member-name").text(n),Ot.show(ct("Disable two-step verification"),$("disable-2fa-modal"),{user_id:t,elm:e})},show_reset_2fa_modal:function(e,t,n){return l("#reset-2fa-modal .member-name").text(n),Ot.show(ct("Reset two-step verification"),$("reset-2fa-modal"),{user_id:t,user_name:n,elm:e})},reset_2fa:function(){return new Ajax.DBRequest("/account/team/reset_2fa",{parameters:{team_id:this.team_id,user_id:Ot.vars.user_id},onSuccess:function(e){var t;return l(".tfa_enabled").replaceWith(ct("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),Ke.success(ct("Two-step verification reset for %(user_name)s").format({user_name:Ot.vars.user_name})),Ot.hide()}})},disable_2fa:function(){return new Ajax.DBRequest("/account/team/disable_2fa",{parameters:{team_id:this.team_id,user_id:Ot.vars.user_id},onSuccess:function(e){var t;return l(".tfa_enabled").replaceWith(ct("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),Ke.success(ct("Two-step verification disabled.")),Ot.hide()}})},show_sso_preview_email:function(e){return Ot.show(ct("Email preview"),$(e))},show_sso_sample_email:function(e){return Ot.show(ct("Sample email"),$(e))},show_user_message_modal:function(e,t,n){var i;return mt.fillVal(n,"user-message-email"),i=ct("Send email to '%(user_name)s'").format({user_name:e}),$("user-message").value="",Ot.show(i,$("user-message-modal"),{user_name:e,user_id:t}),ht.focus.defer("user-message")},send_user_message:function(){var e,t;return t=Ot.vars.user_id,e=$F("user-message").trim(),new Ajax.DBRequest("/account/team/send_user_message",{parameters:{user_id:t,team_id:this.team_id,message:e},onSuccess:function(){var e;return e=Ot.vars.user_name,Ke.success(ct("Message successfully sent to %(user_name)s.").format({user_name:e})),Ot.hide()}})},hide_team_name_change_banner:function(){return new Ajax.DBRequest("/account/team/name_change_notice_received",{parameters:{team_id:this.team_id}}),l(".team_name_change_notice").hide(),!1},hide_pin_banner:function(){return new Ajax.DBRequest("/team/invalidate_pin"),l(".pin_notice").hide()},hide_pin_banner_with_user_id:function(e,t){var n;return n=function(e){return l(t).closest("span").removeClass("on").addClass("off")},null===e?new Ajax.DBRequest("/team/invalidate_pin",{onSuccess:n}):new Ajax.DBRequest("/team/invalidate_pin",{parameters:{user_id:e},onSuccess:n})},get_pin_with_user_id:function(e,t,n){var i;return null==n&&(n=null),null===n&&(n=function(e,t){return l(t).closest("span").find(".pin-value").text(e.pin+" -"),l(t).closest("span").removeClass("off").addClass("on")}),i=function(e){var i;return i=JSON.parse(e.responseText),n(i,t)},null===e?new Ajax.DBRequest("/team/generate_pin",{onSuccess:i}):new Ajax.DBRequest("/team/generate_pin",{parameters:{user_id:e},onSuccess:i})},send_team_message:function(e){var t;if(Event.stop(e),t=$F("team-message").trim())return new Ajax.DBRequest("/account/team/send_team_message",{parameters:{team_id:this.team_id,message:t},onSuccess:function(e){return Ke.success(ct("Message successfully sent to team.")),Ot.hide()}})},show_security_message_modal:function(){return(new an).show()},send_team_security_message:function(e){var t;return Event.stop(e),$F("team-security-message").trim(),t=$("team-security-message-form"),new Ajax.DBRequest("/account/team/send_team_message",{parameters:t.serialize(!0),onSuccess:function(e){return Ke.success(ct("Message successfully sent.")),Ot.hide()}})},used_licenses:0,total_licenses:0,set_used_licenses:function(e,t){return this.used_licenses=e,this.total_licenses=t},decrement_used_licenses:function(){return this.set_used_licenses(this.used_licenses-1,this.total_licenses)},show_migration_link:function(e,t){return $("migration-url").value=t,Ot.show(ct("Migration link for '%(email)s'").format({email:R.em_snippet(e,18)}),$("migrate-url-modal")),$("migration-url").select()},show_end_session_modal:function(e,t,n){return Mt.hide_all(),l("#end-session-modal .member-name").text(l("#member-name").text()),Ot.show(ct("Close web session",{comment:"Log out of your current Dropbox web session"}),$("end-session-modal"),{login_id:e,user_id:t,elm:n})},end_session:function(){return new Ajax.DBRequest("/logout_remote_session",{parameters:{remote_login_id:Ot.vars.login_id,team_id:this.team_id,user_id:Ot.vars.user_id},onSuccess:function(){return Ot.hide(),rn.remove_closest_row(Ot.vars.elm),Ke.success(ct("Web session closed."))}})},unlink_device:function(e,t,n,i,s,o,r){var a,l;return Mt.hide_all(),a=$("unlink-device-modal-"+o),l=ct("Unlink %(device_name)s").format({device_name:n}),Ot.show(l,a,{app_id:t,user_id:s,elm:r,device_id:e,display_name:n})},unlink_device_submit:function(){return new Ajax.DBRequest("/account/unlink_team_device",{parameters:{app_id:Ot.vars.app_id,team_id:this.team_id,user_id:Ot.vars.user_id,device_id:JSON.stringify(Ot.vars.device_id)},subject_user:De.get_viewer().work_user,onSuccess:function(){return Ot.hide(),rn.remove_closest_row(Ot.vars.elm),Ke.success(ct("%(device_name)s unlinked.").format({device_name:Ot.vars.display_name}))}})},disable_app:function(e,t,n,i){return Mt.hide_all(),l("#disable-app-modal .app-name").text(t),l("#disable-app-modal .member-name").text(l("#member-name").text()),Ot.show(ct("Disable '%(app_name)s'?").format({app_name:t}),$("disable-app-modal"),{app_id:e,user_id:n,elm:i})},disable_app_submit:function(){return new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:Ot.vars.app_id,keep_sandbox_files:!0,team_id:this.team_id,user_id:Ot.vars.user_id},subject_user:De.get_viewer().work_user,onSuccess:function(e){return Ot.hide(),rn.remove_closest_row(Ot.vars.elm),Ke.success(e.responseText)}})},remove_closest_row:function(e){var t,n,i;return t=l(e).closest(".team_admin_table_row"),n=l(t).closest(".team_admin_table"),1===n.find(".team_admin_table_row").length?(i=n.prev(".team_admin_table_title"),i.length||(i=l(".team_apps_table_panel")),i.remove(),n.remove()):t.remove()},submit_report_form:function(e){return l(e.target.elements.tzoffset).val(""+(new Date).getTimezoneOffset()),!0},show_recover_user_modal:function(e,t,n,i,s){var o;return o=new on({element_id:"recover-user-modal",focus:"cancel"}),o.user_name=e||n,o.email=n,o.user_id=t,o.team_id=this.team_id,o.refresh_cb=s,o.pre_removal_join_state=i,o.show(),!1}},Jt=Ze.BetaEnrollConfirmationModal=(function(e){function t(e,n){var i;this.feature_name=e,this.on_confirm_button_click=Ct(this.on_confirm_button_click,this),i="admins-",n&&(i=""),t.__super__.constructor.call(this,{element_id:"beta-enroll-"+i+"confirmation-modal__"+this.feature_name}),this.enroll_team=i}return Tt(t,e),t.prototype.on_confirm_button_click=function(e){var t;return t="#beta-enroll-%(enroll_team)sconfirmation-modal__%(feature_name)s form".format({enroll_team:this.enroll_team,feature_name:this.feature_name}),l("<input>").attr({type:"hidden",name:"feature_name",value:this.feature_name}).appendTo(t),this.$modal_window.addClass("ajax-loading")},t})(nt),Xt=Ze.BetaFeedbackModal=(function(e){function t(e){this.feature_name=e,this.success=Ct(this.success,this),t.__super__.constructor.call(this,{element_id:"beta-feedback-modal"}),this.on_confirm_button_click=(function(e){return function(t){var n,i,s;return t.preventDefault(),n=l(t.target),i=n.closest("form"),s={feature_name:e.feature_name},$t.ajax_submit(i[0],!1,e.success,e.error,n[0],s)}})(this)}return Tt(t,e),t.prototype.success=function(e){return Ke.success(ct("Thank you for your feedback.")),this.$modal_window.hide()},t.prototype.error=function(e){if(200!==e.status)return Ke.error(ct("Failed to submit feedback. Please try again."))},t})(nt),Zt=Ze.DemoSignupModal=(function(e){function t(){return this.on_show=Ct(this.on_show,this),this.on_confirm_button_click=Ct(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Tt(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i,s,o,r,a,u,_,c,d,h;return e.preventDefault(),d=$("demo-signup-form"),u=$("1210"),r=l(d).find("input[name='first_name']").val(),l(u).find("input[name='FirstName']").attr("value",r),a=l(d).find("input[name='last_name']").val(),l(u).find("input[name='LastName']").attr("value",a),o=l(d).find("input[name='email']").val(),l(u).find("input[name='Email']").attr("value",o),c=l(d).find("input[name='phone_number']").val(),l(u).find("input[name='Phone']").attr("value",c),t=l(d).find("input[name='company_name']").val(),l(u).find("input[name='Company']").attr("value",t),i=l(d).find("select[name='company_size']"),n=i.find("option:selected").val(),l(u).find("input[name='Company_size__c']").attr("value",n),s=$(this.$modal_window.find(".confirm-button")[0]),h=(function(e){return function(t){return e.$modal_window.hide(),u.submit()}})(this),_=$t.collect_form_vars(d,!0),$t.ajax_submit(d,!1,h,!1,s,_,!0)},t.prototype.on_show=function(e){return this.$modal_window.find(".db-modal-content").css({"overflow-y":""}),Lt.init()},t})(nt),Gt=Ze.AccountTransferBaseModal=(function(e){function t(e,n,i){this.file_action_selector=n,this.transfer_choice_selector=i,this._clearInput=Ct(this._clearInput,this),this._markInputInvalid=Ct(this._markInputInvalid,this),this._markInputValid=Ct(this._markInputValid,this),this._tokenRemove=Ct(this._tokenRemove,this),this._tokenAdd=Ct(this._tokenAdd,this),this._selectChange=Ct(this._selectChange,this),this._isTransferSelected=Ct(this._isTransferSelected,this),this.checkAndApproveMemberRemoval=Ct(this.checkAndApproveMemberRemoval,this),this.on_cancel_button_click=Ct(this.on_cancel_button_click,this),this.execute_form=Ct(this.execute_form,this),this.get_cancel_button=Ct(this.get_cancel_button,this),this.get_confirm_button=Ct(this.get_confirm_button,this),this.get_button_class=Ct(this.get_button_class,this),this.set_modal_class=Ct(this.set_modal_class,this),this.handleAjaxFailure=Ct(this.handleAjaxFailure,this),this.on_show=Ct(this.on_show,this),t.__super__.constructor.call(this,e,this.file_action_selector,this.transfer_choice_selector)}return Tt(t,e),t.prototype.on_show=function(){if(0!==this.$modal_window.find("#manage-files-new-collab-input").length)return this.auto_completer=new Autocompleter.TeamTokenizer(De.get_viewer().get_user_by_role("work"),"manage-files-new-collab-input","manage-files-new-whobulk","manage-files-hidden-input",{hide_import_contacts:!0,suggestions_disabled:!0,wrap_name:!0,single_token:!0,contact_filter:(function(e){return function(t){return t.excludeNonTeam().excludeNewStyleGroups().excludeByEmail(e.email)}})(this)}),this.tokenAdd=l.proxy(this._tokenAdd,this),this.tokenRemove=l.proxy(this._tokenRemove,this),this.$collab_input=this.$modal_window.find("#manage-files-new-collab-input")[0],this.$collab_input.on("token:add",this.tokenAdd),this.$collab_input.on("token:remove",this.tokenRemove),this.$textinput=this.$modal_window.find(".tokenized_autocompleter_container .textinput"),this.selectChange=l.proxy(this._selectChange,this),this.$modal_window.find(this.file_action_selector).on("change",this.selectChange)},t.prototype.handleAjaxFailure=function(e){if(200===e.status&&this._isTransferSelected())return this._markInputInvalid()},t.prototype.set_modal_class=function(e){var t,n,i,s,o,r;if(i="suspending deleting approve_transfer_to_suspended",s=this.get_form(),s.removeClass(i),null!=e&&s.addClass(e),null!=(o=l(".suspend_option_content"))&&o.removeClass("title_bubble no_suspend"),n=null!=this.limited&&this.limited,t=null!=this.invited&&this.invited,n||t)return l(".suspend_option_content").addClass("title_bubble no_suspend"),r="",r=ct(t?"Invited members can not be suspended":"Limited members can not be suspended"),l(".suspend_option_content").attr("data-title",r)},t.prototype.get_button_class=function(){var e;return e=this.get_form(),e.hasClass("suspending")?".confirm_deactivate_button":e.hasClass("deleting")?".confirm_delete_button":e.hasClass("approve_transfer_to_suspended")?".confirm_transfer_to_suspended_button":void 0},t.prototype.get_confirm_button=function(){var e;return e=this.get_button_class(),null!=e?$(this.$modal_window.find(e+" .confirm-button")):$(this.$modal_window.find(".confirm-button"))},t.prototype.get_cancel_button=function(){var e;return e=this.get_button_class(),null!=e?$(this.$modal_window.find(e+" .cancel-button")):$(this.$modal_window.find(".cancel-button"))},t.prototype.execute_form=function(){var e,t;return t=this.get_form()[0],e=this.get_confirm_button(),$t.ajax_submit(t,!1,this.success_callback,this.handleAjaxFailure,e)},t.prototype.on_cancel_button_click=function(e){var n;return e.preventDefault(),n=this.get_form(),n.hasClass("approve_transfer_to_suspended")?(this.reset_button_click(this.$confirm_button,this.on_confirm_button_click),this.reset_button_click(this.$cancel_button,this.on_cancel_button_click)):t.__super__.on_cancel_button_click.apply(this,arguments)},t.prototype.reset_button_click=function(e,t){if(e.off("click"),null!=t)return e.on("click",t)},t.prototype.checkAndApproveMemberRemoval=function(e){var t,n;return!l("#deactivate_option").is(":checked")&&l("#transfer_files_on").is(":checked")&&!this.invited&&(t=l(".tokenized_autocompleter_container .token-display-text"),n=l(".tokenized_autocompleter_container .token-suspended"),t.length&&n.length)?(this.set_modal_class("approve_transfer_to_suspended"),this.$modal_window.find(".target_user_name").text(t.text()),this.$confirm_button=this.get_confirm_button(),this.reset_button_click(this.$confirm_button,(function(e){return function(t){return e.execute_form()}})(this)),this.$cancel_button=this.get_cancel_button(),void this.$cancel_button.on("click",e)):this.execute_form()},t.prototype._isTransferSelected=function(){return l(this.transfer_choice_selector).prop("checked")},t.prototype._selectChange=function(e){return this._isTransferSelected()?this.$textinput.removeClass("unselected"):this.$textinput.addClass("unselected")},t.prototype._tokenAdd=function(e){return this.$collab_input.hide(),e.memo.valid?this._markInputValid():this._markInputInvalid()},t.prototype._tokenRemove=function(e){return this.$collab_input.show(),this._clearInput()},t.prototype._markInputValid=function(){return this._clearInput(),this.$textinput.addClass("valid")},t.prototype._markInputInvalid=function(){return this._clearInput(),this.$textinput.addClass("invalid")},t.prototype._clearInput=function(){return this.$textinput.removeClass("valid"),this.$textinput.removeClass("invalid")},t})(nt),an=Ze.TwoFactorMessageModal=(function(e){function t(){t.__super__.constructor.call(this,{element_id:"team-security-message-modal",focus:"#team-security-message"})}return Tt(t,e),t.prototype.on_confirm_button_click=function(e){return rn.send_team_security_message(e),this.hide()},t})(nt),tn=Ze.DfeUnsuspendUserModal=(function(e){function t(e){this.on_confirm_button_click=Ct(this.on_confirm_button_click,this),this.failure_callback=Ct(this.failure_callback,this),this.success_callback=Ct(this.success_callback,this),t.__super__.constructor.call(this,e)}return Tt(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=ct("Unsuspend %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find("[name=email]").attr("value",this.email),this.$modal_window.find(".unsuspended_name").text(this.user_name),this.$modal_window.find(".unsuspended_email").text(this.email)},t.prototype.success_callback=function(e){var t;return null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&t.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("unsuspended"):void 0},t.prototype.failure_callback=function(e){return this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),n=this.$modal_window.find(".dfe-unsuspend-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),this.$modal_window.find(".cancel-button").attr("disabled",!0),$t.ajax_submit(n,!1,this.success_callback,this.failure_callback,t)},t})(nt),Qt=Ze.DfeRemoveOrDeactivateUserModal=(function(e){function t(e){this.on_confirm_button_click=Ct(this.on_confirm_button_click,this),this.handleAjaxFailure=Ct(this.handleAjaxFailure,this),this.success_callback=Ct(this.success_callback,this),
this.on_show=Ct(this.on_show,this),this.handle_change_action=Ct(this.handle_change_action,this),this.switch_to_removal_mode=Ct(this.switch_to_removal_mode,this),this.switch_to_deactivation_mode=Ct(this.switch_to_deactivation_mode,this),this.show_removal_content=Ct(this.show_removal_content,this),this.show_deactivation_content=Ct(this.show_deactivation_content,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return Tt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-or-deactivate-user-modal")},t.prototype.set_form_action_to_deactivate=function(){return l(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/suspend_user")},t.prototype.set_form_action_to_remove=function(){return l(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/remove_user")},t.prototype.show_deactivation_content=function(){return this.set_modal_class("suspending")},t.prototype.show_removal_content=function(){return this.set_modal_class("deleting")},t.prototype.switch_to_deactivation_mode=function(){return this.show_deactivation_content(),this.set_form_action_to_deactivate()},t.prototype.switch_to_removal_mode=function(){if(this.show_removal_content(),this.set_form_action_to_remove(),this.invited)return this.$modal_window.find(".remote_wipe_setting").remove()},t.prototype.handle_change_action=function(e){return e.preventDefault(),l("#deactivate_option").is(":checked")?this.switch_to_deactivation_mode():this.switch_to_removal_mode()},t.prototype.on_show=function(e){var n,i;if(t.__super__.on_show.call(this),l("input[name=deactivate_or_remove]").on("change",this.handle_change_action),this.$modal_window.find(".deleted_user_name").text(this.user_name),this.num_api_apps?(n=_t("%(num)s API app","%(num)s API apps",this.num_api_apps).format({num:this.num_api_apps}),this.$modal_window.find(".num_api_apps").text(n)):this.$modal_window.find(".api_app_warning").hide(),i=ct("Suspend or delete %(user_name)s").format({user_name:this.user_name}),this.limited||this.invited?(l("#deactivate_option").prop("disabled",!0),l("#delete_option").attr("checked","checked"),this.switch_to_removal_mode()):(l("#deactivate_option").attr("checked","checked"),this.switch_to_deactivation_mode()),this.$modal_window.find(".db-modal-title-text").text(i),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.hide_transfer_wipe)return this.$modal_window.find(".transfer_data_on_remove_setting").remove(),this.$modal_window.find(".remote_wipe_setting").remove()},t.prototype.success_callback=function(e){var t,n,i,s,o;return null!=__CIRCULAR_DEPENDENCY__.MembersReact&&__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats(),t="",i=null,s={user_id:this.user_id,team_id:this.team_id,user_name:this.user_name,email:this.email},o=null,l("#deactivate_option").is(":checked")?(t="suspended",n=ct("User suspended"),i=null,s=null):(t="deleted",n=ct("User deleted"),o=ct("Restore",{comment:"Undo message that enables restoring a recently deleted user"}),l("#transfer_files_on").is(":checked")||this.invited?(i=null,s=null):i=function(e){return rn.show_recover_user_modal(e.user_name,e.user_id,e.email,nn.ACTIVE,function(e){return Ke.success(ct("User %(msg)s".format({msg:e})))})}),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t,n,s,i,o):void 0},t.prototype.handleAjaxFailure=function(e){return t.__super__.handleAjaxFailure.call(this,e),this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.$modal_window.find(".cancel-button").attr("disabled",!0),this.checkAndApproveMemberRemoval(this.switch_to_removal_mode)},t})(Gt),en=Ze.DfeRemoveUserModal=(function(e){function t(e){this.on_confirm_button_click=Ct(this.on_confirm_button_click,this),this.switch_to_removal_mode=Ct(this.switch_to_removal_mode,this),this.handleAjaxFailure=Ct(this.handleAjaxFailure,this),this.success_callback=Ct(this.success_callback,this),this.on_show=Ct(this.on_show,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return Tt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-user-modal")},t.prototype.on_show=function(e){var n,i;if(t.__super__.on_show.call(this),this.$modal_window.find(".remove_user_name").text(this.user_name),i=this.invited?ct("Uninvite %(user_name)s").format({user_name:this.user_name}):ct("Delete %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(i),this.num_api_apps?(n=_t("%(num)s API app","%(num)s API apps",this.num_api_apps).format({num:this.num_api_apps}),this.$modal_window.find(".num_api_app").text(n)):this.$modal_window.find(".api_app_warning").hide(),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.user_is_managed?this.$modal_window.find(".remove-content-limited-member").remove():(this.$modal_window.find(".remove_content").remove(),this.$modal_window.find(".remote_wipe_setting").remove()),this.invited&&(this.$modal_window.find(".transfer_files_option").remove(),this.$modal_window.find(".remote_wipe_setting").remove(),this.get_form().addClass("invited")),this.hide_transfer_setting&&this.$modal_window.find(".transfer_files_option").remove(),this.hide_remote_wipe_setting)return this.$modal_window.find(".remote_wipe_setting").remove()},t.prototype.success_callback=function(e){var t,n,i,s,o;return JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact&&__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats(),t="",i=null,s=null,o=null,this.invited?(t="uninvited",n=ct("User uninvited")):(t="deleted",n=ct("User deleted"),l("#transfer_files_on").is(":checked")||(o=ct("Restore",{comment:"Undo message that enables restoring a recently deleted user"}),s={user_id:this.user_id,team_id:this.team_id,user_name:this.user_name,email:this.email},i=function(e){return rn.show_recover_user_modal(e.user_name,e.user_id,e.email,nn.SUSPENDED,function(e){return Ke.success(ct("User %(msg)s".format({msg:e})))})})),rn.decrement_used_licenses(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t,n,s,i,o):void 0},t.prototype.handleAjaxFailure=function(e){return t.__super__.handleAjaxFailure.call(this,e),this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.switch_to_removal_mode=function(){return this.set_modal_class()},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.$modal_window.find(".cancel-button").attr("disabled",!0),this.checkAndApproveMemberRemoval(this.switch_to_removal_mode)},t})(Gt),sn=Ze.ManageFilesModal=(function(e){function t(e,n,i){this.source_user_id=e,this.source_user_name=n,this.options=i,this.on_confirm_button_click=Ct(this.on_confirm_button_click,this),this.switch_to_manage_files=Ct(this.switch_to_manage_files,this),this.success_callback=Ct(this.success_callback,this),t.__super__.constructor.call(this,this.options,"input[name=file_action]","#transfer_files_on")}return Tt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".manage-files-modal")},t.prototype.on_show=function(){var e;return t.__super__.on_show.call(this),this.$modal_window.find("[name='source_user_id']").attr("value",this.source_user_id),this.$modal_window.find(".source-user-name").text(this.source_user_name),e=ct("Manage %(team_member)s's files").format({team_member:this.source_user_name}),this.$modal_window.find(".db-modal-title-text").text(e)},t.prototype.success_callback=function(e){var t;return t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():null!=__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),l("#transfer_files_on").prop("checked")?Ke.success(ct("Transfer started",{comment:"This refers to the start of a file transfer from one Dropbox to another"})):Ke.success(ct("Permanently deleted files")),this.hide()},t.prototype.switch_to_manage_files=function(){return this.set_modal_class("manage-files-modal")},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_manage_files)},t})(Gt),Ze.show_manage_files_modal=function(e,t){var n;return n=new sn(e,t,{element_id:"manage-files-modal",focus:".new-collab-input"}),n.show()},on=Ze.RecoverUserModal=(function(e){function t(e){this.on_cancel_button_click=Ct(this.on_cancel_button_click,this),this.on_confirm_button_click=Ct(this.on_confirm_button_click,this),this.failure_callback=Ct(this.failure_callback,this),this.success_callback=Ct(this.success_callback,this),t.__super__.constructor.call(this,e)}return Tt(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=ct("Restore %(user_name)s?").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find(".user_name").text(this.user_name),this.$modal_window.find(".user_email").text(this.email),this.pre_removal_join_state===nn.SUSPENDED?(this.$modal_window.find(".recover_content_active_user").remove(),this.$modal_window.find(".recover_content_suspended_user").show()):(this.$modal_window.find(".recover_content_active_user").show(),this.$modal_window.find(".recover_content_suspended_user").remove())},t.prototype.success_callback=function(e){var t;return null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&t.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("restored"):void 0},t.prototype.failure_callback=function(e){return this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),this.$modal_window.find(".cancel-button").attr("disabled",!0),n=this.$modal_window.find(".recover-user-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),$t.ajax_submit(n,!1,this.success_callback,this.failure_callback,t)},t.prototype.on_cancel_button_click=function(e){return e.preventDefault(),h.TeamsWebActionsLogger.log("admin_restore_user_attempt_cancelled",{restorable_user_id:this.user_id,team_id:this.team_id}),t.__super__.on_cancel_button_click.call(this,e)},t})(nt),un=function(){var e;return e=function(e,t){var n,i;return l(t).css("display","none"),n=l(t).closest("#user_generate_liveops_pin"),i=n.find(".user_generate_liveops_pin_value"),i.text(e.pin),l(t).addClass("liveops_pin_elem_invisible"),n.find(".user_generate_liveops_pin_text").removeClass("liveops_pin_elem_invisible")},rn.get_pin_with_user_id(null,this,e),!1},l("#user_generate_liveops_pin_button").click(un),ln=function(){return l("#help_callus_title").hide(),l("#help_callus_details").show(),!1},l("#help_callus_trigger").click(ln);var _n;_n=Ze.BrowseFile=Class.create({initialize:function(e){}}),_n._CATEGORIES={IMAGE:"bmp cr2 gif ico jpeg jpg nef png psd tif tiff svg svgz",VIDEO:"3gp 3gpp 3gpp2 avi dv flv m2t m4v mkv mov mp4 mpeg mpg mts ts vob wmv",AUDIO:"aif flac m4a m4p mp3 ogg wav wma",DOCUMENT:"ai cdr csv doc docx docm eps fla indd keynote numbers otf pages pdf ppt pptx pptm pps ppsx ppsm ps rtf swf txt wpd xls xlsx xlsm",COMPRESSED_FILE:"7z bz2 gz gzip rar tar zip",CODE:"as as3 asm aspx bat c cc cmake coffee cpp cs css cxx diff erb erl groovy gry h haml hh hpp hxx java js json jsx less lst m make ml mm out patch php pl plist properties py rb sass scala scm script scss sh sml sql vb vi vim xml xsd xsl yaml yml",DISK_IMAGE:"dmg iso",EXECUTABLE:"exe",SHORTCUT:"lnk",LINK:"url webloc",FONT:"ttf"},_n.EXTENSION_TO_CATEGORY={},_n.CATEGORY_TO_TRANSLATION={FILE:ct("file"),FOLDER:ct("folder"),SHARED_FOLDER:ct("shared folder"),TEAM_SHARED_FOLDER:ct("team folder"),PUBLIC_FOLDER:ct("folder"),IMAGE:ct("image"),VIDEO:ct("video"),AUDIO:ct("audio"),DOCUMENT:ct("document"),COMPRESSED_FILE:ct("archive"),CODE:ct("code"),DISK_IMAGE:ct("disk image"),EXECUTABLE:ct("executable"),SHORTCUT:ct("shortcut"),LINK:ct("link"),FONT:ct("font"),SANDBOX:ct("app folder")},_n.CATEGORY_TO_DELETED_TRANSLATION={FILE:ct("deleted file"),FOLDER:ct("deleted folder"),SHARED_FOLDER:ct("deleted shared folder"),TEAM_SHARED_FOLDER:ct("deleted team folder"),PUBLIC_FOLDER:ct("deleted folder"),IMAGE:ct("deleted image"),VIDEO:ct("deleted video"),AUDIO:ct("deleted audio"),DOCUMENT:ct("deleted document"),COMPRESSED_FILE:ct("deleted archive"),CODE:ct("deleted code"),DISK_IMAGE:ct("deleted disk image"),EXECUTABLE:ct("deleted executable"),SHORTCUT:ct("deleted shortcut"),LINK:ct("deleted link"),FONT:ct("deleted font"),SANDBOX:ct("deleted app folder")},(function(){var e,t,n,i,s;i=_n._CATEGORIES,s=[];for(e in i)n=i[e],s.push((function(){var i,s,o,r;for(o=n.trim().split(" "),r=[],i=0,s=o.length;i<s;i++)t=o[i],r.push(_n.EXTENSION_TO_CATEGORY[t]=e);return r})());return s})();var cn;cn=Ze.ProgressWatcher={job_info:{},INIT_POLL_INT:1e3,FAILS_MEAN_FAIL:3,MODAL_WAIT_MS:1e3,watch:function(e,t){var n,i,s;if(e.async_task_id){if(!e.async_task_id.match(/^[A-Za-z0-9_\-=]*$/))return;i=e.async_task_id}else i=e.job_id;return cn.job_info[i]={},n=cn.job_info[i],n.subject_user=e.subject_user||(null!=(s=e.parameters)?s._subject_uid:void 0),n.req=e,n.is_async_task=!!e.async_task_id,n.poll_int=cn.INIT_POLL_INT,n.poll_count=0,n.int_id=setInterval(cn.update_for(i),n.poll_int),n.failures=0,n.start_time=T.time(),n.dont_hide=t},update_for:function(e){return function(){return cn.update(e)}},backoff:function(e){var t;return t=cn.job_info[e],clearInterval(t.int_id),t.poll_int=Math.min(Math.floor(1.5*t.poll_int),3e4),t.int_id=setInterval(cn.update_for(e),t.poll_int)},update:function(e){var t,n;return n=cn.job_info[e],st.peek(e)?cn.done(e):(n.poll_count++,n.poll_count%10===0&&cn.backoff(e),!n.modaled&&T.time()-n.start_time>cn.MODAL_WAIT_MS&&(t=n.req.options,ot.show(t.progress_text),t.onProgress=ot.update,null!=t.on_modal_shown&&t.on_modal_shown(),n.modaled=!0),n.is_async_task?cn.get_async_task_status(e):cn.get_job_status(e))},get_job_status:function(e){return new Ajax.DBRequest("/job_status/"+e,{method:"post",subject_user:cn.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=cn.job_info[e],i=t.responseText,0===i.indexOf("err"))return cn.done(e),void(n.req.options.onFailure&&!st.handled(e)&&n.req.options.onFailure(t));if(0===i.indexOf("done"))return n.req.options.job=!1,st.peek(e)||new Ajax.Request("/job_results/"+e,{method:"post",parameters:{t:Be.read(Me.JS_CSRF_COOKIE)},onSuccess:function(t){if(!st.handled(e))return ft.clearWorkingMessage(),n.req.options.onSuccess?n.req.options.onSuccess(t):void 0},onFailure:function(t){if(!st.handled(e))return ft.clearWorkingMessage(),n.req.options.onFailure?n.req.options.onFailure(t):void 0}}),cn.done(e);try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;if(n=cn.job_info[e],n.failures++,n.failures>=cn.FAILS_MEAN_FAIL)return n.req.options.onFailure&&n.req.options.onFailure(t,!0),ft.remove(n.req),cn.done(e)}})},get_async_task_status:function(e){return new Ajax.DBRequest("/async_task_status/"+e,{method:"post",subject_user:cn.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=cn.job_info[e],i=t.responseText,0===i.indexOf("done:")||0===i.indexOf("err:"))return st.handled(e),ft.clearWorkingMessage(),0===i.indexOf("done:")&&(t.responseText=i.substr(5)),n.req.options.onSuccess&&n.req.options.onSuccess(t),n.req.options.onComplete&&n.req.options.onComplete(t),cn.done(e);if(0===i.indexOf("async_task_err:"))return Ke.error(new We(i.substr(15))),st.handled(e),ft.clearWorkingMessage(),cn.done(e);try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;if(n=cn.job_info[e],n.failures++,n.failures>=cn.FAILS_MEAN_FAIL){try{n.req.options.onFailure&&n.req.options.onFailure(t,!0)}catch(e){}return ft.remove(n.req),cn.done(e)}}})},done:function(e){var t;return t=cn.job_info[e],clearInterval(t.int_id),t.dont_hide?ot.update("1/1"):(delete cn.job_info[e],t.req.async_task_id&&t.req.async_task_id!==e?void 0:ot.hide(e))}};var dn,hn,kt=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};hn=Ze.NamespaceEvents=(function(){function e(e){this.ns_id=e,this.earliest=Number.MAX_VALUE,this.events=[],this.seen={},this.done=!1}return e})(),dn=Ze.EventDatePicker=(function(){function e(e){var t,n,i;this.on_change=e,l(document.body).on("click",(function(e){return function(t){return e.hide_calendar(t)}})(this)),i=new Element("div",{id:"cal_container"}),l(i).bind("click",function(e){return e.preventDefault()}),l(document.body).append(i),this.calendar=new Ut("cal_container",{onDateChange:(function(e){return function(t){return e.on_change(t)}})(this),disable_future:!0}),l(i).css("position","fixed"),n=l("#cal_date"),t=l("#cal_container"),He.clone_position(t,n,{setWidth:!1,setHeight:!1,offsetTop:n.height(),offsetLeft:n.width()-t.children().first()[0].offsetWidth}),this.hide_calendar()}return e.prototype.show_calendar=function(e){return this.shown?(l("#cal_container").hide(),void(this.shown=!1)):(l("#cal_container").show(),this.shown=!0)},e.prototype.hide_calendar=function(e){if(!(e&&l(e.target).closest("#cal_date").length>0))return l("#cal_container").hide(),this.shown=!1,!0},e})(),INLINE_JS.Events=Ze.Events={ns:null,role:"all",now:Number(new Date),timestamp:ht.start_of_day(new Date(Number(new Date)+864e5)),request_in_flight:!1,one_day:864e5,user_navigated_away:!1,init:function(e,t,n,i,s){var o,r,a;return null==s&&(s=!1),this.awaitingFirstRender=!0,a=B.deconstruct_url(),this.first_event_map=e,this.roles=t,this.rss_data=n,this.role_has_events=i,this.deletions_only=s,this.role_picker=ze.get_controller(l("#role-selector")),1===this.roles.length?this.role=this.roles[0].role:a.qargs.role?(this.role=a.qargs.role,this.role_picker.set_state(this.role)):this.deletions_only&&(this.role=this.roles[this.roles.length-1].role),this.date_picker=new dn((function(e){return function(t){return e.change_date(t),e.set_url(),h.WebMiscActivityLogger.log("filter_events_date")}})(this)),this._init_state(),this.role_picker.on_state_change=(function(e){return function(){return e.role=e.role_picker.get_state(),e.ns&&!e.valid_roles().some(function(t){return t.ns_ids.contains(e.ns.ns_id)})&&(e.ns=null,Ft.set_selected_by_value(l("#namespace-list")[0],"false")),e.set_url(),e.get_more(!0)}})(this),G.set_during_login_callback((function(e){return function(e,t){return window.location.reload()}})(this)),l(window).bind("beforeunload",(function(e){return function(){e.user_navigated_away=!0}})(this)),l("#namespace-list-container")[0]&&l("#namespace-list-container")[0].observe("db:change",(function(e){return function(t){return e.ns=e.namespaces[JSON.parse(t.memo)],e.set_url(),e.get_more(!0),h.WebMiscActivityLogger.log("filter_events_shared_folder")}})(this)),l(window).on("scroll",(function(e){return function(){return document.body.scrollTop=Math.min(document.body.scrollTop,document.body.scrollHeight-He.viewport_dimensions().height-10),e.get_more()}})(this)),a.qargs.ns&&(Ft.set_selected_by_value(l("#namespace-list")[0],a.qargs.ns),this.ns=this.namespaces[a.qargs.ns]),a.qargs.date&&(r=a.qargs.date.split("-").map(Number),o=new Date(r[2],r[1]-1,r[0]),this.date_picker.calendar.selected_date=o,this.change_date(o)),this.update_calendar_first_day(),l("#reset-rss-link").on("click",(function(e){return function(t){var i;return n=e.rss_data[null!=(i=e.ns)?i.ns_id:void 0]||e.rss_data[e.role],new Ajax.DBRequest("/reset_rss",{parameters:{ns_id:n.ns_id},onSuccess:function(){return Ke.success(ct("RSS feed url successfully reset.")),Pe.redirect("/events")}}),!1}})(this)),this.get_more()},_init_state:function(){var e,t,n,i,s,o,r,l;for(this.namespaces={},o=a(this.roles).values(),e=0,n=o.length;e<n;e++)for(l=o[e],r=l.ns_ids,t=0,i=r.length;t<i;t++)s=r[t],this.namespaces[s]=new hn(s);if(this.ns)return this.ns=this.namespaces[this.ns.ns_id]},change_date:function(e){return this.timestamp=Number(e)+this.one_day,(this.timestamp<this.earliest()||this.timestamp>this.latest)&&(this.latest=this.timestamp,this._init_state()),l("#cur_date_text").text(mn.localize(e)),this.get_more(!0)},is_scrolled_down:function(){var e,t,n;return n=He.scroll_offsets().top,t=He.viewport_dimensions().height,e=l("#events").height(),n+t+50>=e},get_more:function(e){var t,n,i;if(!this.request_in_flight)return a(this.valid_nss()).all(function(e){return e.done})?void this.render():e||this.is_scrolled_down()?(this.request_in_flight=!0,this.render(),n=(function(e){return function(){return a(e.valid_nss()).map(function(e){return e.ns_id}).join(",")}})(this),t=Math.min(this.earliest(),this.timestamp/1e3,Math.floor(this.now/1e3)),i={page_size:25,ns_ids:n(),timestamp:t},this.deletions_only&&(i.deletions_only=!0),new Ajax.DBRequest("/events/ajax",{method:"POST",parameters:i,onSuccess:(function(e){return function(t){var i,s,o,r,u,_,c,d,h,m,f,p,v,g;for(i=JSON.parse(t.responseText),e.request_in_flight=!1,p=i.events,o=0,_=p.length;o<_;o++)s=p[o],s.html=l(s.html)[0],f=s.pkey+" "+(s.html.textContent||s.html.innerText),h=e.namespaces[s.ns_id],h.seen[f]||(h.events.push(s),h.seen[f]=!0,h.earliest=s.timestamp);if(i.events.length>0)for(v=i.ns_ids,r=0,c=v.length;r<c;r++)m=v[r],e.namespaces[m].earliest=a(i.events).map(function(e){return e.timestamp}).min();if(e.render(),i.events.last())e.get_more();else if(a(i.ns_ids).join(",")!==n())e.get_more();else for(g=i.ns_ids,u=0,d=g.length;u<d;u++)m=g[u],e.namespaces[m].done=!0;return L.configureAllLinks("#event-table",".inline-restore","events")}})(this),onError:(function(e){return function(){if(e.request_in_flight=!1,!e.user_navigated_away)return Ke.error(ct("We had problems loading your events feed; please try again later."))}})(this)})):void this.render()},valid_roles:function(){return"all"!==this.role?a(this.roles).filter((function(e){return function(t){return t.role===e.role}})(this)):this.roles},valid_nss:function(){return this.ns?[this.ns]:a(this.valid_roles()).map((function(e){return function(e){return e.ns_ids}})(this)).flatten().map((function(e){return function(t){return e.namespaces[t]}})(this)).uniq()},earliest:function(){return a(this.valid_nss()).map((function(e){return function(e){return e.earliest}})(this)).max()},latest:Number.MAX_VALUE,update_calendar_first_day:function(){return this.date_picker.calendar.options.first_day=ht.start_of_day(new Date(a(this.valid_nss()).map((function(e){return function(t){return e.first_event_map[t.ns_id]}})(this)).min())),this.date_picker.calendar.selected_date<this.date_picker.calendar.options.first_day&&(this.date_picker.calendar.selected_date=ht.start_of_day(new Date(Number(this.date_picker.calendar.options.first_day)+this.one_day)),this.change_date(this.date_picker.calendar.selected_date)),this.date_picker.calendar.render()},set_url:function(){var e,t,n,i;return n=new Date(this.timestamp-this.one_day),t=this.now-this.timestamp>0,e={},this.ns&&(e.ns=this.ns.ns_id),"all"!==this.role&&(e.role=this.role),t&&(e.date=n.getDate()+"-"+(n.getMonth()+1)+"-"+n.getFullYear()),i=this.deletions_only?"/deleted_files":"/events",B.push_state(i,e)},render:function(){var e,t,n,i,s,o,r,u,_,c,d,m,f,p,v,g,w,b,y,k,x,E,C;if(this.role_has_events[this.role]&&this.update_calendar_first_day(),e=a(this.valid_nss()).map((function(e){return function(e){return e.events}})(this)).flatten(),t=this.earliest(),x=a(e).sortBy(function(e){return-e.timestamp}),s=a(x).filter((function(e){return function(n){return n.timestamp>=t&&n.timestamp<e.timestamp/1e3&&(null!==e.ns||!n.is_dup)}})(this)),this.role_has_events[this.role]){for(l("#event-table").empty(),o=0,_=s.length;o<_;o++)g=s[o],n=l(g.html),w=a(this.valid_roles()).filter((function(e){return function(e){return e.ns_ids.contains(g.ns_id)}})(this)).map((function(e){return function(e){return e.name}})(this)).join(" & "),this.deletions_only?n.find("span.role-path").text(w):n.find("span.role-label > span").text(w),l("#event-table").append(n),null!=g.preview_jsinfo&&(i=g.preview_jsinfo,k=n.find(".inline-button"),k.on("click",this._inline_share_button.bind(this,i)));l("#events-container").show(),l("#events-sub-header").show(),l("#events-sub-header").css("visibility","visible"),l("#events-empty-state").hide(),l(".empty-explanation").hide()}else this.request_in_flight||(l("#events-container").hide(),l("#events-sub-header").hide(),l("#events-empty-state").show(),l(".empty-explanation").show());for(this.request_in_flight?l("#more-loading").show():(this.awaitingFirstRender&&(this.awaitingFirstRender=!1,h.WebMiscActivityLogger.log("events-first-load",{time:Number(new Date)-this.now})),l("#more-loading").hide()),l("#more-loading").css("marginTop",this.earliest()===Number.MAX_VALUE?"140px":"20px"),d=l("#namespace-list > li"),u=0,c=d.length;u<c;u++)r=d[u],E=l(r).data("value"),v=kt.call(a(this.valid_roles()).map(function(e){return e.ns_ids}).flatten(),E)>=0,p=E===!1,C=p||v,l(r).css("display",C?"":"none");if(y=kt.call(function(){var e,t,n,i;for(n=this.valid_roles(),i=[],e=0,t=n.length;e<t;e++)f=n[e],i.push(f.ns_ids.length>1);return i}.call(this),!0)>=0,this.request_in_flight||(y?(l("#namespace-list-container").css("visibility","visible"),l("#namespace-list-container").show()):l("#namespace-list-container").hide(),b=this.rss_data[null!=(m=this.ns)?m.ns_id:void 0]||this.rss_data[this.role],b&&this.role_has_events[this.role]?(l("#rss-feed a").attr("data-title",b.title),l("#rss_url").val(b.url),l("#rss_url").focus(),l("#rss-feed").show(),l("#rss-feed").css("visibility","visible")):l("#rss-feed").hide()),s.length||!this.request_in_flight)return $e.mark_time_to_interactive(!0)},show_rss_modal:function(){var e,t;return Ot.show(ct("Subscribe to this RSS feed"),l("#rss-modal")[0]),t=l("#rss_url").val(),e=w.clipboard_overlay(t,l("#real_copy"),function(){return Ke.success(ct("Link copied to clipboard!")),Ot.hide()},l(".modal-buttons")),e.css({zIndex:1001})},_inline_share_button:function(e,t){return t.preventDefault(),ut(e.user_id,{fqPath:e.fq_path,isFolder:e.is_dir,nsId:e.ns_id,targetNsId:e.target_ns})}};var mn;mn=Ze.DateUtil={fromSecondsSinceEpochUTC:function(e){var t;return t=new Date(1970,0,1),t.setSeconds(e),t},applyTimezoneOffset:function(e,t){var n,i;return n=parseInt(t,10),i=60*(t-n),e.setHours(e.getHours()+n),e.setMinutes(e.getMinutes()+i)},contextualFormat:function(e){var t,n,i,s;return n=new Date(Date.now()),i=(n.getTime()-e.getTime())/1e3,0,i<28800?T.ago(e):(this.applyTimezoneOffset(n,qe.TIMEZONE_OFFSET),this.applyTimezoneOffset(e,qe.TIMEZONE_OFFSET),s=new Date(Date.now()),this.applyTimezoneOffset(s,qe.TIMEZONE_OFFSET),s.setDate(s.getDate()-1),e.getYear()===n.getYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate()?(t=ct("Today %(time)s"),t.format({time:mn.format(e,qe.TIME_FORMAT)})):e.getYear()===s.getYear()&&e.getMonth()===s.getMonth()&&e.getDate()===s.getDate()?(t=ct("Yesterday %(time)s"),t.format({time:mn.format(e,qe.TIME_FORMAT)})):mn.format(e,qe.DATETIME_FORMAT))},toUTCDate:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},differenceStr:function(e,t){var n,i,s,o,r,a,l;return r=(e.getTime()-t.getTime())/1e3,r<60?_t("%d sec","%d secs",r).format(r):r<3600?(s=parseInt(r/60,10),_t("%d min","%d mins",s).format(s)):r<86400?(i=parseInt(r/3600,10),_t("%d hour","%d hours",i).format(i)):r<2592e3?(n=parseInt(r/86400,10),_t("%d day","%d days",n).format(n)):r<4838400?(a=parseInt(r/604800,10),_t("%d week","%d weeks",a).format(a)):r<31536e3?(o=parseInt(r/2592e3,10),_t("%d month","%d months",o).format(o)):(l=parseInt(r/31536e3,10),_t("%d year","%d years",l).format(l))},localize:function(e){return assert(null!=qe.DATE_FORMAT,"Date format missing."),mn.format(e,qe.DATE_FORMAT)},format:function(e,t){var n;return assert("string"==typeof t,"Date format requires a format string"),n={yy:(function(t){return function(){return e.getFullYear().toString().substring(2)}})(this),yyyy:(function(t){return function(){return e.getFullYear().toString()}})(this),M:(function(t){return function(){return(e.getMonth()+1).toString()}})(this),MM:(function(t){return function(){return(e.getMonth()+1).toString().lpad(2)}})(this),d:(function(t){return function(){return e.getDate().toString()}})(this),dd:(function(t){return function(){return e.getDate().toString().lpad(2)}})(this),h:(function(t){return function(){return(e.getHours()%12||12).toString()}})(this),H:(function(t){return function(){return e.getHours().toString()}})(this),HH:(function(t){return function(){return e.getHours().toString().lpad(2)}})(this),m:(function(t){return function(){return e.getMinutes().toString()}})(this),mm:(function(t){return function(){return e.getMinutes().toString().lpad(2)}})(this),a:(function(t){return function(){return e.getHours()>11?ct("PM",{comment:"PM as in evening"}):ct("AM",{comment:"AM as in morning"})}})(this)},t.replace(/([a-zA-Z]+)/g,function(e){return null!=n[e]?n[e]():e})}};var fn;Ze.CreateApp={init:function(e,t){var n,i,s;return this.accepted_tos_by_uid=e,this.form=n=l("#create-app-form"),this.email_verification=null,De.get_viewer().is_paired||(s=De.get_viewer().get_users()[0],this.select_user(s.id)),i=(function(e){return function(e){var t;return t=e.target.name,n.find("input[name="+t+"]").each(function(){return l(this).parents("label").removeClass("active"),n.removeClass(l(this).data("next"))})}})(this),n.find("input[type=radio]").change(function(e){return i(e),l(e.target).parents("label").addClass("active"),n.addClass(l(this).data("next"))}),n.find("input[type=checkbox]").change(function(e){var t;l(this).filter("#accept-tos").length||(l(e.target).parents("label").toggleClass("active"),t=n.find("input[name="+l(this).attr("name")+"]:checked"),n.toggleClass(l(this).data("next"),0!==t.length))}),n.find(".role-choice input").change((function(e){return function(t){var s,o;return s=n.find(".role-choice input:checked"),o=s.val(),De.get_viewer().is_uid_signed_in(o)?e.select_user(o):(s.prop("checked",!1),i(t),G.show_modal({user_id:o,on_success:function(){return s.prop("checked",!0).trigger("change")}}),!1)}})(this)),n.find("input:checked").trigger("change"),n.find("input[name=tos_accept]").change((function(e){return function(t){return e.update_submit_enabled()}})(this)),n.find("#send-verify-email, #resend-verify-email").click((function(e){return function(i){return e.email_verification.send_email(t,function(){return n.addClass("verify-email-sent"),e.email_verification.flash_email_sent_notification(),e.email_verification.ensure_polling(function(){if(e.email_verification.user.is_email_verified)return n.addClass("email-verified"),n.removeClass("verifiy-email-sent"),n.removeClass("email-unverified"),e.update_submit_enabled()})}),!1}})(this)),n.submit(function(e){return n=l(e.target),$t.ajax_submit(n[0],!1,function(e){return window.location.href=e.responseText}),!1})},select_user:function(e){return this.email_verification=Qe.get_for_user(De.get_viewer().get_user_by_id(e)),this.form.find("#accept-tos-wrapper").toggle(!this.accepted_tos_by_uid[e]),this.form.find("input[name=tos_accept]").prop("checked",!1),this.form.removeClass("verify-email-sent"),this.form.find("#verify-email-wrapper").toggle(!this.email_verification.user.is_email_verified),this.form.toggleClass("email-verified",this.email_verification.user.is_email_verified),this.update_submit_enabled()},update_submit_enabled:function(){var e,t;return t=this.email_verification.user,e=this.accepted_tos_by_uid[t.id]||this.form.find("input[name=tos_accept]").prop("checked"),this.form.find("#create-button").prop("disabled",!e)}},fn=INLINE_JS.Apps=Ze.Apps={init_apps:function(){return l("#show-disabled-apps").click(function(){return l(this).parent().hide(),
l("#disabled-apps").show(),!1})},init_app_info:function(e,t,n){return this.user_email=n,l("#app-info .icon-container").each(function(e,t){var n;return n=l(t),n.append(Dropbox.createChooseButton({success:function(e){return n.find(".icon").attr("src",e[0].thumbnailLink),n.find("input[type=hidden]").val(e[0].link)},linkType:"direct",extensions:["images"]}))}),this._hoverable_tmpl=We.tmpl("hoverable_tmpl"),l(".modal-okay-triggers-refresh").on("click",function(e){location.reload()}),l("#unlink-users-button").on("click",function(t){fn.unlink_all_users_in_dev(e)}),l("#enable-additional-users-button").on("click",function(t){fn.enable_users_in_dev(e)}),l("#increase-max-users-button").on("click",function(t){fn.enable_users_in_dev(e)}),l("#unlink-teams-button").on("click",function(t){fn.unlink_all_teams_in_dev(e)}),l("#enable-additional-teams-button").on("click",function(t){fn.enable_teams_in_dev(e)}),this._webhook_info_row_tmpl=We.tmpl("webhook_info_row_tmpl"),l("#domain-list").on("click",".img-container",function(t){fn.remove_domain(t.currentTarget.parentNode,e)}),l("#oauth-uri-list").on("click",".img-container",function(t){fn.remove_oauth_uri(t.currentTarget.parentNode,e)}),l("#webhook-list").on("click",".img-container",function(t){fn.remove_webhook(t.currentTarget.parentNode,e)}),l("#webhook-list").on("click",".webhook-actions.enabled .webhook_disable",function(t){fn.update_webhook_url(t.currentTarget,e,!1)}),l("#webhook-list").on("click",".webhook-actions.disabled .webhook_enable",function(t){fn.update_webhook_url(t.currentTarget,e,!0)}),l("#delete-app-button").on("click",function(n){fn.confirm_disable(t,e,0)}),l("#showcase-url-form").on("submit",function(e){e.preventDefault(),fn.submit_showcase_url(this)}),l("#webhook_url").on("click change paste focus",function(e){l("#webhook-form").removeClass("error")}),this.init_app_info_add_redirect_uri(),l("#oauth2-allow-implicit-grant").on("change",function(t){return fn.set_oauth2_allow_implicit_grant(t.currentTarget,e)})},init_app_info_add_redirect_uri:function(){var e,t,n,i;t=/^\#?add_redirect_uri=(.*)$/.exec(window.location.hash||""),t&&(i=window.decodeURIComponent(t[1]),e=l("#oauth-add-uri-form"),l("input[name=oauth_uri]",e).val(i),n=l("#add-redirect-uri-modal")[0],l("#add-redirect-uri-modal-uri").text(i),Ot.show(ct("Add OAuth redirect URI"),n,{doit:function(){var e;return window.history&&window.history.replaceState?(e=window.location.href,e=e.substring(0,e.indexOf("#")),window.history.replaceState({},document.title,e)):window.location.hash="",Ot.hide(),fn.submit_new_oauth_uri(l("#oauth-add-uri-form")[0])}}))},init_app_datastores_browse:function(e){if(this.ds_info=e,De.get_viewer().is_paired)return this.role_picker=ze.get_controller(l("#role-selector")),this.role_picker.on_state_change=this.app_datastores_browse_render.bind(this),G.set_during_login_callback((function(e){return function(t,n){return e.app_datastores_browse_reload_info(function(){return n()},function(){return n("Error displaying datastores"),window.location.reload()})}})(this))},app_datastores_browse_reload_info:function(e,t){return l.ajax({url:"/developers/apps/datastores/info",success:(function(t){return function(n){return t.ds_info=n,t.app_datastores_browse_render(),"function"==typeof e?e():void 0}})(this),error:(function(e){return function(e){return"function"==typeof t?t(e):void 0}})(this)}),!1},app_datastores_browse_render:function(){return this.app_datastores_browse_render_id("#apps_developed_container"),this.app_datastores_browse_render_id("#apps_used_container"),this.app_datastores_browse_render_empty()},app_datastores_browse_render_empty:function(){var e,t,n,i;if(t=l("#no_apps_container").empty(),0===l("#apps_developed_container").children().length&&0===l("#apps_used_container").children().length)switch(e=l("<div class='empty-state'></div>").appendTo(t),null!=(n=this.role_picker)?n.get_state():void 0){case rt.PERSONAL:case rt.WORK:return i=De.get_viewer().get_user_by_role(this.role_picker.get_state()),e.append("You don't have any datastores in your "+De.get_role_title(i)+" Dropbox.");default:return e.append("You don't have any datastores in your Dropbox.")}},app_datastores_browse_render_id:function(e){var t,n,i,s,o,r,a;for(s=this.app_datastores_browse_get_id_info(e),n=l(e),n.empty(),t="",o=0,r=s.length;o<r;o++)i=s[o],this.app_datastores_should_render(i.uid)&&(t+=i.html);if(t)return n.append(this.app_datastores_browse_get_id_header(e)),a=l("<div class='app-list clearfix'/>").appendTo(n),a.html(t)},app_datastores_should_render:function(e){var t;return null==this.role_picker||(t=De.get_viewer().get_user_by_id(e),this.role_picker.is_role_visible(t.role))},app_datastores_browse_get_id_info:function(e){switch(e){case"#apps_developed_container":return this.ds_info.apps_developed;case"#apps_used_container":return this.ds_info.apps_used;default:return assert(!1,"invalid ds group id")}},app_datastores_browse_get_id_header:function(e){switch(e){case"#apps_developed_container":return l("<h2>Apps you develop</h2>");case"#apps_used_container":return l("<h2>Apps you use</h2>");default:return assert(!1,"invalid ds group id")}},confirm_disable:function(e,t,n){var i,s;return i=ct(n?"Are you sure you want to disable '%(app_name)s'?":"Are you sure you want to delete '%(app_name)s'?"),mt.fillVal(i.format({app_name:e.escapeHTML()}),"app-disable-text"),Ot.show(ct(n?"Confirm disable":"Confirm delete"),$("app-disable-modal")),s="/developers/disable_app/"+t,$("app-disable-modal").down("form").action=s,$("disable-app-button").setValue(ct(n?"Disable":"Delete"))},enable_app:function(e){var t;return t="/developers/enable_app/"+e,l("#status-button-form").attr("action",t).submit()},show_uninstall:function(e,t,n,i,s,o){var r;if(e&&Event.stop(e),Ot.vars={app_id:n,user_id:o},r=l("#delete-"+i+"-app-confirm"),"sandbox"===i){if(!s)return void fn.do_uninstall();l(".app_folder",r).text(s)}return l(".app_name",r).text(t),Ot.show(ct("Remove %(app_name)s?").format({app_name:R.em_snippet(t,22)}),r[0],Ot.vars),null},do_uninstall:function(){var e;return e=Ot.vars.user_id,new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:Ot.vars.app_id,keep_sandbox_files:$F("keep_sandbox_files")},onSuccess:function(t){var n;if(Ke.success(t.responseText),n=l(".apps-"+e),l("#inst-app-"+Ot.vars.app_id+"-row",n).hide().removeClass("active_app"),0===l(".active_app",n).length&&n.hide(),0===l(".active_app").length)return l("#empty-explanation").text(ct("You have no apps linked to your Dropbox.")),l("#applications-explanation",n).remove()},subject_user:e}),Ot.hide()},enable_users_in_dev:function(e,t){return new Ajax.DBRequest("/developers/enable_users_in_dev/"+e,{onSuccess:function(e){var t;return"ok"===e.responseText?Ot.show(ct("User limit increased"),$("increased-dev-user-limit-modal")):(t=JSON.parse(e.responseText),Ot.show(ct("Limit raised to %(user_limit)s users").format({user_limit:t.new_limit}),$("increased-dev-user-limit-modal")))}}),!1},unlink_all_users_in_dev:function(e){return Ot.show(ct("Unlink all users"),$("confirm-unlink-all-users"),{doit:function(){return new Ajax.DBRequest("/developers/unlink_all_users/"+e,{onSuccess:function(e){return Ot.hide(),location.reload()}})}}),!1},enable_teams_in_dev:function(e){return d.WebRequest({url:"/developers/enable_teams_in_dev/"+e,success:function(e){var t;return t=JSON.parse(e),Ot.show(ct("Limit raised to %(team_limit)s teams").format({team_limit:t.new_limit}),$("increased-dev-team-limit-modal"))}}),!1},unlink_all_teams_in_dev:function(e){return Ot.show(ct("Unlink all teams"),$("confirm-unlink-all-teams"),{doit:function(){return d.WebRequest({url:"/developers/unlink_all_teams/"+e,success:function(e){return Ot.hide(),location.reload()}})}}),!1},submit_app_info:function(e){var t;return t=l(e).find("input[name=name]").val(),$t.clear_errors(e),$t.ajax_submit(e,!1,function(){return Ke.success("App info updated."),t&&l("#app-info h1").text(t),location.reload()})},submit_folder_name:function(e){var t;return t=l(e).find("input[name=folder]").val(),$t.clear_errors(e),$t.ajax_submit(e,!1,function(){return Ke.success("App folder name updated."),l("#folder-name .text").text(t),fn.hide_folder_input()})},submit_showcase_url:function(e){return $t.clear_errors(e),$t.ajax_submit(e,!1,function(){return Ke.success("Showcase URL updated.")})},submit_new_webhook:function(e){var t,n,i,s,o,r,a,u,_,c,h,m;return n=l(e),o=l("#webhook-list"),s=l("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:ct("Loading")}).css("vertical-align","middle"),i=n.find("input[name=webhook_url]"),h=function(e,t){return t&&t.remove(),0===o.find(".hoverable-url").length&&o.addClass("hide-status"),l("#webhook-form-error").text(e),l("#webhook-form").addClass("error")},a=i.val(),""===a?void h("Empty URI"):(u=Ge.parse(a),"http"!==(_=u.scheme)&&"https"!==_?void h("URI scheme must be http or https"):u.authority?"localhost"===(c=u.authority)||"127.0.0.1"===c||0===u.authority.indexOf("[::1]")?void h("Webhooks doesn't support localhost as Dropbox can't contact your local server. Please use an internet accessible URI."):o.find("tbody").length>=Re.MAX_WEBHOOKS_PER_APP?void h("You can register a maximum of %d webhook URIs per app.".format(Re.MAX_WEBHOOKS_PER_APP)):(t=l(this._webhook_info_row_tmpl({url:a,status:"Verifying"}).toHTML()),t.find(".status").append(s),t.find(".webhook-actions").removeClass("disabled").addClass("enabled"),o.append(t),o.removeClass("hide-status"),l("#webhook-form").removeClass("error"),r=$t.collect_form_vars(e),i.val(""),m=(new Date).getTime(),d.WebRequest({url:"/developers/apps/update/add_webhook",dataType:"json",data:r,success:function(e){var n,s;return"invalid"===e.status?(h(e.failure_text,t),i.val(a)):(s=(new Date).getTime()-m,n=Math.max(0,1e3-s),setTimeout(function(){return"ok"===e.status?t.find(".status").text("Enabled"):"error"===e.status?(t.find("textarea").text(e.failure_text),t.find(".status").text(e.status_text).addClass("error"),t.find(".timestamp").text("Just now"),t.find(".webhook-failure-info").css("display","")):void 0},n))},error:function(){return t.remove(),i.val(a)}})):void h("Improperly formatted URI (typo maybe?)"))},remove_webhook:function(e,t){var n,i;return l("#webhook-form").removeClass("error"),i=l(e).find(".value").text(),n=l("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:ct("Loading")}).css("vertical-align","middle"),l(e).find(".status").text("Removing").removeClass("error").append(n),d.WebRequest({url:"/developers/apps/update/remove_webhook",data:{app_id:t,webhook_url:i},dataType:"json",success:function(t){var n,s;if(n=e.parentNode,s=n.parentNode,s.removeChild(n),0===s.getElementsByClassName("hoverable-url").length&&l(s).addClass("hide-status"),!l("#webhook_url").val())return l("#webhook_url").val(i)},error:function(){return Ke.error("Unable to complete your request.")}})},update_webhook_url:function(e,t,n){var i,s,o,r,a;return a=l(e.parentNode.parentNode).find(".value").text(),l("#webhook-form").removeClass("error"),o=e.parentNode.parentNode.parentNode,i=l("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:ct("Loading")}).css("vertical-align","middle"),s=l(o).find(".status").text(),n="Disabled"===s,r=n?"Enabling":"Disabling",l(o).find(".status").text(r).removeClass("error").append(i),d.WebRequest({url:"/developers/apps/update/update_webhook_url",data:{app_id:t,webhook_url:a,enable:n},dataType:"json",success:function(e){var t;return s=l(o).find(".status").text(),t="Disabling"===s?"Disabled":"Enabled",l(o).find(".status").text(t).removeClass("error").removeClass("img"),"Disabling"===s?l(o).find(".webhook-actions").removeClass("enabled").addClass("disabled"):l(o).find(".webhook-actions").removeClass("disabled").addClass("enabled")},error:function(e){return Ke.error("Unable to complete your request.")}})},set_oauth2_allow_implicit_grant:function(e,t){return d.WebRequest({url:"/developers/apps/update/oauth2_allow_implicit_grant",data:{app_id:t,allow:l(e).val()},dataType:"json",success:function(e){return Ke.success("OAuth 2 allow implicit grant updated.")},error:function(){return Ke.error("Error updating OAuth 2 allow implicit grant.")}})},submit_new_oauth_uri:function(e){var t;return t=l(e).find("input[name=oauth_uri]").val(),$t.clear_errors(e),$t.ajax_submit(e,!1,function(){return Ke.success("OAuth URI added."),fn.add_oauth_uri(t),l(e).find("input[name=oauth_uri]").val("")})},add_oauth_uri:function(e){var t;return t=l("#oauth-uri-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_oauth_uri:function(e,t){var n,i;return i=l(e).find(".value").text(),n=function(t){var n;if(Ke.success("OAuth URI removed."),n=e.parentNode,n.removeChild(e),0===n.getElementsByTagName("div").length)return n.hide()},d.WebRequest({url:"/developers/apps/update/remove_oauth_uri",data:{app_id:t,oauth_uri:i},dataType:"json",success:n,error:function(){return Ke.error("Unable to complete your request.")}})},submit_new_domain:function(e){var t;return t=l(e).find("input[name=domain_name]").val(),$t.clear_errors(e),$t.ajax_submit(e,!1,function(){return Ke.success("Domain added."),fn.add_domain(t),l(e).find("input[name=domain_name]").val("")})},add_domain:function(e){var t;return t=l("#domain-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_domain:function(e,t){var n,i;return i=l(e).find(".value").text(),n=function(t){var n;if(Ke.success("Domain removed."),n=e.parentNode,n.removeChild(e),0===n.getElementsByTagName("div").length)return n.hide()},d.WebRequest({url:"/developers/apps/update/remove_domain",data:{app_id:t,domain_name:i},dataType:"json",success:n,error:function(){return Ke.error("Unable to complete your request.")}})},show_need_users_modal:function(e){return Ot.show(ct("Please test this app",{comment:"Error message"}),$("app-need-users-modal")),!1},show_need_teams_modal:function(e){return Ot.show(ct("Please test this app",{comment:"Error message"}),$("app-need-teams-modal"))},show_name_branding_modal:function(e){return Ot.show(ct("Please rename this app",{comment:"Error message"}),$("app-name-branding-modal")),!1},show_need_icon_modal:function(e){return Ot.show(ct("Please add an icon for this app",{comment:"Error message"}),$("app-need-icon-modal")),!1},show_need_enable_users_modal:function(e){return Ot.show(ct("Please enable more users for this app",{comment:"Error message"}),$("app-need-enable-users-modal")),!1},show_submit_prod_status_modal:function(e){return Ot.show(ct("Confirm your application submission",{comment:"Error message"}),$("submit-prod-status-modal")),!1},check_for_nongenerated_oauth_tokens:function(e){var t;return t="/developers/prod_request/"+e,new Ajax.DBRequest("/developers/has_nongenerated_oauth_tokens/"+e,{onSuccess:function(e){return"true"===e.responseText?Pe.redirect(t):Ot.show(ct("Please auth at least one user with the OAuth flow",{comment:"Error message"}),$("app-need-nongenerated-token"))},onFailure:function(e){return Pe.redirect(t)}}),!1},hide_folder_input:function(){return l("#folder-name").show(),l("#folder-input").hide()},show_folder_input:function(){return l("#folder-name").hide(),l("#folder-input").show(),l("#folder-input input[name=folder]").focus()}};var pn;INLINE_JS.twitter_auth_complete=function(){return pn.onLoginSuccessCallback?pn.onLoginSuccessCallback():window.location.reload(),!1},pn=Ze.Twitter={do_auth_and_follow_dropbox:function(e){var t,n;return assert(null!=e,"user_id must be provided"),n=Ge({path:"/twitter/request_token_v2"}).updateQuery("_subject_uid",e).toString(),window.open(n,"twitter_auth","width=800,height=400"),t=function(){return zt._completed($("twitter_follow"))},pn.onLoginSuccessCallback=t}};var vn;vn=Ze.ShmodelLogger={CLICK_SIGN_IN:"click_sign_in",CLICK_ADD_TO_MY_DROPBOX:"click_add_to_my_dropbox",REMOVE_LINK:"remove_link",CLICK_FILENAME:"click_filename",CLICK_DOWNLOAD:"click_download",LOGIN_THRU_DEFAULT_DROPDOWN:"login_thru_default_dropdown",CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN:"click_signup_thru_default_dropdown",CLICK_SHARE:"click_share",log:function(e){return new Ajax.DBRequest("/shmlog",{method:"post",noAutonotify:!0,parameters:{evt:e,url:window.location.href}})},attachLogListener:function(e,t){if(null!=t)return t.observe("click",function(n){if(vn.log(e),t.href&&"#"!==t.href&&"_blank"!==t.target)return Event.stop(n),function(){return window.location.href=t.href}.defer()})}};return INLINE_JS.viewer=De.get_viewer(),l(function(){return Event.fire(document,"script:loaded")}),Ze});
//# sourceMappingURL=dropbox.min.js-vflY3AtEB.map