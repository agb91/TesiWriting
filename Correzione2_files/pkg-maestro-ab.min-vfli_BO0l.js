var bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/captcha",["jquery","external/react","external/react-dom","modules/clean/ajax","modules/clean/react/recaptcha_challenge","modules/core/i18n","modules/core/notify"],function(t,e,i,r,n,o,s){var a,c;return a=o._,c=e.createElement,(function(){function e(t,e,i,r,n,o,s){var a;this.parent_form=t,this.captcha_div=e,this.other_recaptcha_div=i,this.endpoint=r,this.email_name=n,this.variant=o,this.is_v2=s,this.captcha_display_handler=bind(this.captcha_display_handler,this),this._hide_other_captcha=bind(this._hide_other_captcha,this),this._hide_captcha_v2=bind(this._hide_captcha_v2,this),this._hide_captcha=bind(this._hide_captcha,this),this._show_captcha_v2=bind(this._show_captcha_v2,this),this._show_captcha=bind(this._show_captcha,this),this.$recaptcha_container=null!=(a=this.parent_form.find(this.captcha_div))?a[0]:void 0,this.$recaptcha_react_component=null}return e.prototype._show_captcha=function(t,e){var r,o;return null==(null!=(o=this.$recaptcha_container)?o.children:void 0)&&(this.$recaptcha_react_component=null),null==this.$recaptcha_react_component?(r=c(n,{public_key:t,variant:this.variant,error:e}),this.$recaptcha_react_component=i.render(r,this.$recaptcha_container)):this.$recaptcha_react_component.reload(e)},e.prototype._show_captcha_v2=function(e,i){return t("#"+this.captcha_div).parent().show(),t("#"+this.captcha_div).children().length?"undefined"!=typeof grecaptcha&&null!==grecaptcha?grecaptcha.reset():void 0:"undefined"!=typeof grecaptcha&&null!==grecaptcha?grecaptcha.render(this.captcha_div,{sitekey:e}):void 0},e.prototype._hide_captcha=function(){var t;if(null==(null!=(t=this.$recaptcha_container)?t.children:void 0)&&(this.$recaptcha_react_component=null),null!=this.$recaptcha_react_component)return i.unmountComponentAtNode(this.$recaptcha_container),this.$recaptcha_react_component=null},e.prototype._hide_captcha_v2=function(){return t("#"+this.captcha_div).parent().hide()},e.prototype._hide_other_captcha=function(){var e;if(e=t(this.other_recaptcha_div)[0],null!=(null!=e?e.children:void 0))return i.unmountComponentAtNode(e)},e.prototype.captcha_display_handler=function(t){return r.WebRequest({url:this.endpoint,data:{email:this.parent_form.find("input[name='"+this.email_name+"']").val()},success:(function(e){return function(i){var r;try{return r=JSON.parse(i),r.needs_captcha?(e._hide_other_captcha(),e.is_v2?e._show_captcha_v2(r.recaptcha_v2_public_key,t):e._show_captcha(r.recaptcha_public_key,t)):e.is_v2?e._hide_captcha_v2():e._hide_captcha()}catch(t){return t,s.error(a("There was a problem completing this request."))}}})(this)})},e})()}),define("modules/clean/form_util/name_parser",[],function(){return(function(){function t(){}return t.splitFullName=function(t){var e,i,r;return r=t.split(" "),e=r[0],i=r.slice(1).join(" "),[e,i]},t})()});var bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/header_bubble",[],function(){return(function(){function t(t,e){this.$element=t,this.options=e,this.hide=bind(this.hide,this),this.$element.parent().addClass("active"),this.$element.find(".confirm-button").on("click",this.hide),this.$element.find(".dismiss-button").on("click",this.hide)}return t.prototype.hide=function(t){return"#"===t.target.getAttribute("href")&&t.preventDefault(),this.$element.parent().removeClass("active")},t})()}),define("modules/clean/hi_res",["jquery"],function(t){return(function(){function e(t){var e;this.constructor._show_hi_res()&&(e=t.attr("data-hi-res-no-resize"),this.constructor.set_src(t,t.attr("data-hi-res"),e),this.constructor.set_bg(t,t.attr("data-hi-res-background"),e))}return e.set_src=function(t,e,i){if(this._show_hi_res())return e&&e!==t.attr("src")?this._replace(t,e,!i,this._replace_img):void 0},e.set_bg=function(t,e,i){if(this._show_hi_res())return this._replace(t,e,!i,this._replace_background)},e._show_hi_res=function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1},e._replace=function(e,i,r,n){var o;if(i)return o=new Image,o.src=i,t(o).on("load",function(){return n(e,i,r,o.width,o.height)})},e._replace_img=function(t,e,i,r,n){if(t.attr("src",e),i)return t.width(r/2),t.height(n/2)},e._replace_background=function(t,e,i,r,n){var o;if(o="url('%(src)s')".format({src:e}),t.css("backgroundImage",o),i)return t.css("backgroundSize",r/2+"px "+n/2+"px")},e})()}),define("modules/clean/legacy_pyxl_controllers/login_form",["require","exports","external/cyfd","external/pixie","external/u2f-api","jquery","modules/clean/ajax","modules/clean/captcha","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/sso_login_checks","modules/constants/pixie","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,e,i,r,n,o,s,a,c,l,h,u,_,d,p,f,m,g){"use strict";var v=new r.Pixie(_).get_specter();v.start();var y=(function(){function e(e,i,r,n,s,l,h,_,p,f){void 0===n&&(n=!1),void 0===s&&(s=!0),void 0===l&&(l=!1),void 0===h&&(h=null),void 0===_&&(_=null),void 0===p&&(p=!0),void 0===f&&(f=!0);var m=this;if(this.loginType=i,this.variant=r,this.inlineGoogleLoginErrors=l,this.signupTag=h,this.signupEndpoint=_,this.canRedirect=p,this.keepUrlFragment=f,this.multiLogin="multi"===this.loginType,this.pairing="pairing"===this.loginType,this.$loginForm=e.find(".login-form"),this.$googleAuthContainer=e.find(".login-form-container__google-div"),this.$allTwoFactorForms=e.find(".two-factor-form"),this.$twoFactorPhoneForm=e.find(".two-factor-form.2fa-phone-form"),this.$twoFactorSeckeyForm=e.find(".two-factor-form.2fa-seckey-form"),this.$loginViaEmailForm=e.find(".login-via-email-link"),this.$twoFactorForm=this.$twoFactorPhoneForm,n||t(["modules/clean/unity/features/web_destiny_ui"],function(t){new t(e).maybe_show_web_destiny()}),this.loginController=new c(this.$loginForm,this.beforeSubmit.bind(this),{should_submit_once:!0}),this.$loginForm.find(".recaptcha_v2_challenge").length){var v=o(this.$loginForm.find(".recaptcha_v2_challenge"));this.$captchaComponent=new a(this.$loginForm,v.attr("id"),null,"/needs_captcha","login_email",this.variant,!0)}else this.$captchaComponent=new a(this.$loginForm,"#react-login-recaptcha-challenge-div","#react-signup-recaptcha-challenge-div","/needs_captcha","login_email",this.variant);this.$loginForm.on(c.SUCCESS_EVENT,this.loginSuccess.bind(this)),this.$loginForm.on(c.ERROR_EVENT,function(t,e){var i=null!=e?e.recaptcha_response:void 0;return m.$captchaComponent.captcha_display_handler(i),m.$loginForm.find(".login-via-email-blade-link").click(m.loginViaEmailStart.bind(m))}),this.$loginForm.is(":visible")&&this.$captchaComponent.captcha_display_handler();var y=g.parse(this.$loginForm.find("input[name='cont']").val());this.keepUrlFragment&&y.setFragment(window.location.hash.substr(1)),this.cont=y.toString(),this.twoFactorPhoneController=new c(this.$twoFactorPhoneForm,function(){return null},{should_submit_once:!0}),this.twoFactorSeckeyController=new c(this.$twoFactorSeckeyForm,function(){return null},{should_submit_once:!0}),this.twoFactorController=this.twoFactorPhoneController,this.$twoFactorPhoneForm.on(c.SUCCESS_EVENT,this.twoFactorSuccess.bind(this)),this.$twoFactorSeckeyForm.on(c.SUCCESS_EVENT,this.twoFactorSuccess.bind(this)),this.$twoFactorSeckeyForm.on(c.ERROR_EVENT,function(t,e){return m.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions .error-msg").text(e.u2f.message_text),m.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions").toggle()}),this.$twoFactorPhoneForm.find(".resend-two-factor-code").click(this.resendCode.bind(this)),this.$twoFactorSeckeyForm.find(".two-factor-use-phone-instead").click(this.usePhoneInstead.bind(this)),this.$twoFactorSeckeyForm.find(".two-factor-seckey-retry").click(this.retryU2fChallenge.bind(this)),null!=this.$loginViaEmailForm&&this.$loginViaEmailForm.click(this.loginViaEmailStart.bind(this)),this.$googleAuthContainer.find(".auth-google").click(this.googleLogin.bind(this)),this.$googleAuthContainer.find(".auth-google").prop("disabled",!1);var w=this.$twoFactorSeckeyForm.find("input[name='u2f_challenge']").val();w&&this.signU2fChallenge(w),this.$loginForm.find(".sso-optout a").click(function(){return m.hideSso(!0)}),this.$loginForm.find(".login-button").attr("disabled",null),this.$loginForm.find(".login-button.disabled-button").prop("disabled",!0),s&&e.find(".login-need-help a").click(function(t){t.preventDefault();var e=o(t.target).attr("href"),i=encodeURIComponent(m.$loginForm.find("input[name='login_email']").val());return d.redirect(e+"?email_from_login="+i)}),this.setFocusToPassword(),new u.SsoLoginChecks(this.$loginForm.find("input[name='login_email']"),this.showSso.bind(this),this.hideSso.bind(this))}return e.prototype.ie8SafeFocus=function(t){try{t.focus()}catch(t){}},e.prototype.setFocusToPassword=function(){this.$loginForm.find("input[name='login_email']").first().val()&&this.ie8SafeFocus(this.$loginForm.find("input[name='login_password']")[0])},e.prototype.setFocusToTwofactor=function(){this.ie8SafeFocus(this.$twoFactorForm.find("input[name='code']").val(""))},e.prototype.googleLogin=function(){c.clear_errors(this.$loginForm);var t="on"===this.$loginForm.find("input[name='remember_me']").val(),e=new h.ProfileServicesLinkingHandler,i=this.$googleAuthContainer.find(".auth-google").data("is-popup");e.auth_service_login_web(l.GOOGLE,this.googleLoginCallback.bind(this),"login_form",i,t,this.cont,this.pairing)},e.prototype.googleLoginCallback=function(t){if(t.success)m.success(f._("Log in successful! Your browser will be redirected in a few seconds.")),s.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success"}}),d.redirect(this.cont?this.cont:"/home");else if(s.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error"}}),"emails_do_not_match_redirect"===t.err_msg){var e=this.getThirdPartyAuthUrl(t,!0);d.redirect(e)}else"emails_do_not_match"===t.err_msg&&this.inlineGoogleLoginErrors&&!this.pairing?this.handleEmailsDoNotMatch(t):"tfa_required"===t.err_msg?this.redirectToPath(t,"/verify_code"):"not_verified"===t.err_msg?this.redirectToPath(t,"/show_password_form"):(t.localized_error&&m.error(t.localized_error),"google_login_not_allowed"!==t.err_msg&&"sso_required"!==t.err_msg||this.fillInEmail(t.profile.email))},e.prototype.handleEmailsDoNotMatch=function(t){var e=this.getThirdPartyAuthUrl(t,!1);this.$googleAuthContainer.find(".third-party-signup-link").attr("href",e),this.$googleAuthContainer.find(".google-login-error").removeClass("u-l-dn")},e.prototype.getThirdPartyAuthUrl=function(t,e){var i={fname:t.profile.given_name,lname:t.profile.family_name,email:t.profile.email,picture_url:t.profile.picture_url,refresh_token:t.refresh_token,email_sig:t.email_sig,automatic_redirect:e.toString(),cont:this.cont};return this.signupTag&&(i.signup_tag=this.signupTag),this.signupEndpoint&&(i.signup_endpoint=this.signupEndpoint),String(new g({path:"/third_party_signup"}).updateQuery(i))},e.prototype.fillInEmail=function(t){this.$loginForm.find("input[name='login_email']").val(t),this.$loginForm.find("input[name='login_email']").trigger("input"),this.setFocusToPassword()},e.prototype.redirectToPath=function(t,e){var i=new g({path:e}).updateQuery({cont:this.cont,remember_me:t.remember_me.toString(),pair_user:t.pair_user.toString()});d.redirect(i.toString())},e.prototype.beforeSubmit=function(){i.cfsubmit(),this.loginController.add_additional_data({specter_login_tm:v.dump()})},e.prototype.showSso=function(t){this.$loginForm.find("input[name='login_password']").val(""),this.$loginForm.addClass("sso-required"),t&&this.$loginForm.addClass("sso-optional")},e.prototype.hideSso=function(t){if(void 0===t&&(t=!1),this.$loginForm.removeClass("sso-required sso-optional"),t)try{this.$loginForm.find("input[name='login_password']").focus()}catch(t){}},e.prototype.browserSupportsU2F=function(){return void 0!==MessageChannel},e.prototype.showLogin=function(){this.$twoFactorForm.hide(),o(".login-register-header, .login-register-switch").show(),this.$loginForm.show(),this.$loginForm.find("input[name='login_password']").val("")},e.prototype.setupTwoFactor=function(t){t.u2f_challenge&&this.browserSupportsU2F()&&(this.$twoFactorForm=this.$twoFactorSeckeyForm,this.twoFactorController=this.twoFactorSeckeyController,this.signU2fChallenge(t.u2f_challenge)),t.last_four_digits?(this.$allTwoFactorForms.addClass("hide-authenticator"),this.$twoFactorPhoneForm.find(".last-four-digits").text(t.last_four_digits)):this.$allTwoFactorForms.addClass("hide-sms"),this.$twoFactorForm.find("input[name='remember_me']").val(t.remember_me),this.showTwoFactor()},e.prototype.showTwoFactor=function(){o(".login-register-header, .login-register-switch").hide(),this.$loginForm.hide(),this.$twoFactorForm.show(),this.setFocusToTwofactor()},e.prototype.loginSuccess=function(t,e){switch(e.status){case"OK":return this.finishLogin(e);case"TWOFACTOR":return this.setupTwoFactor(e);case"TWOFACTOR_REQUIRED":return d.redirect(e.cont);case"LOGIN_VIA_EMAIL_REQUIRED":var i=e.email,r=new g({path:e.cont}).updateQuery({email:i});return d.redirect(r.toString());case"SSO":return d.unsafeRedirect(e.sso_url);case"RATELIMIT":return this.fillLoginError(f._("You’ve tried to log in too many times. Please try again in a few minutes."));case"ERROR":var n=e.html_response?new p(e.message):e.message;return m.error(n),this.loginController._clear_pending(!0);case"EXPIRED":return d.redirect(e.cont);default:return m.error(f._("There was a problem completing this request."))}},e.prototype.twoFactorSuccess=function(t,e){switch(e.status){case"OK":return this.$twoFactorSeckeyForm.find(".seckey-loading-status").toggle(),this.finishLogin(e);case"EXPIRED":return this.switchFromTwoFactorToLoginError(e.message);case"REQUIRES_ROLE":return this.switchFromTwoFactorToLoginError(e.message);case"ERROR":return m.error(e.message);default:return m.error(f._("There was a problem completing this request."))}},e.prototype.switchFromTwoFactorToLoginError=function(t){this.twoFactorController._clear_pending(!0),this.loginController._clear_pending(!0),this.showLogin(),this.fillLoginError(t),this.setFocusToPassword()},e.prototype.resendCodeSuccess=function(t){switch(t){case"OK":return m.success(f._("We sent you a code. It may take a few minutes to arrive."));case"RATELIMIT":return this.fillTwoFactorError(f._("You’ve tried to log in too many times. Please try again in a few minutes."));case"UNREACHABLE":return this.fillTwoFactorError(f._("We couldn’t reach your phone number. Are you sure it’s correct?"));case"EXPIRED":return this.fillTwoFactorError(f._("Sorry, your phone code has expired. Please log in again."));case"BADCARRIER":return this.fillTwoFactorError(f._("Unfortunately, your carrier isn’t supported at this time."));case"INVALIDNUMBER":return this.fillTwoFactorError(f._("That isn’t a valid phone number."));case"NOTAMOBILE":return this.fillTwoFactorError(f._("That phone number doesn’t appear to be a valid mobile number."));default:return m.error(f._("There was a problem completing this request."))}},e.prototype.resendCode=function(){return s.WebRequest({url:"/twofactor_resend",data:{backup:this.$twoFactorForm.find("input[name='backup']").val()},success:this.resendCodeSuccess.bind(this),error:function(){return m.error(f._("There was a problem completing this request."))}}),!1},e.prototype.usePhoneInstead=function(){return this.$twoFactorSeckeyForm.hide(),this.$twoFactorPhoneForm.show(),this.$twoFactorForm=this.$twoFactorPhoneForm,this.$twoFactorPhoneForm.hasClass("hide-authenticator")&&this.resendCode(),this.setFocusToTwofactor(),!1},e.prototype.retryU2fChallenge=function(){var t=this;return s.WebRequest({url:"/account/twofactor/u2f_start_authentication",success:function(e){t.$twoFactorSeckeyForm.find(".two-factor-seckey-instructions").toggle(),t.signU2fChallenge(e)},error:function(){m.error(f._("There was a problem completing this request."))}}),!1},e.prototype.signU2fChallenge=function(t){var e=this;if(this.browserSupportsU2F()){var i=JSON.parse(t);return n.sign(i.authenticateRequests,function(t){e.$twoFactorSeckeyForm.find(".text-input-input").val(JSON.stringify(t)),e.$twoFactorSeckeyForm.submit()})}},e.prototype.loginViaEmailStart=function(){var t=this;return c.clear_errors(this.$loginForm),s.WebRequest({url:"/ajax_login_via_email_start",data:{login_email:this.$loginForm.find("input[name='login_email']").val(),remember_me:"on"===this.$loginForm.find("input[name='remember_me']").val()},success:function(){m.success(f._("We emailed you a sign in link. Please check your inbox."))},error:function(e,i,r){return c.fill_errors(t.$loginForm,JSON.parse(r))}}),!1},e.prototype.fillLoginError=function(t){c.fill_errors(this.$loginForm,{login_email:{message_text:t}})},e.prototype.fillTwoFactorError=function(t){c.fill_errors(this.$twoFactorForm,{code:{message_text:t}})},e.prototype.finishLogin=function(t){var i=this.$loginForm.find("input[type='hidden'][name=refresh_token]").val(),r=this.$loginForm.find("input[type='hidden'][name=email_sig]").val();i&&r&&s.WebRequest({url:"/profile_services/link_google_service_with_user",subject_user:t.id,data:{service:l.GOOGLE,refresh_token:i,email_sig:r}});var n=this.multiLogin?e.MULTI_LOGIN_SUCCESS:e.LOGIN_SUCCESS;this.$loginForm.trigger(n,t),this.cont&&this.canRedirect&&d.redirect(this.cont)},e})();return y.LOGIN_SUCCESS="db:login:success",y.MULTI_LOGIN_SUCCESS="db:multilogin:success",y}),define("modules/clean/legacy_pyxl_controllers/login_or_register",["jquery","modules/clean/register_form"],function(t,e){return(function(){function i(i){this.$login_form=i.find(".login-register-login-part"),this.$register_form=i.find(".login-register-register-part"),i.click((function(e){return function(i){if(t(i.target).hasClass("login-register-switch-link"))return i.preventDefault(),e._toggle_forms(),e.$login_form.find(".text-input input:visible").first().focus(),e.$register_form.find(".text-input input:visible").first().focus()}})(this)),this.$register_form.on(e.USER_EXISTS,(function(t){return function(e){var i,r,n;t._toggle_forms(),r=e.prefill;for(i in r)n=r[i],t.$login_form.find(i).val(n);return t.$login_form.find(e.focus).focus()}})(this))}return i.prototype._toggle_forms=function(){return this.$login_form.toggle(),this.$register_form.toggle()},i})()});var extend=function(t,e){function i(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;define("modules/clean/legacy_pyxl_controllers/tooltip",["jquery","external/underscore","modules/core/controller_helpers"],function(t,e,i){var r,n,o;return o=[],r=(function(){function t(t,r,n){var o,s,a,c;this.$wrapper=t,this.prompt=this.$wrapper.find(".tooltip-prompt"),this.tooltip=this.$wrapper.find(".tooltip-tooltip"),this.hover_target=this.find_hover_target(),this.position_global=r,this.tooltip_location=n,this.listen(),o=i.clone_element(this.tooltip).appendTo("body"),o.css({position:"static",display:"inline-block"}),s=500,c=o.width()+1,c>s&&(c=s),this.tooltip.css({width:c,position:"absolute",display:"none"}),o.remove(),this.position_global&&this.tooltip.remove().appendTo("body"),this.is_focusable()&&(a=e.uniqueId("tooltip-tooltip-"),this.tooltip.attr({role:"tooltip",id:a}),this.hover_target.attr({tabindex:0,"aria-describedby":a}))}return t.prototype.tooltip_shown=!1,t.prototype.position_global=!1,t.prototype.listen=function(){var t,e,i,r,n;for(r=[this.hover_target,this.tooltip],n=[],e=0,i=r.length;e<i;e++)t=r[e],t.mouseenter((function(t){return function(){return clearTimeout(t.tooltip.data("timeout_id")),t.show_tooltip()}})(this)),t.mouseleave((function(t){return function(){var e;return e=setTimeout(function(){return t.hide_tooltip()},200),t.tooltip.data("timeout_id",e)}})(this)),this.is_focusable()?(t.focusin((function(t){return function(){return clearTimeout(t.tooltip.data("timeout_id")),t.show_tooltip()}})(this)),n.push(t.focusout((function(t){return function(){var e;return e=setTimeout(function(){return t.hide_tooltip()},200),t.tooltip.data("timeout_id",e)}})(this)))):n.push(void 0);return n},t.prototype.find_hover_target=function(){return this.prompt},t.prototype.is_focusable=function(){return!1},t.prototype.show_tooltip=function(t){var e,i,r,n,s,a,c;if(!this.tooltip_shown){for(s=this.position_global?this.hover_target.offset():this.hover_target.position(),i=0,n=o.length;i<n;i++)c=o[i],c.hide_tooltip();return o.push(this),"top"===this.tooltip_location?(a=s.top-this.tooltip.outerHeight()-this.hover_target.height()/2,r=s.left-this.tooltip.outerWidth()/2,e={top:"-=7"}):"left"===this.tooltip_location?(a=s.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2,r=s.left-this.tooltip.outerWidth()-2,e={left:"-=7"}):"bottom"===this.tooltip_location?(a=s.top+this.hover_target.outerHeight(),r=s.left-this.tooltip.outerWidth()/2+this.hover_target.outerWidth()/2,e={top:"+=7"}):(a=s.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2,r=s.left+this.hover_target.width()+2,e={left:"+=7"}),this.tooltip.css({top:a,left:r}).show().animate(e,50),this.tooltip_shown=!0}},t.prototype.hide_tooltip=function(){var t;if(this.tooltip_shown)return clearTimeout(this.tooltip.data("timeout_id")),this.tooltip.hide(),this.tooltip_shown=!1,t=o.indexOf(this),t!==-1?o.splice(t,1):void 0},t})(),n=(function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.find_hover_target=function(){return this.prompt.find(".sprite")},e.prototype.is_focusable=function(){return!0},e})(r),{DBTooltip:r,InfoTooltip:n}}),define("modules/clean/legacy_ui_button",["jquery"],function(t){return function(){var e;return e=t(document),t(document).on("mouseover.ui-button",".ui-button",function(){return t(this).addClass("over")}).on("mouseout.ui-button",".ui-button",function(){return t(this).removeClass("over")}).on("mousedown.ui-button",".ui-button",function(){return t(this).addClass("down")}).on("click.ui-button",".ui-button",function(){var i;return i=t(this),i.hasClass("ui-button-dropdown")&&(i.hasClass("active")?e.trigger("dropdownClosed",[1]):e.trigger("dropdownOpened",[1])),i.toggleClass("active")}),e.on("click.ui-button",function(i){var r,n,o;return r=t(i.target),n=r.closest(".ui-button.active"),o=0,t(".ui-button.active").not(n).each(function(){var e;return e=t(this),e.hasClass("active")&&e.hasClass("ui-button-dropdown")&&(o+=1),e.removeClass("active")}),e.trigger("dropdownClosed",[o])}).on("mouseup.ui-button",function(){return t(".ui-button.down").removeClass("down")})}}),define("modules/clean/mailcheck",["jquery","modules/core/html","modules/core/i18n"],function(t,e,i){var r;return r=i._,(function(){function t(t,e,i){var r;this.$input=t,this.$suggestion_container=e,null==i&&(i={}),this.checkInput(),r=i.livecheck===!0?"keyup blur":"blur",this.$input.on(r,this.checkInput.bind(this))}return t.DOMAINS=["gmail.com","hotmail.com","yahoo.com","aol.com","web.de","gmx.de","googlemail.com","me.com","live.com","msn.com","mail.ru","comcast.net","google.com","mac.com"],t.WHITELIST_REGEXS=[/ymail.com/,/yahoo\.co\./,/yahoo\.com\./,/hotmail\.co\./,/hotmail\.com\./,/gmx\.net/,/gmx\.at/,/gmx\.ch/,/gmx\.com/,/mail\.com/,/web\.com/],t.THRESHOLD=2,t.prototype.checkInput=function(){var t;t=this.suggest(this.$input.val()),t?this.populate(t):this.clear()},t.prototype.populate=function(t){var i,n,o;return o=e.escape(t.local).toHTML(),i=e.escape(t.domain).toHTML(),n=o+"@<span class='email_warning_area'>"+i+"</span>",this.$suggestion_container.html(new e(r("Did you mean <a>%(suggested_email)s</a>?").format({suggested_email:n})).toHTML()),this.$suggestion_container.show(),this.$suggestion_container.on("click",(function(e){return function(){return e.$input.val(t.full),e.clear()}})(this))},t.prototype.clear=function(){return this.$suggestion_container.empty(),this.$suggestion_container.hide()},t.prototype.suggest=function(t){var e,i,r,n;if(null==t&&(t=""),t.length)return t=t.toLowerCase(),!!(n=this.splitEmail(t))&&(r=n.local,i=n.domain,!this.whitelistedDomain(i)&&(e=this.findClosestDomain(i),!!e&&{local:r,domain:e,full:r+"@"+e}))},t.prototype.whitelistedDomain=function(e){var i,r,n,o;for(o=t.WHITELIST_REGEXS,i=0,r=o.length;i<r;i++)if(n=o[i],n.test(e))return!0;return!1},t.prototype.splitEmail=function(t){var e;return e=t.split("@"),2===e.length&&{local:e[0],domain:e[1]}},t.prototype.findClosestDomain=function(e){var i,r,n,o,s,a,c;for(a=99,r=null,c=t.DOMAINS,o=0,s=c.length;o<s;o++)i=c[o],n=this.stringDistance(e,i),n<a&&(a=n,r=i);return!!(r&&r!==e&&a<=t.THRESHOLD)&&r},t.prototype.stringDistance=function(t,e){var i,r,n,o,s,a;if(null==t||0===t.length)return null==e||0===e.length?0:e.length;if(null==e||0===e.length)return t.length;for(i=0,s=0,a=0,n=0,o=5;i+s<t.length&&i+a<e.length;){if(t.charAt(i+s)===e.charAt(i+a))n++;else for(s=0,a=0,r=0;r<o;){if(i+r<t.length&&t.charAt(i+r)===e.charAt(i)){s=r;break}if(i+r<e.length&&t.charAt(i)===e.charAt(i+r)){a=r;break}r++}i++}return(t.length+e.length)/2-n},t})()}),define("modules/clean/marketing_tracker",["require","exports","modules/core/exception"],function(t,e,i){"use strict";var r=(function(){function t(){var e=this;this.push=function(r){var n=r.dataLayer;return e.src=r.src,i.assert(!!e.src,"MarketingTracker.push requires src"),t.el||(t.el=e.load(e.src)),!t.ready&&t.el?t.el.addEventListener("load",function(){if(t.ready=!0,t&&t.el)return t.el.contentWindow.postMessage(n,"https://marketing.dropbox.com")}):t.el.contentWindow.postMessage(n,"https://marketing.dropbox.com"),e},this.load=function(t){var e=document.createElement("iframe");return e.style.display="none",e.hidden=!0,e.src=t,e.setAttribute("sandbox","allow-scripts allow-same-origin"),document.body.appendChild(e),e},t.el=null,t.ready=!1}return t})();r.ready=!1,e.MarketingTracker=new r}),define("modules/clean/photos/legacy_thumb_loader",["jquery","modules/clean/photos/batch_thumb_loader","modules/clean/sprite"],function(t,e,i){return{MAX_THUMB_BATCH_REQUESTS:24,batch_load_thumbs:function(r,n,o,s){var a,c,l,h,u,_,d,p,f,m;for(m=t.grep(r,function(e){return t(e).data("src")}),this.img_map={},h=0,_=m.length;h<_;h++)l=m[h],p=String(t(l).data("src")),null==(c=this.img_map)[p]&&(c[p]=[]),this.img_map[p].push(l);for(this.instance?this.instance.reset({batch_size:n,batch_logger:s}):this.instance=new e({batch_size:n,max_parallel_requests:this.MAX_THUMB_BATCH_REQUESTS,on_batch:(function(e){return function(i){var r,n,o,s,a;for(s=[],n=0,o=i.length;n<o;n++)a=i[n],r=t(e.img_map[a]),r.data("src",null),s.push(r.data("loading-src",a));return s}})(this),batch_logger:s}),[],u=0,d=m.length;u<d;u++)l=m[u],a=t(l),f=a.data("src"),this.instance.queue_thumb(f,function(t,e,r,n){if(n||e.data("loading-src"))return e.data("loading-src",null),0===r.indexOf("data:image")?(e.attr("src",r),"function"==typeof o?o(e[0]):void 0):(e.error(function(){return e.attr("src",e.data("fail-src")||i.SPACER)}),e.load(function(){return"function"==typeof o?o(e[0]):void 0}),e.attr("src",r))}.bind(this,f,a));return this.instance.flush(),m.length},clear_all_pending_batches:function(){var t;return null!=(t=this.instance)?t.clear():void 0}}}),define("modules/clean/profile_services/auth_callback_handler",["require","exports","modules/core/browser","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/core/i18n"],function(t,e,i,r,n,o,s){"use strict";function a(t,e,i){t.success&&t.user_id?l(e.cont):t.success?h({emailSig:t.email_sig,refreshToken:t.refresh_token,profile:t.profile},e,i):_({errMsg:t.err_msg,rememberMe:t.remember_me,pairUser:t.pair_user,profile:t.profile,emailSig:t.email_sig,refreshToken:t.refresh_token},e.cont,i)}function c(t,e){if(t.success)r.success(s._("Log in successful!")),o.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success",value:"success"}}),e.onSuccess(),e.redirectOnSuccess&&i.redirect(e.cont);else if(o.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error",value:t.err_msg}}),"access_denied"===t.err_msg)r.error(s._("You need to accept Google’s request in order to log in."));else if("emails_do_not_match"===t.err_msg)r.error(s._("We couldn’t find a Dropbox account matching that email."));else if("google_login_not_allowed"===t.err_msg)r.error(s._("Google sign in is disabled. Sign in with your Dropbox password or ask your                      Dropbox admin for help."));else if("sso_required"===t.err_msg)r.error(s._("Your team has single sign-on. Sign in with your Dropbox password or ask your                      Dropbox admin for help."));else if("tfa_required"===t.err_msg){var a=new n({path:"/verify_code",query:{cont:e.cont,remember_me:String(t.remember_me),pair_user:String(t.pair_user)}}).toString();i.redirect(a)}else if("disabled_account"===t.err_msg)r.error(s._("This account is disabled."));else if("invalid_pair_target"===t.err_msg)r.error(s._("That account can’t be paired. Paired account must be a personal account."));else if("already_paired"===t.err_msg)r.error(s._("That account is already paired to another account."));else if("error_pairing"===t.err_msg)r.error(s._("There was an error pairing."));else if("not_verified"===t.err_msg){var a=new n({path:"/show_password_form",query:{cont:e.cont,remember_me:String(t.remember_me),pair_user:String(t.pair_user)}}).toString();i.redirect(a)}else r.error(s._("We couldn’t log you in with Google.  Try again?"))}function l(t){i.redirect(t)}function h(t,e,r){var o={fname:t.profile.given_name,lname:t.profile.family_name,email:t.profile.email,picture_url:t.profile.picture_url,email_sig:t.emailSig,refresh_token:t.refreshToken,cont:e.cont,signup_tag:e.signupTag};null!=e.k&&(o.k=e.k),null!=e.eh&&(o.eh=e.eh),null!=e.signupEndpoint&&(o.signup_endpoint=e.signupEndpoint),r&&u(r.form,r.newAccount,o),e.canRedirect&&i.redirect(new n({path:"/third_party_signup",query:o}).toString())}function u(t,e,i){t.trigger(e,i)}function _(t,e,o){if("tfa_required"===t.errMsg){var a={cont:e};null!=t.pairUser&&(a.pair_user=t.pairUser.toString()),null!=t.rememberMe&&(a.remember_me=t.rememberMe.toString()),i.redirect(new n({path:"/verify_code",query:a}).toString())}else if("sso_required"===t.errMsg){var a={email:t.profile.email,cont:e};i.redirect(new n({path:"/login",query:a}).toString())}else"user_exists"===t.errMsg?(o&&u(o.form,o.userExists,{focus:"input[name=login_password]",prefill:{".login-email":t.profile.email,"input[type='hidden'][name=refresh_token]":t.refreshToken,"input[type='hidden'][name=email_sig]":t.emailSig}}),r.error(s._("This email address is already taken. Please sign in."))):r.error(s._("Unable to link to Google. Please refresh the page to try again."))}e.handleRegisterResponse=a,e.handleLoginResponse=c}),define("modules/clean/react/recaptcha_challenge",["jquery","external/react","modules/clean/react/form_error_mixin","modules/clean/react/input","modules/core/i18n","modules/clean/static_urls"],function(t,e,i,r,n,o){var s,a,c,l,h;return a=n._,h=o.static_url,s=r.text,l=e.DOM,c=e.createElement,e.createClass({displayName:"RecaptchaChallenge",mixins:[i],getDefaultProps:function(){return{public_key:"",errorWrapperClassName:"text-input-error-wrapper",variant:"standard",onInputChange:null}},componentDidMount:function(){var e;return e=this.props.public_key,t.getScript("https://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){return Recaptcha.create(e,"recaptcha_widget",{theme:"custom"})})},handleReloadLinkClick:function(){return Recaptcha.reload()},handleSwitchTypeToAudioLinkClick:function(){return Recaptcha.switch_type("audio")},handleSwitchTypeToImageLinkClick:function(){return Recaptcha.switch_type("image")},handleHelpLinkClick:function(){return Recaptcha.showhelp()},_renderButtons:function(){return l.div({className:this.props.variant+" recaptcha-buttons"},l.a({
className:"recaptcha-button recaptcha-reload",onClick:this.handleReloadLinkClick},l.img({src:h("/static/images/icons/captcha-reload-vflqH90Ce.png")})),l.a({className:"recaptcha-button recaptcha_only_if_image",onClick:this.handleSwitchTypeToAudioLinkClick},l.img({src:h("/static/images/icons/captcha-audio-vfl_VBPgQ.png")})),l.a({className:"recaptcha-button recaptcha_only_if_audio",onClick:this.handleSwitchTypeToImageLinkClick},l.img({src:h("/static/images/icons/captcha-words-vfl-bt9Xw.png")})),l.a({className:"recaptcha-button recaptcha-show-help",onClick:this.handleHelpLinkClick},l.img({src:h("/static/images/icons/captcha-help-vfleUYtSD.png")})))},_renderRecaptchaResponseInput:function(){return c(s,{id:"recaptcha_response",name:"recaptcha_response",className:"login-text-input","disable-errors":!0,placeholder:a("Type the text"),onChange:this.props.onInputChange})},_renderDummyInput:function(){return l.input({type:"hidden",id:"recaptcha_response_field"})},_renderStandard:function(){var t;return t=this.renderErrorIfEnabled(),l.div({id:"recaptcha_widget",className:"standard recaptcha-container"},t,l.div({id:"recaptcha_image",className:"standard login-recaptcha-challenge-container"}),this._renderRecaptchaResponseInput(),this._renderButtons(),this._renderDummyInput())},_renderSmall:function(){var t;return t=this.renderErrorIfEnabled(),l.div({id:"recaptcha_widget",className:"small recaptcha-container"},t,l.div({id:"recaptcha_image",className:"small login-recaptcha-challenge-container"}),this._renderButtons(),this._renderRecaptchaResponseInput(),this._renderDummyInput())},render:function(){return"standard"===this.props.variant?this._renderStandard():"small"===this.props.variant?this._renderSmall():void 0},reload:function(){return Recaptcha.reload()}})});var bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/register_form",["jquery","external/cyfd","external/pixie","external/underscore","modules/clean/ajax","modules/clean/captcha","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/em_string","modules/clean/form_util/name_parser","modules/clean/mailcheck","modules/clean/profile_services/auth_callback_handler","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/constants/pixie","modules/constants/subgrowth_experiments","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,e,i,r,n,o,s,a,c,l,h,u,_,d,p,f,m,g,v){var y,w,b,k,$,S;return $=h.handleRegisterResponse,y=_.ProfileServicesLinkingHandler,m._,S=new i.Pixie(d).get_specter(),S.start(),k=function(){return e.cfsubmit()},b=(function(){function e(e,i,r){var n,s,a;this.$form=t(i),(null!=(a=this.$form.find(".recaptcha_v2_challenge"))?a.length:void 0)?(n=t(this.$form.find(".recaptcha_v2_challenge")),this.$captcha_component=new o(this.$form,n.attr("id"),null,"/ajax_needs_business_signup_captcha","email",e,!0)):this.$captcha_component=new o(this.$form,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_business_signup_captcha","email",e),r&&(s={message_text:r}),this.$captcha_component.captcha_display_handler(s),this.$form.on("submit",(function(t){return function(t){return k()}})(this))}return e})(),w=(function(){function e(e,i,r,n,c,h,_,d,p){var f,m,g,v,w,b,k,$;this.$register_form_container=e,this.can_redirect=r,this.show_form=n,this.client_side_validation=c,this.custom_error_handler=h,this.combined_name=_,this.last_name_goes_first=d,this.signup_endpoint=p,this._combined_name_handler=bind(this._combined_name_handler,this),this._index_error_handler=bind(this._index_error_handler,this),this._animate_form=bind(this._animate_form,this),this._on_register_error=bind(this._on_register_error,this),this._on_register_success=bind(this._on_register_success,this),this._before_submit=bind(this._before_submit,this),this._handle_google_callback=bind(this._handle_google_callback,this),this.$register_form=this.$register_form_container.find(".register-form"),w={client_side_validation:this.client_side_validation,error_handler:!1},"index"===this.custom_error_handler&&(w.error_handler=this._index_error_handler,this.$register_form.on("click change","input",this._index_clear_error_handler)),this.register_controller=new s(this.$register_form,this._before_submit,w),this.cont=this.$register_form.find("input[name='cont']").val(),this.$register_form.find(".login-button, .auth-google").prop("disabled",!1),this.$register_form.find(".login-button.disabled-button").prop("disabled",!0),(null!=($=this.$register_form.find(".recaptcha_v2_challenge"))?$.length:void 0)?(g=t(this.$register_form.find(".recaptcha_v2_challenge")),this.$captcha_component=new o(this.$register_form,g.attr("id"),null,"/ajax_needs_signup_captcha","email",i,!0)):this.$captcha_component=new o(this.$register_form,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_signup_captcha","email",i),f=this.$register_form.find("label[for='tos_agree']"),v=parseInt(f.css("font-size")),k=200,new a(f.text()).length*v>k&&this.$register_form.find(".checkbox").removeClass("checkbox-inline"),this.$register_form.on(s.SUCCESS_EVENT,this._on_register_success),this.$register_form.on(s.ERROR_EVENT,this._on_register_error),this.show_form?(m=this.$register_form.find("input[type='hidden'][name='is_third_party_auth']").val(),m&&(b=function(e,i){return!t(i).val()},this.$register_form_container.find("input").filter(":visible").filter(b).first().focus()),this.$register_form.is(":visible")&&this.$captcha_component.captcha_display_handler()):this.$register_form.find(".login-button").on("click",(function(t){return function(e){if(!t.$register_form_container.hasClass("form_shown"))return e.preventDefault(),t._animate_form()}})(this)),this.$register_form.find(".auth-google").click((function(t){return function(e){var i,r,n;return i=function(e){return t._handle_google_callback(e)},n="true"===e.target.getAttribute("data-third-party-no-popup"),r=new y,r.auth_service_create_user_if_needed(u.GOOGLE,i,"register_form",!n)}})(this)),"small"===i?(this.$register_form.find(".bubble-dropdown-container .bubble-dropdown").css({visibility:"hidden"}),this.$register_form.find(".password-input-meter").css({cursor:"default"})):new l(this.$register_form.find(".input-email"),this.$register_form.find(".email-suggestion"),{livecheck:!1})}return e.REGISTER_SUCCESS="db:register:success",e.NEW_ACCOUNT_FROM_3RD_PARTY="db:register:new_account_from_3rd_party",e.USER_EXISTS="db:register:user_exists",e.prototype._handle_google_callback=function(t){var i,r,n,o,s,a;return r="/home","V1"===p.SUBGROWTH_USER_TRIALS?r="/pro-upgrade":"V4"!==(s=p.SUBGROWTH_USER_TRIALS)&&"V5"!==s||(r="/select-upgrade"),i=this.$register_form.find("input[type='hidden'][name='cont']").val()||r,a=this.$register_form.find("input[type='hidden'][name='signup_tag']").val(),o=this.$register_form.find("input[type='hidden'][name='k']").val(),n=this.$register_form.find("input[type='hidden'][name='eh']").val(),$(t,{cont:i,signupTag:a,canRedirect:this.can_redirect,k:o,eh:n,signupEndpoint:this.signup_endpoint},{form:this.$register_form,newAccount:e.NEW_ACCOUNT_FROM_3RD_PARTY,userExists:e.USER_EXISTS})},e.prototype._before_submit=function(){return this.combined_name===!0&&this._combined_name_handler(),k(),this.register_controller.add_additional_data({specter_signup_tm:S.dump(),signup_endpoint:this.signup_endpoint})},e.prototype._on_register_success=function(t,i){if(this.$register_form.trigger(e.REGISTER_SUCCESS,i),this.can_redirect){if(this.cont)return f.redirect(this.cont);if(i.redirect_url)return f.redirect(i.redirect_url)}},e.prototype._on_register_error=function(t,e){return this.$captcha_component.captcha_display_handler(null!=e?e.recaptcha_response:void 0)},e.prototype._animate_form=function(){if(!this.$register_form_container.hasClass("form_shown"))return t.when(this.$register_form_container.animate({height:this.$register_form.height()},{easing:"easeInOutCubic",duration:500})).done((function(t){return function(){return t.$register_form_container.addClass("form_shown"),t.$register_form_container.filter(":input").filter(":visible").first().focus(),t.$captcha_component.captcha_display_handler()}})(this))},e.prototype.fill=function(t){return r.each(t,(function(t){return function(e,i){return t.$register_form.find("[name="+i+"]").val(e)}})(this))},e.prototype._index_error_handler=function(e){var i,r,n,o;this.$register_form_container.find(".register-form__errors").remove(),i=t("<ul />").addClass("register-form__errors");for(n in e)r=e[n],o=r.message_text||r.message_html,t("<li />").addClass("register-form__error").html(o).appendTo(i),this.$register_form.find(".input-"+n).addClass("text-input--error"),"tos_agree"===n&&this.$register_form.find(".checkbox-inline.agree").addClass("checkbox-inline--error"),this.combined_name&&"fname"===n&&(this.$register_form.find(".input-fullname").addClass("text-input--error"),this.$register_form.find("input[name='fullname']").addClass("input-error")),this.$register_form.find("input[name='"+n+"']").addClass("input-error");return this.$register_form_container.append(i)},e.prototype._index_clear_error_handler=function(e){var i;return i=t(e.target),i.removeClass("input-error"),"checkbox"===i.attr("type")?i.parents(".checkbox-inline--error").removeClass("checkbox-inline--error"):i.parents(".text-input--error").removeClass("text-input--error")},e.prototype._combined_name_handler=function(){var t,e,i,r,n,o;if(t=this.$register_form_container.find('input[name="fullname"]'),e=this.$register_form_container.find('input[name="fname"]'),i=this.$register_form_container.find('input[name="lname"]'),n=c.splitFullName(t.val()),r=n[0],o=n[1],this.last_name_goes_first!==!0){if(e.val(r),void 0!==o&&o!==r)return i.val(o)}else if(i.val(r),void 0!==o&&o!==r)return e.val(o)},e})(),{RegisterNamesAndCredentialsWithCaptcha:b,RegisterForm:w}}),define("modules/clean/shared_link_error",["jquery","modules/clean/ajax"],function(t,e){return(function(){function i(){t("#broken-share-article").on("click",function(){return e.WebRequest({url:"/shared_link_error_log",data:{evt:r}})})}var r;return r="click-sharing-article",i})()});var bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/sso_login_checks",["modules/clean/ajax"],function(t){var e;return e=(function(){function e(t,e,i,r){this.$email_input=t,this.show_sso_fn=e,this.hide_sso_fn=i,this.should_trigger_check=null==r||r,this.check_sso_state=bind(this.check_sso_state,this),this._trigger_check_sso_state=bind(this._trigger_check_sso_state,this),this.should_trigger_check&&(this._trigger_check_sso_state(),this.$email_input.on("input keyup change",this._trigger_check_sso_state))}return e._sso_check_in_flight={},e._sso_check_cache={},e.prototype._trigger_check_sso_state=function(){var t;return t=this.$email_input.val(),this.check_sso_state(t)},e.prototype.check_sso_state=function(i){var r,n;return n=i.trim(),n.match(/^[^@\s]+@[^@\s]+\.[A-Za-z]{2,}$/)?(r=n.toLowerCase(),r in e._sso_check_cache?this._handle_sso_state(e._sso_check_cache[r]):e._sso_check_in_flight[r]?void 0:(e._sso_check_in_flight[r]=!0,t.WebRequest({url:"/sso_state",data:{email:n},success:(function(t){return function(n){return n=JSON.parse(n),delete e._sso_check_in_flight[r],e._sso_check_cache[r]=n.user_sso_state,t.should_trigger_check&&t.$email_input.val()!==i?t._trigger_check_sso_state():t._handle_sso_state(n.user_sso_state)}})(this),error:(function(t){return function(){return delete e._sso_check_in_flight[r],t.hide_sso_fn()}})(this)}))):this.hide_sso_fn()},e.prototype._handle_sso_state=function(t){return"required"===t?this.show_sso_fn(!1):"optional"===t?this.show_sso_fn(!0):this.hide_sso_fn()},e})(),{SsoLoginChecks:e}});var bind=function(t,e){return function(){return t.apply(e,arguments)}};define("modules/clean/upsell/ha",["jquery","modules/clean/upsell/prompt_event_emitter","modules/clean/upsell/exception","modules/clean/upsell/upsell_controller"],function(t,e,i,r){return(function(){function n(t,e){var r;this.$ha=t,this.options=e,this._show_if_possible=bind(this._show_if_possible,this);try{this._attach_listeners(),this._maybe_show(),this.options.isMaestro&&this._init_maestro()}catch(t){r=t,i.reportJsControllerException({err:r,js_controller_options:this.options})}}return n.prototype._attach_listeners=function(){if(!this.$ha.data("ha-has-listeners"))return this.$ha.data("ha-has-listeners",!0),this.$ha.find(".dismiss-button").on("click",(function(t){return function(){return t.$ha.hide()}})(this)),this.upsell_controller=new r(this.$ha.find(".confirm-button"),this.$ha.find(".dismiss-button"),this.options)},n.prototype._init_maestro=function(){return e.Emitter.addListener(e.Events.REACT_HA_DID_UPDATE,this._show_if_possible)},n.prototype._maybe_show=function(){var e;return this.has_been_shown=!1,this.$footer=t("#page-footer"),this.$window=t(window),this.$ha_clone=this.$ha.clone().addClass("clone"),this.$ha.parent().append(this.$ha_clone),this._show_if_possible(),t(window).resize(this._show_if_possible),e=this.$ha_clone.find("img"),e.load((function(t){return function(){return t._show_if_possible()}})(this))},n.prototype._log_first_impression=function(){if(!this.has_been_shown)return this.upsell_controller.log_impression(),this.has_been_shown=!0},n.prototype._element_or_parent_is_fixed=function(e){return e.add(e.parents()).is(function(){return"fixed"===t(this).css("position")})},n.prototype._can_fit=function(){return this.options.isMaestro?this._can_fit_maestro():this._can_fit_old()},n.prototype._can_fit_maestro=function(){var e,i,r,n,o,s,a,c,l;if(i=t(".maestro-secondary-sidebar, .appactions-menu").first(),!i.length)return!1;for(e=i.children(),c=i.offset().top-t(document).scrollTop(),s=0,a=e.length;s<a;s++)r=e[s],c+=t(r).outerHeight(!0);return o=75,n=this.$ha_clone.outerHeight()+o,l=this.$window.height(),c+n<=l},n.prototype._can_fit_old=function(){var e,i,r,n,o;return n=this.$ha.offset().top-t(document).scrollTop(),r=n+this.$ha_clone.outerHeight(),i=this.$footer.outerHeight(),o=this.$window.height(),e=r+5+i<o,e||!this._element_or_parent_is_fixed(this.$ha)},n.prototype._can_fit_without_image=function(){return this.$ha_clone.addClass("no-image"),this._can_fit()},n.prototype._show_without_image=function(){return this.$ha.addClass("no-image"),this._show()},n.prototype._can_fit_with_image=function(){return this.$ha_clone.removeClass("no-image"),this._can_fit()},n.prototype._show_with_image=function(){return this.$ha.removeClass("no-image"),this._show()},n.prototype._show=function(){return this.$ha.css("visibility","visible"),this._log_first_impression()},n.prototype._hide=function(){return this.$ha.css("visibility","hidden")},n.prototype._show_if_possible=function(){return this._can_fit_with_image()?this._show_with_image():this._can_fit_without_image()?this._show_without_image():this._hide()},n})()});var extend=function(t,e){function i(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;define("modules/clean/upsell/header_bubble_or_link",["modules/clean/header_bubble","modules/clean/upsell/exception","modules/clean/upsell/upsell_controller"],function(t,e,i){return(function(t){function r(t,n){var o,s;this.$el=t,this.options=n;try{s=new i(this.$el.find(".confirm-button"),this.$el.find(".dismiss-button"),this.options),s.log_impression(),r.__super__.constructor.apply(this,arguments)}catch(t){o=t,e.reportJsControllerException({err:o,js_controller_options:this.options})}}return extend(r,t),r})(t)}),define("modules/clean/ux_analytics",["require","exports"],function(t,e){"use strict";function i(){return(new Date).getTime()}function r(){var t=document.documentElement;return(window.pageYOffset||t.scrollTop)-(t.clientTop||0)}function n(t){return void 0===t&&(t=window),t.location.href}function o(t){return void 0===t&&(t=window),t.location.search}function s(t,e,r){void 0===r&&(r={});var n=null,o=0;return function(){var s=i();o||r.leading!==!1||(o=s);var a=e-(s.valueOf()-o.valueOf()),c=arguments;if(a<=0||a>e)n&&(clearTimeout(n),n=null),o=s,t.apply(null,c),c=null;else if(!n&&r.trailing!==!1){var l=function(){o=r.leading===!1?0:i(),n=null,t.apply(null,c),c=null};n=setTimeout(l,a)}}}function a(){var t={},e=o();if(e.length)for(var i=e.substring(1).replace(/&amp;/g,"&").split("&"),r=0,n=i;r<n.length;r++){var s=n[r],a=s.split("="),c=a[0],l=a[1];c&&l&&(c=c.trim(),l=l.trim(),c.length&&l.length&&(t[c]=decodeURIComponent(l.replace(/\+/g," "))))}return t}function c(t){return t&&"A"===t.nodeName}function l(t){return t&&t.getAttribute("data-trackingid")}function h(t){return t&&"BODY"===t.nodeName}function u(t){for(var e=t,i=0;i<6&&(!c(e)&&!l(e))&&!h(e);i++){var r=e.parentNode;if(!(r instanceof HTMLElement))break;e=r}return e}var _,d=(function(){var t=null,e="uxa.onedoesnotsimplyusesessionstorage";try{t=window.sessionStorage,t&&(t.setItem(e,e),t.removeItem(e))}catch(e){t=null}return t})(),p=(function(){var t=window;return t.hasOwnProperty("JSON")?t.JSON:null})();(function(t){function e(t){return"uxa."+t}function i(){return!!a}function r(t){if(!a||!c)return null;try{var i=a.getItem(e(t));return null===i?null:c.parse(i)}catch(t){return null}}function n(t,i){if(!a||!c)return null;try{return null===i?o(t):(a.setItem(e(t),c.stringify(i)),null)}catch(t){return null}}function o(t){return a?(a.removeItem(e(t)),null):null}function s(t){return a?(a.clear(),null):null}var a=d,c=p;t.isEnabled=i,t.get=r,t.set=n,t.remove=o,t.clear=s})(_=e.UXStorage||(e.UXStorage={}));var f={heartbeat:"heartbeat",linkClick:"link_click",linkNoSessionStorage:"link_no_session_storage",modalClose:"modal_close",modalOpen:"modal_open",pageView:"page_view",scroll:"scroll_event"},m=Object.keys(f).map(function(t){return f[t]}),g={linkClick:"clicked_link",trackingParams:"tracking_params"},v=(function(){function t(t,e,n,o){void 0===o&&(o={});var s=this;this.currentModalId=null,this.lastScrollOffset=0,this.scrollTimer=null,this.startHeartbeat=function(){for(var t=0,e=[2,5,10,15,30];t<e.length;t++){var i=e[t];setTimeout(s.logOnPage.bind(s,f.heartbeat),1e3*i)}for(var r=0,n=[1,2,4,9];r<n.length;r++){var i=n[r];setTimeout(s.logOnPage.bind(s,f.heartbeat),60*i*1e3)}},this.delayedInit=function(){s.saveTrackingParams(),s.logPageView(),s.logDelayedClickEvent(),s.setupListeners()},this.trackScrolling=function(){s.scrollTimer&&clearTimeout(s.scrollTimer),s.scrollTimer=setTimeout(s.onScroll,500)},this.onScroll=function(){var t=r();s.lastScrollOffset!==t&&(s.lastScrollOffset=t,s.logOnPage(f.scroll,{vertical_offset:t}))},this.handleLinkClick=function(t){var e=u(t.target);if(c(e)||l(e)){var i=e.getBoundingClientRect(),n=s.createEvent(f.linkClick,{left:Math.round(i.left),link_id:e.getAttribute("data-trackingid"),link_rank:s.getLinkRank(e),origin_href:e.getAttribute("href"),time_on_page:s.getTimeOnPage(),top:Math.round(i.top),vertical_offset:r(),tag_name:e.tagName.toLowerCase()});s.delayedLinkClickLogging&&c(e)?s.storeDelayedLinkClick(n):s.logEvent(n)}},this.handleLinkKeyboardEnter=function(t){13===t.keyCode&&s.handleLinkClick(t)},this.trackModalShow=function(){var t=document.querySelector(s.modalClass);t&&(t.offsetWidth>0||t.offsetHeight>0)&&(s.currentModalId=t.id,s.logModal(f.modalOpen,s.currentModalId))},this.trackModalHide=function(){s.currentModalId&&(s.logModal(f.modalClose,s.currentModalId),s.currentModalId=null)},this.requestId=t,this.orgReferrer=e,this.logger=n,void 0!==o.delayed_link_click_logging?this.delayedLinkClickLogging=o.delayed_link_click_logging:this.delayedLinkClickLogging=!0,void 0!==o.modal_class?this.modalClass=o.modal_class:this.modalClass=".ui-modal",this.initTime=i(),this.startHeartbeat(),setTimeout(this.delayedInit,200)}return t.resetStorage=function(){for(var t=0,e=Object.keys(g);t<e.length;t++){var i=e[t];_.remove(g[i])}},t.prototype.setupListeners=function(){window.addEventListener("scroll",s(this.trackScrolling,2e3,{leading:!0})),document.body.addEventListener("mousedown",this.handleLinkClick),document.body.addEventListener("keydown",this.handleLinkKeyboardEnter),document.addEventListener("modalOpened",this.trackModalShow),document.addEventListener("modalClosed",this.trackModalHide)},t.prototype.logPageView=function(){this.logEvent(this.createEvent(f.pageView))},t.prototype.logModal=function(t,e){var i={modal:e};this.logOnPage(t,i)},t.prototype.logDelayedClickEvent=function(){if(!_.isEnabled())return null;var t=_.get(g.linkClick);if(t)try{t.destination_url=n();var e={eventName:f.linkClick,extra:t};this.logEvent(e),_.remove(g.linkClick)}catch(t){}return null},t.prototype.logOnPage=function(t,e){void 0===e&&(e={}),e.vertical_offset=e.vertical_offset||r(),e.time_on_page=e.time_on_page||this.getTimeOnPage(),this.getTimeOnPage()<600&&this.logEvent(this.createEvent(t,e))},t.prototype.logEvent=function(t){try{if(m.indexOf(t.eventName)===-1)throw new Error("UXAnalytics.log: trying to log an invalid event ("+t.eventName+")");this.logger.log(t.eventName,t.extra)}catch(t){throw t}},t.prototype.createEvent=function(t,e){if(void 0===e&&(e={}),this.orgReferrer&&(e.org_referrer=this.orgReferrer),e.request_id=e.request_id||this.requestId,e.url=e.url||n(),e.uxa_v=2.2,this.trackingParams)for(var i=0,r=Object.keys(this.trackingParams);i<r.length;i++){var o=r[i],s=o.replace(/^_/,""),a=this.trackingParams[o];e["param_"+s]=a}return{eventName:t,extra:e}},t.prototype.storeDelayedLinkClick=function(t){if(!_.isEnabled())return this.logOnPage(f.linkNoSessionStorage),!1;try{_.set(g.linkClick,t.extra)}catch(t){return!1}return!0},t.prototype.saveTrackingParams=function(){var t=this.getTrackingParams();Object.keys(t).length?(_.set(g.trackingParams,t),this.trackingParams=t):this.trackingParams=null},t.prototype.getTrackingParams=function(){for(var t=_.get(g.trackingParams)||{},e=["gclid","oqa","trigger","_tk","_camp","_ad","_net","_kw","utm_source","utm_medium"],i=a(),r=0,n=e;r<n.length;r++){var o=n[r];i.hasOwnProperty(o)&&(t[o]=i[o])}return t},t.prototype.getTimeOnPage=function(){return Math.round((i()-this.initTime)/1e3)},t.prototype.getLinkRank=function(t){var e=t.getAttribute("href"),i=document.querySelectorAll('a[href="'+e+'"]');if(1===i.length)return 1;for(var r=0;r<i.length;r++)if(i[r]===t)return r+1;return-1},t})();e.UXAnalytics=v}),define("modules/core/ordered_dictionary",[],function(){return(function(){function t(t,e){this.list=t,this.dict=e}return t.list=[],t.dict={},t.prototype.push=function(t,e){this.list.push(t),this.dict[t]=e},t.prototype.remove=function(t){this.list.removeItem(t),delete this.dict[t]},t.prototype.indexOfKey=function(t){return this.list.indexOf(t)},t.prototype.keyAtIndex=function(t){return this.list[t]},t.prototype.valueFromKey=function(t){return this.dict[t]},t.prototype.valueAtIndex=function(t){return this.dict[this.list[t]]},t.prototype.getValues=function(){var t;return function(){var e,i,r,n;for(r=this.list,n=[],e=0,i=r.length;e<i;e++)t=r[e],n.push(this.dict[t]);return n}.call(this)},t.prototype.length=function(){return this.list.length},t.prototype.insertAtIndex=function(t,e,i){return this.list.splice(t,0,e),this.dict[e]=i},t})()});
//# sourceMappingURL=pkg-maestro-ab.min.js-vflvZwJIH.map