var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/comments/comment_dom",["external/react","modules/clean/referrer_cleansing_redirect"],function(e,t){var n,i,r;return n="…",i=function(n,i,o){var a,s,c,l,d,u,h,m,p,_,f,g,v,y,E,I,A,R;for(null==i&&(i=!0),null==o&&(o=null),s=e.DOM,h=/@\[(?:\s*(?:dbid:)?[^:\[\]]+):(?:[^\[]+)\]/i,u=/@\[(\s*(?:dbid:)?[^:\[\]]+):([^\[]+)\]/i,R="(?:[-a-zA-Z0-9@:%_+~#=]+[.])+[a-z]{2,6}(?:[:./?#][-a-zA-Z0-9@%_+~&=]+)*(?=[^a-zA-Z0-9_]|$)",I="http://"+R+"|https://"+R+"|www."+R+"|"+R,A=new RegExp(I,"i"),d=/\n/,g=[h,d],i&&g.push(A),v=RegExp("("+(function(){var e,t,n;for(n=[],e=0,t=g.length;e<t;e++)_=g[e],n.push(_.source);return n})().join("|")+")","gi"),p=[],f=n.split(v),c=0,l=f.length;c<l;c++)a=f[c],a&&(a.match(h)?(y=a.match(u),m=y[2].trim(),p.push(s.span({className:"comment-mention"},m))):indexOf.call(g,A)>=0&&a.match(A)?(E=a,E.indexOf("http://")<0&&E.indexOf("https://")<0&&(E="http://"+E),E=t.get_redirect_uri(E),p.push(s.a({href:E,target:"_blank",rel:"noopener noreferrer"},a))):a.match(d)?p.push(s.br({})):p.push(a));return r(p,o)},r=function(e,t){var i,r,o,a,s,c,l,d,u;if(null==t&&(t=null),!t)return e;if(i=0,u=[],t<=0)return e.length>0?n:e;for(r=0,a=e.length;r<a;r++)if(d=e[r],"object"==typeof d){if(null!=(null!=(s=d.props)?s.children:void 0)&&(i+=null!=(c=d.props)&&null!=(l=c.children)?l.length:void 0),u.push(d),i>=t)return u.push(n),u}else{if(i+d.length>=t)return o=t-i,u.push(d.substring(0,o)),u.push(n),u;i+=d.length,u.push(d)}return e},{convertRawCommentTextToReactDom:i}});var extend=function(e,t){function n(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/deprecated/dbmodal_loading",["modules/clean/dbmodal","modules/clean/deprecated/uirequest"],function(e,t){return(function(e){function n(e){n.__super__.constructor.call(this,e)}return extend(n,e),n.prototype.on_show=function(){return this.fetch()},n.prototype.fetch=function(){return new t(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,error:(function(e){return function(t,n,i){return e.hide()}})(this)})},n.prototype.on_confirm_button_click=null,n.prototype.on_cancel_button_click=null,n})(e.DBModal)}),define("modules/clean/fileops",["require","exports","tslib","jquery","modules/clean/ajax","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,r,o,a,s){"use strict";function c(e,t){var n=i.Deferred(),s=o.ungettext("Deleted %(file_count)s item.","Deleted %(file_count)s items.",t.length).format({file_count:t.length});return a.success(s),r.WebRequest({url:"/cmd/delete",data:{files:t},subject_user:e,success:function(e){n.resolve(e)},error:function(e){a.error(o._("Failed to perform the delete. Please try again later.")),n.reject(e)}}),n.promise()}function l(e,t,i){return void 0===i&&(i={}),i=n.__assign((r={},r._subject_uid=String(t),r),i),new s({path:"/history"+e,query:i});var r}t.do_nonbrowse_delete=c,t.build_revisions_uri=l}),define("modules/clean/page_role_observer",["modules/core/exception"],function(e){var assert;return assert=e.assert,new((function(){function e(){this._listeners=[]}return e.prototype.addListener=function(e){return assert("function"==typeof e,"PageRoleState.addListener expects a function, got: "+typeof e),this._listeners.push(e)},e.prototype.removeListener=function(e){var t;return assert("function"==typeof e,"PageRoleState.removeListener expects a function, got: "+typeof e),this._listeners=function(){var n,i,r,o;for(r=this._listeners,o=[],n=0,i=r.length;n<i;n++)t=r[n],t!==e&&o.push(t);return o}.call(this)},e.prototype.removeAllListeners=function(){return this._listeners=[]},e.prototype.emit=function(e){var t,n,i,r,o;for(r=this._listeners.slice(),o=[],n=0,i=r.length;n<i;n++)t=r[n],o.push(t(e));return o},e})())}),define("modules/clean/react/home/home_access/recents/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/recents/constants"],function(e,t,n,i){"use strict";t.HomeRecentsActions={logEvent:function(e,t,r,o,a){var s={actionType:e,cellView:t,fqPaths:r,totalCount:o,index:a};n.dispatch({type:i.HomeRecentsActionTypes.LOG_EVENT,event:s})}}}),define("modules/clean/react/home/home_access/recents/constants",["require","exports"],function(e,t){"use strict";t.HomeRecentsActionTypes={LOG_EVENT:"HOME_RECENTS_LOG_EVENT"}}),define("modules/clean/recent_activity/actions/error_actions",["require","exports","external/underscore","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/core/exception","modules/core/i18n","modules/core/notify"],function(e,t,n,i,r,o,a,s){"use strict";var c=(function(){function e(e){var t=this;this._flushQueues=function(){t._rafId=null;var e=t._recentActivityQueue;t._recentActivityQueue=[],e.length&&t._dispatcher.dispatch({type:i.RAW_RECENT_ACTIVITY_PARSE_ERROR,errors:e});var n=t._relatedActivityQueue;t._relatedActivityQueue=[],n.length&&t._dispatcher.dispatch({type:i.RAW_RELATED_ACTIVITY_PARSE_ERROR,errors:n})},this._notify=n.throttle(function(){var e=a._("Sorry, we were unable to show some recent items. The team has been notified");s.error(e)},500,{trailing:!1}),this._dispatcher=e,this._recentActivityQueue=[],this._relatedActivityQueue=[],this._rafId=null}return e.prototype.recentActivityParseError=function(e,t){o.reportException({err:t}),this._notify(),this._enqueueError(this._recentActivityQueue,e,t)},e.prototype.relatedActivityParseError=function(e,t){o.reportException({err:t}),this._notify(),this._enqueueError(this._relatedActivityQueue,e,t)},e.prototype._enqueueError=function(e,t,n){e.push({activityKey:t,error:n}),this._rafId||(this._rafId=window.requestAnimationFrame(this._flushQueues))},e})();t.ErrorActions=c,t.errorActions=new c(r)}),define("modules/clean/recent_activity/actions/recent_activity_action_permissions",["require","exports","modules/clean/recent_activity/recent_activity_model"],function(e,t,n){"use strict";function i(e,t){return n.isShareLinkRecentItem(e)?r(!!t.canOpen):{open:!!t.canOpen,delete:!t.isReadOnly,download:!0,comment:!t.isDir,versions:!t.isDir,archive:!1,share:!1}}function r(e){return{archive:!1,comment:!1,delete:!1,download:!1,open:e,share:!1,versions:!1}}function o(e,t,i){if(e.federatedRecentItem)return{archive:e.federatedRecentItem.isArchiveable(),comment:!1,delete:!1,download:!1,open:!1,share:e.federatedRecentItem.isShareable(),versions:!1};var o=e.attachmentIds.length>1,s=t[0],c=i.length,l=!o||1===c;if(n.isShareLinkRecentItem(e))return r(!!(l&&s&&s.canOpen));var d=a(t,i),u=c>0,h=!s||!s.isDir;return{archive:!1,comment:l&&h,delete:u&&d.allSelectedItemsAreNotReadOnly||o&&d.allItemsAreNotReadOnly||!o&&s&&!s.isReadOnly,download:l,open:!!(l&&s&&s.canOpen),share:!!(l||u&&d.allSelectedItemsAreInRootCollections||d.allItemsAreInRootCollection),versions:l&&h}}function a(e,t){for(var n={allItemsAreInRootCollection:!0,allItemsAreNotReadOnly:!0,allSelectedItemsAreInRootCollections:!0,allSelectedItemsAreNotReadOnly:!0},i=0,r=e;i<r.length;i++){var o=r[i];o.inRootCollection||(n.allItemsAreInRootCollection=!1),o.isReadOnly&&(n.allItemsAreNotReadOnly=!1),t.indexOf(o.id)>=0&&(o.inRootCollection||(n.allSelectedItemsAreInRootCollections=!1),o.isReadOnly&&(n.allSelectedItemsAreNotReadOnly=!1))}return n}t.getDocAttachmentViewPermissions=i,t.getRecentActivityItemViewPermissions=o}),define("modules/clean/recent_activity/actions/recent_activity_actions",["require","exports","tslib","external/underscore","modules/clean/dbmodal","modules/clean/deprecated/dbmodal_loading","modules/clean/downloads","modules/clean/fileops","modules/clean/react/home/home_access/recents/actions","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/recent_activity/transactions","modules/clean/sharing/async_share_modal_util","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/python","modules/constants/python","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/store_utils"],function(e,t,n,i,r,o,a,s,c,l,d,u,h,m,p,_,f,g,v,y,E,I,A,R,T,w,C,S,b,N,P,L,O){"use strict";function D(e){return i.pluck(e,"previewInfo").filter(function(e){return e&&!e.is_dir})}function k(t,r,o){var a=I.get_viewer().get_user_by_id(t);o=n.__assign({index:0,shouldFocusCommentInput:!1},o),A.waitForTTI().then(function(){e(["modules/clean/react/file_viewer/controller"],function(e){e.isShown()?e.updateFiles(r):e.open(r,o.index,a,"react-file-viewer",{disableRouting:!0,oref:R.OREF_CONSTANTS.RECENTS,fileViewTarget:T.FileViewTargetType.PRIVATE,fileViewOrigin:T.FileViewOriginType.RECENTS,fileViewAction:T.FileViewActionType.CLICK,shouldFocusCommentInput:o.shouldFocusCommentInput,onCloseViewer:o.onCloseViewer||i.noop})},function(){return b.error(S._("There was a problem completing this request."))})})}function x(e,t,r){void 0===r&&(r={});var o=!1,a=g.attachmentStore.getByIds(t);if(!i.all(i.pluck(a,"isLoaded"))){var s=n.__assign({},r),c=s.onCloseViewer||i.noop;s.onCloseViewer=function(){o=!0,c()};var l=D(a);l.length&&k(e,l,s)}return function(){return o}}function V(e){var t=v.recentActivityStore.cursorForUser(e);return t&&f.loadRecentItems(e,t),!!t}function M(e,t,n){f.ensureAttachments(e,[t],function(t){var r=t[0],o=r.fqPath,a=I.get_viewer().get_user_by_id(e);if(E.asyncShowShareModal(a,{fqPath:o,isFolder:r.previewInfo.is_dir,origin:"RECENTS"}),n){var s=i.pluck(t,"fqPath");_.logShareFile(e,o,n.totalCount,n.cellView),c.HomeRecentsActions.logEvent(p.ActionTypes.SHARE,n.cellView,s,n.totalCount,s.indexOf(o))}})}function F(e,t,n){f.ensureAttachments(e,t,function(t){var a=t.map(function(e){return{ns_id:e.nsId,ns_path:e.nsPath}});if(u.createCollectionSharedLink(e,a).then(function(t){if(t.shareableItemCount<a.length){var n=a.length-t.shareableItemCount;b.error(S.ungettext("%(missing)s file can’t be shared.","%(missing)s files can’t be shared.",n).format({missing:n}))}var i=new N({path:"/sm/get_link_modal_content/"+t.tkey}).toString();r.DBModalStack.push(new o({element_id:"share-link-modal",endpoint_url:i,subject_user:e,parameters:{origin:"recents"}}))}),n){var s=i.pluck(t,"fqPath");_.logShareCollection(e,s,n.totalCount,n.cellView)}})}function U(e){w.redirect(e)}function H(e,t,n,r){void 0===n&&(n={});var o=x(e,t,n);f.ensureAttachments(e,t,function(t){var a=t[0],s=i.pluck(t,"fqPath"),l=D(t),d=n.shouldFocusCommentInput?p.ActionTypes.COMMENT:p.ActionTypes.VIEW_FILE;if(r&&c.HomeRecentsActions.logEvent(d,r.cellView,s,r.totalCount,n.index),l.length){if(o()||k(e,l,n),r){var u=r.totalCount,h=r.cellView;n.shouldFocusCommentInput?_.logCommentFile(e,s[n.index||0],u,h):_.logPreviewFiles(e,s,u,h)}}else U(a.entityUri)})}function q(t,n,r,o){void 0===o&&(o=i.noop),e(["modules/clean/unity/features"],function(e){C.assert(!!e,"Unity is not supported by this browser"),f.ensureAttachments(t,[n],function(n){var a=n[0],s=a.nsId,l=a.nsPath,d=a.fqPath;if(e.open_file(s,l,t,i.noop,function(e){b.error("We were unable to open this file"),C.reportException({err:Error(e),tags:["recents"],severity:C.SEVERITY.NONCRITICAL})}),r){var u=r.totalCount,h=r.cellView,m=i.pluck(n,"fqPath");_.logUnityOpenFile(t,d,u,h),c.HomeRecentsActions.logEvent(p.ActionTypes.OPEN,h,m,u,m.indexOf(d))}o()})})}function B(e,t,n){var r,o,a=function(){return f.ensureAttachments(e,t,function(r){var o=i.pluck(r,"fqPath");if(n){var a=n.totalCount,l=n.cellView;_.logDeleteFiles(e,o,a,l),c.HomeRecentsActions.logEvent(p.ActionTypes.DELETE,l,o,a,void 0)}var d=y.createTransaction(h.TransactionPrefixes.DELETE_FILES,m);d.pending({attachmentIds:t}),s.do_nonbrowse_delete(e,o).then(d.commit,d.rollback)})};if(1===t.length){o=S._("Delete file?");var d=g.attachmentStore.getById(t[0]);r=d&&d.isLoaded?S._("Do you want to delete <b>%(file_name)s</b>?").format({file_name:i.escape(d.displayName)}):S._("Do you want to delete this file?")}else o=S._("Delete files?"),r=S._("Do you want to delete <b>%(num)s files</b>?").format({num:i.escape(String(t.length))});l.SimpleModal.show({title_text:o,body_html:r,confirm_text:S._("Delete"),confirm_callback:a,cancel_text:S._("Cancel"),autoclose:!0})}function W(e){m.dispatch({type:d.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:e})}function j(e,t){m.dispatch({type:d.SELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})}function Y(e,t){m.dispatch({type:d.DESELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})}function G(e,t,n){f.ensureAttachments(e,t,function(t){if(n){var r=i.pluck(t,"fqPath"),o=n.totalCount,s=n.cellView;_.logDownloadFile(e,r,o,s),c.HomeRecentsActions.logEvent(p.ActionTypes.DOWNLOAD,s,r,o)}for(var l=0,d=t;l<d.length;l++){var u=d[l];if(u.isDir&&null!=u.previewInfo&&null!=u.previewInfo.block_hash)a.get_zip({fq_paths:[u.fqPath],subject_uid:e,block_hash:u.previewInfo.block_hash,parent_path:u.fqPath});else{var h=null!=u.previewInfo?u.previewInfo.direct_blockserver_link:void 0;h&&a.get_blockserver_link({url:h})}}})}function K(e,t,n){f.ensureAttachments(e,[t],function(t){var r=t[0].fqPath,o=s.build_revisions_uri(r,e);if(n){var a=n.totalCount,l=n.cellView,d=i.pluck(t,"fqPath");_.logOpenVersions(e,r,a,l),c.HomeRecentsActions.logEvent(p.ActionTypes.VERSIONS,l,d,a,d.indexOf(r))}w.redirect(o.toString())})}t.loadNextPage=V,t.loadAttachmentsForRecentActivities=P.loadAttachmentsForRecentActivities,t.shareFile=M,t.shareCollection=F,t.browseFile=U,t.previewFiles=H,t.openFile=q,t.markOnboardingAsSeen=L.markOnboardingAsSeen,t.promptAndDeleteAttachments=B,t.loadAttachments=O.loadAttachments,t.updateRecentActivities=O.updateRecentActivities,t.updateRelatedActivities=W,t.selectAttachments=j,t.deselectAttachments=Y,t.downloadFiles=G,t.openVersions=K}),define("modules/clean/recent_activity/react/attachment_file_icon_view",["external/underscore","external/classnames","external/react","modules/clean/em_string","modules/clean/react/sprite","modules/clean/recent_activity/react/selectable_view"],function(e,t,n,i,r,o){var a,s;return s=n.DOM,a=n.PropTypes,n.createClass({displayName:"AttachmentFileIconView",propTypes:{id:a.string,file:a.shape({displayName:a.string.isRequired,icon:a.string.isRequired,entityUri:a.string}),overlayText:a.string,handleClick:a.func,handleContextMenu:a.func,showCheckmark:a.bool,handleToggleSelect:a.func,isSelected:a.bool},getDefaultProps:function(){return{handleClick:e.noop,handleContextMenu:e.noop}},_onClick:function(e){return e.preventDefault(),this.props.handleClick(this.props.id)},_onContextMenu:function(e){return e.preventDefault(),this.props.handleContextMenu(this.props.id)},_renderFilename:function(){var e,t,n;return n=this.props.file.displayName.split("."),t="."+n.pop(),e=i.em_snippet(n.join("."),10),s.span({ref:"filename",className:"attachment-item__filename"},e,s.wbr(),s.span({className:"nowrap"},t))},_renderIcon:function(){return n.createElement(r,{ref:"icon",alt:"",group:"web",name:this.props.file.icon,className:"attachment-item__icon"})},render:function(){var e,i,r,a,c,l,d;return l=this._renderIcon(),c=this._renderFilename(),this.props.overlayText&&(d=s.span({ref:"overlay",className:"attachment-item__overlay"},this.props.overlayText)),this.props.showCheckmark&&(r=n.createElement(o,{id:this.props.id,ref:"checkmark",handleToggleSelect:this.props.handleToggleSelect,isSelected:this.props.isSelected})),i={ref:"anchor",href:this.props.file.entityUri,title:this.props.file.displayName,className:"attachment-item__anchor",onClick:this._onClick,onContextMenu:this._onContextMenu},e=s.a(i,l,c,d,r),a={"attachment-item":!0,"attachment-item--file-thumb":!0,"attachment-item--show-more":!!this.props.overlayText,"attachment-item--selected":this.props.isSelected},s.div({className:t(a)},e)}})}),define("modules/clean/recent_activity/react/attachment_grid",function(){return(function(){function e(e,t){this._gridWidth=e,this._gutterWidth=t}return e.create=function(){return(function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i})(e,arguments,function(){})},e.prototype.generate=function(e,t){var n,i,r;for(null==t&&(t=1/0),i=[],n=0;i.length<t&&n<e.length;)r=this._buildRow(e.slice(n)),n+=r.length,i.push(r);return i},e.prototype._buildRow=function(e){var t,n,i,r,o;for(o=[],t=this._gridWidth+this._gutterWidth,n=0,r=e.length;n<r&&(i=e[n],t=t-i.width-this._gutterWidth,t>=0||0===o.length);n++)o.push(i);return o},e})()}),define("modules/clean/recent_activity/react/attachment_image_expanded_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/accessibility/utils","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i,r,o){var a,s,c,l;return i._,c=r.accessibleTriggerProps,l=n.DOM,s=n.PropTypes,a={VIDEO:"video"},n.createClass({displayName:"AttachmentImageExpandedView",propTypes:{id:s.string,image:s.shape({thumbnailUrl:s.string.isRequired,entityUri:s.string,displayName:s.string,width:s.number,height:s.number}),badgeType:s.oneOf(e.values(a)),handleClick:s.func,handleLoadError:s.func,showCheckmark:s.bool,handleToggleSelect:s.func,handleCornerClick:n.PropTypes.func,isSelected:s.bool},_handleCornerClick:function(e){return e.preventDefault(),this.props.handleCornerClick(this.props.id)},render:function(){var t,i;return t=l.div({className:"attachment-item--expanded__image"},n.createElement(o,this.props)),i=l.a(e.extend(c(this._handleCornerClick),{ref:"overlayCorner",className:"attachment-item--expanded__corner"}),"-"),l.div({className:"attachment-item attachment-item--expanded",style:{width:this.props.image.width,height:this.props.image.height}},t,i)}})}),define("modules/clean/recent_activity/react/attachment_image_stack_view",["external/underscore","external/classnames","external/react","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i){var r,o,a;return a=n.DOM,o=n.PropTypes,r={VIDEO:"video"},n.createClass({displayName:"AttachmentImageStackView",propTypes:{id:o.string,image:o.shape({thumbnailUrl:o.string.isRequired,entityUri:o.string,displayName:o.string,width:o.number,height:o.number}),badgeType:o.oneOf(e.values(r)),handleClick:o.func,handleLoadError:o.func,handleCornerClick:n.PropTypes.func,stackLength:n.PropTypes.number,isSelected:o.bool},_handleCornerClick:function(e){return e.preventDefault(),this.props.handleCornerClick(this.props.id)},render:function(){var t,r,o,s,c,l,d;return s=this.props.image.width,o=this.props.image.height,d=s-4,l=o-4,r=a.div({ref:"imgFront",className:"attachment-item--stacked__front"},n.createElement(i,e.extend({},this.props,{image:e.extend({},this.props.image,{width:d,height:l})}))),t=a.div({ref:"imgBack",className:"attachment-item--stacked__back"},n.createElement(i,{image:e.extend({},this.props.image,{width:d,height:l})})),c=a.a({ref:"overlayCorner",className:"attachment-item--stacked__corner",onClick:this._handleCornerClick},"+%(count)s".format({count:this.props.stackLength-1})),a.div({className:"attachment-item attachment-item--stacked",style:{width:s,height:o}},r,t,c)}})}),define("modules/clean/recent_activity/react/attachment_image_view",["external/underscore","external/classnames","external/react","modules/clean/react/helpers","modules/clean/recent_activity/react/selectable_view"],function(e,t,n,i,r){var o,a,s,c;return s=i.compareStateAndProps,c=n.DOM,a=n.PropTypes,o={VIDEO:"video"},n.createClass({displayName:"AttachmentImageView",statics:{BadgeType:o},propTypes:{id:a.string,image:a.shape({thumbnailUrl:a.string.isRequired,entityUri:a.string,displayName:a.string,width:a.number,height:a.number}),badgeType:a.oneOf(e.values(o)),overlayText:a.string,handleClick:a.func,handleContextMenu:a.func,handleLoadError:a.func,showCheckmark:a.bool,handleToggleSelect:a.func,isSelected:a.bool},getDefaultProps:function(){return{handleClick:function(){},handleContextMenu:function(){},handleLoadError:function(){},handleToggleSelect:function(){},showCheckmark:!1,isSelected:!1}},getInitialState:function(){return{isLoading:!0}},shouldComponentUpdate:s,_onClick:function(e){return e.preventDefault(),this.props.handleClick(this.props.id)},_onContextMenu:function(e){return e.preventDefault(),this.props.handleContextMenu(this.props.id)},_onLoad:function(){return this.setState({isLoading:!1})},_onError:function(){return this.props.handleLoadError(this.props.id),this.setState({isLoading:!1})},_handletoggleSelected:function(e){return e.preventDefault(),e.stopPropagation(),this.props.handleToggleSelect(this.props.id,!this.props.isSelected)},render:function(){var e,i,o,a,s,l;return s=c.img({ref:"img",alt:this.props.image.displayName,className:"attachment-item__thumbnail",src:this.props.image.thumbnailUrl,onLoad:this._onLoad,onError:this._onError}),this.props.overlayText&&(l=c.span({ref:"overlay",className:"attachment-item__overlay"},this.props.overlayText)),this.props.showCheckmark&&(o=n.createElement(r,{id:this.props.id,ref:"checkmark",handleToggleSelect:this.props.handleToggleSelect,isSelected:this.props.isSelected})),i={href:this.props.image.entityUri,onClick:this._onClick,onContextMenu:this._onContextMenu,title:this.props.image.displayName,className:"attachment-item__anchor",style:{width:this.props.image.width,height:this.props.image.height},tabIndex:0},e=c.a(i,s,l),a={"attachment-item":!0,"attachment-item--show-more":!!this.props.overlayText,"attachment-item--is-loading":this.state.isLoading,"attachment-item--selected":this.props.isSelected},a["attachment-item--badge-"+this.props.badgeType]=!!this.props.badgeType,c.div({className:t(a)},e,o)}})}),define("modules/clean/recent_activity/react/attachment_list_layout",["external/underscore","modules/core/browser","modules/core/exception","modules/clean/photos/thumbnail_url_util","modules/clean/recent_activity/react/attachment_grid","modules/clean/recent_activity/react/attachment_image_view","modules/clean/recent_activity/react/attachment_file_icon_view"],function(e,t,n,i,r,o,a){var s,c,l,d,u,h,m,p,_,f,g,v,y,E,I,assert;return assert=n.assert,y=i.ThumbnailSizeMode,g=y.FIT_ONE,m=y.EXACT_NO_BACKGROUND,v=100,p=100,h=200,d=200,f=75,_=359,u=718,c=92,s=100,l=3,E={AGGREGATED_SCALED:"aggregated-scaled",AGGREGATED_WIDE_CROPPED:"aggregated-wide-cropped",AGGREGATED_CROPPED:"aggregated-cropped"},I=function(n,r){var o,a,s,c;switch(a=t.is_high_density_display(),r){case E.AGGREGATED_SCALED:c=a?h:v,o=a?d:p,s=g;break;case E.AGGREGATED_CROPPED:c=a?h:v,o=a?d:p,s=m;break;case E.AGGREGATED_WIDE_CROPPED:c=a?u:_,o=a?d:p,s=m;break;default:assert(!1,"type: "+r+" must be one of: "+e.values(E))}return i.thumbnailUrlForSize(n,c,o,s)},(function(){function t(e,t,n){this._gridWidth=e,this._columnWidth=t,this._gutterWidth=n,this._grid=r.create(e,n)}return t.create=function(){return(function(e,t,n){n.prototype=e.prototype;var i=new n,r=e.apply(i,t);return Object(r)===r?r:i})(t,arguments,function(){})},t.prototype.generate=function(e,t,n){var i;return i=this._cellMetadata(e,n),this._grid.generate(i,t)},t.prototype._cellMetadata=function(t,n){var i,r;return r=function(e,t){return e[t]=t,e},i=n.reduce(r,{}),e.map(t,(function(e){return function(t){var n;return n=i[t.id],n||t.isLoaded&&!t.thumbnailUrl?e._buildFileIconViewMetadata(t):t.isLoaded?e._buildImageViewMetadata(t):e._buildLoadingImageViewMetadata(t)}})(this))},t.prototype._buildFileIconViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:a,width:c,height:s,attachment:e}},t.prototype._buildLoadingImageViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:null,width:v,height:p,attachment:e}},t.prototype._buildImageViewMetadata=function(e){var t,n,i,r,a;return i=e.thumbnailUrl,n=this._calculateThumbnailDimensions(e.thumbnailDimensions),a=n.width,t=n.height,r=n.variant,0!==i.indexOf("data:")&&(i=I(i,r)),{id:e.id,view:o,scaledThumbnailUrl:i,width:a+2*l,height:t+2*l,attachment:e}},t.prototype._calculateThumbnailDimensions=function(e){var t,n,i,r;return e&&(r=E.AGGREGATED_SCALED,t=e.width/e.height,n=p,i=Math.floor(t*n),i>this._columnWidth-2*l&&(r=E.AGGREGATED_WIDE_CROPPED,i=this._columnWidth-2*l)),(!e||i<f)&&(r=E.AGGREGATED_CROPPED,i=v,n=p),{width:i,height:n,variant:r}},t})()}),define("modules/clean/recent_activity/react/attachment_list_view",["jquery","external/underscore","external/react","external/react-dom","modules/core/exception","modules/core/i18n","modules/clean/components/loading_indicator","modules/clean/recent_activity/react/attachment_image_view","modules/clean/recent_activity/react/attachment_image_stack_view","modules/clean/recent_activity/react/attachment_image_expanded_view","modules/clean/recent_activity/react/attachment_file_icon_view","modules/clean/recent_activity/react/attachment_list_layout","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/actions/recent_activity_actions"],function(e,t,n,i,r,o,a,s,c,l,d,u,h,m,p,_){var f,g,v,y,assert,E;return assert=r.assert,y=o._,v=h.SHOW_MORE_THUMBNAIL_ROW_INCREMENT,E=n.DOM,g=n.PropTypes,f=m.PropTypes,n.createClass({displayName:"AttachmentListView",propTypes:{attachments:g.arrayOf(f.attachment).isRequired,duplicateIds:n.PropTypes.arrayOf(n.PropTypes.number),selectedAttachmentIds:g.array,handleToggleSelect:g.func},componentDidMount:function(){if(this._updateLayoutController(),this.state.rows>1)return this._loadRemainingAttachments()},componentWillReceiveProps:function(e){if(this._isAllSelected(e))return this.setState({rows:1/0})},componentDidUpdate:function(e,t){if(this._updateLayoutController(),this.state.rows>1)return this._loadRemainingAttachments()},getInitialState:function(){return{rows:this._isAllSelected(this.props)?1/0:1,errored:[],containerWidth:null,expandedAttachments:{}}},getDefaultProps:function(){return{handleToggleSelect:function(){},selectedAttachmentIds:[]}},_isAllSelected:function(e){return t.size(e.selectedAttachmentIds)===e.attachments.length},_updateLayoutController:function(){var t,n,r,o;if(t=e(i.findDOMNode(this.refs.attachmentsList)),n=t.innerWidth(),n!==this.state.containerWidth)return r=Math.abs(parseFloat(t.css("margin-left")))||0,o=Math.floor(n/2)-r,this._layoutController=u.create(n,o,r),this.setState({containerWidth:n})},_previewAttachment:function(e){var n,i,r,o;return n=t.findWhere(this.props.attachments,{id:e}),o=n.viewingUserId,i=t.pluck(this.props.attachments,"id"),r={totalCount:this.props.attachments.length,cellView:this},_.previewFiles(o,i,{index:this.props.attachments.indexOf(n)},r)},_expandStack:function(e){var n,i,r,o,a,s,c,l,d;for(n=this._dedupeMetadata(),s=t.find(n,function(t){return t.attachment.id===e}),i=t.clone(this.state.expandedAttachments),o=this.props.attachments.indexOf(s.attachment),d=s.stackLength,r=a=c=o,l=o+d;c<=l?a<l:a>l;r=c<=l?++a:--a)i[this.props.attachments[r].id]=e;return this.setState({expandedAttachments:i})},_collapseStack:function(e){var n,i,r,o,a,s,c,l,d,u;for(r=this.state.expandedAttachments[e],n=this._dedupeMetadata(),c=t.find(n,function(e){return e.attachment.id===r}),i=t.clone(this.state.expandedAttachments),a=this.props.attachments.indexOf(c.attachment),u=c.stackLength,o=s=l=a,d=a+u;l<=d?s<d:s>d;o=l<=d?++s:--s)delete i[this.props.attachments[o].id];return this.setState({expandedAttachments:i})},_handleImageToggleSelect:function(e,n){var i;return i=t.findWhere(this.props.attachments,{id:e}),this.props.handleToggleSelect(i,n)},_handleImageLoadError:function(e){var t;return t=this.state.errored.slice(),t.push(e),this.setState({errored:t})},_revealNextGroup:function(){return this.setState({rows:this.state.rows+v})},_loadRemainingAttachments:function(){var e,n;if(n=this.props.attachments[0].viewingUserId,e=this.props.attachments.filter(t.negate(t.property("isLoaded"))).map(t.property("id")),e.length)return _.loadAttachments(n,e)},_renderFileIconView:function(e,t,i){var r;return r=e.attachment,n.createElement(d,{key:"attachment-"+e.id,id:e.id,file:{icon:r.previewInfo.icon,displayName:r.displayName,entityUri:r.entityUri},overlayText:t,handleClick:i,showCheckmark:this.props.attachments.length>1&&!t,handleToggleSelect:this._handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.indexOf(r.id)>-1})},_renderStackedImageView:function(e,t,i){var r;return e.attachment,r=this._propsForImageView(e,i),r.key="attachment-stacked-"+e.id,r.handleClick=this._expandStack,r.handleCornerClick=this._expandStack,r.stackLength=t,n.createElement(c,r)},_renderExpandedImageView:function(e,t,i){var r;return e.attachment,r=this._propsForImageView(e,i),r.showCheckmark=this.props.attachments.length>1,r.handleCornerClick=this._collapseStack,n.createElement(l,r)},_renderImageView:function(e,t,i){var r;return e.attachment,r=this._propsForImageView(e,i),r.key="attachment-expanded-"+e.id,r.overlayText=t,r.showCheckmark=this.props.attachments.length>1&&!t,n.createElement(s,r)},_propsForImageView:function(e,t){var n,i,r;return n=e.attachment,i="video"===(null!=(r=n.previewInfo)?r.preview_type:void 0),{id:e.id,image:{thumbnailUrl:e.scaledThumbnailUrl,entityUri:n.entityUri,displayName:n.displayName,width:e.width,height:e.height},badgeType:i?s.BadgeType.VIDEO:void 0,handleClick:t,handleLoadError:this._handleImageLoadError,handleToggleSelect:this._handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.indexOf(n.id)>-1}},_dedupeMetadata:function(){var e,t,n,i,r,o,a,s,c,l,d,u,h,m,p,_,f,g,v;if(n=[],i={},t={},v={},this.props.duplicateIds)for(p=this.props.attachments,o=d=0,h=p.length;d<h;o=++d)e=p[o],r=this.props.duplicateIds[o],r in i||(i[r]=[],v[e.id]=e),i[r].push(e),t[e.id]=i[r];for(_=this.props.attachments,u=0,m=_.length;u<m;u++)e=_[u],s=e.id in this.state.expandedAttachments,g=null!=(f=t[e.id])?f.length:void 0,c=e.id in v,l=g>1&&c,a=g>1&&!c,a&&!s||n.push({attachment:e,stackLength:g,isParentOfStack:c,isStacked:l,isExpanded:s});return n},_isLoading:function(){return this.state.rows>1&&!t.all(this.props.attachments,t.property("isLoaded"))},_renderAttachmentItems:function(){var e,n,i,r,o,a,c,l,u,h,m,p,_,f,g,v,I,A,R,T,w;return this.state.containerWidth?(i=this._dedupeMetadata(),n=t.pluck(i,"attachment"),A=this._isLoading()?1:this.state.rows,r=this._layoutController.generate(n,A,this.state.errored),e=t.flatten(r),o=this._previewAttachment,w=e.length,T=n.length,I=T-w+1,h=!this._isLoading()&&w<T,function(){var t,n,r;for(r=[],a=t=0,n=e.length;t<n;a=++t)switch(f=e[a],u=a===e.length-1,p=i[a].isStacked,m=i[a].isParentOfStack,l=i[a].isExpanded,R=i[a].stackLength,u&&h&&(o=this._revealNextGroup,g=y("+%(count)s").format({count:I})),_="attachment-item-"+f.attachment.id,v={key:_},f.view){case d:r.push(E.li(v,this._renderFileIconView(f,g,o)));break;case s:c=h&&u,R>1&&!c?m&&l?r.push(E.li(v,this._renderImageView(f,g,o))):p&&!l?r.push(E.li(v,this._renderStackedImageView(f,R,o))):l?r.push(E.li(v,this._renderExpandedImageView(f,g,o))):r.push(void 0):r.push(E.li(v,this._renderImageView(f,g,o)));break;default:f.view?r.push(assert(!1,f.view.displayName+" is not supported by AttachmentListView")):r.push(void 0)}return r}.call(this)):[]},_renderLoadingView:function(){var e;return e=n.createElement(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}),E.div({ref:"loading",className:"attachment-loading"},e)},render:function(){var e,t
;return e=this._renderAttachmentItems(),t=null,this._isLoading()&&(t=this._renderLoadingView()),E.div({className:"recents-item__attachments"},E.ul({ref:"attachmentsList",className:"attachment-list"},e),t)}})});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/recent_activity/react/comment_attachment_view",["external/underscore","external/classnames","external/react","modules/core/user_i18n","modules/clean/em_string","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/viewer_avatar","modules/clean/react/file_path_breadcrumb","modules/clean/react/helpers","modules/clean/comments/comment_dom","modules/clean/recent_activity/recent_activity_view_models","modules/clean/viewer"],function(e,t,n,i,r,o,a,s,c,l,d,u,h){var m,p,_;return p=l.compareStateAndProps,_=n.DOM,m=u.PropTypes,n.createClass({displayName:"CommentAttachmentView",propTypes:{attachment:m.attachment.isRequired,handlePreview:n.PropTypes.func},getDefaultProps:function(){return{handlePreview:e.noop}},shouldComponentUpdate:p,_handleClick:function(){return this.props.handlePreview()},_renderCommentText:function(){var e;return e=d.convertRawCommentTextToReactDom(this.props.attachment.commentRawText,!1),_.div({className:"comment-attachment-item__comment"},_.div({className:"comment-bubble"},e))},_renderAvatar:function(){var e,t,r;return t={dimension:24,defaultAvatar:n.createElement(a,{key:"commenter-"+this.props.attachment.commenterId,dimension:24,shape:"CIRCLE",initials:i.getInitials(this.props.attachment.commenterDisplayName)})},""!==this.props.attachment.commenterPhotoUrl&&(t.photoUrl=this.props.attachment.commenterPhotoUrl),r=this.props.attachment.commenterId,e=indexOf.call(h.get_viewer().get_user_ids(!0),r)>=0?n.createElement(s,t):n.createElement(o,t),_.div({className:"comment-attachment-item__avatar"},e)},render:function(){var e,t;return e=this._renderAvatar(),t=this._renderCommentText(),_.div({className:"comment-attachment-item",onClick:this._handleClick},e,t)}})});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/recent_activity/react/doc_attachment_list_view",["jquery","external/underscore","external/react","external/classnames","modules/core/exception","modules/core/i18n","modules/clean/em_string","modules/clean/components/loading_indicator","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/doc_attachment_view","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models"],function(e,t,n,i,r,o,a,s,c,l,d,u){var h,m,p,_,f,g,assert,v;return assert=r.assert,g=o._,h=l.DocAttachmentView,m=d.MAX_INITIAL_DOC_ATTACHMENTS,f=d.SHOW_MORE_DOC_ATTACHMENT_INCREMENT,v=n.DOM,_=n.PropTypes,p=u.PropTypes,n.createClass({displayName:"DocAttachmentListView",propTypes:{recentItem:p.recentItem,attachments:_.arrayOf(p.attachment),isCollapsed:_.bool,renderingInfo:n.PropTypes.shape({isUnityAvailable:n.PropTypes.boolean,version:n.PropTypes.object,role:n.PropTypes.string})},getInitialState:function(){return{numberOfRows:m}},componentDidMount:function(){if(this.state.numberOfRows>m)return this._loadRemainingAttachments()},componentDidUpdate:function(){if(this.state.numberOfRows>m)return this._loadRemainingAttachments()},componentWillReceiveProps:function(e){var n,i,r,o;if(o=this.props.attachments.slice(0,this.state.numberOfRows).filter(t.property("isLoaded")).map(t.property("id")),r=o.length,i=e.attachments.map(t.property("id")).filter(function(e){return indexOf.call(o,e)>=0}).length,i<r)return n=this.state.numberOfRows+i-r,assert(n>=0,"number of rows removed cannot be greater than the total number of rows"),this.setState({numberOfRows:this.state.numberOfRows+i-r})},_loadRemainingAttachments:function(){var e,n;if(this.props.attachments.length)return n=this.props.attachments[0].viewingUserId,e=this.props.attachments.filter(t.negate(t.property("isLoaded"))).map(t.property("id")),e.length?c.loadAttachments(n,e):void 0},_shouldShowSubheading:function(){return!1},_revealNextGroup:function(e){return e.preventDefault(),this.setState({numberOfRows:this.state.numberOfRows+f})},_renderFileView:function(e){return n.createElement(h,{key:"attachment-"+e.id,attachment:e,recentItem:this.props.recentItem,showSubheading:this._shouldShowSubheading(),renderingInfo:this.props.renderingInfo})},_renderLoadMoreView:function(e){var t;return t=g("Show %(num)s more").format({num:e}),v.button({ref:"loadMore",key:"attachment-load-more",className:"button-as-link",onClick:this._revealNextGroup},t)},_renderLoadingView:function(){var e;return e=n.createElement(s,{style:s.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}),v.li({ref:"loading",key:"attachment-loading",className:"attachment-loading"},e)},_renderFooter:function(e){var t,n;return n=Math.min(e,f),t=v.div({className:"doc-attachment-list__footer--cell"},this._renderLoadMoreView(n)),v.li({key:"attachment-footer",className:"doc-attachment-list__footer"},t)},_renderAttachmentItems:function(){var e,n,i,r;return e=this.props.attachments.slice(0,this.state.numberOfRows),n=e.filter(t.property("isLoaded")).map(this._renderFileView),r=this.props.attachments.length-n.length,i=e.filter(t.negate(t.property("isLoaded"))),i.length>0?n.push(this._renderLoadingView()):r>0&&n.push(this._renderFooter(r)),n},render:function(){var e,t,n;return t=this._renderAttachmentItems(),n=null,this.props.attachments&&0!==this.props.attachments.length&&(n=v.div({className:"doc-attachment-list__spacer"})),e={"recents-item__doc-attachments":!0,"recents-item__doc-attachments--collapsed":this.props.isCollapsed},v.div({className:i(e)},n,v.ul({ref:"attachmentsList",className:"doc-attachment-list"},t))}})}),define("modules/clean/recent_activity/react/doc_attachment_view",["require","exports","tslib","external/classnames","external/react","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/recent_activity/actions/recent_activity_action_permissions","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_activity_item_actions_view","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/recent_activity_model","modules/clean/recent_activity/recent_activity_view_helper","modules/core/exception","modules/core/i18n"],function(e,t,n,i,r,o,a,s,c,l,d,u,h,m,p){"use strict";var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.previewOrOpenFiles=function(e){n.getVersion().previewOrOpenRecentItem(n.getRecentItem(),n.getAttachments(),{shouldFocusCommentInput:e},n.getLogData())},n.onBlur=function(e){n.setState({isFocused:!1})},n.onFocus=function(e){n.setState({isFocused:!0})},n.onMouseEnter=function(e){n.setState({isHovered:!0})},n.onMouseLeave=function(e){n.setState({isHovered:!1})},n.onPreview=function(e){e.preventDefault(),n.previewOrOpenFiles(!1)},n.handleArchive=function(){},n.handleComment=function(){n.previewOrOpenFiles(!0)},n.handleDelete=function(){n.getVersion().deleteRecentItem(n.getRecentItem(),n.getAttachments(),n.getLogData())},n.handleDeselectAll=function(){},n.handleDownload=function(){c.downloadFiles(n.getViewingUserId(),[n.getAttachmentId()],n.getLogData())},n.handleSelectAll=function(){},n.handleOpen=function(){m.assert(!!n.getAttachment().canOpen,"This item does not support opening"),c.openFile(n.getViewingUserId(),n.getAttachmentId(),n.getLogData())},n.handleShare=function(){n.getVersion().shareRecentItem(n.getRecentItem(),n.getAttachments(),n.getLogData())},n.handleVersions=function(){c.openVersions(n.getViewingUserId(),n.getAttachmentId(),n.getLogData())},n.onShowTooltip=function(){n.setState({tooltipShown:!0})},n.onHideTooltip=function(){n.setState({tooltipShown:!1})},n.state={tooltipShown:!1,isHovered:!1,isFocused:!1},n}return n.__extends(t,e),t.prototype.getVersion=function(){return this.props.renderingInfo.version},t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getAttachment=function(){return this.props.attachment},t.prototype.getAttachments=function(){return[this.props.attachment]},t.prototype.getAttachmentId=function(){return this.props.attachment.id},t.prototype.getViewingUserId=function(){return this.props.attachment.viewingUserId},t.prototype.getLogData=function(){return{totalCount:this.getRecentItem().attachmentIds.length,cellView:this}},t.prototype.isSharedLink=function(){return u.isShareLinkRecentItem(this.getRecentItem())},t.prototype.getIcon=function(){var e=this.getAttachment().previewInfo;return e&&e.icon||"page_white_text"},t.prototype.getHeaderProps=function(){var e=this.getAttachment(),t={heading:e.displayName&&o.em_snippet(e.displayName,35)||"",icon:this.getIcon(),thumbnailUrl:e.thumbnailUrl,star:this.getVersion().renderStar(this.props.renderingInfo.role,this.getRecentItem(),this.getAttachment())};return this.props.showSubHeading&&(t.subheading=this.renderSubheading()),t},t.prototype.renderSubheading=function(){return this.getRecentItem().paths.length?r.createElement(a,{handlePathClick:this.props.handlePathClick,paths:this.getRecentItem().paths,viewingUserId:this.getViewingUserId()}):null},t.prototype.renderShareButton=function(){return r.createElement("a",{ref:"shareLink",className:"recents-item__share-link button-secondary",href:"#share",onClick:this.handleShare},p._("Share"))},t.prototype.renderActions=function(){return r.createElement(l.RecentActivityItemActionsView,{ref:"recentsItemActionsView",permissions:s.getDocAttachmentViewPermissions(this.getRecentItem(),this.getAttachment()),handler:this,tooltipHandler:this,selectCount:0,attachmentCount:1,disableActions:!1,type:this.getRecentItem().type,rowIsHovered:this.state.isHovered,renderingInfo:this.props.renderingInfo})},t.prototype.renderHeading=function(){return r.createElement(d.RecentActivityItemHeaderView,{ref:"recentsItemHeader",header:this.getHeaderProps(),tooltipShown:this.state.tooltipShown,handleClick:this.onPreview},this.isSharedLink()?null:r.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this.renderShareButton()),this.renderActions())},t.prototype.render=function(){return r.createElement("li",{className:i((e={},e["doc-attachment-item"]=!0,e["doc-attachment-item--focused-in"]=this.state.isFocused,e)),onClick:h.ensureUserIntentToClick(this.onPreview),onBlur:this.onBlur,onFocus:this.onFocus,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.renderHeading());var e},t})(r.PureComponent);_.defaultProps={showSubheading:!1},t.DocAttachmentView=_});var slice=[].slice;define("modules/clean/recent_activity/react/pending_attachment_list_view",["external/underscore","external/classnames","external/react"],function(e,t,n){var i,r;return r=n.DOM,i=4,n.createClass({displayName:"PendingAttachmentListView",propTypes:function(){return{count:n.PropTypes.number.isRequired}},render:function(){var n,o;return o=e.times(Math.min(this.props.count,i),function(){return r.li({className:"attachment-item attachment-item--placeholder"})}),n={"attachment-list":!0,"attachment-list--is-pending":!0,"attachment-list--standalone":1===this.props.count},r.div({className:"recents-item__attachments"},r.ul.apply(r,[{ref:"attachmentsList",className:t(n)}].concat(slice.call(o))))}})}),define("modules/clean/recent_activity/react/recent_activity_blank_slate_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/react/button","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/react/recent_activity_onboarding_modal"],function(e,t,n,i,r,o,a,s){var c,l,d,u,h,m,p,_,f,g,v;return f=i._,g=r.button,h=o.Modal,p=a.RECENT_EVENT_FILTER_TYPE,v=n.DOM,c=p.ALL,m=p.PHOTOS,_=p.VIDEOS,d=p.DOCUMENTS,l=p.COMMENTS,u=p.JUNK,n.createClass({displayName:"RecentActivityBlankSlateView",propTypes:{filter:n.PropTypes.oneOf(e.values(p)).isRequired},_heading:function(){switch(this.props.filter){case c:return f("Pick up where you left off");case m:return f("You don’t have any recent images");case _:return f("You don’t have any recent videos");case d:return f("You don’t have any recent documents");case l:return f("You don’t have any recent comments");case u:return f("You don’t have any other recent files");default:return f("You don’t have any files matching this filter")}},_subheadingMarkup:function(){var e;return e=function(){switch(this.props.filter){case c:return f("Find what you need fast with Recents, a list of files you’ve worked on lately.");case m:return f("When you add or edit an image, you’ll see it here.");case _:return f("When you add or edit a video, you’ll see it here.");case d:return f("When you add or edit an Office document or PDF, you’ll see it here.");case l:return f("When someone comments on one of your documents, you’ll see it here.");case u:return f("You’ll only see unimportant files here, like files created automatically by programs.")}}.call(this),{__html:e}},_filterName:function(){switch(this.props.filter){case c:return"all";case m:return"photos";case _:return"videos";case d:return"documents";case l:return"comments";case u:return"junk"}},render:function(){var e,i,r,o,a;return r=v.h1({ref:"heading",className:"recents-blankslate__heading recents-blankslate--show-image"},this._heading()),a=v.p({ref:"subheading",className:"recents-blankslate__subheading",dangerouslySetInnerHTML:this._subheadingMarkup()}),o=n.createElement(s),e=n.createElement(g,{ref:"button",className:"recents-blankslate__button",onClick:function(){return h.showInstance(o)}},f("Learn about recents")),i=["recents-blankslate","recents-blankslate--"+this._filterName()],v.div({className:t.apply(null,i),ref:"blankslate"},r,a,e)}})}),define("modules/clean/recent_activity/react/recent_activity_container",["require","exports","tslib","jquery","external/underscore","external/react","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/react_logger","modules/clean/page_role_observer","modules/clean/web_timing_logger","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_maestro_action_sidebar","modules/clean/recent_activity/react/recent_activity_view","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/versions/recent_activity_version_1","modules/clean/viewer","modules/core/i18n"],function(e,t,n,i,r,o,a,s,c,l,d,u,h,m,p,_,f,g){"use strict";function v(e){var t=0,n=function(){var n=i(window).scrollTop()/(document.documentElement.scrollHeight-window.innerHeight);n>.8&&n>t&&e(),t=n};window.addEventListener("scroll",r.throttle(n,150,{trailing:!1}),!1)}function y(e){"function"==typeof e&&e()}var E=(function(t){function i(e){var n=t.call(this,i.displayName,e)||this;return n.onShouldLoadMore=function(){var e=n.getCurrentUser();e&&!n.state.isPending&&n.getVersion().shouldLoadMore(e.id,n.state.filter)&&u.loadNextPage(e.id)&&n.setState({isPending:!0})},n.onUpdateFromStore=function(){var e=n.getRecentItems(),t=n.getVersion().isStoreReadyForUserId(n.getCurrentUserId(),n.hasRecentItems());n.setState({isPending:!t,items:e})},n.onRoleUpdate=function(e){if(e!==n.state.role){var t=n.getRecentItems(e);n.getVersion().loadPage(n.getUserId(e)),n.setState({role:e,items:t,filter:p.RECENT_EVENT_FILTER_TYPE.ALL,isPending:0===t.length,renderingInfo:n.createRenderingInfo(e,null)})}},n.removeStoreListeners=null,n.logTimeToInteractive=null,n._timer=0,n.state={items:[],role:n.props.initialRole,filter:p.RECENT_EVENT_FILTER_TYPE.ALL,isPending:!1,renderingInfo:n.createRenderingInfo(n.props.initialRole,!1)},n}return n.__extends(i,t),i.prototype.componentWillMount=function(){t.prototype.componentWillMount.call(this),this.removeStoreListeners=this.getVersion().getRemoveStoreListeners(this.onUpdateFromStore),this.getVersion().isInHome()&&this.getVersion().loadPreFetchedPage(this.getCurrentUserId());var e=this.getRecentItems();this.didReceiveRecentActivities()?this.setState({isPending:!1,items:e}):this.setState({isPending:0===e.length,items:e}),l.addListener(this.onRoleUpdate),this.logTimeToInteractive=this.getVersion().maybeInitLoggingAndGetTTILogger()},i.prototype.hasRecentItems=function(){return this.state.items.length>0},i.prototype.componentDidMount=function(){var n=this;t.prototype.componentDidMount.call(this),v(r.throttle(this.onShouldLoadMore,2e3,{trailing:!1})),d.waitForTTI().then(function(){e(["modules/clean/react/file_viewer/controller","modules/clean/sharing/share_modal_util","modules/clean/sharing/wizard/wizard_modals","modules/clean/unity/features"],function(e,t,i,r){null!=r&&n.setState({renderingInfo:n.createRenderingInfo(null,!0)})})}),!this.hasRecentItems()&&this.didReceiveRecentActivities()&&(y(this.logTimeToInteractive),this.setState({isPending:!1}))},i.prototype.clearLoadNewItemsTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)},i.prototype.didReceiveRecentActivities=function(){return this.getVersion().didReceiveRecentActivities()},i.prototype.componentDidUpdate=function(){this.hasRecentItems()&&y(this.logTimeToInteractive)},i.prototype.componentWillUnmount=function(){this.clearLoadNewItemsTimer(),y(this.removeStoreListeners),l.removeListener(this.onRoleUpdate)},i.prototype.createRenderingInfo=function(e,t){return{isUnityAvailable:null===t?this.state.renderingInfo.isUnityAvailable:t,version:this.getVersion(),role:null===e?this.state.role:e}},i.prototype.getRecentItems=function(e){var t=this.getUserId(e||this.state.role);return this.getVersion().getRecentItems(t,this.state.filter)},i.prototype.getCurrentUser=function(){return f.get_viewer().get_user_by_role(this.state.role)},i.prototype.getUserId=function(e){return f.get_viewer().get_user_by_role(e).id},i.prototype.getCurrentUserId=function(){return this.getCurrentUser().id},i.prototype.getVersion=function(){return this.props.version},i.prototype.renderBody=function(){return o.createElement(m.RecentActivityView,{items:this.state.items,filter:this.state.filter,isPending:this.state.isPending,showNewFeatureMessage:this.props.showNewFeatureMessage,userId:this.getCurrentUserId(),localDatetime:this.props.localDatetime,renderingInfo:this.state.renderingInfo})},i.prototype.renderSidebarContent=function(){return o.createElement(h.MaestroRecentActionSidebar,{activeUser:this.getCurrentUser()})},i.prototype.renderTitle=function(){return o.createElement(a.MaestroHeaderTitle,null,g._("Recents"))},i.prototype.renderMaestro=function(){return o.createElement(s.MaestroChrome,{user:this.props.user,viewer:this.props.viewer,titleRegion:this.renderTitle(),embeddedAppRegion:this.renderBody(),actionSidebarRegion:this.renderSidebarContent()})},i.prototype.render=function(){return this.getVersion().isInHome()?this.renderBody():this.renderMaestro()},i})(c.ReactPureLogger);E.displayName="RecentActivityContainer",E.defaultProps={initialRole:"personal",showNewFeatureMessage:!1,version:_.RecentActivityVersion1},t.RecentActivityContainer=E}),define("modules/clean/recent_activity/react/recent_activity_item_actions_view",["require","exports","tslib","external/classnames","external/mcl/popover","external/mcl/overflow_button","external/react","modules/core/i18n","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/recent_activity/versions/recent_activity_version_1","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/recent_activity_model"],function(e,t,n,i,r,o,a,s,c,l,d,u,h,m){"use strict";var p=function(){return null},_=s._("Open"),f=s._("Comment"),g=s._("Archive"),v=s._("Version history"),y=s._("Select all"),E=s._("Deselect all"),I=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onOpen=function(e){e.preventDefault(),t.getHandler().handleOpen()},t.onDelete=function(e){e.preventDefault(),t.getHandler().handleDelete()},t.onArchive=function(e){e.preventDefault(),t.getHandler().handleArchive()},t.onSelectAll=function(e){e.preventDefault(),t.getHandler().handleSelectAll()},t.onDeselectAll=function(e){e.preventDefault(),t.getHandler().handleDeselectAll()},t.onDownload=function(e){e.preventDefault(),t.getHandler().handleDownload()},t.onComment=function(e){e.preventDefault(),t.getHandler().handleComment()},t.onVersions=function(e){e.preventDefault(),t.getPermissions().versions&&t.getHandler().handleVersions()},t}return n.__extends(t,e),t.prototype.getPermissions=function(){return this.props.permissions},t.prototype.getHandler=function(){return this.props.handler},t.prototype.canOpen=function(){return this.getPermissions().open&&this.props.renderingInfo.isUnityAvailable},t.prototype.canSelect=function(){var e=this.props;return e.attachmentCount>1&&e.selectCount>0&&e.selectCount<e.attachmentCount},t.prototype.canDeselect=function(){return this.props.attachmentCount>1&&this.props.selectCount>0},t.prototype.addOptionUi=function(e,t,n,i,r){e.push(a.createElement(c.BubbleMenuItem,{className:"recents-actions-list__item recents-actions-list__item--"+t,key:t,onClick:r},a.createElement(d,{group:"web",name:i,text:n,alt:""})))},t.prototype.getDeleteLabel=function(){var e=this.props.selectCount;return e>1?s._("Delete (%(count)s)…").format({count:e}):0===e&&this.props.attachmentCount>1?s._("Delete all…"):s._("Delete…")},t.prototype.getDownloadLabel=function(){var e=this.props.selectCount;return e>1?s._("Download (%(count)s)").format({count:e}):s._("Download")},t.prototype.renderMoreActionsList=function(){var e=this.getPermissions(),t=[];return this.canOpen()&&this.addOptionUi(t,"open",_,"open",this.onOpen),e.download&&this.addOptionUi(t,"download",this.getDownloadLabel(),"download",this.onDownload),e.comment&&this.addOptionUi(t,"comment",f,"s_file_comment",this.onComment),e.delete&&this.addOptionUi(t,"delete",this.getDeleteLabel(),"delete_16",this.onDelete),e.archive&&this.addOptionUi(t,"archive",g,"delete_16",this.onArchive),e.versions&&this.addOptionUi(t,"versions",v,"previous_versions",this.onVersions),this.canSelect()&&this.addOptionUi(t,"select",y,"select",this.onSelectAll),this.canDeselect()&&this.addOptionUi(t,"deselect",E,"deselect",this.onDeselectAll),t},t.prototype.renderMoreActionsInnerButton=function(){var e=i({"recents-item__actions-button":!0,"button-secondary":!0,disabled:this.props.disableActions});return a.createElement(o.OverflowButton,{className:e,tabIndex:0})},t.prototype.renderMoreActionsButton=function(){if(this.props.disableActions)return this.renderMoreActionsInnerButton();var e=this.props.tooltipHandler;return a.createElement(c.BubbleMenu,{targetButton:this.renderMoreActionsInnerButton(),arrow_position:"top",bubbleDropdownShown:e.onShowTooltip,bubbleDropdownHidden:e.onHideTooltip,items:this.renderMoreActionsList(),position:c.BubbleMenu.POSITIONS.BOTTOM,ref:"moreActionDropdown"})},t.prototype.renderPopoverItem=function(e,t,i,o){if(e){var s={onClick:o};return a.createElement(r.PopoverContentItem,n.__assign({className:"recents-item-action-"+i},s),t)}return null},t.prototype.renderPopoverTrigger=function(){var e={tag:"span"};return a.createElement(r.PopoverTrigger,{"aria-label":s._("More actions"),disabled:this.props.disableActions},a.createElement(o.OverflowButton,n.__assign({variant:this.props.rowIsHovered?"secondary":"borderless",disabled:this.props.disableActions},e)))},t.prototype.renderPopoverContent=function(){var e=this.getPermissions();return a.createElement(r.PopoverContent,{className:"recents-overflow-menu-content",attachment:"right"},this.renderPopoverItem(this.canOpen(),_,"open",this.onOpen),this.renderPopoverItem(e.download,this.getDownloadLabel(),"download",this.onDownload),this.renderPopoverItem(e.comment,f,"comment",this.onComment),this.renderPopoverItem(e.delete,this.getDeleteLabel(),"delete",this.onDelete),this.renderPopoverItem(e.archive,g,"archive",this.onArchive),this.renderPopoverItem(e.versions,v,"versions",this.onVersions),this.renderPopoverItem(this.canSelect(),y,"select",this.onSelectAll),this.renderPopoverItem(this.canDeselect(),E,"deselect",this.onDeselectAll))},t.prototype.renderMoreActionsMenu=function(){return a.createElement(r.Popover,{onSelection:p},this.renderPopoverTrigger(),this.renderPopoverContent())},t.prototype.renderActionsPlaceholder=function(){return a.createElement(l,{className:"recents-item__more-actions-placeholder",group:"web",name:"overflow-glyph",alt:"…"})},t.prototype.render=function(){if(this.props.renderingInfo.version.shouldRenderItemActions(this.props.permissions)){var e=i((t={},t["recents-item__more-actions"]=!0,t["recents-item__more-actions--disabled"]=this.props.disableActions,t));return m.isShareLinkEventType(this.props.type)?a.createElement("div",{className:e}):a.createElement("div",{className:e},this.props.renderingInfo.version.isInHome()?this.renderActionsPlaceholder():null,a.createElement("div",{className:"recents-item__more-actions-button recents-item__action-button",tabIndex:-1},this.props.renderingInfo.version.isInHome()?this.renderMoreActionsButton():this.renderMoreActionsMenu()))}return null;var t},t})(a.PureComponent);I.defaultProps={handler:h.getStubRecentActivityItemContainerHandler(),tooltipHandler:h.getStubRecentActivityTooltipHandler(),selectCount:0,attachmentCount:1,disableActions:!1,renderingInfo:{isUnityAvailable:!1,version:u.RecentActivityVersion1,role:"personal"}},t.RecentActivityItemActionsView=I}),define("modules/clean/recent_activity/react/recent_activity_item_container",["require","exports","tslib","external/underscore","external/react","modules/core/exception","modules/clean/react/home/home_access/recents/actions","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_activity_item_view","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_model","modules/clean/recent_activity/versions/recent_activity_version_1","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/selection_store"],function(e,t,n,i,r,o,a,s,c,l,d,u,h,m){"use strict";var p=(function(e){function t(t){var n=e.call(this,t)||this;return n.onSelectionStoreChange=function(){n.setState({selectedAttachmentIds:m.selectionStore.getByRecentItemId(n.getRecentItemId())})},n.onAttachmentStoreChange=function(){n.setState({attachments:n.getAttachmentsFromStore()})},n.handleArchive=function(){n.getVersion().archiveRecentItem(n.getRecentItem(),n.getLogData()),n.clearSelection()},n.handleComment=function(){var e=n.getSingleAttachment("handleComment only supports a single attachment"),t=Math.max(0,n.getStateAttachments().indexOf(e));n.previewOrOpenFiles({index:t,shouldFocusCommentInput:!0})},n.handleDelete=function(){n.getVersion().deleteRecentItem(n.getRecentItem(),n.getSelectedAttachments(),n.getLogData()),n.clearSelection()},n.handleDeselectAll=function(){s.deselectAttachments(n.getRecentItemId(),n.getSelectedAttachmentIds())},n.handleDownload=function(){var e=n.getSingleAttachment("handleDownload only supports a single attachment");s.downloadFiles(n.getViewingUserId(),[e.id],n.getLogData())},n.handleHeaderClick=function(){if(n.isSubset()){var e=n.state.isCollapsed?"uncollapse":"collapse";a.HomeRecentsActions.logEvent(e,n,n.getStateAttachmentFqPaths(),n.getStateAttachments().length)}n.setState({isCollapsed:!n.state.isCollapsed})},n.handleOpen=function(){var e=n.getSingleAttachment("handleOpen only supports a single attachment");s.openFile(n.getViewingUserId(),e.id,n.getLogData())},n.handlePathClick=function(e){var t=n.getStateAttachmentFqPaths();l.logOpenPathUrl(n.getViewingUserId(),t,n.props.recentItem.attachmentIds.length,n),n.getVersion().handlePathClick(e,n.getRecentItem(),n.getLogData())},n.handlePreview=function(){n.previewOrOpenFiles({shouldFocusCommentInput:!1})},n.handleSelectAll=function(){var e=d.extractAttachmentIds(n.getStateAttachments());s.selectAttachments(n.getRecentItemId(),e)},n.handleShare=function(){n.getVersion().shareRecentItem(n.getRecentItem(),n.getSelectedAttachments(),n.getLogData())},n.handleToggleSelect=function(e,t){t?s.selectAttachments(n.getRecentItemId(),[e.id]):s.deselectAttachments(n.getRecentItemId(),[e.id])},n.handleVersions=function(){var e=n.getSingleAttachment("handleVersions only supports a single attachment");s.openVersions(n.getViewingUserId(),e.id,n.getLogData())},n.removeStoreListeners=null,n.state={attachments:[],selectedAttachmentIds:[],isCollapsed:!0},n}return n.__extends(t,e),t.prototype.getStateAttachments=function(){return this.state.attachments},t.prototype.getSelectedAttachmentIds=function(){return this.state.selectedAttachmentIds},t.prototype.getVersion=function(){return this.props.renderingInfo.version},t.prototype.isSubset=function(){return i.uniq(i.values(this.getRecentItem().filterTypesByKey)).length>1},t.prototype.getViewingUserId=function(){return this.props.recentItem.viewingUserId},t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getRecentItemId=function(){return this.props.recentItem.id},t.prototype.getLogData=function(){return{totalCount:this.props.recentItem.attachmentIds.length,cellView:this}},t.prototype.getStateAttachmentFqPaths=function(){return this.getStateAttachments().map(function(e){return e.fqPath}).filter(Boolean)},t.prototype.getAttachmentsFromStore=function(){return h.attachmentStore.getByIds(this.getRecentItem().attachmentIds)},t.prototype.getSelectedAttachments=function(){var e=this.getSelectedAttachmentIds();return e.length?this.getStateAttachments().filter(function(t){return e.indexOf(t.id)>=0}):this.getStateAttachments()},t.prototype.getSingleAttachment=function(e){var t=this.getSelectedAttachments();return o.assert(1===t.length,e),t[0]},t.prototype.previewOrOpenFiles=function(e){e.shouldBrowse=d.isShareLinkRecentItem(this.props.recentItem);var t=e.shouldBrowse?[this.getSingleAttachment("previewOrOpenFiles only supports a single shared link")]:this.getStateAttachments();this.getVersion().previewOrOpenRecentItem(this.getRecentItem(),t,e,this.getLogData())},t.prototype.clearSelection=function(){s.deselectAttachments(this.getRecentItemId(),this.getSelectedAttachmentIds())},t.prototype.componentWillMount=function(){var e=m.selectionStore.addListener(this.onSelectionStoreChange),t=h.attachmentStore.addListener(this.onAttachmentStoreChange);this.removeStoreListeners=function(){e(),t()},this.setState({attachments:this.getAttachmentsFromStore(),selectedAttachmentIds:m.selectionStore.getByRecentItemId(this.getRecentItemId())})},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.render=function(){return r.createElement(c.RecentActivityItemView,{recentItem:this.getRecentItem(),attachments:this.getStateAttachments(),handler:this,isCollapsed:this.state.isCollapsed,selectedAttachmentIds:this.getSelectedAttachmentIds(),renderingInfo:this.props.renderingInfo})},t})(r.PureComponent);p.defaultProps={renderInfo:{isUnityAvailable:!1,version:u.RecentActivityVersion1}},t.RecentActivityItemContainer=p}),define("modules/clean/recent_activity/react/recent_activity_item_header_view",["require","exports","tslib","external/classnames","external/react","modules/clean/accessibility/utils","modules/clean/react/helpers","modules/clean/react/file_icon_view","modules/clean/recent_activity/recent_activity_model","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/user_education/user_education_client"],function(e,t,n,i,r,o,a,s,c,l,d){"use strict";var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.stopPropagation(),e.preventDefault(),t.props.handleClick(e)},t.shouldComponentUpdate=a.compareStateAndProps,t}return n.__extends(t,e),t.prototype.getHeaderProps=function(){return this.props.header},
t.prototype.renderIcon=function(){var e=this.getHeaderProps();return r.createElement("div",{className:"recents-item__icon"},r.createElement(s,{icon:e.icon,className:"recents-item__img",src:e.thumbnailUrl}))},t.prototype.renderHeading=function(){return r.createElement("a",n.__assign({ref:"heading",className:"recents-item__heading"},o.accessibleTriggerProps(this.props.handleClick)),this.getHeaderProps().heading)},t.prototype.renderSubheading=function(){var e=this.getHeaderProps().subheading;return e?r.createElement("div",{ref:"subheading",className:"recents-item__subheading"},e):null},t.prototype.renderDetails=function(){return r.createElement("div",{ref:"recentsItemDetails",className:"recents-item__details"},this.renderHeading(),this.renderStar(),this.renderSubheading())},t.prototype.renderStar=function(){var e=this.getHeaderProps().star,t=i((n={},n.item__star=!0,n["item__star--onboarding"]=this.props.onboardingItem,n));return e?r.createElement("div",{className:t},r.createElement(d.UserEducationEffect,{containerName:"RecentActivityItemHeaderView",name:"recent-item-star-"+this.props.onboardingItem},e)):null;var n},t.prototype.renderActions=function(){if(this.props.recentActivityType&&c.isShareLinkEventType(this.props.recentActivityType)||0===r.Children.count(this.props.children))return null;var e=i((t={},t["recents-item__actions-inner"]=!0,t["recents-item__actions-inner--tooltip-shown"]=this.props.tooltipShown,t));return r.createElement("div",{ref:"actions",className:"recents-item__actions"},r.createElement("div",{className:e},this.props.children));var t},t.prototype.renderOnboardingSpotlight=function(){return this.props.onboardingItem?r.createElement(d.UserEducationEffect,{containerName:"RecentActivityItemHeaderView",name:"recent-item-spotlight"}):null},t.prototype.render=function(){return r.createElement("div",{className:"recents-item__wrapper",onClick:l.ensureUserIntentToClick(this.onClick)},this.renderIcon(),this.renderOnboardingSpotlight(),this.renderDetails(),this.renderActions())},t})(r.PureComponent);u.defaultProps={handleClick:function(e){return null},tooltipShown:!1},t.RecentActivityItemHeaderView=u}),define("modules/clean/recent_activity/react/recent_activity_item_view",["require","exports","tslib","external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/react/helpers","modules/clean/recent_activity/actions/recent_activity_action_permissions","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_model","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/recent_activity/recent_activity_text_helper","modules/clean/recent_activity/react/attachment_list_view","modules/clean/recent_activity/react/comment_attachment_view","modules/clean/recent_activity/react/pending_attachment_list_view","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/react/recent_activity_item_actions_view","modules/clean/recent_activity/react/doc_attachment_list_view","modules/clean/recent_activity/versions/recent_activity_version_1"],function(e,t,n,i,r,o,a,s,c,l,d,u,h,m,p,_,f,g,v,y,E,I,A,R){"use strict";var T=(function(e){function t(t){var n=e.call(this,t)||this;return n.onDisabled=function(e){e.preventDefault()},n.ensureEnabled=function(e){return n.shouldDisableActions()?n.onDisabled:e},n.handleBlur=function(){n.setState({isFocused:!1})},n.handleFocus=function(){n.setState({isFocused:!0})},n.handleMouseEnter=function(){n.setState({isHovered:!0})},n.handleMouseLeave=function(){n.setState({isHovered:!1})},n.onShare=function(e){e.preventDefault(),n.getHandler().handleShare()},n.onSelectAll=function(e){e.preventDefault(),n.getHandler().handleSelectAll()},n.onShowTooltip=function(){n.setState({tooltipShown:!0})},n.onHideTooltip=function(){n.setState({tooltipShown:!1})},n.shouldComponentUpdate=l.compareStateAndProps,n.state={tooltipShown:!1,isFocused:!1,isHovered:!1},n}return n.__extends(t,e),t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getAttachments=function(){return this.props.attachments},t.prototype.getHandler=function(){return this.props.handler},t.prototype.getSelectedAttachmentIds=function(){return this.props.selectedAttachmentIds},t.prototype.shouldDisableActions=function(){var e=this.getRecentItem().federatedRecentItem;return e?!e.hasMenuActions():!this.hasLoadedAttachments()},t.prototype.isAggregation=function(){return this.props.recentItem.attachmentIds.length>1},t.prototype.shouldShowComment=function(){var e=this.getAttachments()[0];return!(!e||!e.commentRawText)},t.prototype.shouldShowThumbnails=function(){return!m.isShareLinkRecentItem(this.props.recentItem)&&h.shouldShowThumbnails(this.getRecentItem().filterTypesByKey)},t.prototype.getLoadedAttachmentsCount=function(){return this.getAttachments().filter(function(e){return e.isLoaded}).length},t.prototype.canRenderAttachmentView=function(){var e=this.getLoadedAttachmentsCount();return e===this.getRecentItem().attachmentIds.length||e>=u.MAX_INITIAL_THUMBNAIL_ATTACHMENTS},t.prototype.hasLoadedAttachments=function(){return!(!this.getAttachments().length||!this.getLoadedAttachmentsCount())},t.prototype.getHeading=function(){var e=this.getAttachments();if(e.length<2)return s.em_snippet(this.getRecentItem().displayName,30);for(var t=this.getRecentItem(),n=t.attachmentIds.length,r=i.uniq(i.values(t.filterTypesByKey)),o=[],c=0,l=e;c<l.length;c++){var d=l[c];d.isLoaded&&d.displayName&&o.push(d.displayName)}switch(r.length){case 1:switch(r[0]){case u.RECENT_EVENT_FILTER_TYPE.PHOTOS:return a.ungettext("%(count)s image","%(count)s images",n).format({count:n});case u.RECENT_EVENT_FILTER_TYPE.VIDEOS:return a.ungettext("%(count)s video","%(count)s videos",n).format({count:n});case u.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES:return a.ungettext("%(count)s visual note","%(count)s visual notes",n).format({count:n})}break;case 2:if(r.indexOf(u.RECENT_EVENT_FILTER_TYPE.PHOTOS)>=0&&r.indexOf(u.RECENT_EVENT_FILTER_TYPE.VIDEOS)>=0)return a._("%(count)s images and videos").format({count:n})}return o.length?f.snippetList(o,30,{totalCount:n}):a.ungettext("%(count)s file","%(count)s files",n).format({count:n})},t.prototype.getSubheading=function(){var e=this.getRecentItem();return m.isShareLinkRecentItem(this.props.recentItem)?e.type===u.RECENT_EVENT_TYPES.FILE_SHARED_ADD?o.createElement("a",{className:"recents-item__subheading-path",href:"/links/your_links",onClick:this.getHandler().handlePathClick},a._("Your links")):o.createElement("div",{className:"recents-item__subheading"},o.createElement("span",{className:"recents-item__subheading-path"},a._("Recently viewed"))):e.paths.length?o.createElement(c,{handlePathClick:this.getHandler().handlePathClick,paths:e.paths,viewingUserId:e.viewingUserId}):null},t.prototype.getIcon=function(){var e=this.getRecentItem(),t=e.icon+"_32";if(e.attachmentIds.length>1){for(var n=0,i=this.getAttachments();n<i.length;n++){var r=i[n];if(r.previewInfo){t=r.previewInfo.icon;break}}t=t.replace(/_32$/,"_stack_32")}return t},t.prototype.getThumbnailUrl=function(){var e=this.getAttachments();return 1===e.length&&e[0].thumbnailUrl||void 0},t.prototype.renderShareButton=function(){var e=this.props.renderingInfo.version.getShareButtonVisibility(this.getRecentItem(),this.hasLoadedAttachments());if(e!==u.RecentElementVisibilities.HIDDEN){var t=r({disabled:e===u.RecentElementVisibilities.DISABLED,"button-secondary":!0,"recents-item__share-link":!0});return o.createElement("a",{ref:"shareLink",className:t,href:"#share",onClick:e===u.RecentElementVisibilities.SHOWN?this.onShare:this.onDisabled},a._("Share"))}return null},t.prototype.renderSelectAllButton=function(){var e=r((t={disabled:this.shouldDisableActions()},t["button-secondary"]=!0,t["recents-action-button"]=!0,t));return o.createElement("a",{ref:"selectAllButton",className:e,href:"#select-all",onClick:this.ensureEnabled(this.onSelectAll)},a._("Select all"));var t},t.prototype.renderAttachments=function(){return this.shouldShowThumbnails()?this.canRenderAttachmentView()?o.createElement(g,{ref:"attachments",attachments:this.getAttachments(),handleToggleSelect:this.getHandler().handleToggleSelect,selectedAttachmentIds:this.getSelectedAttachmentIds()}):o.createElement(y,{ref:"pendingAttachments",count:this.getRecentItem().attachmentIds.length}):this.isAggregation()?o.createElement(A,{ref:"docAttachments",recentItem:this.getRecentItem(),attachments:this.getAttachments(),isCollapsed:this.props.isCollapsed,renderingInfo:this.props.renderingInfo}):this.shouldShowComment()?o.createElement(v,{ref:"commentAttachment",attachment:this.getAttachments()[0],handlePreview:this.getHandler().handlePreview}):null},t.prototype.renderActions=function(e){return o.createElement(I.RecentActivityItemActionsView,{ref:"recentsItemActionsView",handler:this.getHandler(),tooltipHandler:this,type:this.getRecentItem().type,permissions:e,selectCount:this.getSelectedAttachmentIds().length,attachmentCount:this.getRecentItem().attachmentIds.length,disableActions:this.shouldDisableActions(),rowIsHovered:this.state.isHovered,renderingInfo:this.props.renderingInfo})},t.prototype.renderButton=function(e){return this.shouldShowThumbnails()&&this.getRecentItem().attachmentIds.length>1&&0===this.getSelectedAttachmentIds().length?o.createElement("div",{className:"recents-item__select-all recents-item__action-button"},this.renderSelectAllButton()):e.share?o.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this.renderShareButton()):null},t.prototype.getHeaderProps=function(){return{heading:this.getHeading(),subheading:this.getSubheading(),icon:this.getIcon(),thumbnailUrl:this.getThumbnailUrl(),star:this.props.renderingInfo.version.renderStar(this.props.renderingInfo.role,this.getRecentItem())}},t.prototype.renderHeader=function(){var e=d.getRecentActivityItemViewPermissions(this.getRecentItem(),this.getAttachments(),this.getSelectedAttachmentIds());return o.createElement(E.RecentActivityItemHeaderView,{ref:"header",header:this.getHeaderProps(),handleClick:this.isAggregation()?this.getHandler().handleHeaderClick:this.getHandler().handlePreview,tooltipShown:this.state.tooltipShown,recentActivityType:this.getRecentItem().type,onboardingItem:this.getRecentItem().onboardingItem},this.renderButton(e),this.renderActions(e))},t.prototype.render=function(){var e=r((i={},i["recents-item"]=!0,i["recents-item--focused-in"]=this.state.isFocused,i["recents-item--loaded"]=this.hasLoadedAttachments(),i)),t=this.shouldShowThumbnails()||!this.isAggregation()?_.ensureUserIntentToClick(this.getHandler().handlePreview):void 0,n=this.getRecentItem();return o.createElement("li",{"data-item-id":n.id,"data-item-type":n.type,"data-item-date":n.when,className:e,onClick:t,onBlur:this.handleBlur,onFocus:this.handleFocus,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},this.renderHeader(),this.renderAttachments());var i},t})(o.PureComponent);T.defaultProps={handler:p.getStubRecentActivityItemContainerHandler(),isCollapsed:!0,attachments:[],selectedAttachmentIds:[],renderingInfo:{isUnityAvailable:!1,version:R.RecentActivityVersion1,role:"personal"}},t.RecentActivityItemView=T}),define("modules/clean/recent_activity/react/recent_activity_list_view",["external/classnames","external/react","modules/clean/recent_activity/react/recent_activity_item_container"],function(e,t,n){var i,r;return i=n.RecentActivityItemContainer,r=t.DOM,t.createClass({displayName:"RecentActivityListView",propTypes:function(){return{items:t.PropTypes.array.isRequired,isPending:t.PropTypes.bool,renderingInfo:t.PropTypes.shape({isUnityAvailable:t.PropTypes.boolean,version:t.PropTypes.object,role:t.PropsTypes.string})}},getDefaultProps:function(){return{isPending:!1}},render:function(){var n,o,a;return n=function(){var e,n,r,o;for(r=this.props.items,o=[],e=0,n=r.length;e<n;e++)a=r[e],o.push(t.createElement(i,{key:a.id,recentItem:a,renderingInfo:this.props.renderingInfo}));return o}.call(this),o={"recents-list":!0,"recents-list--is-pending":this.props.isPending&&0===n.length},r.ul({className:e(o)},n)}})}),define("modules/clean/recent_activity/react/recent_activity_onboarding_modal",["external/underscore","external/react","modules/core/i18n","modules/clean/browse_interface","modules/clean/react/modal"],function(e,t,n,i,r){var o,a,s;return a=n._,o=r.Modal,s=t.DOM,t.createClass({displayName:"RecentActivityOnboardingModal",propTypes:{onConfirm:t.PropTypes.func},getDefaultProps:function(){return{onConfirm:function(){}}},render:function(){return t.createElement(o,{className:"recents-onboarding-modal",style:"clean",acceptButtonText:a("Got it"),onAccept:this.props.onConfirm,autoFocusPrimaryInput:!1},s.div({},s.div({className:"recents-onboarding-modal__header"},s.h1({className:"recents-onboarding-modal__header__text"},a("Get started with Recents"))),s.div({className:"recents-onboarding-modal__body"},s.h2({className:"recents-onboarding-modal__subheader"},a("Find important files fast")),s.p({className:"recents-onboarding-modal__p"},a("Files you’re opening often will stay at the top of your Recents list, so you can get back to them when you need them.")),s.h2({className:"recents-onboarding-modal__subheader"},a("Share files you’ve just edited")),s.p({className:"recents-onboarding-modal__p"},a("When you add or edit files, you’ll see them in Recents. That way, you can find and share them right away.")),s.h2({className:"recents-onboarding-modal__subheader"},a("See photos you’ve just taken ")),s.p({className:"recents-onboarding-modal__p"},a("If your photos are saved to Dropbox, you can get to them easily from Recents. You can open or download recent photos right from there.")))))}})}),define("modules/clean/recent_activity/react/recent_activity_sections_view",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/recent_activity/react/recent_activity_list_view","modules/clean/react/sticky/container","modules/clean/react/sticky/sticky"],function(e,t,n,i,r,o,a){var s,c,l,d,u;return l=i._,c=o.StickyContainer,s=a.Sticky,d=n.createElement,u=n.DOM,n.createClass({displayName:"RecentActivitySectionView",propTypes:{items:n.PropTypes.array.isRequired,isPending:n.PropTypes.bool,localDatetime:n.PropTypes.string,renderingInfo:n.PropTypes.shape({isUnityAvailable:n.PropTypes.boolean,version:n.PropTypes.object,role:n.PropTypes.string})},getDefaultProps:function(){return{isPending:!1,localDatetime:Date.now().toString()}},getInitialState:function(){return{promptBannerIsVisible:!1}},componentDidMount:function(){if(document.querySelector(".has-top-notification"))return this.setState({promptBannerIsVisible:!0})},_getTimeBands:function(){var e,t,n,i,r,o,a,s,c,l,d;return t=this.props.localDatetime,n=864e5,d=new Date(t),d.setHours(0,0,0,0),c=d.getTime(),l=c-n,e=new Date(t),0===d.getDay()?e.setDate(d.getDate()-7):e.setDate(d.getDate()-d.getDay()-1),e.setHours(0),s=e.getTime(),o=s-7*n,d.setDate(1),a=d.getTime(),d.setMonth(d.getMonth()-1),i=d.getTime(),d.setMonth(d.getMonth()-3),r=d.getTime(),{today:c,yesterday:l,thisWeek:s,lastWeek:o,thisMonth:a,lastMonth:i,lastThreeMonths:r}},_getSections:function(){var t;return t=this._getTimeBands(),e.groupBy(this.props.items,function(e){return e.when>=t.today?"today":e.when>=t.yesterday?"yesterday":e.when>=t.thisWeek?"thisWeek":e.when>=t.lastWeek?"lastWeek":e.when>=t.thisMonth?"thisMonth":e.when>=t.lastMonth?"lastMonth":e.when>=t.lastThreeMonths?"lastThreeMonths":"beforeLastThreeMonths"})},render:function(){var e,t,n,i,o,a,h,m,p;p=this._getSections(),e=[],i=40,o=96,this.state.promptBannerIsVisible&&(o+=48),t={today:l("Today"),yesterday:l("Yesterday"),thisWeek:l("This week"),lastWeek:l("Last week"),thisMonth:l("This month"),lastMonth:l("Last month"),lastThreeMonths:l("Three months ago"),beforeLastThreeMonths:l("Older")};for(a in p)n=p[a],m=u.h2({className:"recents-section__title"},t[a]),h=d(r,{items:n,isPending:this.props.isPending,renderingInfo:this.props.renderingInfo}),this.props.renderingInfo.version.isInHome()?e.push(u.li({className:"recents-section",key:a},m,h)):e.push(u.li({className:"recents-section",key:a},d(c,{offsetTop:o},d(s,{offsetHeight:i},m),h)));return u.ul({className:"recents-view__sections"},e)}})}),define("modules/clean/recent_activity/react/recent_activity_view",["require","exports","tslib","external/classnames","external/react","modules/clean/components/loading_indicator","modules/clean/react_logger","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/react/recent_activity_sections_view"],function(e,t,n,i,r,o,a,s,c){"use strict";var l=(function(e){function t(n){return e.call(this,t.displayName,n)||this}return n.__extends(t,e),t.prototype.renderLoadingView=function(){return r.createElement("div",{className:"recents-loading-view",key:"loading"},r.createElement(o,{style:o.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.renderSectionView=function(){return r.createElement(c,{key:"sections",items:this.props.items,isPending:this.props.isPending,localDatetime:this.props.localDatetime,renderingInfo:this.props.renderingInfo})},t.prototype.renderPendingContent=function(){return[this.renderLoadingView(),this.renderSectionView()]},t.prototype.renderBlankSlateContent=function(){return[this.props.renderingInfo.version.renderEmptyState(this.props.filter)]},t.prototype.renderLoadedContent=function(){return[this.renderSectionView(),this.props.isPending?this.renderLoadingView():null]},t.prototype.renderContent=function(){return this.props.items.length?this.renderLoadedContent():this.props.isPending?this.renderPendingContent():this.renderBlankSlateContent()},t.prototype.render=function(){var e=i({"recents-view":!0,"recents-view--is-pending":this.props.isPending&&0===this.props.items.length});return r.createElement("div",{className:e},this.renderContent())},t})(a.ReactPureLogger);l.displayName="RecentActivityView",l.defaultProps={filter:s.RECENT_EVENT_FILTER_TYPE.ALL,isPending:!1},t.RecentActivityView=l}),define("modules/clean/recent_activity/react/recent_maestro_action_sidebar",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/file_uploader/file_uploader","modules/clean/web_timing_logger","modules/clean/react/app_actions_view","modules/clean/react_logger","modules/clean/sharing/wizard/async_wizard_modals"],function(e,t,n,i,r,o,a,s,c,l){"use strict";var d=(function(e){function t(t){var n=e.call(this,"MaestroRecentActionSidebar",t)||this;return n.handleUploadFiles=function(){n.props.activeUser.is_cdm_member&&o.FileUploaderController.setPath(n.props.activeUser.cdm_tmf_path),o.FileUploaderController.showModal()},n.handleCreateSharedFolder=function(){l.asyncShowShareAFolderWizardModal(n.props.activeUser)},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){e.prototype.componentDidMount.call(this),o.FileUploaderController.setUser(this.props.activeUser),a.waitForTTI().then(function(){o.FileUploaderController.loadCoreComponent()})},t.prototype.render=function(){return i.createElement("div",{className:"maestro-recent-action-sidebar"},i.createElement(o.FileUploaderController,{loadOnRender:!1,needToSetStoreValues:!0}),i.createElement(s,{primaryMenuItem:{displayName:r._("Upload files"),handleClick:this.handleUploadFiles},secondaryMenuItems:[{displayName:r._("New shared folder"),iconName:"rainbow_16",handleClick:this.handleCreateSharedFolder,mclIconName:"action-new-shared-folder"}]}))},t})(c.ReactLogger);t.MaestroRecentActionSidebar=d}),define("modules/clean/recent_activity/react/selectable_view",["external/classnames","external/react","external/underscore","modules/clean/accessibility/utils","modules/clean/react/helpers","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,r,o,a){var s,c,l,d,u;return l=i.accessibleTriggerProps,d=r.compareStateAndProps,c=a._,u=t.DOM,s=t.PropTypes,t.createClass({displayName:"SelectableView",propTypes:{id:s.string,handleToggleSelect:s.func,isSelected:s.bool},getDefaultProps:function(){return{handleToggleSelect:function(){},isSelected:!1}},shouldComponentUpdate:d,_handletoggleSelected:function(e){return e.preventDefault(),e.stopPropagation(),this.props.handleToggleSelect(this.props.id,!this.props.isSelected)},render:function(){var e,i,r,a;return e=c(this.props.isSelected?"Deselect":"Select"),r=t.createElement(o,{group:"web",name:"white_check",alt:e}),i=u.span({className:"attachment-item__checkmark-inner"},r),a=n.extend(l(this._handletoggleSelected),{className:"attachment-item__checkmark"}),u.a(a,i)}})}),define("modules/clean/recent_activity/recent_activity_client",["require","exports","tslib","jquery","external/underscore","modules/clean/ajax","modules/constants/python","modules/core/exception","external/tracekit"],function(e,t,n,i,r,o,a,s,c){"use strict";function l(e,t){return function(n){"ok"===n.status?t(n.payload):e.reject(new Error("Payload not okay: "+n))}}function d(e){return"    "+e}function u(e){return e.split("\n").map(d).join("\n")}function h(e,t){return function(n,i,r){var o="\n      Failed XHR request for "+t+":\n      Exception: "+(r.stack?r:"")+"\n      Response Status: "+JSON.stringify(n.status)+" "+n.statusText+"\n      Response Headers:\n"+u(n.getAllResponseHeaders()||"[No Headers]")+"\n      Response Body:\n"+u(n.responseText?"[No Body]":"")+"\n      ";if("abort"!==i){var a=[],l=c.computeStackTrace(r);l&&l.stack&&(a=l.stack),s._reportException({msg:o,tags:["recents"],severity:r instanceof Error?s.SEVERITY.CRITICAL:s.SEVERITY.NONCRITICAL,stack:a})}e.reject(new T(o,n))}}function m(e){return function(t,n,i){if("abort"!==n)throw new Error("Failed XHR request for "+e+": "+i)}}function p(e){var t=e.recent_activities;return e.users&&t.forEach(function(t){"number"==typeof t.actor&&(t.actor=e.users[t.actor]),"number"==typeof t.owner&&(t.owner=e.users[t.owner]),"number"==typeof t.viewing_user&&(t.viewing_user=e.users[t.viewing_user])}),t}function _(e,t){var n=i.Deferred();return o.WebRequest({url:"/recents/json",type:"POST",subject_user:e,data:{num_activities:20,cursor:t},dataType:"json",success:l(n,function(e){var t=p(e);n.resolve({recentActivities:t,cursor:e.cursor,encrypted:e.encrypted})}),error:h(n,"/recents/json")}),n.promise()}function f(e,t){var n=i.Deferred();return o.WebRequest({url:"/home_feed/retrieve_paper_recents",type:"POST",subject_user:e,data:{is_initial_fetch:t},dataType:"json",success:l(n,function(e){n.resolve({items:e.items,hasMore:e.has_more})}),error:h(n,"/home_feed/retrieve_paper_recents")}),n.promise()}function g(e,t,n){var a=i.Deferred();return o.SilentBackgroundRequest({url:"/activity/generate/json",type:"POST",subject_user:e,data:{activity_keys:JSON.stringify(r.unique(t)),loading_modes:JSON.stringify([R.PREVIEW_INFO]),encrypted:n},dataType:"json",success:l(a,function(e){a.resolve(e.activities_by_activity_key)}),error:h(a,"/activity/generate/json")}),a.promise()}function v(e,t){o.SilentBackgroundRequest({url:"/recents/logger",type:"POST",subject_user:e,data:t,error:m("/recents/logger")})}function y(e){o.WebRequest({url:"/recents/mark_onboarding_as_seen",type:"POST",subject_user:e,error:m("/recents/mark_onboarding_as_seen")})}function E(e,t){var n=i.Deferred();return o.WebRequest({url:"/recents/check_files_in_root_collection",type:"POST",subject_user:e,data:{files_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){n.resolve({fileInRootCollectionInfo:e.file_in_root_collection_info})}),error:h(n,"/recents/check_files_in_root_collection")}),n.promise()}function I(e,t){var n=i.Deferred();return o.WebRequest({url:"/home_feed/archive_paper_resources",type:"POST",subject_user:e,data:{resources_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){return n.resolve(e)}),error:h(n,"/home_feed/archive_paper_resources")}),n.promise()}function A(e,t){var n=i.Deferred();return o.WebRequest({url:"/recents/create_collection_shared_link",type:"POST",subject_user:e,data:{files_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){n.resolve({link:e.link,tkey:e.tkey,shareableItemCount:e.shareable_item_count})}),error:h(n,"/recents/create_collection_shared_link")}),n.promise()}var R=a.FILE_ACTIVITY_LOADING_MODE,T=(function(e){function t(t,n){var i=e.call(this,t)||this;return i.xhr=n,i}return n.__extends(t,e),t})(Error);t.denormalizeActivities=p,t.fetchRecentActivities=_,t.fetchPaperRecents=f,t.fetchActivitiesByKey=g,t.postLogEvent=v,t.markOnboardingAsSeen=y,t.checkFileInRootCollection=E,t.archivePaperResources=I,t.createCollectionSharedLink=A}),define("modules/clean/recent_activity/recent_activity_constants",["require","exports","modules/constants/python"],function(e,t,n){"use strict";t.RECENT_EVENT_TYPES=n.RECENT_EVENT_TYPES,t.RECENT_EVENT_FILTER_TYPE=n.RECENT_EVENT_FILTER_TYPE,t.RECENT_CREATE_FILTER="createFilter",t.ARCHIVE_PAPER_DOCUMENT_COMMIT="ARCHIVE_PAPER_DOCUMENT_COMMIT",t.ARCHIVE_PAPER_DOCUMENT_PENDING="ARCHIVE_PAPER_DOCUMENT_PENDING",t.ARCHIVE_PAPER_DOCUMENT_ROLLBACK="ARCHIVE_PAPER_DOCUMENT_ROLLBACK",t.DELETE_FILES_COMMIT="DELETE_FILES_COMMIT",t.DELETE_FILES_PENDING="DELETE_FILES_PENDING",t.DELETE_FILES_ROLLBACK="DELETE_FILES_ROLLBACK",t.DESELECT_ATTACHMENTS="DESELECT_ATTACHMENTS",t.RAW_RECENT_ACTIVITY_PARSE_ERROR="RAW_RECENT_ACTIVITY_PARSE_ERROR",t.RAW_RELATED_ACTIVITY_PARSE_ERROR="RAW_RELATED_ACTIVITY_PARSE_ERROR",t.RECEIVE_CAN_OPEN_INFO="RECEIVE_CAN_OPEN_INFO",t.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO="RECEIVE_FILE_IN_ROOT_COLLECTION_INFO",t.RECEIVE_PAPER_RECENT_ITEMS="RECEIVE_PAPER_RECENT_ITEMS",t.RECEIVE_RAW_RECENT_ACTIVITIES="RECEIVE_RAW_RECENT_ACTIVITIES",t.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY="RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY",t.SELECT_ATTACHMENTS="SELECT_ATTACHMENTS",t.ActionTypes={RECEIVE_RAW_RECENT_ACTIVITIES:t.RECEIVE_RAW_RECENT_ACTIVITIES,RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:t.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,RECEIVE_CAN_OPEN_INFO:t.RECEIVE_CAN_OPEN_INFO,RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:t.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO,RECEIVE_PAPER_RECENT_ITEMS:t.RECEIVE_PAPER_RECENT_ITEMS,DELETE_FILES_PENDING:t.DELETE_FILES_PENDING,DELETE_FILES_COMMIT:t.DELETE_FILES_COMMIT,DELETE_FILES_ROLLBACK:t.DELETE_FILES_ROLLBACK,ARCHIVE_PAPER_DOCUMENT_PENDING:t.ARCHIVE_PAPER_DOCUMENT_PENDING,ARCHIVE_PAPER_DOCUMENT_COMMIT:t.ARCHIVE_PAPER_DOCUMENT_COMMIT,ARCHIVE_PAPER_DOCUMENT_ROLLBACK:t.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,SELECT_ATTACHMENTS:t.SELECT_ATTACHMENTS,DESELECT_ATTACHMENTS:t.DESELECT_ATTACHMENTS,RAW_RECENT_ACTIVITY_PARSE_ERROR:t.RAW_RECENT_ACTIVITY_PARSE_ERROR,RAW_RELATED_ACTIVITY_PARSE_ERROR:t.RAW_RELATED_ACTIVITY_PARSE_ERROR},t.TransactionPrefixes={DELETE_FILES:"DELETE_FILES",MOVE_FILES:"MOVE_FILES"},t.MAX_INITIAL_DOC_ATTACHMENTS=3,t.SHOW_MORE_DOC_ATTACHMENT_INCREMENT=10,t.MAX_INITIAL_THUMBNAIL_ATTACHMENTS=8,t.SHOW_MORE_THUMBNAIL_ROW_INCREMENT=4,t.PaperRecentItemTypes={DOCUMENT:"DOCUMENT",FOLDER:"FOLDER",PROJECT:"PROJECT"},t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2=100,t.FederatedOrigins={PAPER:"PAPER"},t.RecentElementVisibilities={SHOWN:"SHOWN",HIDDEN:"HIDDEN",DISABLED:"DISABLED"}}),define("modules/clean/recent_activity/recent_activity_dispatcher",["external/flux"],function(e){return new e.Dispatcher}),define("modules/clean/recent_activity/recent_activity_logger",["require","exports","tslib","external/underscore","modules/clean/recent_activity/recent_activity_client","modules/core/exception"],function(e,t,n,i,r,o){"use strict";function a(e,t,i){if(void 0===i&&(i={}),I){var o=n.__assign({},i,{event_name:t});r.postLogEvent(e,o)}}function s(e,t,n){var r=i.keys(n),a=i.difference(r,t);o.assert(0===a.length,e+" called with unsupported keys: "+a)}function c(){I=!0}function l(){I=!1}function d(){return I}function u(e,t){s("logPageLoaded",f,t),a(e,"client_page_loaded",t)}function h(e,t){s("logRequestFailed",g,t),a(e,"request_failed",t)}function m(e,t){s("logCellAction",v,t),a(e,"cell_action",t)}function p(e,t){s("logTimeToFirstAction",y,t),a(e,"time_to_first_action",t)}function _(e,t){s("logOnboardingAction",E,t),a(e,"onboarding_action",t)}t.ActionScopes={SINGLE:"single",SUBSET:"subset",AGGREGATION:"aggregation"},t.ActionTypes={VIEW_FILE:"view",OPEN:"open",SHARE:"share",SHARE_COLLECTION:"share_collection",DELETE:"delete",HIDE:"hide",UNITY_OPEN:"unity_open",OPEN_DIR:"open_dir",OPEN_PATH:"open_path",REPORT_JUNK:"report_junk",COMMENT:"comment",DOWNLOAD:"download",VERSIONS:"versions",VIEW_SHARED_LINK:"view_shared_link",PAPER_ARCHIVE:"paper_archive",PAPER_OPEN:"paper_open",PAPER_SHARE:"paper_share"},t.FilterViews={EVERYTHING:"everything"};var f=["is_full_page","item_count","contains_aggregation","latency","is_paginated"],g=["failure_type","is_paginated"],v=["in_aggregation","filter_view","action_type","target_activity_type","action_scope","position","file_extension","days_ago"],y=["latency","action_type","action_scope"],E=["action_type"],I=!0;t.enableLogging=c,t.disableLogging=l,t.isLoggingEnabled=d,t.logPageLoaded=u,t.logRequestFailed=h,t.logCellAction=m,t.logTimeToFirstAction=p,t.logOnboardingAction=_}),define("modules/clean/recent_activity/recent_activity_logger_utils",["require","exports","tslib","external/react-dom","external/underscore","jquery","modules/clean/recent_activity/recent_activity_logger","modules/clean/web_timing_logger"],function(e,t,n,i,r,o,a,s){"use strict";function c(e){return Math.floor((Date.now()-e)/864e5)}function l(e,t,n,s,l){var u,h=o(i.findDOMNode(l)),m=h.closest(".recents-item"),p=r.uniq(r.map(n,function(e){return null!=e?e.split(".").pop().toLowerCase():void 0})).filter(Boolean),_=s>1;u=1===s?I.SINGLE:n.length===s?I.AGGREGATION:I.SUBSET;var f={in_aggregation:_,filter_view:y.EVERYTHING,action_type:e,action_scope:u,target_activity_type:m.data("item-type"),position:m.prevAll().length,file_extension:p.join(","),days_ago:c(m.data("item-date"))};a.logCellAction(t,f),d(t,r.pick(f,"action_scope","action_type"))}function d(e,t){if(!A){var i=s.start_time();i&&(A=!0,a.logTimeToFirstAction(e,n.__assign({},t,{latency:Date.now()-i})))}}function u(e){return function(t,n,i,r){l(e,t,n,i,r)}}function h(e){return function(t,n,i,r){return u(e)(t,[n],i,r)}}function m(e){a.logOnboardingAction(e,{action_type:"onboarding_dismissed"})}function p(e){a.logOnboardingAction(e,{action_type:"full_onboarding_opened"})}function _(e){a.logOnboardingAction(e,{action_type:"full_onboarding_dismissed"})}function f(e,t){a.logRequestFailed(e,{failure_type:t.status,is_paginated:!1})}function g(){var e=Date.now(),t=!1;if(!R){var i=s.start_time();i&&(t=!0,e=i,R=!0)}return function(i,r){void 0===r&&(r={});var o=n.__assign({is_full_page:t},r,{latency:Date.now()-e});a.logPageLoaded(i,o)}}function v(){R=A=!1}var y=a.FilterViews,E=a.ActionTypes,I=a.ActionScopes,A=!1,R=!1;t.logShareFile=h(E.SHARE),t.logShareCollection=u(E.SHARE_COLLECTION),t.logPreviewFiles=u(E.VIEW_FILE),t.logDeleteFiles=u(E.DELETE),t.logUnityOpenFile=h(E.UNITY_OPEN),t.logOpenPathUrl=u(E.OPEN_DIR),t.logOpenSharedLinkUrl=u(E.VIEW_SHARED_LINK),t.logCommentFile=h(E.COMMENT),t.logDownloadFile=u(E.DOWNLOAD),t.logOpenVersions=h(E.VERSIONS),t.logOnboardingClosed=m,t.logOnboardingLearnMore=p,t.logOnboardingModalClosed=_,t.logRequestFailed=f,t.startRequestTimer=g,t.reset=v}),define("modules/clean/recent_activity/recent_activity_model",["require","exports","modules/clean/recent_activity/recent_activity_constants"],function(e,t,n){"use strict";function i(e){return e.map(function(e){return e.id})}function r(e){return e in a}function o(e){return r(e.type)}t.extractAttachmentIds=i;var a=(s={},s[n.RECENT_EVENT_TYPES.FILE_SHARED_ADD]=!0,s[n.RECENT_EVENT_TYPES.FILE_SHARED_VIEW]=!0,s);t.isShareLinkEventType=r,t.isShareLinkRecentItem=o;var s}),
define("modules/clean/recent_activity/recent_activity_prefetch",["require","exports","jquery","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/store_utils"],function(e,t,n,i,r){"use strict";function o(e,t){void 0===t&&(t=!1);var n=window;a(e,n.__REGISTER_RECENTS_PRELOAD_HANDLER),t&&s(e,n.__REGISTER_PAPER_RECENTS_PRELOAD_HANDLER)}function a(e,t){t?t(function(t){var o=n.Deferred(),a=i.denormalizeActivities(t.payload);o.resolve({recentActivities:a,cursor:t.payload.cursor,encrypted:t.payload.encrypted}),r.handleAndLogFetchRecentActivitiesPromise(o.promise(),e)},function(){return r.loadRecentItems(e)}):r.loadRecentItems(e)}function s(e,t){t?t(function(t){var i=n.Deferred();i.resolve({items:t.payload.items,hasMore:t.payload.has_more}),r.handleFetchPaperRecentsPromise(i.promise(),e,!0)},function(){return r.loadPaperRecentItems(e,!0)}):r.loadPaperRecentItems(e,!0)}t.preloadRecentItems=o}),define("modules/clean/recent_activity/recent_activity_rendering_models",["require","exports"],function(e,t){"use strict";function n(){return{handleArchive:function(){},handleComment:function(){},handleDelete:function(){},handleDeselectAll:function(){},handleDownload:function(){},handleHeaderClick:function(){},handleOpen:function(){},handlePathClick:function(){},handlePreview:function(){},handleSelectAll:function(){},handleShare:function(){},handleToggleSelect:function(e,t){},handleVersions:function(){}}}function i(){return{onShowTooltip:function(){},onHideTooltip:function(){}}}var r=(function(){function e(){}return e})();t.RecentActivityVersion=r,t.getStubRecentActivityItemContainerHandler=n,t.getStubRecentActivityTooltipHandler=i}),define("modules/clean/recent_activity/recent_activity_text_helper",["require","exports","modules/clean/em_string","modules/core/i18n"],function(e,t,n,i){"use strict";function r(e,t){return i.ungettext("%(name)s and %(num)s other","%(name)s and %(num)s others",t).format({name:e,num:t})}function o(e,t,o){void 0===o&&(o={});var a=Math.max(Math.floor(o.totalCount||0),e.length);if(1===a)return n.em_snippet(e[0],t);var s=e[0],c=a-1,l=r(s,c);if(new n(l).length>t){var d=Math.floor(t-new n(r("",c)).length)-1;l=d<3?i.ungettext("%(num)s other","%(num)s others",a).format({num:a}):r(n.em_snippet(s,d),c)}for(var u="",h=1;h<e.length&&(h+=1,u=e.slice(0,h).join(", "),h<a&&(u=r(u,a-h)),new n(u).length<t);)l=u;return l}t.snippetList=o}),define("modules/clean/recent_activity/recent_activity_view_helper",["require","exports"],function(e,t){"use strict";function n(e){return function(t){if(!window.getSelection().toString()){for(var n=t.target;n&&n.parentNode&&n!==t.currentTarget;){if(["a","button"].includes(n.nodeName.toLowerCase()))return;n=n.parentNode}e.apply(this,arguments)}}}t.ensureUserIntentToClick=n});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/recent_activity/recent_activity_view_models",["external/underscore","external/react","external/immutable","modules/clean/browse_interface","modules/clean/recent_activity/recent_activity_constants","modules/clean/viewer"],function(e,t,n,i,r,o){var a,s,c,l,d,u,h,m,p,_,f,g,v,y;return l=r.RECENT_EVENT_FILTER_TYPE,c=t.PropTypes,a=n.Record({id:null,isLoaded:!1,displayName:null,viewingUserId:null,entityUri:null,previewInfo:null,fqPath:null,nsPath:null,nsId:null,thumbnailUrl:null,thumbnailDimensions:null,canOpen:!1,inRootCollection:!1,isReadOnly:!1,isDir:!1,commentRawText:null,commenterId:null,commenterDisplayName:null,commenterPhotoUrl:null},"AttachmentRecord"),a.PropTypes=c.shape({id:c.string.isRequired,isLoaded:c.bool.isRequired,viewingUserId:c.number.isRequired,displayName:c.string,entityUri:c.string,previewInfo:c.object,fqPath:c.string,nsPath:c.string,nsId:c.number,thumbnailUrl:c.string,thumbnailDimensions:c.object,canOpen:c.bool,inRootCollection:c.bool,isReadOnly:c.bool,isDir:c.bool,commentRawText:c.string,commenterId:c.number,commenterDisplayName:c.string,commenterPhotoUrl:c.string}),d=n.Record({id:null,type:null,icon:null,when:null,viewingUserId:null,displayName:null,accountDisplayName:null,contextDisplayName:null,filterTypesByKey:{},attachmentIds:n.List(),paths:n.List(),order:null},"RecentItemRecord"),d.PropTypes=c.shape({id:c.string.isRequired,type:c.number.isRequired,icon:c.string.isRequired,when:c.number.isRequired,viewingUserId:c.number.isRequired,displayName:c.string.isRequired,accountDisplayName:c.string.isRequired,contextDisplayName:c.string.isRequired,filterTypesByKey:c.object.isRequired,attachmentIds:c.arrayOf(c.string).isRequired,paths:c.arrayOf(c.object).isRequired,order:c.number.isRequired}),s=n.Record({name:null,url:null},"PathRecord"),u=n.Record({width:null,height:null},"SizeRecord"),h=0,m=e.memoize(function(e){return h+=1}),_=function(e){var t,i;return i=e.skeleton_data,t=e.activity_key,new d({id:t,type:e.recent_event_type,icon:i.icon,when:e.when_milli,viewingUserId:e.viewing_user.id,displayName:i.display_name,accountDisplayName:i.account_display_name,contextDisplayName:i.context_display_name,filterTypesByKey:Object.freeze(i.filter_types_by_key),attachmentIds:n.List(e.related_activity_keys),paths:v(i.context_display_path,e.viewing_user.id,{isDir:!0}),order:m(t)})},g=function(e){return new d(e).toJS()},p=function(e){var t,n,i,r,o,s,c,l,d,h;return n=e.preview_jsinfo||null,(null!=n?n.thumbnail_url_tmpl:void 0)&&(d=n.thumbnail_url_tmpl),(null!=n?n.thumbnail_dimensions:void 0)&&(i=n.thumbnail_dimensions,h=i[0],t=i[1],l=new u({height:t,width:h})),new a({id:e.activity_key,isLoaded:!0,viewingUserId:e.viewing_user.id,displayName:e.name,entityUri:e.entity_uri,previewInfo:e.preview_jsinfo,fqPath:e.fq_path,nsPath:e.ns_path,nsId:e.ns_id,thumbnailUrl:d,thumbnailDimensions:l||null,canOpen:!1,inRootCollection:!1,isReadOnly:e.is_read_only,isDir:e.is_dir,commentRawText:(null!=(r=e.comment)?r.raw_comment_text:void 0)||null,commenterId:(null!=(o=e.comment)?o.commenter_dict.id:void 0)||null,commenterDisplayName:(null!=(s=e.comment)?s.commenter_dict.display_name:void 0)||null,commenterPhotoUrl:(null!=(c=e.comment)?c.commenter_dict.photo_circle_url:void 0)||null})},f=function(e){return e.skeleton,e.related_activity_keys.map(function(t){return new a({id:t,viewingUserId:e.viewing_user.id})})},v=function(t,r,a){var c,l,d,u,h,m,p;for(null==a&&(a={}),p=o.get_viewer(),m=p.get_user_by_id(r),"/"===t&&(t=""),h=[],u=t.split("/"),a.isDir!==!0&&u.pop();u.length;)d=e.last(u),l=u.join("/"),1===u.length&&""===d&&(d=o.get_root_name(m),l=""),c=i.browse_uri_for_fq_path(m,l).toString(),h.push(new s({name:d,url:c})),u.pop();return n.List(h.reverse())},y=function(t){var n,i,r,o,a,s;return a=e.uniq(e.values(t)),n=l.PHOTOS,r=l.VIDEOS,o=l.VISUAL_NOTES,i=[n,r,o],s=function(e){return indexOf.call(i,e)>=0},e.all(a,s)&&e.size(t)>1},{createRecentItemJs:g,convertRecentActivityToRecentItem:_,convertFileActivityToAttachmentItem:p,createPartialAttachmentsFromRecentActivity:f,shouldShowThumbnails:y,getPathsByFqPath:v,PropTypes:{recentItem:d.PropTypes,attachment:a.PropTypes}}}),define("modules/clean/recent_activity/store_utils",["require","exports","jquery","external/underscore","modules/core/i18n","modules/clean/recent_activity/stores/attachment_store","modules/clean/web_timing_logger","modules/core/notify","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models"],function(e,t,n,i,r,o,a,s,c,l,d,u,h){"use strict";function m(e,t){return p(d.fetchRecentActivities(e,t),e,t)}function p(e,t,n){var i=l.startRequestTimer(),r=e.then(function(e){return f(t,e)}).then(function(){},_(t));return e.then(function(e){return r.then(function(){var r=!1,o=0;e.recentActivities.forEach(function(e){e.skeleton_data&&(o+=e.skeleton_data.num_related_activities||0,(e.skeleton_data.num_related_activities||0)>1&&(r=!0))}),i(t,{is_paginated:!!n,contains_aggregation:r,item_count:o})})})}function _(e){return function(t){l.logRequestFailed(e,t)}}function f(e,t){return g(e,t.recentActivities,t.cursor,t.encrypted),v(e,t.recentActivities)}function g(e,t,n,i){c.dispatch({type:u.ActionTypes.RECEIVE_RAW_RECENT_ACTIVITIES,rawRecentActivities:t,cursor:n,encrypted:i,userId:e})}function v(e,t){var n=[];return t.forEach(function(e){if(e.skeleton_data&&e.related_activity_keys){var t=h.shouldShowThumbnails(e.skeleton_data.filter_types_by_key)?u.MAX_INITIAL_THUMBNAIL_ATTACHMENTS:u.MAX_INITIAL_DOC_ATTACHMENTS;e.related_activity_keys.slice(0,t).forEach(function(e){return n.push(e)})}}),I(e,n)}function y(e,t){E(d.fetchPaperRecents(e,t),e,t)}function E(e,t,n){e.then(function(e){var i=n&&e.hasMore;c.dispatch({type:u.ActionTypes.RECEIVE_PAPER_RECENT_ITEMS,items:e.items,hasMore:i,userId:t}),i&&a.waitForTTI().then(function(){return y(t,!1)})},_(t))}function I(e,t){var r=o.attachmentStore.groupIdsByEncryptedToken(t),a=i.map(r,function(t,n){return d.fetchActivitiesByKey(e,t,n).then(function(t){return A(e,t)})});return n.when.apply(n,a).then(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={};return e.forEach(function(e){i.map(e,function(e,t){n[t]=e})}),n})}function A(e,t){return c.dispatch({type:u.ActionTypes.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:t,userId:e}),R(t,e),C(t,e),t}function R(e,t){if(e){T(w(e),t).then(function(e){c.dispatch({type:u.ActionTypes.RECEIVE_CAN_OPEN_INFO,canOpenInfo:e})})}}function T(t,r){var o=n.Deferred();return e(["modules/clean/unity/features"],function(e){i.isUndefined(e)||e.check_file_batch(t,r).then(function(e){o.resolve(e)})}),o.promise()}function w(e){return i.values(e).map(function(e){return{ns_id:e.ns_id,ns_path:e.ns_path}})}function C(e,t){if(e){var n=w(e);d.checkFileInRootCollection(t,n).then(function(e){c.dispatch({type:u.ActionTypes.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO,fileInRootCollectionInfo:e.fileInRootCollectionInfo})})}}function S(e,t,n){var a=o.attachmentStore.getByIds(t),c=a.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});c.length?I(e,c).then(function(){return S(e,t,n)},function(){return s.error(r._("There was a problem completing this request."))}):i.defer(function(){return n(a)})}t.loadRecentItems=m,t.handleAndLogFetchRecentActivitiesPromise=p,t.getOnFail=_,t.updateRecentActivities=g,t.loadAttachmentsForRecentActivities=v,t.loadPaperRecentItems=y,t.handleFetchPaperRecentsPromise=E,t.loadAttachments=I,t.ensureAttachments=S}),define("modules/clean/recent_activity/stores/attachment_store",["require","exports","tslib","external/immutable","external/underscore","modules/clean/flux/flux_store","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/transactions","modules/core/exception"],function(e,t,n,i,r,o,a,s,c,l,d,u){"use strict";var h=(function(e){function t(t,n){void 0===n&&(n={});var o=e.call(this,t)||this;o._onDeleteFilesPending=function(e){var t=[];o._transactionHistory[e.transactionId]={deletedAttachments:t},o._updateAttachments(function(n){for(var i=0,r=e.attachmentIds;i<r.length;i++){var o=r[i],a=n.get(o);if(!a)return;t.push(a),n.remove(o)}})},o._onDeleteFilesRollback=function(e){var t=o._transactionHistory[e.transactionId];u.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),o._updateAttachments(function(e){for(var n=0,i=t.deletedAttachments;n<i.length;n++){var r=i[n];e.set(r.get("id"),r)}})};var a=n.attachments||[],s=n.encryptedToken||null,c=r.pluck(a,"id");o._attachments=i.fromJS(r.object(c,a));var l={};return s&&(l=r.object(c.map(function(e){return[e,s]}))),o._encryptedTokens=i.Map(l),o._transactionHistory={},o}return n.__extends(t,e),t.prototype.getById=function(e){return this._attachments.has(e)?this._attachments.get(e).toJS():null},t.prototype.getByIds=function(e){var t=this;return i.List(e).map(function(e){return t._attachments.get(e)}).filterNot(r.isUndefined).toJS()},t.prototype.getByFqPath=function(e){var t=this._attachments.find(function(t){return t.get("fqPath")===e});return t?t.toJS():null},t.prototype.getAll=function(){return this._attachments.toList().toJS()},t.prototype.groupIdsByEncryptedToken=function(e){var t=this,n=r.groupBy(e,function(e){return t._encryptedTokens.get(e)||"__missing__"});return r.omit(n,"__missing__")},t.prototype.__onDispatch=function(e){if(!d.handleTransaction(s.TransactionPrefixes.DELETE_FILES,e,{onPending:this._onDeleteFilesPending.bind(this),onCommit:this._onCommit.bind(this),onRollback:this._onDeleteFilesRollback.bind(this)}))switch(e.type){case s.RECEIVE_RAW_RECENT_ACTIVITIES:this._onReceiveRawRecentActivities(e);break;case s.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this._onReceiveRawRelatedActivitiesByKey(e);break;case s.RECEIVE_CAN_OPEN_INFO:this._onReceiveCanOpenInfo(e);break;case s.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:this._onReceiveFileInRootCollectionInfo(e)}},t.prototype._updateAttachments=function(e){var t=this._attachments;this._attachments=this._attachments.withMutations(e),this._attachments!==t&&this.__emitChange()},t.prototype._onCommit=function(e){delete this._transactionHistory[e.transactionId]},t.prototype._onReceiveRawRecentActivities=function(e){var t=this,n=e.rawRecentActivities.map(l.createPartialAttachmentsFromRecentActivity),i=(r=[]).concat.apply(r,n).filter(function(e){var n=t.getById(e.id);return!n||!n.isLoaded});this._updateAttachments(function(n){var r={};i.forEach(function(t){n.has(t.get("id"))||n.set(t.get("id"),t),r[t.get("id")]=e.encrypted}),t._encryptedTokens=t._encryptedTokens.merge(r)});var r},t.prototype._onReceiveRawRelatedActivitiesByKey=function(e){var t=r.mapObject(e.rawRelatedActivitiesByKey,this._createAttachment,this),n=r.compact(r.values(t));this._updateAttachments(function(e){return n.forEach(function(t){return e.set(t.get("id"),t)})})},t.prototype._onReceiveCanOpenInfo=function(e){this._updateAttachments(function(t){return r.each(e.canOpenInfo,function(e,n){var i=n.split(":"),r=i[0],o=i[1],a=t.find(function(e){return e.get("nsId")===Number(r)&&e.get("nsPath")===o});a&&t.setIn([a.get("id"),"canOpen"],e.is_locally_available)})})},t.prototype._onReceiveFileInRootCollectionInfo=function(e){this._updateAttachments(function(t){return r.each(e.fileInRootCollectionInfo,function(e,n){var i=n.split(":"),r=i[0],o=i[1],a=t.find(function(e){return e.get("nsId")===Number(r)&&e.get("nsPath")===o});a&&t.setIn([a.get("id"),"inRootCollection"],e)})})},t.prototype._createAttachment=function(e,t){try{return l.convertFileActivityToAttachmentItem(e)}catch(e){r.defer(function(){return a.errorActions.relatedActivityParseError(t,e)})}return null},t})(o);t.AttachmentStore=h,t.attachmentStore=new h(c)}),define("modules/clean/recent_activity/stores/recent_activity_store",["require","exports","tslib","external/immutable","external/underscore","modules/clean/flux/flux_store","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/transactions","modules/core/exception"],function(e,t,n,i,r,o,a,s,c,l,d,u,h,m){"use strict";var p=r.values(c.RECENT_EVENT_FILTER_TYPE),_=(function(e){function t(t,n,o){void 0===o&&(o=[]);var a=e.call(this,t)||this;return a._items=i.fromJS(r.object(r.pluck(o,"id"),o)),a._attachmentMap=i.Map(),a._cursors=i.Map(),a._loaded=i.Set(),a._attachmentStore=n,a._didReceiveRecentActivities=!1,a._transactionHistory={},a._regenerateAttachmentMap(),a}return n.__extends(t,e),t.prototype._itemComparator=function(e,t){return e.when===t.when?e.order-t.order:t.when-e.when},t.prototype.getAll=function(){return r.values(this._items.toJS()).sort(this._itemComparator)},t.prototype.didReceiveRecentActivities=function(){return this._didReceiveRecentActivities},t.prototype.cursorForUser=function(e){return this._cursors.get(e,null)},t.prototype.isLoadedForUser=function(e){return this._loaded.contains(e)},t.prototype.getById=function(e){var t=this._items.get(e);return t?t.toJS():null},t.prototype.filterItemsForUser=function(e,t){m.assert(p.includes(t),"filter must be one of "+p);var n=c.RECENT_EVENT_FILTER_TYPE.ALL,i=c.RECENT_EVENT_FILTER_TYPE.JUNK;return this.getAll().filter(function(o){var a=r.values(o.filterTypesByKey),s=t===n&&!a.includes(i);return o.viewingUserId===e&&(s||a.includes(t))})},t.prototype.__onDispatch=function(e){if(!h.handleTransaction(s.TransactionPrefixes.DELETE_FILES,e,{onPending:this._onDeleteFilesPending.bind(this),onCommit:this._onCommit.bind(this),onRollback:this._onDeleteFilesRollback.bind(this)}))switch(e.type){case c.RECEIVE_RAW_RECENT_ACTIVITIES:this._onReceiveRawRecentActivities(e);break;case c.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this._onReceiveRawRelatedActivitiesByKey(e);break;case c.RAW_RELATED_ACTIVITY_PARSE_ERROR:this._onRawRelatedActivityParseError(e)}},t.prototype._onCommit=function(e){delete this._transactionHistory[e.transactionId]},t.prototype._onReceiveRawRecentActivities=function(e){this._didReceiveRecentActivities||e.rawRecentActivities.length||(this._didReceiveRecentActivities=!0,this.__emitChange()),this._didReceiveRecentActivities=!0;var t=r.compact(e.rawRecentActivities.map(this._createRecentItem,this));this._items=this._items.withMutations(function(e){return t.forEach(function(t){var n=e.find(function(e){return e.id!==t.id&&e.contextDisplayName===t.contextDisplayName});if(n){r.intersection(n.attachmentIds.toArray(),t.attachmentIds.toArray()).length>0&&e.delete(n.get("id"))}e.set(t.get("id"),t)})});var n=i.Set(),o=this._items.toList().sort(this._itemComparator);o=o.filter(function(e){if(e.attachmentIds&&e.attachmentIds.size>0){if(e.attachmentIds.every(function(e){return n.has(e)}))return!1;n=n.union(e.attachmentIds)}return!0}),this._items=i.Map(o.map(function(e){return[e.get("id"),e]})),this._loaded=this._loaded.add(e.userId),this._cursors=this._cursors.set(e.userId,e.cursor),this._regenerateAttachmentMap(),this.__emitChange()},t.prototype._onReceiveRawRelatedActivitiesByKey=function(e){var t=this;this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]);var n=r.keys(e.rawRelatedActivitiesByKey),o=i.Set(n).flatMap(function(e){return t._attachmentMap.get(e)});this._items=this._items.withMutations(function(e){o.forEach(function(n){var i=e.get(n);if(i){var r=i.get("attachmentIds");if(r){var o=t._attachmentStore.getById(r.first());if(o&&o.isLoaded){var a=o.fqPath;r.slice(1).forEach(function(e){var n=t._attachmentStore.getById(e);n.isLoaded&&n.fqPath.split("/").length<a.split("/").length&&(a=n.fqPath)});var s=a.split("/"),c=s[s.length-2];c&&e.setIn([n,"contextDisplayName"],c),e.setIn([n,"paths"],d.getPathsByFqPath(a,i.get("viewingUserId")))}}}})}),this.__emitChange()},t.prototype._onRawRelatedActivityParseError=function(e){var t=this;this._items=this._items.withMutations(function(n){for(var r=0,o=e.errors;r<o.length;r++){var a=o[r].activityKey;t._attachmentMap.get(a,i.Set()).forEach(n.delete,n)}}),this.__emitChange()},t.prototype._onDeleteFilesPending=function(e){this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]);var t=this._deleteAttachments(e.attachmentIds);t&&(this._transactionHistory[e.transactionId]=t,this.__emitChange())},t.prototype._onDeleteFilesRollback=function(e){this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]);var t=this._transactionHistory[e.transactionId];m.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),delete this._transactionHistory[e.transactionId],this._rollbackDelete(t),this.__emitChange()},t.prototype._deleteAttachments=function(e){var t=this,n=null;return this._items=this._items.withMutations(function(o){var a=t._attachmentMap.get(e[0],i.Set()).first(),s=o.get(a);if(s){a=s.get("id");var c=r.difference(s.get("attachmentIds").toArray(),e);o.mergeIn([a],{attachmentIds:i.List(c)}),n={deletedAttachmentIds:e,item:o.get(a)},0===c.length&&o.delete(a)}}),n},t.prototype._rollbackDelete=function(e){this._items=this._items.withMutations(function(t){var n=e.item.get("id"),r=t.get(n);r||(r=e.item,r=r.set("attachmentIds",i.List()));var o=r.get("attachmentIds").concat(e.deletedAttachmentIds);r=r.merge({attachmentIds:o}),t.set(n,r)})},t.prototype._createRecentItem=function(e){try{return d.convertRecentActivityToRecentItem(e)}catch(t){r.defer(function(){return a.errorActions.recentActivityParseError(e.activity_key,t)})}return null},t.prototype._regenerateAttachmentMap=function(){var e={};this._items.forEach(function(t){return t.get("attachmentIds").forEach(function(n){var r=e[n];r||(r=i.Set()),e[n]=r.add(t.get("id"))})}),this._attachmentMap=i.Map(e)},t})(o);t.RecentActivityStore=_,t.recentActivityStore=new _(l,u.attachmentStore)}),define("modules/clean/recent_activity/stores/selection_store",["require","exports","tslib","external/immutable","modules/clean/flux/flux_store","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher"],function(e,t,n,i,r,o,a){"use strict";var s=(function(e){function t(t,n,r){void 0===n&&(n=null),void 0===r&&(r=[]);var o=e.call(this,t)||this;return o._selected=i.Set(r),o._recentItemId=n,o}return n.__extends(t,e),t.prototype.getByRecentItemId=function(e){return e===this._recentItemId?this._selected.toArray():[]},t.prototype.__onDispatch=function(e){switch(e.type){case o.SELECT_ATTACHMENTS:this._onReceiveSelectAttachments(e);break;case o.DESELECT_ATTACHMENTS:this._onReceiveDeselectAttachments(e)}},t.prototype._onReceiveSelectAttachments=function(e){this._recentItemId!==e.recentItemId&&(this._recentItemId=e.recentItemId,this._selected=this._selected.clear()),this._selected=this._selected.concat(e.attachmentIds),this.__emitChange()},t.prototype._onReceiveDeselectAttachments=function(e){this._recentItemId!==e.recentItemId&&(this._recentItemId=e.recentItemId,this._selected=this._selected.clear()),this._selected=this._selected.filter(function(t){return e.attachmentIds.indexOf(t)===-1}),this.__emitChange()},t})(r);t.SelectionStore=s,t.selectionStore=new s(a)}),define("modules/clean/recent_activity/transactions",["external/underscore"],function(e){var t,n;return n=function(){},t={onPending:n,onCommit:n,onRollback:n},{createTransaction:function(t,n){var i,r;return r=e.uniqueId(t+"_"),i=function(t){return function(i){return i=e.extend({type:t,transactionId:r},i),n.dispatch(i)}},{pending:i(t+"_PENDING"),commit:i(t+"_COMMIT"),rollback:i(t+"_ROLLBACK")}},handleTransaction:function(n,i,r){switch(r=e.extend(t,r),i.type){case n+"_PENDING":r.onPending(i);break;case n+"_COMMIT":r.onCommit(i);break;case n+"_ROLLBACK":r.onRollback(i);break;default:return!1}return!0}}}),define("modules/clean/recent_activity/versions/recent_activity_version_1",["require","exports","tslib","external/underscore","external/react","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/recent_activity_model","modules/clean/web_timing_logger","modules/clean/recent_activity/recent_activity_prefetch","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/react/recent_activity_blank_slate_view","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/stores/recent_activity_store","modules/core/exception"],function(e,t,n,i,r,o,a,s,c,l,d,u,h,m,p){"use strict";var _=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderStar=function(e,t,n){return null},t.prototype.renderEmptyState=function(e){return r.createElement(u,{ref:"blankslate",filter:e})},t.prototype.getRemoveStoreListeners=function(e){return m.recentActivityStore.addListener(e)},t.prototype.getRecentItems=function(e,t){return m.recentActivityStore.filterItemsForUser(e,t)},t.prototype.didReceiveRecentActivities=function(){return m.recentActivityStore.didReceiveRecentActivities()},t.prototype.isInHome=function(){return!1},t.prototype.isStoreReadyForUserId=function(e,t){var n=m.recentActivityStore.isLoadedForUser(e);return this.didReceiveRecentActivities()&&!t&&(n=!0),n},t.prototype.loadPreFetchedPage=function(e){c.preloadRecentItems(e,!1)},t.prototype.loadPage=function(e){h.loadRecentItems(e)},t.prototype.shareRecentItem=function(e,t,n){var i=e.viewingUserId;if(1===e.attachmentIds.length||1===t.length)o.shareFile(i,t[0].id,n);else{var r=a.extractAttachmentIds(t);o.shareCollection(i,r,n)}},t.prototype.previewOrOpenRecentItem=function(e,t,n,i){n.shouldBrowse?o.browseFile(t[0].entityUri):this.previewRecentItem(e,t,n,i)},t.prototype.previewRecentItem=function(e,t,n,i){o.previewFiles(e.viewingUserId,a.extractAttachmentIds(t),{index:n.index||0,shouldFocusCommentInput:n.shouldFocusCommentInput===!0},i)},t.prototype.deleteRecentItem=function(e,t,n){o.promptAndDeleteAttachments(e.viewingUserId,a.extractAttachmentIds(t),n)},t.prototype.archiveRecentItem=function(e,t){p.reportStack("Archiving is not supported in version 1",{severity:p.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e}})},t.prototype.shouldLoadMore=function(e,t){return!0},t.prototype.handlePathClick=function(e,t,n){},t.prototype.shouldRenderItemActions=function(e){return!0},t.prototype.getShareButtonVisibility=function(e,t){return t?d.RecentElementVisibilities.SHOWN:d.RecentElementVisibilities.DISABLED},t.prototype.maybeInitLoggingAndGetTTILogger=function(){return s.log_js_modules_application_code_start(),i.once(function(){return s.mark_time_to_interactive()})},t})(l.RecentActivityVersion);t.RecentActivityVersion1=new _});
//# sourceMappingURL=pkg-maestro-recents.min.js-vflVYx05p.map