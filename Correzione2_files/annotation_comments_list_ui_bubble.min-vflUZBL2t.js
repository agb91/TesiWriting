define(["jquery","external/classnames","external/react","external/react-dom","modules/clean/activity/activity_user","modules/clean/datetime","modules/clean/keycode","modules/clean/react/file_comments/conversation_or_input_card","modules/clean/comments/components/ui_constants","modules/clean/comments/lib/click_outside","modules/constants/file_viewer"],function(e,t,o,n,i,s,r,a,p,l,u){var c,d,m,y;return i.ActivityUser,r.KeyCode,d=a.ConversationCard,m=p.DEFAULT_ANNOTATION_COMMENT_INPUT_MAX_HEIGHT,c=l.ClickOutside,y=o.DOM,o.createClass({displayName:"AnnotationCommentsListUIBubble",mixins:[o.addons.PureRenderMixin],propTypes:{user:o.PropTypes.object,activity:o.PropTypes.object,x:o.PropTypes.number.isRequired,y:o.PropTypes.number.isRequired,annotation:o.PropTypes.object,commentActivity:o.PropTypes.object,position:o.PropTypes.string,maxHeight:o.PropTypes.number,replyText:o.PropTypes.string,onMouseEnter:o.PropTypes.func,onMouseLeave:o.PropTypes.func,onConversationExpand:o.PropTypes.func,actionCreators:o.PropTypes.object.isRequired,isDemoMode:o.PropTypes.bool},getDefaultProps:function(){return{maxHeight:m,isDemoMode:!1}},getInitialState:function(){return{button_disabled:!0,show_post_button:!1,initial_text:""}},onConversationExpand:function(){var e;return this._scrollToBottom(),"function"==typeof(e=this.props).onConversationExpand?e.onConversationExpand():void 0},onReplyInputBlur:function(){return this.props.actionCreators.updateAnnotationReplyFocused(!1)},onReplyInputFocus:function(){return this.props.actionCreators.updateAnnotationReplyFocused(!0)},_handleOutsideClick:function(e){return this.props.actionCreators.hideAnnotationConversation()},onCancelComment:function(){return this.props.actionCreators.cancelAnnotationComment()},onAddReply:function(e,t){return this.props.actionCreators.addReply({targetActivityKey:t.activity_key,body:{text:e}})},_getReplyCommentInput:function(){var e,t;return null!=(e=this.refs.conversationCard)&&null!=(t=e.refs.threadedCommentActivityUI)?t.refs.commentInput:void 0},_getRawReplyInput:function(){var e;return(null!=(e=this._getReplyCommentInput())?e.getRawCommentInput():void 0)||""},_saveReplyDraft:function(){var e,t,o;return e=this._getRawReplyInput(),o=e.length>0&&e!==(null!=(t=this._getReplyCommentInput())?t.getPlaceholderText():void 0)?e:null,this.props.actionCreators.updateAnnotationReplyText({activityKey:this.props.commentActivity.activity_key,text:o})},_getRevisionDateTime:function(){var e;if(e=this._getRevision(),null!=e.when&&!isNaN(new Date(null!=e.when)))return""+s.ago(new Date(1e3*e.when))},_getRevision:function(){return this.props.commentActivity.comment.comment_metadata.revision},_isOnOldRevision:function(){return!1},_scrollToBottom:function(){var t;return t=n.findDOMNode(this.refs.annotationBubbleField),e(t).animate({scrollTop:t.scrollHeight},{duration:300})},_renderConversation:function(){var e,t;return t={ref:"threadedCommentActivityUI",key:"annotation_bubble_threaded_"+this.props.commentActivity.activity_key,activity:this.props.activity,commentActivity:this.props.commentActivity,user:this.props.user,shouldUseSimpleModals:!1,shouldHidePhotoAvatars:!1,shouldAutoLinkify:!0,shouldShowPostText:u.MAESTRO_ENABLED,onReplyInputFocus:this.onReplyInputFocus,onReplyInputBlur:this.onReplyInputBlur,replyText:this.props.replyText,onCommentExpanded:this.onConversationExpand,isInAnnotationBubble:!0,onCancelComment:this.onCancelComment,onInputChange:this._saveReplyDraft,onAddComment:this.onAddReply},o.createElement(d,{ref:"conversationCard",shouldInitiallyShowNotifyHint:!1,initialUsersToNotify:null!=(e=this.props.commentActivity)?e.users_to_notify:void 0,commentProps:t,actionCreators:this.props.actionCreators,isDemoMode:this.props.isDemoMode})},_renderComments:function(){var e,o;return o={"comments-holder":!0},e={maxHeight:this.props.maxHeight},y.div({className:"annotation-bubble__field",ref:"annotationBubbleField",style:e},this._isOnOldRevision()?y.div({className:"annotation-bubble__field__old-revision"},"On older revision, updated "+this._getRevisionDateTime()):void 0,y.div({className:t(o)},y.div({className:"comment-list"},this._renderConversation())))},render:function(){var e,n,i,s;return s=!0,i=s?25:0,n={"annotation-bubble-container":!0,"annotation-bubble-invisible-border":s},e={left:this.props.x-i},this.props.position.indexOf("bottom")>=0?e.bottom=this.props.y-i:e.top=this.props.y-i,o.createElement(c,{onClickOutside:this._handleOutsideClick},y.div({onMouseOver:this.onMouseOver,onMouseLeave:this.props.onMouseLeave,onMouseEnter:this.props.onMouseEnter,className:t(n),style:e},y.div({className:"annotation-bubble bubble-dropdown "+this.props.position},this._renderComments(),y.div({className:"bubble-arrow-border"}),y.div({className:"bubble-arrow"}))))}})});
//# sourceMappingURL=annotation_comments_list_ui_bubble.min.js-vflb-i60E.map