var bind=function(e,t){return function(){return e.apply(t,arguments)}};define(["jquery","modules/clean/ajax","modules/clean/unity/features","modules/core/browser","modules/core/exception","modules/core/uri"],function(e,t,i,n,r,_){if(null!=i)return(function(){function e(){this._assert_is_initialized=bind(this._assert_is_initialized,this),this._direct_web_destiny=bind(this._direct_web_destiny,this),this.is_direct_allowed=bind(this.is_direct_allowed,this),this.user_display_name=bind(this.user_display_name,this),this.continue_as_user=bind(this.continue_as_user,this),this._cached_web_destiny_info=null}return e.Error={UNITY_CONNECTION_ERROR:"unity_connection_error",REFRESH_TIMEOUT:"refresh_timeout",LOGIN_REQUEST_ERROR:"login_request_error"},e._DESTINY_REFRESH_TOKEN_KEY="web-destiny-refresh-token",e._DESTINY_MANUAL_REFRESH_TIMEOUT=5e3,e._DESTINY_REFRESH_TIMEOUT=1e4,e.finish_indirect_web_destiny=function(e){var t;try{return localStorage.setItem(this._DESTINY_REFRESH_TOKEN_KEY,e),t=localStorage.getItem("web-destiny-redirect-uri"),localStorage.removeItem("web-destiny-redirect-uri"),t?n.redirect(t):n.redirect("/")}catch(e){return n.redirect("/")}},e.prototype.start_connection=function(e,t){if(null==t&&(t=null),null==this._cached_web_destiny_info)return i.web_destiny_info((function(t){return function(i){if(null!=i)return t._cached_web_destiny_info=i,e(i.user_display_name)}})(this),t)},e.prototype.continue_as_user=function(e,t){var i,r;return null==e&&(e=null),null==t&&(t=null),this._assert_is_initialized(),i=function(){return null!=e?n.redirect(e):window.location.reload()},r=function(e){if(null!=t)return t(e)},this._cached_web_destiny_info.is_direct_allowed?this._direct_web_destiny(i,r):this._indirect_web_destiny(i,r)},e.prototype.user_display_name=function(){return this._assert_is_initialized(),this._cached_web_destiny_info.user_display_name},e.prototype.is_direct_allowed=function(){return this._assert_is_initialized(),this._cached_web_destiny_info.is_direct_allowed},e.prototype._indirect_web_destiny=function(t,r){var _,s,o,u;u=null,o=null;try{localStorage.setItem("web-destiny-localStorage-test","true"),u=(new Date).getTime().toString(),s=function(i){if(i.key===e._DESTINY_REFRESH_TOKEN_KEY&&i.newValue===u)return window.clearTimeout(o),t()},null!=window.addEventListener?window.addEventListener("storage",s,!1):window.attachEvent("onstorage",s)}catch(e){}return _=function(){try{return localStorage.setItem("web-destiny-localStorage-test","true"),o=window.setTimeout(function(){return r(e.Error.REFRESH_TIMEOUT)},e._DESTINY_REFRESH_TIMEOUT)}catch(i){return o=window.setTimeout(t,e._DESTINY_MANUAL_REFRESH_TIMEOUT)}},i.continue_as_user(n.browser_name,u,_,function(){return r(e.Error.UNITY_CONNECTION_ERROR)})},e.prototype._direct_web_destiny=function(n,s){var o;return r.assert(this._cached_web_destiny_info.is_direct_allowed,"Direct Web Destiny is not allowed."),o=function(i){var r,o,u;return r={i:(function(){var e;e=[];for(o in i)u=i[o],e.push(o);return e})(),n:(function(){var e;e=[];for(o in i)u=i[o],e.push(u);return e})(),return_json:!0},t.WebRequest({url:_({path:"/desktop_login"}),data:r,success:n,error:function(){return s(e.Error.LOGIN_REQUEST_ERROR)}})},i.continue_as_user_direct(o,function(){return s(e.Error.UNITY_CONNECTION_ERROR)})},e.prototype._assert_is_initialized=function(){return r.assert(null!=this._cached_web_destiny_info,"Method not allowed. WebDestiny was not initialized.")},e})()});
//# sourceMappingURL=web_destiny.min.js-vfl3AgGcl.map