define("modules/clean/ajax_as_promised",["require","exports","modules/clean/ajax"],function(e,t,r){"use strict";function n(e){return function(t){return new Promise(function(r,n){return e(t).then(r,function(e,t,r){return n({jqXHR:e,textStatus:t,errorThrown:r})})})}}t.Request=n(r.Request),t.BackgroundRequest=n(r.BackgroundRequest),t.SilentBackgroundRequest=n(r.SilentBackgroundRequest),t.SilentBackgroundRequestOref=n(r.SilentBackgroundRequestOref),t.WebRequest=n(r.WebRequest),t.WebRequestOref=n(r.WebRequestOref),t.FormWebRequest=n(r.FormWebRequest),t.WebProgressRequest=n(r.WebProgressRequest),t.ValidationSchemaRequest=n(r.ValidationSchemaRequest),t.SilentBackgroundBeaconRequest=n(r.SilentBackgroundBeaconRequest)}),define("modules/clean/events/rollback",["jquery","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/analytics","modules/clean/react/modal","modules/clean/ajax"],function(e,t,r,n,s,a,i,o,l){var c,u,d,p;return d=n._,p=n.ungettext,u=i.SupportExperimentsWebLogger,c={configureAllLinks:function(t,r,n,s,a){return null==n&&(n=null),null==s&&(s=void 0),null==a&&(a=void 0),e(t).on("click",r,function(t){var r,i,l,p,m,_;return null!=n&&u.log_file_restore(n),r=e(t.target),_=r.data("user-id"),l=r.data("ns-id"),i=r.data("cs-id"),p=r.data("redirect"),null==p&&(p=!0),m=s?r.data("sjids"):null,o.SimpleModal.show({title_text:d("Undo this deletion"),body_html:d("Are you sure you want to undo this deletion?"),confirm_text:d("Undo deletion"),confirm_callback:function(){return c.rollback(_,l,i,p,a,m,s)},cancel_text:d("Cancel")}),!1})},createRollbackHandler:function(e,t,n,s){var a,i;return i=p("Restore this file","Restore %(num)d files",s).format({num:s}),a=p("Are you sure you want to restore this file?","Are you sure you want to restore these %(num)d files?",s).format({num:s}),function(s){return s.stopPropagation(),o.SimpleModal.show({title_text:i,body_html:r.escape(a).toHTML(),confirm_text:d("Restore"),confirm_callback:function(){return c.rollback(e,t,n)},cancel_text:d("Cancel")}),!1}},rollback:function(e,r,n,i,o,c,u,p){var m;return null==o&&(o=void 0),null==c&&(c=null),null==u&&(u=!1),null==p&&(p=null),m={},u?(m[r]=c,l.WebProgressRequest({url:"/cmd/restore_sjids",data:{ns_to_sjids:JSON.stringify(m)},subject_user:e,html_in_error_msg:!0,progress_text:d("Restoring files..."),success:function(){if(s.success(d("Finished restoring files.")),"function"==typeof o&&o(),i)return p?t.replace_location(p):t.redirect(a({path:"/browse_cs/"+e+"/"+r+"/"+n}))}})):(m[r]=n,l.WebProgressRequest({url:"/cmd/restore_changesets",data:{ns_to_cs:JSON.stringify(m)},subject_user:e,html_in_error_msg:!0,progress_text:d("Restoring files..."),success:function(){if(s.success(d("Finished restoring files.")),"function"==typeof o&&o(),i)return p?t.replace_location(p):t.redirect(a({path:"/browse_cs/"+e+"/"+r+"/"+n}))}}))}}}),define("modules/clean/react/maestro/filter_view",["external/classnames","external/mcl/dropdown_menu","external/react","modules/clean/react/calendar","modules/clean/react/css","modules/clean/react_logger","modules/core/i18n"],function(e,t,r,n,s,a,i){var o,l,c,u,d,p,m,_,h,f,g;return l=t.DropdownMenu,c=t.DropdownMenuButton,p=t.Menu,m=t.MenuItem,o=n.Calendar,_=a.ReactLogger,h=i._,g=r.DOM,f=r.createElement,u=r.createClass({displayName:"FilterView",propTypes:{className:r.PropTypes.string,namespaces:r.PropTypes.array.isRequired,activeNS:r.PropTypes.number,defaultNS:r.PropTypes.number,onNamespaceChange:r.PropTypes.func,onDateChange:r.PropTypes.func,calendarInitDate:r.PropTypes.object,calendarLastDay:r.PropTypes.object,calendarAlignAtLeft:r.PropTypes.bool,disabled:r.PropTypes.bool},componentWillMount:function(){return _.start(this.constructor.displayName)},componentDidMount:function(){return _.end(this.constructor.displayName)},getDefaultProps:function(){return{calendarAlignAtLeft:!1}},getDefaultNSFilter:function(){return{value:"all",displayValue:h("All events")}},getNSDisplayValue:function(e){var t;return this.props.activeNS?function(){var e,r,n,s;for(n=this.props.namespaces,s=[],e=0,r=n.length;e<r;e++)t=n[e],t.ns_id===this.props.activeNS&&s.push(t.name);return s}.call(this)[0]:this.getDefaultNSFilter().displayValue},renderNamespaceList:function(){var e,t,r;return t=this.getDefaultNSFilter(),r=t.value,e=t.displayValue,f(l,{onSelection:this.props.onNamespaceChange},f(c,{disabled:this.props.disabled},this.getNSDisplayValue()),f(p,{},f(m,{value:r},e),this.props.namespaces.map(function(e){return f(m,{value:e.ns_id,displayValue:e.name,key:e.ns_id},e.name)})))},render:function(){return g.ul({className:e("filter-item-list",this.props.className)},g.li({className:"filter-item"},this.renderNamespaceList()),g.li({className:"filter-item"},f(o,{onDateChange:this.props.onDateChange,initDate:this.props.calendarInitDate,isMaestroDesign:!0,lastDay:this.props.calendarLastDay,alignAtLeft:this.props.calendarAlignAtLeft,disabled:this.props.disabled})))}}),d=s(u,["/static/css/scooter/scooter-scoped-vfl0UVTY2.css","/static/css/dropbox/filter_menu-vflLfv6Ax.css"]),{FilterView:d}}),define("modules/clean/react/trash/actions",["require","exports","tslib","external/underscore","modules/clean/react/trash/api","modules/clean/react/trash/constants","modules/clean/react/trash/selectors","modules/clean/react/trash/utils","modules/constants/ajax_strings","modules/core/notify","modules/core/i18n","modules/clean/js_client_stopwatch","modules/clean/web_timing_logger"],function(e,t,r,n,s,a,i,o,l,c,u,d,p){"use strict";function m(){c.error(l.PROBLEM_COMPLETING_REQUEST)}function _(){var e=this;return d.JSStopwatch.create_stopwatch_if_not_exist("maestro_trash_tracing"),function(t,l){return r.__awaiter(e,void 0,void 0,function(){var e,_,h,f,g,v,E,y,T,S,b,R,M,w,N,A,D,P;return r.__generator(this,function(r){switch(r.label){case 0:if(e=l(),_=e.fetchPhase,h=null,null!=_)return[2];f=e.user_id,g=e.ns_id,v=e.timestamp_ms,E=e.events,y=i.getHomeNsId(e),T=e.ns_id,S=Math.floor(Math.min(g?i.getEventsForNs(E,g).earliest:E.map(function(e){return e.earliest}).max(),v?v/1e3:1/0,Date.now()/1e3)),r.label=1;case 1:return r.trys.push([1,7,8,9]),t({type:a.START_FETCH_PHASE1}),b=s.tryPrefetchDeletions(f).catch(function(){return s.fetchDeletionsForNamespace({userId:f,nsId:T||y,earlierThan:S})}),b.then(function(){d.JSStopwatch.recordTrace("received_initial_events",{stopwatchName:"maestro_trash_tracing"})}),R=s.tryPrefetchNamespaceList(f).catch(function(){return s.fetchNamespaceList(f)}),R.then(function(){d.JSStopwatch.recordTrace("received_namespace_list",{stopwatchName:"maestro_trash_tracing"})}),[4,Promise.all([b,R])];case 2:return M=r.sent(),w=M[0],N=M[1],p.log_js_modules_fetched_data_required_for_tti(),t({type:a.COMPLETE_FETCH_PHASE1,deletionEvents:w,mountedNamespaces:N}),requestAnimationFrame(function(){h=c.info(u._("Loading deleted files..."),9999)}),[4,o.nextRAF()];case 3:return r.sent(),A=N.map(function(e){return e.ns_id}),T&&(A=n.without(A,T),A.push(y)),A.length>0?[4,s.fetchDeletionsForNamespaceMulti({userId:f,nsIds:A,earlierThan:S})]:[3,5];case 4:return D=r.sent(),t({type:a.COMPLETE_FETCH_PHASE2,deletionEvents:D,requestedNsIds:A}),[3,6];case 5:t({type:a.COMPLETE_FETCH_PHASE2,deletionEvents:[],requestedNsIds:[]}),r.label=6;case 6:return[3,9];case 7:throw P=r.sent(),m(),P;case 8:return c.current()&&c.current()===h&&c.clear(),[7];case 9:return[2]}})})}}function h(){var e=this;return function(t,n){return r.__awaiter(e,void 0,void 0,function(){var e,o,l,c,u,d,p,_;return r.__generator(this,function(r){switch(r.label){case 0:if(e=n(),e.isLoadingMore||e.fetchPhase!==a.FetchPhase.PHASE3)return[2];if(o=e.ns_id,l=e.events,o){if(!l.has(o)||l.get(o).done)return[2]}else if(l.every(function(e){return e.done}))return[2];t({type:a.REQUEST_MORE_DATA}),c=e.timestamp_ms,u=Math.floor(Math.min(o?i.getEventsForNs(l,o).earliest:l.filter(function(e){return!e.done}).map(function(e){return e.earliest}).max(),c?c/1e3:1/0,Date.now()/1e3)),d=o?[o]:l.filter(function(e){return!e.done}).keySeq().toArray(),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.fetchDeletionsForNamespaceMulti({userId:e.user_id,nsIds:d,earlierThan:u})];case 2:return p=r.sent(),t({type:a.RECEIVE_MORE_DATA,deletionEvents:p,requestedNsIds:d}),[3,4];case 3:return _=r.sent(),m(),t({type:a.FAIL_REQUESTING_MORE_DATA}),[3,4];case 4:return[2]}})})}}function f(e,t){return{type:a.REMOVE_ROW,ns_id:e,pkey:t}}function g(e){return function(t,r){t({type:a.SET_NAMESPACE,ns_id:e}),t(h())}}function v(e){return{type:a.TRASH_INIT,data:r.__assign({},e)}}function E(e){return{type:a.SET_EVENTS,events:r.__assign({},e)}}function y(){return function(e,t){var r=t().user_id;s.markRestoreFilesTipAsSeen(r),e({type:a.DISMISS_RESTORE_FILES_TIP})}}function T(e){return function(t){t({type:a.SET_TIMESTAMP,timestamp_ms:e}),t(h())}}t.initiateFetchPhases=_,t.loadMore=h,t.removeRow=f,t.setNamespace=g,t.initialize=v,t.setEvents=E,t.dismissRestoreFilesTip=y,t.setTimestampMs=T}),define("modules/clean/react/trash/api",["require","exports","tslib","modules/clean/ajax_as_promised","modules/clean/analytics"],function(e,t,r,n,s){"use strict";function a(e,t,n){return void 0===n&&(n={}),function(a){"abort"!==a.jqXHR.statusText&&s.WebMiscActivityLogger.log(t,r.__assign({},n,{is_prefetch:!1}),e)}}function i(e,t,n){return void 0===n&&(n={}),function(){return s.WebMiscActivityLogger.log(t,r.__assign({},n,{is_prefetch:!0}),e)}}function o(e){var t=window.__REGISTER_TRASH_PRELOAD_HANDLER;if(t){var r=new Promise(function(e,r){t(function(t){e(t.events)},r)});return r.catch(i(e,"trash-fetch-deletions-failure",{requested_ns_count:1})),r}return Promise.reject(null)}function l(e,t){return t.namespaces.map(function(t){return{name:t.name,user_id:e,ns_id:t.nsId}})}function c(e){var t=window.__REGISTER_TRASH_NS_LIST_PRELOAD_HANDLER;if(t){var r=new Promise(function(r,n){t(function(t){r(l(e,t))},n)});return r.catch(i(e,"trash-fetch-ns-list-failure")),r}return Promise.reject(null)}function u(e){var t=n.BackgroundRequest({type:"GET",url:"/trash/namespace_list",subject_user:e,dataType:"json"});return t.catch(a(e,"trash-fetch-ns-list-failure")),t.then(function(t){return l(e,t)})}function d(e){return p({userId:e.userId,nsIds:[e.nsId],earlierThan:e.earlierThan})}function p(e){var t={ns_ids:e.nsIds.join(","),timestamp:e.earlierThan},r=n.BackgroundRequest({type:"POST",url:"/deleted_files_with_mixed_cs/ajax",subject_user:e.userId,dataType:"json",data:t});return r.catch(a(e.userId,"trash-fetch-deletions-failure",{requested_ns_count:e.nsIds.length})),r.then(function(e){return e.events})}function m(e){return n.SilentBackgroundRequest({url:"/trash/seen_restore_files_tip",subject_user:e})}t.tryPrefetchDeletions=o,t.tryPrefetchNamespaceList=c,t.fetchNamespaceList=u,t.fetchDeletionsForNamespace=d,t.fetchDeletionsForNamespaceMulti=p,t.markRestoreFilesTipAsSeen=m}),define("modules/clean/react/trash/constants",["require","exports"],function(e,t){"use strict";t.ONE_DAY_MS=864e5;(function(e){e[e.PHASE1=1]="PHASE1",e[e.PHASE2=2]="PHASE2",e[e.PHASE3=3]="PHASE3"})(t.FetchPhase||(t.FetchPhase={})),t.START_FETCH_PHASE1="START_FETCH_PHASE1",t.COMPLETE_FETCH_PHASE1="COMPLETE_FETCH_PHASE1",t.COMPLETE_FETCH_PHASE2="COMPLETE_FETCH_PHASE2",t.REQUEST_MORE_DATA="REQUEST_MORE_DATA",t.RECEIVE_MORE_DATA="RECEIVE_MORE_DATA",t.FAIL_REQUESTING_MORE_DATA="FAIL_REQUESTING_MORE_DATA",t.SET_NAMESPACE="SET_NAMESPACE",t.SET_TIMESTAMP="SET_TIMESTAMP",t.SET_EVENTS="SET_EVENTS",t.TRASH_INIT="TRASH_INIT",t.REMOVE_ROW="REMOVE_ROW",t.DISMISS_RESTORE_FILES_TIP="DISMISS_RESTORE_FILES_TIP"}),define("modules/clean/react/trash/reducer",["require","exports","tslib","external/underscore","external/immutable","external/react","modules/clean/react/trash/constants"],function(e,t,r,n,s,a,i){"use strict";function o(e,t,r){if(0===t.length&&0===r.length)return e;var s=n.groupBy(t,"ns_id");return e.withMutations(function(e){n.each(s,function(t,r){var n=parseInt(r,10);if(e.has(n)){var s=e.get(n);t=t.filter(function(e){return e.timestamp<s.earliest});var a=s.events.concat(t);e.set(n,{earliest:Math.min.apply(Math,a.map(function(e){return e.timestamp})),events:a,done:!1})}else e.set(n,{earliest:Math.min.apply(Math,t.map(function(e){return e.timestamp})),events:t,done:!1})});for(var t=0,a=r;t<a.length;t++){var i=a[t];if(!s.hasOwnProperty(String(i))){var o=e.get(i);o&&(o.done=!0)}}return e})}function l(e,t,n){return r.__assign({},e,{events:o(s.Map(),t,[e.root_ns_ids[e.user_id]]),namespaces:s.List(n),fetchPhase:i.FetchPhase.PHASE2})}function c(e,t,n){return r.__assign({},e,{events:o(e.events,t,n),fetchPhase:i.FetchPhase.PHASE3})}function u(e,t,n){return r.__assign({},e,{events:o(e.events,t,n),isLoadingMore:!1})}function d(e){return{earliest:Number.MAX_VALUE,events:[],done:!1}}function p(e){var t=s.Map().withMutations(function(t){e.namespaces.forEach(function(r){r.user_id===e.user_id&&t.set(r.ns_id,d(r.ns_id))});var r=e.root_ns_ids[e.user_id];t.set(r,d(r))});return r.__assign({},e,{events:t})}function m(e){var t=e.ns_id,r=null!=t?e.events.get(t):null;return r?[r]:e.events.toArray()}function _(e){return Math.max.apply(Math,m(e).map(function(e){return e.earliest}))}function h(e,t){var n=1e3*_(e),s=r.__assign({},e,{timestamp_ms:t});return(n<0||t<n||t>e.latest_ms)&&(s=p(r.__assign({},s,{latest_ms:t}))),s}function f(e,t,s){var a=e.events,i=a.get(t),o=i?n.findIndex(i.events,function(e){return e.pkey===s}):-1;return o!==-1&&(a=a.update(t,function(e){return E(e,{events:{$splice:[[o,1]]}})})),r.__assign({},e,{events:a})}function g(e,t){return p(r.__assign({},e,{user_id:t.user_id,namespaces:s.List(t.ns_entries),root_ns_ids:t.root_ns_ids,timestamp_ms:t.date,latest_ms:t.date,ns_id:t.active_ns_id,seenRestoreFilesTip:t.seenRestoreFilesTip}))}function v(e,t){switch(t.type){case i.START_FETCH_PHASE1:return r.__assign({},e,{fetchPhase:i.FetchPhase.PHASE1});case i.COMPLETE_FETCH_PHASE1:return l(e,t.deletionEvents,t.mountedNamespaces);case i.COMPLETE_FETCH_PHASE2:return c(e,t.deletionEvents,t.requestedNsIds);case i.REQUEST_MORE_DATA:return r.__assign({},e,{isLoadingMore:!0});case i.RECEIVE_MORE_DATA:return u(e,t.deletionEvents,t.requestedNsIds);case i.FAIL_REQUESTING_MORE_DATA:return r.__assign({},e,{isLoadingMore:!1});case i.SET_NAMESPACE:return r.__assign({},e,{ns_id:t.ns_id});case i.SET_TIMESTAMP:return h(e,t.timestamp_ms);case i.SET_EVENTS:return r.__assign({},e,{events:t.events});case i.TRASH_INIT:return g(e,t.data);case i.REMOVE_ROW:return f(e,t.ns_id,t.pkey);case i.DISMISS_RESTORE_FILES_TIP:return r.__assign({},e,{seenRestoreFilesTip:!0});default:return e}}var E=a.addons.update;t.reducer=v}),define("modules/clean/react/trash/selectors",["require","exports","modules/clean/react/trash/constants"],function(e,t,r){"use strict";function n(e,t){return null==t?l:e.get(t,l)}function s(e){var t=e.ns_id,r=e.timestamp_ms,s=e.events;return Math.min(t?n(s,t).earliest:s.map(function(e){return e.earliest}).max(),r?r/1e3:1/0,Math.floor(Date.now()/1e3))}function a(e){return e.root_ns_ids[e.user_id]}function i(e){return e.fetchPhase!==r.FetchPhase.PHASE3||e.isLoadingMore}function o(e){var t=e.fetchPhase;return null===t||t===r.FetchPhase.PHASE1}var l=Object.freeze({earliest:+(1/0),events:Object.freeze([]),done:!0});t.getEventsForNs=n,t.earliestTimestampInSecs=s,t.getHomeNsId=a,t.isLoading=i,t.shouldDisableFilterView=o}),define("modules/clean/react/trash/store",["require","exports","external/immutable","external/redux","external/redux-thunk","modules/clean/react/trash/reducer"],function(e,t,r,n,s,a){"use strict";var i=n.compose,o=n.createStore(a.reducer,{user_id:0,ns_id:void 0,root_ns_ids:{},events:r.Map(),namespaces:r.List(),latest_ms:Number.MAX_VALUE,timestamp_ms:null,fetchPhase:null,isLoadingMore:!1,seenRestoreFilesTip:!1},i(n.applyMiddleware(s)));t.TrashStore=o}),define("modules/clean/react/trash/trash",["require","exports","tslib","external/mcl/scroll_monitor","external/react","external/react-redux","external/underscore","modules/clean/history","modules/clean/pagelet_logger","modules/clean/react/trash/actions","modules/clean/react/trash/constants","modules/clean/react/trash/selectors","modules/clean/react/trash/store","modules/clean/react/trash/trash_view","modules/clean/react/trash/utils","modules/clean/react_logger","modules/clean/viewer","modules/clean/web_timing_logger"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,m,_,h,f,g){"use strict";function v(e){var t,r=e.ns_id;return t=r?[d.getEventsForNs(e.events,r)]:e.events.toList().toJS(),{namespaces:e.namespaces,root_ns_ids:e.root_ns_ids,active_ns_id:e.ns_id,loading:d.isLoading(e),timestamp_ms:e.timestamp_ms,seenRestoreFilesTip:e.seenRestoreFilesTip,filterViewDisabled:d.shouldDisableFilterView(e),valid_nss:t}}var E=Date.now(),y=(function(e){function t(t){var r=e.call(this,"Trash",t)||this;return r.pageletLogger=new l.PageletLogger("trash",["TrashView"]),r._currentFromBottom=null,r.state={user:f.get_viewer().get_user_by_id(r.props.user_id)},r.handleComponentReady=function(e){r.pageletLogger.componentReady(e)},r.handleDateChange=function(e){var t=Number(e);r.props.dispatch(c.setTimestampMs(t))},r.handleRestoreFilesTipDismiss=function(){r.props.dispatch(c.dismissRestoreFilesTip())},r.handleScroll=function(e){var t=e.fromBottom;r._currentFromBottom=t,r.loadMoreIfNearBottom()},r.removeRow=function(e,t){r.props.dispatch(c.removeRow(e,t))},r.updateNSFilter=function(e){var t="all"===e?null:e;r.props.dispatch(c.setNamespace(t))},r}return r.__extends(t,e),t.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this),g.log_js_modules_application_code_start()},t.prototype.componentDidMount=function(){e.prototype.componentDidMount.call(this),this.props.dispatch(c.initiateFetchPhases())},t.prototype.componentDidUpdate=function(){this.setUrl()},t.prototype.setUrl=function(){if(this.props.timestamp_ms){var e=new Date(this.props.timestamp_ms),t=E-(this.props.timestamp_ms+u.ONE_DAY_MS)>0,r={};this.props.active_ns_id&&(r.ns=String(this.props.active_ns_id)),t&&(r.date=e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear()),o.push_state("/deleted_files",r)}},t.prototype.getFilteredEvents=function(){var e=this;return i(i(i(this.props.valid_nss.map(function(e){return e.events})).flatten()).sortBy(function(e){return-e.timestamp})).filter(function(t){return t.timestamp>=-(1/0)&&t.timestamp<(e.props.timestamp_ms+u.ONE_DAY_MS)/1e3&&!(e.props.active_ns_id&&t.is_dup)})},t.prototype.getFilteredNamespaces=function(){var e=this;return this.props.namespaces.filter(function(t){return t.user_id===e.props.user_id})},t.prototype.loadMoreIfNearBottom=function(){null!==this._currentFromBottom&&this._currentFromBottom>=0&&this._currentFromBottom<=400&&this.props.dispatch(c.loadMore())},t.prototype.render=function(){return s.createElement("div",null,s.createElement(m.TrashView,{user:this.state.user,viewer:f.get_viewer(),onDateChange:this.handleDateChange,calendarInitDate:new Date(this.props.initial_timestamp),calendarLastDay:new Date,activeNS:this.props.active_ns_id,defaultNS:this.props.initial_active_ns_id,events:this.getFilteredEvents(),namespaces:this.getFilteredNamespaces(),onNamespaceChange:this.updateNSFilter,onRemoveRow:this.removeRow,loading:this.props.loading,expBizUpsellUserType:this.props.exp_biz_upsell_user_type,handleComponentReady:this.handleComponentReady,seenRestoreFilesTip:this.props.seenRestoreFilesTip,onRestoreFilesTipDismiss:this.handleRestoreFilesTipDismiss,filterViewDisabled:this.props.filterViewDisabled}),s.createElement(n.ScrollMonitor,{onScroll:this.handleScroll}))},t})(h.ReactLogger),T=a.connect(v)(y),S=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentWillMount=function(){p.TrashStore.dispatch(c.initialize({date:this.getInitialTimestamp(),user_id:this.props.user_id,ns_entries:this.props.namespaces,root_ns_ids:this.props.root_ns_ids,active_ns_id:this.props.initial_active_ns_id,seenRestoreFilesTip:this.props.seenRestoreFilesTip}))},t.prototype.getInitialTimestamp=function(){var e=this.props.date_str;return e?_.parseDateFromString(e)||Date.now():Date.now()},t.prototype.render=function(){var e=this.props,t=e.initial_active_ns_id,r=e.exp_subgrowth_biz_deleted_files_upsell_user_type,n=e.user_id,i=this.getInitialTimestamp();return s.createElement(a.Provider,{store:p.TrashStore},s.createElement(T,{exp_biz_upsell_user_type:r,initial_active_ns_id:t,initial_timestamp:i,user_id:n}))},t})(s.Component);t.Trash=S}),define("modules/clean/react/trash/trash_view",["require","exports","tslib","external/classnames","external/mcl/media_table","external/mcl/table","external/mcl/tip_card","external/mcl/vertically_fixed","external/react","modules/clean/analytics","modules/clean/react/file_icon_view","modules/clean/react/file_path_breadcrumb","modules/clean/react/maestro/filter_view","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/react/modal","modules/clean/react_format","modules/clean/react_logger","modules/clean/static_urls","modules/clean/trash/trash_modal","modules/constants/python","modules/core/i18n"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,m,_,h,f,g,v,E,y,T){"use strict";var S=(function(e){function t(t){var r=e.call(this,"TrashView",t)||this;return r.state={scrollPosition:0},r.removeRowByPkey=function(e,t){r.props.onRemoveRow(e,t)},r.purgeCallback=function(e,t,n){c.WebMiscActivityLogger.log("trash-purge",{source:n,with_mixed_cs:!0}),r.removeRowByPkey(e,t)},r.launchModal=function(e,t,n){c.WebMiscActivityLogger.log("trash-modal-launch",{type:t}),h.Modal.showInstance(l.createElement(E.TrashModal,{event:n,restoreCallback:function(){return r.rollbackCallback("modal")},purgeCallback:function(){return r.purgeCallback(n.ns_id,e,"modal")},type:t,userId:r.props.user.id}))},r.updateOnScroll=function(){var e=window.pageYOffset;if(Math.abs(e-r.state.scrollPosition)>r.props.listItemHeight)return r.setState({scrollPosition:e})},r.renderTrashRow=function(e,t,a){var i=e.is_folder,o=e.file_count>1&&!i,c=i||o,u=c?"group":"single";return l.createElement(s.CulledMediaRow,{key:e.pkey,doubleLine:!0,className:n("mc-table-row-culled",{"trash-group-item":!!c}),onClick:function(){return r.launchModal(e.pkey,u,e)},topOffset:a},function(t){var n=t.isHovered;return[l.createElement(s.MediaCell,{key:"event_title",highlight:n,icon:r.renderEventIcon(e,o),title:e.file_name,subtitle:r.renderDeletionPath(e.src_path)}),l.createElement(s.MediaCell,{key:"event_meta",title:e.ago,subtitle:e.name?T._("by %(event_name)s").format({event_name:e.name}):void 0,variant:"detail"})]})},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){e.prototype.componentDidMount.call(this),window.addEventListener("scroll",this.updateOnScroll),this.updateOnScroll()},t.prototype.componentWillUnmount=function(){window.removeEventListener("scroll",this.updateOnScroll)},t.prototype.rollbackCallback=function(e){c.WebMiscActivityLogger.log("trash-restore",{source:e,with_mixed_cs:!0})},t.prototype.renderDeletionPath=function(e){if(e){for(var t=[{name:"Dropbox",url:""}],r=0,n=e.split("/");r<n.length;r++){var s=n[r];t.push({name:s,url:""})}return l.createElement("span",{className:"deletion-path"},l.createElement(d,{paths:t,viewingUserId:this.props.user.id,useLinks:!1,pathClassname:"deletion-path__item",maxWidth:25}))}},t.prototype.renderEventIcon=function(e,t){return l.createElement("div",{className:n({"trash-row-icon-stacked":t})},l.createElement(u,{icon:e.icon}),t?l.createElement(u,{icon:e.icon}):void 0)},t.prototype.renderTrashContent=function(){return l.createElement(a.Table,{columnFlex:[3,2],key:"trash-content"},l.createElement(a.FixedTableHead,null,l.createElement(a.TableHeadCell,null,T._("Name")),l.createElement(a.TableHeadCell,null,T._("Deleted"))),l.createElement(a.CulledTableBody,{items:this.props.events,listItemHeight:this.props.listItemHeight,renderRow:this.renderTrashRow}))},t.prototype.maybeRenderEVHUpsellBanner=function(){var e=this.props.user,t=l.createElement("div",{className:"trash-evh-upsell-banner",key:"evhupsell"},l.createElement("span",null,T._("Deleted files are stored up to 30 days. Want 120 days of file recovery?")),l.createElement("br",null),T._("Keep your files safe and secure when you "),l.createElement("a",{href:"/plans",target:"_blank",rel:"noopener noreferrer"},T._("upgrade to %(trademark_business)s").format({trademark_business:y.TRADEMARK_BUSINESS})),"."),r=l.createElement("div",{className:"trash-evh-upsell-banner",key:"evhupsell"},l.createElement("span",null,T._("Deleted files are stored up to 30 days. Want to start keeping them for a year?"),l.createElement("br",null),T._("Choose Extended Version History when you "),l.createElement("a",{href:"/plans",target:"_blank",rel:"noopener noreferrer"},T._("upgrade to Dropbox %(trademark_plus)s").format({trademark_plus:y.TRADEMARK_PLUS})),"."));if(!e.is_team){if(!e.paid)return"basic_biz_domain"===this.props.expBizUpsellUserType?t:r;if("pro_biz_domain_can_have_evh"===this.props.expBizUpsellUserType)return t}return null},t.prototype.renderNoTrash=function(){var e=v.static_url("/static/images/empty_states/trash-vflgo8AWd.png");return l.createElement("div",{className:"tab-empty-state",id:"trash-empty-state",key:"notrash"},l.createElement("img",{src:e,alt:""}),l.createElement("div",{className:"empty-explanation"},l.createElement("div",{className:"page-header-text"},T._("You donâ€™t have any recently deleted files")),this.maybeRenderEVHUpsellBanner()))},t.prototype.renderFetchingTrash=function(){return l.createElement("div",{className:"maestro-loading-spinner-wrapper",key:"fetchingtrash"},l.createElement("div",{className:"maestro-loading-spinner"}))},t.prototype.renderFetchingMore=function(){return l.createElement("div",{className:"maestro-loading-spinner-more-data",key:"fetchingmore"},l.createElement("div",{className:"maestro-loading-spinner"}))},t.prototype.renderRestoreFilesTip=function(){return l.createElement("div",{className:"trash-restore-files-tip__shadow",key:"trash-restore-files-tip"},l.createElement(o.VerticallyFixed,{className:"trash-restore-files-tip"},l.createElement(i.TipCard,{onDismiss:this.props.onRestoreFilesTipDismiss,dismissAriaLabel:T._("dismiss")},f.reactFormat(T._("Need help restoring deleted files? <a>Learn more</a>",{project:"maestro"}),{a:l.createElement("a",{href:"/help/9217"})}))))},t.prototype.renderBody=function(){var e=[];return this.props.seenRestoreFilesTip||e.push(this.renderRestoreFilesTip()),this.props.events.length>0?(e.push(this.renderTrashContent()),this.props.handleComponentReady("TrashView"),this.props.loading?e.push(this.renderFetchingMore()):e.push(this.maybeRenderEVHUpsellBanner())):this.props.loading?e.push(this.renderFetchingTrash()):(e.push(this.renderNoTrash()),this.props.handleComponentReady("TrashView")),l.createElement("div",{className:"trash-body"},e)},t.prototype.renderFilterView=function(){return l.createElement(p.FilterView,{className:"trash-filter-view",namespaces:this.props.namespaces.toJS(),activeNS:this.props.activeNS,defaultNS:this.props.defaultNS,onNamespaceChange:this.props.onNamespaceChange,onDateChange:this.props.onDateChange,calendarInitDate:this.props.calendarInitDate,calendarLastDay:this.props.calendarLastDay,calendarAlignAtLeft:!1,disabled:this.props.filterViewDisabled})},t.prototype.render=function(){var e=this.props,t=e.user,r=e.viewer;return l.createElement(_.MaestroChrome,{user:t,viewer:r,titleRegion:l.createElement(m.MaestroHeaderTitle,null,T._("Deleted files")),embeddedAppRegion:this.renderBody(),actionSidebarRegion:this.renderFilterView()})},t})(g.ReactLogger);S.defaultProps={filterViewDisabled:!1,listItemHeight:72,loading:!1,seenRestoreFilesTip:!1,handleComponentReady:function(e){return null}},t.TrashView=S}),define("modules/clean/react/trash/utils",["require","exports","tslib"],function(e,t,r){"use strict";function n(e){var t=e.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(null==t)return null;var r=t[1],n=t[2],s=t[3];1===r.length&&(r="0"+r),1===n.length&&(n="0"+n);var a=Date.parse(s+"-"+n+"-"+r);return isNaN(a)?null:Number(new Date(Number(s),Number(n)-1,Number(r)))}function s(){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(e){return[2,new Promise(function(e){requestAnimationFrame(function(){return e()})})]})})}t.parseDateFromString=n,t.nextRAF=s}),define("modules/clean/trash/trash_modal",["require","exports","tslib","external/react","external/underscore","modules/clean/ajax","modules/clean/components/loading_indicator","modules/clean/em_string","modules/clean/events/rollback","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react_logger","modules/clean/static_urls","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,m,_,h,f){"use strict";function g(e){return p.static_url("/static/images/icons128/%(icon)s.png".format({icon:e.slice(0,-8)}))}t.SingleModalItem=function(e){return n.createElement("div",{className:"modal-item-row"},n.createElement("div",{className:"modal-item-icon lfloat"},n.createElement(u,{group:"web",name:e.icon,alt:""})),n.createElement("div",{className:"modal-item-name lfloat"},e.name),n.createElement("div",{className:"modal-item-size rfloat"},e.size))},t.SingleModalView=function(e){var t=g(e.icon);return n.createElement("div",{id:"modal-single-container"},n.createElement("div",null,n.createElement("img",{id:"modal-single-icon",src:t,alt:""}),n.createElement("div",{id:"modal-single-name"},o.em_snippet(e.text,34)),n.createElement("div",{id:"modal-single-path"},o.em_snippet(e.src_path,34,0)),n.createElement("div",{id:"modal-single-size"},e.size),n.createElement("div",{id:"modal-single-time"},e.deletionString||"")))};var v=(function(e){function s(){var t=null!==e&&e.apply(this,arguments)||this;return t.TableHeader=function(){return n.createElement("div",{id:"modal-table-header"},n.createElement("div",{id:"modal-path",className:"lfloat"},o.em_snippet(t.props.srcPath,13,0)),n.createElement("div",{id:"modal-timestamp",className:"rfloat"},t.props.deletionString))},t}return r.__extends(s,e),s.prototype.renderEmptyState=function(){return n.createElement("div",{id:"modal-empty-state"},n.createElement("h3",null,_._("This folder is empty")))},s.prototype.renderPreviewUnavailable=function(){return n.createElement("div",{id:"modal-empty-state"},n.createElement("h3",null,_._("Preview not available")))},s.prototype.renderTableContents=function(){var e=this.props,t=e.canDisplayContent,r=e.items;return t?0===r.length?this.renderEmptyState():1===r.length?this.renderSingleModalView(r[0]):this.renderListView():this.renderPreviewUnavailable()},s.prototype.renderSingleModalView=function(e){return n.createElement(t.SingleModalView,{icon:e.icon,text:e.name,src_path:e.src_path,size:e.size})},s.prototype.renderListView=function(){var e=this;return n.createElement("div",null,this.props.items.map(function(t){return e.createSingleModalItem(t)}))},s.prototype.createSingleModalItem=function(e){return n.createElement(t.SingleModalItem,{icon:e.icon,key:e.name,name:o.em_snippet(e.name,35),size:e.size})},s.prototype.render=function(){return n.createElement("div",null,n.createElement(this.TableHeader,null),n.createElement("div",{id:"modal-table-contents"},this.renderTableContents()))},s})(n.Component);t.GroupModalView=v;var E=(function(e){function u(t){var r=e.call(this,"TrashModal",t)||this;return r.state={items:[],inFlight:!0,error:!1,canDisplayContent:!0},r.ajaxRequest=null,r.handleFetchEventDetailsSuccess=function(e){var t=!0;if("group"===r.props.type){t=!(1===e.length&&!e[0].can_display_content),e=e.filter(function(e){return!(e.src_path===r.props.event.src_path&&e.name===r.props.event.file_name)});var n=r.props.event.file_count;if(n>100){var s=void 0;if(r.props.event.cs_info.can_rollback){var a=r.props.event.file_count-100;s=_.ungettext("And %(num)d more file.","And %(num)d more files.",a).format({num:a})}else s=_._("To view or restore all %(file_count)d files, visit Event Details page.").format({file_count:n});e.push({can_display_content:!0,icon:"",name:s,size:"",src_path:""})}}r.setState({inFlight:!1,canDisplayContent:t,items:e})},
r.handleFetchEventDetailsError=function(e){r.userAborted(e)||r.setState({inFlight:!1,error:!0})},r.redirectToEventDetails=function(){var e=r.props,t=e.event,n=e.userId,s=new f({path:"/event_details/"+n+"/"+t.ns_id+"/"+t.cs_info.cs_id+"/0"});m.redirect(s.toString())},r.restoreFiles=function(){var e=r.props.event;l.rollback(r.props.userId,e.ns_id,e.cs_info.cs_id,!0,r.props.restoreCallback,e.cs_info.sj_ids,!0,e.browse_uri)},r.redirectToUpgrade=function(){var e=new f({path:"/pro/buy",query:{oqa:"rf"}});m.redirect(e.toString())},r.purgeFiles=function(){var e=r.props,t=e.event,n=e.userId,s=(i={},i[t.ns_id]=t.cs_info.sj_ids,i);a.WebProgressRequest({url:"/cmd/purge_sjids",data:{ns_to_sjids:JSON.stringify(s)},subject_user:n,progress_text:_._("Deleting files permanently..."),success:function(){h.success(_._("Finished deleting files.")),r.props.purgeCallback()}});var i},r.confirmPurge=function(){var e=r.props.event,t=e.file_count,n=_.ungettext("Permanently delete %(num)d file?","Permanently delete %(num)d files?",t).format({num:t});c.SimpleModal.show({title_text:n,body_html:_._("Are you sure you want to delete <strong>%(filename)s</strong> from your Dropbox permanently?").format({filename:s.escape(e.file_name)}),confirm_text:_._("Delete permanently"),confirm_callback:r.purgeFiles,cancel_text:_._("Cancel")})},r}return r.__extends(u,e),u.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this),this.fetchEventDetails()},u.prototype.componentWillUnmount=function(){this.ajaxRequest&&this.ajaxRequest.abort()},u.prototype.fetchEventDetails=function(){var e=this.props,t=e.event,r=e.userId,n={user_id:r,ns_id:t.ns_id,sjids:t.cs_info.sj_ids.join(","),page:0};this.ajaxRequest=a.WebRequest({url:"/trash_details/ajax",type:"POST",data:n,dataType:"json",success:this.handleFetchEventDetailsSuccess,error:this.handleFetchEventDetailsError})},u.prototype.userAborted=function(e){return!e.getAllResponseHeaders()},u.prototype.getDeletionTimeString=function(){var e=this.props.event,t={deletor:"",ago:e.ago};if(e.name){var r="single"===this.props.type?25:15;return t.deletor=o.em_snippet(e.name,r),_._("%(deletor)s deleted %(ago)s").format(t)}return _._("You deleted %(ago)s").format(t)},u.prototype.renderError=function(){return n.createElement("div",{id:"modal-error-state"},n.createElement("h3",null,_._("Oops! An error occurred. Please try again later!")))},u.prototype.renderLoader=function(){return n.createElement("div",{id:"modal-loading"},n.createElement(i,{style:i.LoadingIndicatorStyle.BLUE_SPINNER}))},u.prototype.renderSingleModal=function(){var e=this.state.items;if(e.length)return n.createElement(t.SingleModalView,{icon:e[0].icon,text:this.props.event.file_name,src_path:this.props.event.src_path,size:e[0].size,deletionString:this.getDeletionTimeString()})},u.prototype.renderGroupModal=function(){return n.createElement(v,{items:this.state.items,srcPath:this.props.event.src_path,deletionString:this.getDeletionTimeString(),canDisplayContent:this.state.canDisplayContent})},u.prototype.renderModalContainerContents=function(){return this.state.inFlight?this.renderLoader():this.state.error?this.renderError():"single"===this.props.type?this.renderSingleModal():this.renderGroupModal()},u.prototype.render=function(){var e=this.props.event,t=e.cs_info,r=t.can_purge,s=t.can_rollback,a=_._("Go to Event Details"),i="secondary",l=this.redirectToEventDetails;if(s){a="group"===this.props.type&&this.state.items.length>1?_._("Restore all files"):_._("Restore"),"V1"===this.props.expOQProUpsellVariant&&(a=_._("Upgrade to Restore")),i="primary",l="V1"===this.props.expOQProUpsellVariant?this.redirectToUpgrade:this.restoreFiles}var u=n.createElement("div",{id:"modal-table-container"},this.renderModalContainerContents());if(s&&r){var d=_._("Delete permanently"),p=this.confirmPurge;return n.createElement(c.Modal,{title:o.em_snippet(_._("%(text)s").format({text:e.file_name}),30),buttonComponent:n.createElement("div",{className:"db-modal-buttons"},n.createElement("button",{className:"dbmodal-button button-secondary",style:{color:"red",borderColor:"red",backgroundColor:"white"},onClick:p},d),n.createElement("button",{className:"dbmodal-button button-primary",onClick:function(e){c.Modal.close(e.target),l()}},a)),setMaxHeight:!0},u)}return n.createElement(c.Modal,{title:o.em_snippet(_._("%(text)s").format({text:e.file_name}),30),acceptButtonText:a,dismissButtonText:_._("Cancel"),acceptButtonImportance:i,onAccept:l,setMaxHeight:!0},u)},u})(d.ReactLogger);E.defaultProps={restoreCallback:s.noop,purgeCallback:s.noop,type:"group"},t.TrashModal=E});
//# sourceMappingURL=pkg-maestro-deleted_files.min.js-vfl33Gg5m.map